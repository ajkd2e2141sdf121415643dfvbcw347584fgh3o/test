-- AUTO-GENERATED COMPRESSED ROBLOX SCRIPT
-- Fixed Version - Compatible with all Roblox versions
-- สร้างโดย: Roblox Compression Pipeline v2

local SgcCQqZOZevS = '7gfuRF9AMkPnTBi'
local rCedVxKcpodr = 'sfIhkYYbnEfTGE0'
local ciGwKiyIRwih = 'cuTvM2xrp1U8sJ0'
local jeuJTiwyBgiC = '1msCdUlobvsxFI7'
local apnvRXUtjxXs = 'LS1CbG94RnJ1aXQgV29ybGQzCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBXb3Jrc3BhY2UgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIFR3ZWVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIikKbG9jYWwgVmlydHVhbElucHV0TWFuYWdlciA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpCmxvY2FsIEd1aVNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkd1aVNlcnZpY2UiKQpsb2NhbCBWaXJ0dWFsVXNlciA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgUGxheWVyR3VpID0gTG9jYWxQbGF5ZXIuUGxheWVyR3VpCmxvY2FsIHR3ZWVuID0gZ2FtZTpzZXJ2aWNlIlR3ZWVuU2VydmljZSIKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCmxvY2FsIE1vdXNlID0gTG9jYWxQbGF5ZXI6R2V0TW91c2UoKQpsb2NhbCBfRyA9IF9HIG9yIGdldGdlbnYoKQpyZXBlYXQgd2FpdCgwKSB1bnRpbCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgaWQgPSBnYW1lLlBsYWNlSWQgaWYgaWQgPT0gNzQ0OTQyMzYzNSB0aGVuIFdvcmxkMyA9IHRydWU7IGVsc2UgZ2FtZTpTaHV0ZG93bigpIGVuZDsgCgpyZXBlYXQgd2FpdCgpIHVudGlsIGdhbWU6SXNMb2FkZWQoKSAKX0cuU2V0dGluZ3MgPSB7CiAgICBBdXRvRmFybSA9IGZhbHNlLAogICAgTmVhcmVhc3RGYXJtID0gZmFsc2UsCiAgICBBdXRvTmV3V29ybGQgPSBmYWxzZSwKICAgIEF1dG9TYWJlciA9IGZhbHNlLAogICAgQXV0b1BvbGUgPSBmYWxzZSwKICAgIFRlbGVwb3J0SXNsYW5kID0gZmFsc2UsCgotLVtXb3JsZCAyXQogICAgQXV0b1RoaXJkU2VhID0gZmFsc2UsCiAgICBBdXRvQmFydGlsb1F1ZXN0ID0gZmFsc2UsCiAgICBBdXRvX0V2b19SYWNlX1YyID0gZmFsc2UsCiAgICBBdXRvRGFya0NvYXQgPSBmYWxzZSwKICAgIEF1dG9Td2FuR2xhc3NlcyA9IGZhbHNlLAogICAgQXV0b1RydWVUcmlwbEthdGFuYSA9IGZhbHNlLAogICAgQXV0b1Jlbmdva3UgPSBmYWxzZSwKICAgIEF1dG9FY3RvcGxhc20gPSBmYWxzZSwKICAgIEF1dG9GYWN0b3J5ID0gZmFsc2UsCgogICAgLS1bV29ybGQgM10KICAgIE1pcmFnZSA9IGZhbHNlICwKICAgIE1pcmFnZUhvcCA9IGZhbHNlLAogICAgQXV0b19HZWFyID0gZmFsc2UsCiAgICBUZWxlcG9ydEdlYXIgPSBmYWxzZSwKICAgIEF1dG9SYWluYm93SGFraSA9IGZhbHNlLAogICAgQXV0b0J1eUVuY2hhbm1lbnRIYWtpSG9wID0gZmFsc2UsCiAgICBBdXRvQnV5TGVnZW5kYXJ5U3dvcmRIb3AgPSBmYWxzZSwKICAgIEF1dG9FbGl0ZUh1bnRlciA9IGZhbHNlLAogICAgQXV0b011c2tldGVlckhhdCA9IGZhbHNlLAogICAgQXV0b0J1ZGR5U3dvcmQgPSBmYWxzZSwKICAgIEF1dG9GYXJtQm9uZSA9IGZhbHNlLAogICAgQXV0b0tlbkhha2lWMiA9IGZhbHNlLAogICAgQXV0b09ic2VydmF0aW9uID0gZmFsc2UsCiAgICBBdXRvT2JzZXJ2YXRpb25fSG9wID0gZmFsc2UsCiAgICBBdXRvR29kSHVtYW4gPSBmYWxzZSwKICAgIEF1dG9DYXZhbmRlciA9IGZhbHNlLAogICAgQXV0b0N1cnNlZER1YWxLYXRhbmEgPSBmYWxzZSwKICAgIEF1dG9ZYW1hU3dvcmQgPSBmYWxzZSwKICAgIEF1dG9UdXNoaXRhU3dvcmQgPSBmYWxzZSwKICAgIEF1dG9TZXJwZW50Qm93ID0gZmFsc2UsCiAgICBBdXRvRGFya0RhZ2dlciA9IGZhbHNlLAogICAgQXV0b0Nha2VQcmluY2UgPSBmYWxzZSwKICAgIEF1dG9Eb3VnaFYyID0gZmFsc2UsCiAgICBBdXRvSG9seVRvcmNoID0gZmFsc2UsCiAgICBBdXRvQnVkZHlTd29yZHMgPSBmYWxzZSwKICAgIEF1dG9GYXJtQm9zc0hhbGxvdyA9IGZhbHNlLAogICAgQXV0b0V2ZW50ID0gZmFsc2UsCiAgICBUUFRPQk9BVCA9IGZhbHNlLAogICAgQXV0b0Zhcm1NYXRlcmlhbCA9IGZhbHNlLAogICAgVGVsZXBvcnR0b3AgPSBmYWxzZSwKICAgIEF1dG9GYXJtQ2hlc3QgPSBmYWxzZSwKICAgIC0tW0Jvc3NdCiAgICBBdXRvQWxsQm9zcyA9IGZhbHNlLAogICAgQXV0b0Jvc3NTZWxlY3QgPSBmYWxzZSwKICAgIEF1dG9GYXJtQm9zcyA9IGZhbHNlLAogICAgLS1bTWFzdGVyeV0KICAgIEF1dG9GYXJtRnJ1aXRNYXN0ZXJ5ID0gZmFsc2UsCiAgICBBdXRvRmFybUd1bk1hc3RlcnkgPSBmYWxzZSwKICAgIEZhcm1NYXN0ZXJ5U3dvcmRMaXN0ID0gZmFsc2UsCiAgICAtLVtSYWlkc10KICAgIEF1dG9SYWlkcyA9IGZhbHNlLAogICAgQXV0b05leHRQbGFjZSA9IGZhbHNlCn0KCmZ1bmN0aW9uIFZlYyh0ZXh0KQogICAgbG9jYWwgTm90aWZpY2F0aW9uID0gcmVxdWlyZShnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlLk5vdGlmaWNhdGlvbikKICAgIGxvY2FsIG5vdGlmaWNhdGlvbiA9IE5vdGlmaWNhdGlvbi5uZXcodGV4dCkKICAgIG5vdGlmaWNhdGlvbi5EdXJhdGlvbiA9IDEwCiAgICBub3RpZmljYXRpb246RGlzcGxheSgpCmVuZApWZWMoIjxDb2xvcj1DeWFuPlZlY3RvciBIdWIoQkVUQSkgTG9hZGluZy4uPENvbG9yPS8+IikgICAKLS0gW1NhdmUgU2V0dGluZ3NdCmZ1bmN0aW9uIExvYWRTZXR0aW5ncygpCiAgICBpZiByZWFkZmlsZSBhbmQgd3JpdGVmaWxlIGFuZCBpc2ZpbGUgYW5kIGlzZm9sZGVyIHRoZW4KICAgICAgICBpZiBub3QgaXNmb2xkZXIoIlZlY3Rvckh1YiIpIHRoZW4KICAgICAgICAgICAgbWFrZWZvbGRlcigiVmVjdG9ySHViIikKICAgICAgICBlbmQKICAgICAgICBpZiBub3QgaXNmb2xkZXIoIlZlY3Rvckh1Yi9CbG94IEZydWl0cy8iKSB0aGVuCiAgICAgICAgICAgIG1ha2Vmb2xkZXIoIlZlY3Rvckh1Yi9CbG94IEZydWl0cy8iKQogICAgICAgIGVuZAogICAgICAgIGlmIG5vdCBpc2ZpbGUoIlZlY3Rvckh1Yi9CbG94IEZydWl0cy8iIC4uIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lIC4uICIuanNvbiIpIHRoZW4KICAgICAgICAgICAgd3JpdGVmaWxlKCJWZWN0b3JIdWIvQmxveCBGcnVpdHMvIiAuLiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZSAuLiAiLmpzb24iLAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJIdHRwU2VydmljZSIpOkpTT05FbmNvZGUoX0cuU2V0dGluZ3MpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgbG9jYWwgRGVjb2RlID0gZ2FtZTpHZXRTZXJ2aWNlKCJIdHRwU2VydmljZSIpOkpTT05EZWNvZGUocmVhZGZpbGUoIlZlY3Rvckh1Yi9CbG94IEZydWl0cy8iIC4uCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZSAuLiAiLmpzb24iKSkKICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoRGVjb2RlKSBkbwogICAgICAgICAgICAgICAgX0cuU2V0dGluZ3NbaV0gPSB2CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIHJldHVybiAKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFNhdmVTZXR0aW5ncygpCiAgICBpZiByZWFkZmlsZSBhbmQgd3JpdGVmaWxlIGFuZCBpc2ZpbGUgYW5kIGlzZm9sZGVyIHRoZW4KICAgICAgICBpZiBub3QgaXNmaWxlKCJWZWN0b3JIdWIvQmxveCBGcnVpdHMvIiAuLiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZSAuLiAiLmpzb24iKSB0aGVuCiAgICAgICAgICAgIExvYWRTZXR0aW5ncygpCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbCBEZWNvZGUgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIik6SlNPTkRlY29kZShyZWFkZmlsZSgiVmVjdG9ySHViL0Jsb3ggRnJ1aXRzLyIgLi4KICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lIC4uICIuanNvbiIpKQogICAgICAgICAgICBsb2NhbCBBcnJheSA9IHt9CiAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKF9HLlNldHRpbmdzKSBkbwogICAgICAgICAgICAgICAgQXJyYXlbaV0gPSB2CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB3cml0ZWZpbGUoIlZlY3Rvckh1Yi9CbG94IEZydWl0cy8iIC4uIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lIC4uICIuanNvbiIsCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIik6SlNPTkVuY29kZShBcnJheSkpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIAogICAgZW5kCmVuZAoKTG9hZFNldHRpbmdzKCkKcmVwZWF0IHdhaXQoMCkgdW50aWwgZ2FtZTpJc0xvYWRlZCgpCnBjYWxsKGZ1bmN0aW9uKCkKICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuVGVhbSB+PSBuaWwgIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWlbIk1haW4gKG1pbmltYWwpIl06RmluZEZpcnN0Q2hpbGQoIkNob29zZVRlYW0iKSAgdGhlbgogICAgICAgIHJlcGVhdCB3YWl0KCkKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpOldhaXRGb3JDaGlsZCgiTWFpbiAobWluaW1hbCkiKS5DaG9vc2VUZWFtLlZpc2libGUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICBpZiBfRy5UZWFtID09ICJQaXJhdGUiIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnZXRjb25uZWN0aW9ucyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWlbIk1haW4gKG1pbmltYWwpIl0uQ2hvb3NlVGVhbS5Db250YWluZXIuUGlyYXRlcy5GcmFtZS5UZXh0QnV0dG9uLkFjdGl2YXRlZCkpIGRvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHYuRnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIF9HLlRlYW0gPT0gIk1hcmluZSIgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdldGNvbm5lY3Rpb25zKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aVsiTWFpbiAobWluaW1hbCkiXS5DaG9vc2VUZWFtLkNvbnRhaW5lci5NYXJpbmVzLkZyYW1lLlRleHRCdXR0b24uQWN0aXZhdGVkKSkgZG8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdi5GdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2V0Y29ubmVjdGlvbnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpWyJNYWluIChtaW5pbWFsKSJdLkNob29zZVRlYW0uQ29udGFpbmVyLlBpcmF0ZXMuRnJhbWUuVGV4dEJ1dHRvbi5BY3RpdmF0ZWQpKSBkbyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB2LkZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICB1bnRpbCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuVGVhbSB+PSBuaWwgCiAgICBlbmQKZW5kKQoKZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuSWRsZWQ6Y29ubmVjdChmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24yRG93bihWZWN0b3IyLm5ldygwLCAwKSwgd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lKQp3YWl0KDEpCmdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24yVXAoVmVjdG9yMi5uZXcoMCwgMCksIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZSkKZW5kKQoKZnVuY3Rpb24gVW5FcXVpcFdlYXBvbihXZWFwb24pCiAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKFdlYXBvbikgdGhlbgogICAgICAgIF9HLk5vdEF1dG9FcXVpcCA9IHRydWUKICAgICAgICB3YWl0KC41KQogICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoV2VhcG9uKS5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICB3YWl0KC4xKQogICAgICAgIF9HLk5vdEF1dG9FcXVpcCA9IGZhbHNlCiAgICBlbmQKZW5kCmZ1bmN0aW9uIEVxdWlwV2VhcG9uKFRvb2wpCglwY2FsbChmdW5jdGlvbigpCgkJaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKFRvb2wpIHRoZW4gCgkJCWxvY2FsIFRvb2xIdW1hbm9pZCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZChUb29sKSAKCQkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woVG9vbEh1bWFub2lkKSAKCQllbmQKCWVuZCkKZW5kCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwoJCXBjYWxsKGZ1bmN0aW9uKCkKCQkJaWYgX0cuVXNlc2tpbGwgdGhlbgoJCQkJZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsIloiLGZhbHNlLGdhbWUpCgkJCQl3YWl0KDAuMSkKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwiWiIsZmFsc2UsZ2FtZSkKICAgICAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsIlgiLGZhbHNlLGdhbWUpCgkJCQl3YWl0KDAuMSkKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwiWCIsZmFsc2UsZ2FtZSkKICAgICAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsIkMiLGZhbHNlLGdhbWUpCgkJCQl3YWl0KDAuMSkKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwiQyIsZmFsc2UsZ2FtZSkKICAgICAgICAgICAgICAgIHdhaXQoMC4xKQoJCQllbmQKCQllbmQpCiAgICBlbmQKZW5kKQpmdW5jdGlvbiBFcXVpcEFsbFdlYXBvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgdjpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHYpCiAgICAgICAgICAgICAgICBfRy5Vc2VTa2lsbCA9IHRydWUKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCmZ1bmN0aW9uIEVxdWlwQmxveEZydWl0KCkKICAgIGZvciBpICx2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHYuVG9vbFRpcCA9PSAiQmxveCBGcnVpdCIgdGhlbgogICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCh0b3N0cmluZyh2Lk5hbWUpKSB0aGVuCiAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbih2Lk5hbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKVGFiZWwgPSB7fQoJZnVuY3Rpb24gR2V0Q2FrZV9DRnJhbWVfTW9uKCkKCQlsb2NhbCB0YXJnZXRNb25zdGVycyA9IHsiQmFraW5nIFN0YWZmIiwgIkhlYWQgQmFrZXIiLCAiQ2FrZSBHdWFyZCIsICJDb29raWUgQ3JhZnRlciJ9CgkJbG9jYWwgZW5lbXlTcGF3bnMgPSB3b3Jrc3BhY2UuRW5lbXlTcGF3bnM6R2V0Q2hpbGRyZW4oKQoJCWxvY2FsIHJhbmRvbVNwYXduSW5kZXggPSBtYXRoLnJhbmRvbSgxLCAjZW5lbXlTcGF3bnMpCgkJbG9jYWwgc2VsZWN0ZWRTcGF3biA9IGVuZW15U3Bhd25zW3JhbmRvbVNwYXduSW5kZXhdCgkJCgkJZm9yIF8sX3YxIGluIHBhaXJzKHRhcmdldE1vbnN0ZXJzKSBkbwoJCQlsb2NhbCByZXN1bHQgPSBzdHJpbmcuZ3N1YihfdjEsICJMdi4gIiwgIiIpCgkJCWxvY2FsIHJlc3VsdDIgPSBzdHJpbmcuZ3N1YihyZXN1bHQsICJbJVslXV0iLCAiIikKCQkJbG9jYWwgcmVzdWx0MyA9IHN0cmluZy5nc3ViKHJlc3VsdDIsICIlZCsiLCAiIikKCQkJbG9jYWwgcmVzdWx0NCA9IHN0cmluZy5nc3ViKHJlc3VsdDMsICIlcysiLCAiIikKCQkJbG9jYWwgbW9uUU5hbWUgPSByZXN1bHQ0CgkJCQoJCQlpZiBzZWxlY3RlZFNwYXduLk5hbWUgPT0gcmVzdWx0NCB0aGVuCgkJCQlyZXR1cm4gc2VsZWN0ZWRTcGF3bi5DRnJhbWUKCQkJZW5kCgkJZW5kCgllbmQKbG9jYWwgRW5lbXlTcGF3bnMgPSBJbnN0YW5jZS5uZXcoIkZvbGRlciIsd29ya3NwYWNlKQoJRW5lbXlTcGF3bnMuTmFtZSA9ICJFbmVteVNwYXducyIKCWZvciBpLCB2IGluIHBhaXJzKHdvcmtzcGFjZS5fV29ybGRPcmlnaW4uRW5lbXlTcGF3bnM6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB2OklzQSgiUGFydCIpIHRoZW4KCQkJbG9jYWwgRW5lbXlTcGF3bnNYMiA9IHY6Q2xvbmUoKQoJCQlsb2NhbCByZXN1bHQgPSBzdHJpbmcuZ3N1Yih2Lk5hbWUsICJMdi4gIiwgIiIpCgkJCWxvY2FsIHJlc3VsdDIgPSBzdHJpbmcuZ3N1YihyZXN1bHQsICJbJVslXV0iLCAiIikKCQkJbG9jYWwgcmVzdWx0MyA9IHN0cmluZy5nc3ViKHJlc3VsdDIsICIlZCsiLCAiIikKCQkJbG9jYWwgcmVzdWx0NCA9IHN0cmluZy5nc3ViKHJlc3VsdDMsICIlcysiLCAiIikKCQkJRW5lbXlTcGF3bnNYMi5OYW1lID0gcmVzdWx0NAoJCQlFbmVteVNwYXduc1gyLlBhcmVudCA9IHdvcmtzcGFjZS5FbmVteVNwYXducwoJCQlFbmVteVNwYXduc1gyLkFuY2hvcmVkID0gdHJ1ZQoJCWVuZAoJZW5kCglmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB2OklzQSgiTW9kZWwiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KCQkJbG9jYWwgRW5lbXlTcGF3bnNYMiA9IHYuSHVtYW5vaWRSb290UGFydDpDbG9uZSgpCgkJCWxvY2FsIHJlc3VsdCA9IHN0cmluZy5nc3ViKHYuTmFtZSwgIkx2LiAiLCAiIikKCQkJbG9jYWwgcmVzdWx0MiA9IHN0cmluZy5nc3ViKHJlc3VsdCwgIlslWyVdXSIsICIiKQoJCQlsb2NhbCByZXN1bHQzID0gc3RyaW5nLmdzdWIocmVzdWx0MiwgIiVkKyIsICIiKQoJCQlsb2NhbCByZXN1bHQ0ID0gc3RyaW5nLmdzdWIocmVzdWx0MywgIiVzKyIsICIiKQoJCQlFbmVteVNwYXduc1gyLk5hbWUgPSByZXN1bHQ0CgkJCUVuZW15U3Bhd25zWDIuUGFyZW50ID0gd29ya3NwYWNlLkVuZW15U3Bhd25zCgkJCUVuZW15U3Bhd25zWDIuQW5jaG9yZWQgPSB0cnVlCgkJZW5kCgllbmQKCWZvciBpLCB2IGluIHBhaXJzKGdhbWUuUmVwbGljYXRlZFN0b3JhZ2U6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB2OklzQSgiTW9kZWwiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KCQkJbG9jYWwgRW5lbXlTcGF3bnNYMiA9IHYuSHVtYW5vaWRSb290UGFydDpDbG9uZSgpCgkJCWxvY2FsIHJlc3VsdCA9IHN0cmluZy5nc3ViKHYuTmFtZSwgIkx2LiAiLCAiIikKCQkJbG9jYWwgcmVzdWx0MiA9IHN0cmluZy5nc3ViKHJlc3VsdCwgIlslWyVdXSIsICIiKQoJCQlsb2NhbCByZXN1bHQzID0gc3RyaW5nLmdzdWIocmVzdWx0MiwgIiVkKyIsICIiKQoJCQlsb2NhbCByZXN1bHQ0ID0gc3RyaW5nLmdzdWIocmVzdWx0MywgIiVzKyIsICIiKQoJCQlFbmVteVNwYXduc1gyLk5hbWUgPSByZXN1bHQ0CgkJCUVuZW15U3Bhd25zWDIuUGFyZW50ID0gd29ya3NwYWNlLkVuZW15U3Bhd25zCgkJCUVuZW15U3Bhd25zWDIuQW5jaG9yZWQgPSB0cnVlCgkJZW5kCgllbmQKCiAgICAKbG9jYWwgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPSAxCmxvY2FsIGxhc3RSYW5kb21VcGRhdGUgPSAwCmxvY2FsIFJBTkRPTV9VUERBVEVfSU5URVJWQUwgPSAxIAoKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCgpsb2NhbCBjYWNoZWRRdWVzdERhdGEgPSBuaWwKbG9jYWwgbGFzdFF1ZXN0Q2hlY2sgPSAwCmxvY2FsIFFVRVNUX0NBQ0hFX0RVUkFUSU9OID0gMgoKbG9jYWwgZnVuY3Rpb24gUXVlc3RDaGVjaygpCiAgICBsb2NhbCBjdXJyZW50VGltZSA9IHRpY2soKQogICAgCiAgICAtLSBVc2UgY2FjaGVkIGRhdGEgaWYgc3RpbGwgdmFsaWQKICAgIGlmIGNhY2hlZFF1ZXN0RGF0YSBhbmQgKGN1cnJlbnRUaW1lIC0gbGFzdFF1ZXN0Q2hlY2spIDwgUVVFU1RfQ0FDSEVfRFVSQVRJT04gdGhlbgogICAgICAgIHJldHVybiBjYWNoZWRRdWVzdERhdGEKICAgIGVuZAogICAgCiAgICBsb2NhbCBMdmwgPSBMb2NhbFBsYXllci5EYXRhLkxldmVsLlZhbHVlCiAgICAKICAgIC0tIENsZWFyIHByZXZpb3VzIHZhbHVlcwogICAgbG9jYWwgTW9iTmFtZSwgUXVlc3ROYW1lLCBRdWVzdExldmVsLCBNb24sIE5QQ1Bvc2l0aW9uLCBMZXZlbFJlcXVpcmUsIE1vYkNGcmFtZQogICAgCiAgICAtLSBIYW5kbGUgbG93IGxldmVscyBlZmZpY2llbnRseQogICAgaWYgTHZsID49IDEgYW5kIEx2bCA8PSA5IHRoZW4KICAgICAgICBpZiB0b3N0cmluZyhMb2NhbFBsYXllci5UZWFtKSA9PSAiTWFyaW5lcyIgdGhlbgogICAgICAgICAgICBNb2JOYW1lID0gIlRyYWluZWUiCiAgICAgICAgICAgIFF1ZXN0TmFtZSA9ICJNYXJpbmVRdWVzdCIKICAgICAgICAgICAgUXVlc3RMZXZlbCA9IDEKICAgICAgICAgICAgTW9uID0gIlRyYWluZWUiCiAgICAgICAgICAgIE5QQ1Bvc2l0aW9uID0gQ0ZyYW1lLm5ldygtMjcwOS42Nzk0NCwgMjQuNTIwNjU4NSwgMjEwNC4yNDU4NSwgLTAuNzQ0NzI0OTI5LCAtMy45Nzk2NzQ1NWUtMDgsIC0wLjY2NzM3MTU3MSwgNC4zMjQwMzU4OGUtMDgsIDEsIC0xLjA3ODg0MzA0ZS0wNywgMC42NjczNzE1NzEsIC0xLjA5MjAxNTE1ZS0wNywgLTAuNzQ0NzI0OTI5KQogICAgICAgIGVsc2VpZiB0b3N0cmluZyhMb2NhbFBsYXllci5UZWFtKSA9PSAiUGlyYXRlcyIgdGhlbgogICAgICAgICAgICBNb2JOYW1lID0gIkJhbmRpdCIKICAgICAgICAgICAgTW9uID0gIkJhbmRpdCIKICAgICAgICAgICAgUXVlc3ROYW1lID0gIkJhbmRpdFF1ZXN0MSIKICAgICAgICAgICAgUXVlc3RMZXZlbCA9IDEKICAgICAgICAgICAgTlBDUG9zaXRpb24gPSBDRnJhbWUubmV3KDEwNTkuOTk3MzEsIDE2LjkyMjIwNjksIDE1NDkuMjgxNjIsIC0wLjk1NDY2Mjc0LCA3LjI5NzIxNzk0ZS0wOSwgMC4yOTc2ODk1ODcsIDEuMDUxOTAxMDZlLTA4LCAxLCA5LjIyMDY0MTE0ZS0wOSwgLTAuMjk3Njg5NTg3LCAxLjE5MzQwMDIyZS0wOCwgLTAuOTU0NjYyNzQpCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgY2FjaGVkUXVlc3REYXRhID0gewogICAgICAgICAgICBbMV0gPSBRdWVzdExldmVsLAogICAgICAgICAgICBbMl0gPSBOUENQb3NpdGlvbiwKICAgICAgICAgICAgWzNdID0gTW9iTmFtZSwKICAgICAgICAgICAgWzRdID0gUXVlc3ROYW1lLAogICAgICAgICAgICBbNV0gPSBMZXZlbFJlcXVpcmUsCiAgICAgICAgICAgIFs2XSA9IE1vbiwKICAgICAgICAgICAgWzddID0gTW9iQ0ZyYW1lCiAgICAgICAgfQogICAgICAgIGxhc3RRdWVzdENoZWNrID0gY3VycmVudFRpbWUKICAgICAgICByZXR1cm4gY2FjaGVkUXVlc3REYXRhCiAgICBlbmQKCiAgICAtLSBGaXhlZCBQcmlzb25lciBRdWVzdCBMZXZlbCAxCiAgICBpZiBMdmwgPj0gMTkwIGFuZCBMdmwgPD0gMjA5IHRoZW4KICAgICAgICBNb2JOYW1lID0gIlByaXNvbmVyIgogICAgICAgIFF1ZXN0TmFtZSA9ICJQcmlzb25lclF1ZXN0IgogICAgICAgIFF1ZXN0TGV2ZWwgPSAxCiAgICAgICAgTW9uID0gIlByaXNvbmVyIgogICAgICAgIE5QQ1Bvc2l0aW9uID0gQ0ZyYW1lLm5ldyg1MzA4LjkzMTE1LCAxLjY1NTE3NTIxLCA0NzUuMTIwNTE0LCAtMC4wODk0Mjc0NzEyLCAtNS4wMDI5MjkxOGUtMDksIC0wLjk5NTk5MzMxNiwgMS42MDgxNzg1OWUtMDksIDEsIC01LjE2NzQ0ODY5ZS0wOSwgMC45OTU5OTMzMTYsIC0yLjA2Mzg0NzA5ZS0wOSwgLTAuMDg5NDI3NDcxMikKICAgICAgICBNb2JDRnJhbWUgPSBnZXRNb2JDRnJhbWUoIlByaXNvbmVyIikKICAgICAgICAKICAgICAgICBjYWNoZWRRdWVzdERhdGEgPSB7CiAgICAgICAgICAgIFsxXSA9IFF1ZXN0TGV2ZWwsCiAgICAgICAgICAgIFsyXSA9IE5QQ1Bvc2l0aW9uLAogICAgICAgICAgICBbM10gPSBNb2JOYW1lLAogICAgICAgICAgICBbNF0gPSBRdWVzdE5hbWUsCiAgICAgICAgICAgIFs1XSA9IExldmVsUmVxdWlyZSwKICAgICAgICAgICAgWzZdID0gTW9uLAogICAgICAgICAgICBbN10gPSBNb2JDRnJhbWUKICAgICAgICB9CiAgICAgICAgbGFzdFF1ZXN0Q2hlY2sgPSBjdXJyZW50VGltZQogICAgICAgIHJldHVybiBjYWNoZWRRdWVzdERhdGEKICAgIGVuZAoKICAgIC0tIERhbmdlcm91cyBQcmlzb25lciBmb3IgaGlnaGVyIGxldmVscwogICAgaWYgTHZsID49IDIxMCBhbmQgTHZsIDw9IDI0OSB0aGVuCiAgICAgICAgTW9iTmFtZSA9ICJEYW5nZXJvdXMgUHJpc29uZXIiCiAgICAgICAgUXVlc3ROYW1lID0gIlByaXNvbmVyUXVlc3QiCiAgICAgICAgUXVlc3RMZXZlbCA9IDIKICAgICAgICBNb24gPSAiRGFuZ2Vyb3VzIFByaXNvbmVyIgogICAgICAgIE5QQ1Bvc2l0aW9uID0gQ0ZyYW1lLm5ldyg1MzA4LjkzMTE1LCAxLjY1NTE3NTIxLCA0NzUuMTIwNTE0LCAtMC4wODk0Mjc0NzEyLCAtNS4wMDI5MjkxOGUtMDksIC0wLjk5NTk5MzMxNiwgMS42MDgxNzg1OWUtMDksIDEsIC01LjE2NzQ0ODY5ZS0wOSwgMC45OTU5OTMzMTYsIC0yLjA2Mzg0NzA5ZS0wOSwgLTAuMDg5NDI3NDcxMikKICAgICAgICBNb2JDRnJhbWUgPSBnZXRNb2JDRnJhbWUoIkRhbmdlcm91c1ByaXNvbmVyIikKICAgICAgICAKICAgICAgICBjYWNoZWRRdWVzdERhdGEgPSB7CiAgICAgICAgICAgIFsxXSA9IFF1ZXN0TGV2ZWwsCiAgICAgICAgICAgIFsyXSA9IE5QQ1Bvc2l0aW9uLAogICAgICAgICAgICBbM10gPSBNb2JOYW1lLAogICAgICAgICAgICBbNF0gPSBRdWVzdE5hbWUsCiAgICAgICAgICAgIFs1XSA9IExldmVsUmVxdWlyZSwKICAgICAgICAgICAgWzZdID0gTW9uLAogICAgICAgICAgICBbN10gPSBNb2JDRnJhbWUKICAgICAgICB9CiAgICAgICAgbGFzdFF1ZXN0Q2hlY2sgPSBjdXJyZW50VGltZQogICAgICAgIHJldHVybiBjYWNoZWRRdWVzdERhdGEKICAgIGVuZAogICAgCiAgICAtLSBDb250aW51ZSB3aXRoIG9yaWdpbmFsIHF1ZXN0IGxvZ2ljIGJ1dCBvcHRpbWl6ZWQKICAgIGxvY2FsIEd1aWRlTW9kdWxlID0gcmVxdWlyZShSZXBsaWNhdGVkU3RvcmFnZS5HdWlkZU1vZHVsZSkKICAgIGxvY2FsIFF1ZXN0cyA9IHJlcXVpcmUoUmVwbGljYXRlZFN0b3JhZ2UuUXVlc3RzKQogICAgCiAgICBmb3IgaSx2IGluIHBhaXJzKEd1aWRlTW9kdWxlWyJEYXRhIl1bIk5QQ0xpc3QiXSkgZG8KICAgICAgICBmb3IgaTEsdjEgaW4gcGFpcnModlsiTGV2ZWxzIl0pIGRvCiAgICAgICAgICAgIGlmIEx2bCA+PSB2MSB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgTGV2ZWxSZXF1aXJlIHRoZW4KICAgICAgICAgICAgICAgICAgICBMZXZlbFJlcXVpcmUgPSAwCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHYxID4gTGV2ZWxSZXF1aXJlIHRoZW4KICAgICAgICAgICAgICAgICAgICBOUENQb3NpdGlvbiA9IGlbIkNGcmFtZSJdCiAgICAgICAgICAgICAgICAgICAgUXVlc3RMZXZlbCA9IGkxCiAgICAgICAgICAgICAgICAgICAgTGV2ZWxSZXF1aXJlID0gdjEKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgI3ZbIkxldmVscyJdID09IDMgYW5kIFF1ZXN0TGV2ZWwgPT0gMyB0aGVuCiAgICAgICAgICAgICAgICAgICAgTlBDUG9zaXRpb24gPSBpWyJDRnJhbWUiXQogICAgICAgICAgICAgICAgICAgIFF1ZXN0TGV2ZWwgPSAyCiAgICAgICAgICAgICAgICAgICAgTGV2ZWxSZXF1aXJlID0gdlsiTGV2ZWxzIl1bMl0KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICAtLSBGaXNobWFuIGFyZWEgdGVsZXBvcnRhdGlvbgogICAgaWYgTHZsID49IDM3NSBhbmQgTHZsIDw9IDQ0OSB0aGVuCiAgICAgICAgaWYgX0cuQXV0b0Zhcm0gYW5kIE5QQ1Bvc2l0aW9uIGFuZCAoTlBDUG9zaXRpb24uUG9zaXRpb24gLSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMzAwMCB0aGVuCiAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigicmVxdWVzdEVudHJhbmNlIixWZWN0b3IzLm5ldyg2MTE2My44NTE1NjI1LCAxMS42Nzk2ODc1LCAxODE5Ljc4NDE3OTY4NzUpKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0gR2V0IHF1ZXN0IGluZm9ybWF0aW9uCiAgICBmb3IgaSx2IGluIHBhaXJzKFF1ZXN0cykgZG8KICAgICAgICBmb3IgaTEsdjEgaW4gcGFpcnModikgZG8KICAgICAgICAgICAgaWYgdjFbIkxldmVsUmVxIl0gPT0gTGV2ZWxSZXF1aXJlIGFuZCBpIH49ICJDaXRpemVuUXVlc3QiIHRoZW4KICAgICAgICAgICAgICAgIFF1ZXN0TmFtZSA9IGkKICAgICAgICAgICAgICAgIGZvciBpMix2MiBpbiBwYWlycyh2MVsiVGFzayJdKSBkbwogICAgICAgICAgICAgICAgICAgIE1vYk5hbWUgPSBpMgogICAgICAgICAgICAgICAgICAgIE1vbiA9IHN0cmluZy5zcGxpdChpMiwiIFtMdi4gIi4uIHYxWyJMZXZlbFJlcSJdIC4uICJdIilbMV0KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICAtLSBIYW5kbGUgc3BlY2lhbCBjYXNlcwogICAgaWYgUXVlc3ROYW1lID09ICJNYXJpbmVRdWVzdDIiIHRoZW4KICAgICAgICBRdWVzdE5hbWUgPSAiTWFyaW5lUXVlc3QyIgogICAgICAgIFF1ZXN0TGV2ZWwgPSAxCiAgICAgICAgTW9iTmFtZSA9ICJDaGllZiBQZXR0eSBPZmZpY2VyIgogICAgICAgIE1vbiA9ICJDaGllZiBQZXR0eSBPZmZpY2VyIgogICAgICAgIExldmVsUmVxdWlyZSA9IDEyMAogICAgZWxzZWlmIFF1ZXN0TmFtZSA9PSAiSW1wZWxRdWVzdCIgdGhlbgogICAgICAgIFF1ZXN0TmFtZSA9ICJQcmlzb25lclF1ZXN0IgogICAgICAgIFF1ZXN0TGV2ZWwgPSAyCiAgICAgICAgTW9iTmFtZSA9ICJEYW5nZXJvdXMgUHJpc29uZXIiCiAgICAgICAgTW9uID0gIkRhbmdlcm91cyBQcmlzb25lciIKICAgICAgICBMZXZlbFJlcXVpcmUgPSAyMTAKICAgICAgICBOUENQb3NpdGlvbiA9IENGcmFtZS5uZXcoNTMxMC42MDU0NywgMC4zNTAwMTQ5MjUsIDQ3NC45NDY1OTQsIDAuMDE3NTAxNzExOCwgMCwgMC45OTk4NDY5MzUsIDAsIDEsIDAsIC0wLjk5OTg0NjkzNSwgMCwgMC4wMTc1MDE3MTE4KQogICAgZWxzZWlmIFF1ZXN0TmFtZSA9PSAiU2t5RXhwMVF1ZXN0IiB0aGVuCiAgICAgICAgaWYgUXVlc3RMZXZlbCA9PSAxIHRoZW4KICAgICAgICAgICAgTlBDUG9zaXRpb24gPSBDRnJhbWUubmV3KC00NzIxLjg4ODY3LCA4NDMuODc0Njk1LCAtMTk0OS45NjY0MywgMC45OTYxOTE4NTksIC0wLCAtMC4wODcxODg0MzAxLCAwLCAxLCAtMCwgMC4wODcxODg0MzAxLCAwLCAwLjk5NjE5MTg1OSkKICAgICAgICBlbHNlaWYgUXVlc3RMZXZlbCA9PSAyIHRoZW4KICAgICAgICAgICAgTlBDUG9zaXRpb24gPSBDRnJhbWUubmV3KC03ODU5LjA5ODE0LCA1NTQ0LjE5MDQzLCAtMzgxLjQ3NjE5NiwgLTAuNDIyNTkyOTk4LCAwLCAwLjkwNjMxOTYxOCwgMCwgMSwgMCwgLTAuOTA2MzE5NjE4LCAwLCAtMC40MjI1OTI5OTgpCiAgICAgICAgZW5kCiAgICBlbHNlaWYgUXVlc3ROYW1lID09ICJBcmVhMlF1ZXN0IiBhbmQgUXVlc3RMZXZlbCA9PSAyIHRoZW4KICAgICAgICBRdWVzdE5hbWUgPSAiQXJlYTJRdWVzdCIKICAgICAgICBRdWVzdExldmVsID0gMQogICAgICAgIE1vYk5hbWUgPSAiU3dhbiBQaXJhdGUiCiAgICAgICAgTW9uID0gIlN3YW4gUGlyYXRlIgogICAgICAgIExldmVsUmVxdWlyZSA9IDc3NQoKICAgIGVsc2VpZiBRdWVzdE5hbWUgPT0gIlRpa2lRdWVzdDEiIGFuZCBRdWVzdExldmVsID09IDEgdGhlbgogICAgICAgICAgICBRdWVzdExldmVsID0gMQogICAgICAgICAgICBNb2JOYW1lID0gIklzbGUgT3V0bGF3IgogICAgICAgICAgICBNb24gPSAiSXNsZSBPdXRsYXciCiAgICAgICAgICAgIExldmVsUmVxdWlyZSA9IDI0NTAKICAgIGVsc2VpZiBRdWVzdE5hbWUgPT0gIlRpa2lRdWVzdDEiIGFuZCBRdWVzdExldmVsID09IDIgdGhlbgogICAgICAgICAgICBRdWVzdExldmVsID0gMgogICAgICAgICAgICBNb2JOYW1lID0gIklzbGFuZCBCb3kiCiAgICAgICAgICAgIE1vbiA9ICJJc2xhbmQgQm95IgogICAgICAgICAgICBMZXZlbFJlcXVpcmUgPSAyNDc1CiAgICBlbHNlaWYgUXVlc3ROYW1lID09ICJUaWtpUXVlc3QyIiBhbmQgUXVlc3RMZXZlbCA9PSAxIHRoZW4KICAgICAgICAgICAgUXVlc3RMZXZlbCA9IDEKICAgICAgICAgICAgTW9iTmFtZSA9ICJTdW4ta2lzc2VkIFdhcnJpb3IiCiAgICAgICAgICAgIE1vbiA9ICJTdW4ta2lzc2VkIFdhcnJpb3IiCiAgICAgICAgICAgIExldmVsUmVxdWlyZSA9IDI1MDAKICAgIGVsc2VpZiBRdWVzdE5hbWUgPT0gIlRpa2lRdWVzdDIiIGFuZCBRdWVzdExldmVsID09IDIgdGhlbgogICAgICAgICAgICBRdWVzdExldmVsID0gMgogICAgICAgICAgICBNb2JOYW1lID0gIklzbGUgQ2hhbXBpb24iCiAgICAgICAgICAgIE1vbiA9ICJJc2xlIENoYW1waW9uciIKICAgICAgICAgICAgTGV2ZWxSZXF1aXJlID0gMjUyNQogICAgZWxzZWlmIFF1ZXN0TmFtZSA9PSAiVGlraVF1ZXN0MyIgYW5kIFF1ZXN0TGV2ZWwgPT0gMSB0aGVuCiAgICAgICAgICAgIFF1ZXN0TGV2ZWwgPSAxCiAgICAgICAgICAgIE1vYk5hbWUgPSAiU2VycGVudCBIdW50ZXIiCiAgICAgICAgICAgIE1vbiA9ICJTZXJwZW50IEh1bnRlciIKICAgICAgICAgICAgTGV2ZWxSZXF1aXJlID0gMjU1MAogICAgZWxzZWlmIFF1ZXN0TmFtZSA9PSAiVGlraVF1ZXN0MyIgYW5kIFF1ZXN0TGV2ZWwgPT0gMiB0aGVuCiAgICAgICAgICAgIFF1ZXN0TGV2ZWwgPSAyCiAgICAgICAgICAgIE1vYk5hbWUgPSAiU2t1bGwgU2xheWVyIgogICAgICAgICAgICBNb24gPSAiU2t1bGwgU2xheWVyIgogICAgICAgICAgICBMZXZlbFJlcXVpcmUgPSAyNTc1CiAgICBlbHNlaWYgUXVlc3ROYW1lID09ICJTdWJtZXJnZWRRdWVzdDEiIGFuZCBRdWVzdExldmVsID09IDEgdGhlbgogICAgICAgICAgICBRdWVzdExldmVsID0gMSAKICAgICAgICAgICAgTW9iTmFtZSA9ICJSZWVmIEJhbmRpdCIKICAgICAgICAgICAgTW9uID0gIlJlZWYgQmFuZGl0IgogICAgICAgICAgICBMZXZlbFJlcXVpcmUgPSAyNjAwCiAgICBlbHNlaWYgUXVlc3ROYW1lID09ICJTdWJtZXJnZWRRdWVzdDEiIGFuZCBRdWVzdExldmVsID09IDIgdGhlbgogICAgICAgICAgICBRdWVzdExldmVsID0gMgogICAgICAgICAgICBNb2JOYW1lID0gIkNvcmFsIFBpcmF0ZSIKICAgICAgICAgICAgTW9uID0gIkNvcmFsIFBpcmF0ZSIKICAgICAgICAgICAgTGV2ZWxSZXF1aXJlID0gMjYyNQogICAgIGVsc2VpZiBRdWVzdE5hbWUgPT0gIlN1Ym1lcmdlZFF1ZXN0MiIgYW5kIFF1ZXN0TGV2ZWwgPT0gMSB0aGVuCiAgICAgICAgICAgIFF1ZXN0TGV2ZWwgPSAxIAogICAgICAgICAgICBNb2JOYW1lID0gIlNlYSBDaGFudGVyIgogICAgICAgICAgICBNb24gPSAiU2VhIENoYW50ZXIiCiAgICAgICAgICAgIExldmVsUmVxdWlyZSA9IDI2NTAKICAgIGVsc2VpZiBRdWVzdE5hbWUgPT0gIlN1Ym1lcmdlZFF1ZXN0MiIgYW5kIFF1ZXN0TGV2ZWwgPT0gMiB0aGVuCiAgICAgICAgICAgIFF1ZXN0TGV2ZWwgPSAyCiAgICAgICAgICAgIE1vYk5hbWUgPSAiT2NlYW4gUHJvcGhldCIKICAgICAgICAgICAgTW9uID0gIk9jZWFuIFByb3BoZXQiCiAgICAgICAgICAgIExldmVsUmVxdWlyZSA9IDI2NzUKICAgIGVuZAogICAgCiAgICAtLSBPcHRpbWl6ZSBtb2IgbmFtZSBmaW5kaW5nCiAgICBpZiBNb2JOYW1lIHRoZW4KICAgICAgICBNb2JOYW1lID0gTW9iTmFtZTpzdWIoMSwjTW9iTmFtZSkKICAgICAgICBpZiBub3QgTW9iTmFtZTpmaW5kKCJMdiIpIHRoZW4KICAgICAgICAgICAgLS0gQ2hlY2sgd29ya3NwYWNlIGVuZW1pZXMgZmlyc3QKICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhXb3Jrc3BhY2UuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgTW9uTFYgPSBzdHJpbmcubWF0Y2godi5OYW1lLCAiJWQrIikKICAgICAgICAgICAgICAgIGlmIHYuTmFtZTpmaW5kKE1vYk5hbWUpIGFuZCAjdi5OYW1lID4gI01vYk5hbWUgYW5kIE1vbkxWIGFuZCB0b251bWJlcihNb25MVikgPD0gTHZsICsgNTAgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vYk5hbWUgPSB2Lk5hbWUKICAgICAgICAgICAgICAgICAgICBicmVhayAtLSBFeGl0IGVhcmx5IHdoZW4gZm91bmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBJZiBzdGlsbCBub3QgZm91bmQsIGNoZWNrIFJlcGxpY2F0ZWRTdG9yYWdlCiAgICAgICAgaWYgbm90IE1vYk5hbWU6ZmluZCgiTHYiKSB0aGVuCiAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoUmVwbGljYXRlZFN0b3JhZ2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGxvY2FsIE1vbkxWID0gc3RyaW5nLm1hdGNoKHYuTmFtZSwgIiVkKyIpCiAgICAgICAgICAgICAgICBpZiB2Lk5hbWU6ZmluZChNb2JOYW1lKSBhbmQgI3YuTmFtZSA+ICNNb2JOYW1lIGFuZCBNb25MViBhbmQgdG9udW1iZXIoTW9uTFYpIDw9IEx2bCArIDUwIHRoZW4KICAgICAgICAgICAgICAgICAgICBNb2JOYW1lID0gdi5OYW1lCiAgICAgICAgICAgICAgICAgICAgTW9uID0gdi5OYW1lCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgLS0gRXhpdCBlYXJseSB3aGVuIGZvdW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBHZXQgbW9iIENGcmFtZSBlZmZpY2llbnRseQogICAgTW9iQ0ZyYW1lID0gZ2V0TW9iQ0ZyYW1lKE1vYk5hbWUpCiAgICAKICAgIC0tIENhY2hlIHRoZSByZXN1bHQKICAgIGNhY2hlZFF1ZXN0RGF0YSA9IHsKICAgICAgICBbMV0gPSBRdWVzdExldmVsLAogICAgICAgIFsyXSA9IE5QQ1Bvc2l0aW9uLAogICAgICAgIFszXSA9IE1vYk5hbWUsCiAgICAgICAgWzRdID0gUXVlc3ROYW1lLAogICAgICAgIFs1XSA9IExldmVsUmVxdWlyZSwKICAgICAgICBbNl0gPSBNb24sCiAgICAgICAgWzddID0gTW9iQ0ZyYW1lCiAgICB9CiAgICBsYXN0UXVlc3RDaGVjayA9IGN1cnJlbnRUaW1lCiAgICAKICAgIHJldHVybiBjYWNoZWRRdWVzdERhdGEKZW5kCgotLSBPcHRpbWl6ZWQgZnVuY3Rpb24gdG8gZ2V0IG1vYiBDRnJhbWUKZnVuY3Rpb24gZ2V0TW9iQ0ZyYW1lKG1vYk5hbWUpCiAgICBpZiBub3QgbW9iTmFtZSB0aGVuIHJldHVybiB7fSBlbmQKICAgIAogICAgbG9jYWwgbWF0Y2hpbmdDRnJhbWVzID0ge30KICAgIGxvY2FsIHJlc3VsdCA9IHN0cmluZy5nc3ViKG1vYk5hbWUsICJMdi4gIiwgIiIpCiAgICBsb2NhbCByZXN1bHQyID0gc3RyaW5nLmdzdWIocmVzdWx0LCAiWyVbJV1dIiwgIiIpCiAgICBsb2NhbCByZXN1bHQzID0gc3RyaW5nLmdzdWIocmVzdWx0MiwgIiVkKyIsICIiKQogICAgbG9jYWwgcmVzdWx0NCA9IHN0cmluZy5nc3ViKHJlc3VsdDMsICIlcysiLCAiIikKICAgIAogICAgZm9yIGksdiBpbiBwYWlycyhXb3Jrc3BhY2UuRW5lbXlTcGF3bnM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2Lk5hbWUgPT0gcmVzdWx0NCB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChtYXRjaGluZ0NGcmFtZXMsIHYuQ0ZyYW1lKQogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHJldHVybiBtYXRjaGluZ0NGcmFtZXMKZW5kCi0tdmVsb2NpdHkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQogICAgICAgIGxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQogICAgICAgIGxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHNldHVwQ2hhcmFjdGVyKENoYXJhY3RlcikKICAgICAgICAgICAgaWYgbm90IENoYXJhY3RlciB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIEhSUCA9IENoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiLCA1KQogICAgICAgICAgICBsb2NhbCBIdW1hbm9pZCA9IENoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIiwgNSkKCiAgICAgICAgICAgIGlmIG5vdCBIUlAgb3Igbm90IEh1bWFub2lkIHRoZW4KICAgICAgICAgICAgICAgIHdhcm4oIkh1bWFub2lkUm9vdFBhcnQgb3IgSHVtYW5vaWQgbm90IGZvdW5kISIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIGVuYWJsZUFudGlGYWxsKCkKICAgICAgICAgICAgICAgIEh1bWFub2lkOlNldFN0YXRlRW5hYmxlZChFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkZhbGxpbmdEb3duLCBmYWxzZSkKICAgICAgICAgICAgICAgIEh1bWFub2lkOlNldFN0YXRlRW5hYmxlZChFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkZyZWVmYWxsLCBmYWxzZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiBkaXNhYmxlQW50aUZhbGwoKQogICAgICAgICAgICAgICAgSHVtYW5vaWQ6U2V0U3RhdGVFbmFibGVkKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRmFsbGluZ0Rvd24sIHRydWUpCiAgICAgICAgICAgICAgICBIdW1hbm9pZDpTZXRTdGF0ZUVuYWJsZWQoRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5GcmVlZmFsbCwgdHJ1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiBjYW5jZWxGYWxsU3RhdGUoKQogICAgICAgICAgICAgICAgaWYgSHVtYW5vaWQ6R2V0U3RhdGUoKSA9PSBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkZhbGxpbmdEb3duIG9yIAogICAgICAgICAgICAgICAgICAgSHVtYW5vaWQ6R2V0U3RhdGUoKSA9PSBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkZyZWVmYWxsIHRoZW4KICAgICAgICAgICAgICAgICAgICBIdW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlJ1bm5pbmcpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGxvY2FsIHN0ZXBwZWRDb25uZWN0aW9uCiAgICAgICAgICAgIHN0ZXBwZWRDb25uZWN0aW9uID0gUnVuU2VydmljZS5TdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgbm90IENoYXJhY3Rlci5QYXJlbnQgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlciBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXIgfj0gQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBzdGVwcGVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9GYXJtIG9yIF9HLk5lYXJlYXN0RmFybSBvciBfRy5UZWxlcG9ydElzbGFuZCBvcgogICAgICAgICAgICAgICAgICAgX0cuQXV0b0FsbEJvc3Mgb3IgX0cuQXV0b0Jvc3NTZWxlY3Qgb3IgX0cuQXV0b0Zhcm1Cb3NzIG9yCiAgICAgICAgICAgICAgICAgICBfRy5BdXRvUmFpbmJvd0hha2kgb3IgX0cuQXV0b0VsaXRlSHVudGVyIG9yIF9HLkF1dG9DYXN0bGVSYWlkIG9yIAogICAgICAgICAgICAgICAgICAgX0cuQXV0b011c2tldGVlckhhdCBvciBfRy5BdXRvQnVkZHlTd29yZCBvcgogICAgICAgICAgICAgICAgICAgX0cuQXV0b0Zhcm1Cb25lIG9yIF9HLkF1dG9LZW5IYWtpVjIgb3IgX0cuQXV0b09ic2VydmF0aW9uIG9yIAogICAgICAgICAgICAgICAgICAgX0cuQXV0b0dvZEh1bWFuIG9yIF9HLkF1dG9DYXZhbmRlciBvcgogICAgICAgICAgICAgICAgICAgX0cuQXV0b0N1cnNlZER1YWxLYXRhbmEgb3IgX0cuQXV0b1lhbWFTd29yZCBvciBfRy5BdXRvVHVzaGl0YVN3b3JkIG9yIAogICAgICAgICAgICAgICAgICAgX0cuQXV0b1NlcnBlbnRCb3dvciBvciBfRy5BdXRvRGFya0RhZ2dlciBvciBfRy5BdXRvQ2FrZVByaW5jZSBvciAKICAgICAgICAgICAgICAgICAgIF9HLkF1dG9Eb3VnaFYyIG9yIF9HLkF1dG9Ib2x5VG9yY2ggb3IgX0cuQXV0b0J1ZGR5U3dvcmRzIG9yIAogICAgICAgICAgICAgICAgICAgX0cuQXV0b0Zhcm1Cb3NzSGFsbG93IG9yIF9HLlRQVE9CT0FUIG9yIF9HLlR1c2hpdGFfUXVlc3QyIG9yIF9HLlR1c2hpdGFfUXVlc3QxIG9yCiAgICAgICAgICAgICAgICAgICBfRy5BdXRvRmFybU1hdGVyaWFsIG9yIF9HLnRlbGVwb3J0dG9wIG9yIF9HLkF1dG9GYXJtQ2hlc3Qgb3IgX0cuVG9EcmFnb25IdW50ZXIgb3IgCiAgICAgICAgICAgICAgICAgICBfRy5UcHRvS2lzdW5lSXNsYW5kIG9yIF9HLkF1dG9RdWVzdERvam8gb3IgX0cuVG9Eb2pvIG9yIF9HLkF1dG9RdWVzdERvam8gb3IgCiAgICAgICAgICAgICAgICAgICBfRy5BdXRvUXVlc3REcmFnb25IdW50ZXIgb3IgX0cubmNwIG9yIF9HLlRQQiBvciBfRy5mYXJtc2VhZXZlbnQgb3IgCiAgICAgICAgICAgICAgICAgICBfRy5kcmFnb25odW50ZXJxdWVzdCBvciBfRy5CdXlCb2F0IG9yIF9HLkF1dG9GaW5kSXNsYW5kIG9yIF9HLkF1dG9TZWFiZXN0RmFybSBvciAKICAgICAgICAgICAgICAgICAgIF9HLnZvbGNhbm9Sb2NrcyBvciBfRy5BdXRvU2VhQmVzdCBvciBfRy5UbnBjIG9yIF9HLkNvbGxlY3RCb25lIG9yCiAgICAgICAgICAgICAgICAgICAtLVtNYXN0ZXJ5XQogICAgICAgICAgICAgICAgICAgX0cuQXV0b0Zhcm1GcnVpdE1hc3Rlcnkgb3IgX0cuQXV0b0Zhcm1HdW5NYXN0ZXJ5IG9yIAogICAgICAgICAgICAgICAgICAgLS1bUmFpZHNdCiAgICAgICAgICAgICAgICAgICBfRy5BdXRvUmFpZHMgb3IgX0cuQXV0b05leHRQbGFjZSBvciBfRy5BdXRvX0tpbGxfTGF3IG9yIF9HLkF1dG9fS2lsbF9QbGF5ZXJzX05lYXJieSB0aGVuCiAgICAgICAgICAgICAgICAgICAgX0cuQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0OkZpbmRGaXJzdENoaWxkKCJCb2R5Q2xpcCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgTm9jbGlwID0gSW5zdGFuY2UubmV3KCJCb2R5VmVsb2NpdHkiKQogICAgICAgICAgICAgICAgICAgICAgICBOb2NsaXAuTmFtZSA9ICJCb2R5Q2xpcCIKICAgICAgICAgICAgICAgICAgICAgICAgTm9jbGlwLlBhcmVudCA9IENoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgICAgICAgICAgICAgICAgIE5vY2xpcC5NYXhGb3JjZSA9IFZlY3RvcjMubmV3KDEwMDAwMCwgMTAwMDAwLCAxMDAwMDApCiAgICAgICAgICAgICAgICAgICAgICAgIE5vY2xpcC5WZWxvY2l0eSA9IFZlY3RvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuQ2FuQ29sbGlkZSA9IGZhbHNlICAgIAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIaWdobGlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEhpZ2hsaWdodCA9IEluc3RhbmNlLm5ldygiSGlnaGxpZ2h0IikKICAgICAgICAgICAgICAgICAgICAgICAgSGlnaGxpZ2h0LkZpbGxDb2xvciA9IENvbG9yMy5uZXcoMCwgMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgSGlnaGxpZ2h0Lk91dGxpbmVDb2xvciA9IENvbG9yMy5uZXcoMCwgMCwgMSkgCiAgICAgICAgICAgICAgICAgICAgICAgIEhpZ2hsaWdodC5GaWxsVHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgICAgICAgICBIaWdobGlnaHQuT3V0bGluZVRyYW5zcGFyZW5jeSA9IDAgCiAgICAgICAgICAgICAgICAgICAgICAgIEhpZ2hsaWdodC5QYXJlbnQgPSBDaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmFibGVBbnRpRmFsbCgpCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsRmFsbFN0YXRlKCkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfRy5CcmluZ01vYiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQ6RmluZEZpcnN0Q2hpbGQoIkJvZHlDbGlwIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydDpGaW5kRmlyc3RDaGlsZCgiQm9keUNsaXAiKTpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBDaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhpZ2hsaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIaWdobGlnaHQiKTpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBkaXNhYmxlQW50aUZhbGwoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICBzZXR1cENoYXJhY3RlcihMb2NhbFBsYXllci5DaGFyYWN0ZXIpCiAgICAgICAgZW5kCiAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihuZXdDaGFyYWN0ZXIpCiAgICAgICAgICAgIHNldHVwQ2hhcmFjdGVyKG5ld0NoYXJhY3RlcikKICAgICAgICBlbmQpCiAgICAgICAgTG9jYWxQbGF5ZXIuQW5jZXN0cnlDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXI6SXNEZXNjZW5kYW50T2YoZ2FtZSkgdGhlbgogICAgICAgICAgICAgICAgaWYgc3RlcHBlZENvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICAgICAgICAgIHN0ZXBwZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKZW5kKQoKLS0gW0JyaW5nTW9uXQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIGlmIHNldHNjcmlwdGFibGUgdGhlbiBzZXRzY3JpcHRhYmxlKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCB0cnVlKSBlbmQKICAgIGlmIHNldGhpZGRlbnByb3BlcnR5IHRoZW4gc2V0aGlkZGVucHJvcGVydHkoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkgZW5kCmVuZCkKCmZ1bmN0aW9uIEluTXlOZXRXb3JrKG9iamVjdCkKICAgIGlmIGlzbmV0d29ya293bmVyIHRoZW4gcmV0dXJuIGlzbmV0d29ya293bmVyKG9iamVjdCkgZW5kCiAgICByZXR1cm4gKG9iamVjdC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDUwMCAtLSDguJvguKPguLHguJrguKPguLDguKLguLAKZW5kCgpsb2NhbCBMb2NhbFBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuQnJpbmdNb2IgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uLlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMzAwIGFuZCBub3Qgc3RyaW5nLmZpbmQodi5OYW1lLCJCb3NzIikgIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgSW5NeU5ldFdvcmsodi5IdW1hbm9pZFJvb3RQYXJ0KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBQb3NNb24KICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLDUwLDUwKQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsICBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCmlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlN0dW4iKSB0aGVuCglnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlN0dW4uQ2hhbmdlZDpjb25uZWN0KGZ1bmN0aW9uKCkKCQlwY2FsbChmdW5jdGlvbigpCgkJCWlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlN0dW4iKSB0aGVuCgkJCQlnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlN0dW4uVmFsdWUgPSAwCgkJCWVuZAoJCWVuZCkKCWVuZCkKZW5kCgpmdW5jdGlvbiBEaXNhYmxlZERhbWFnZSgpCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoJ1J1blNlcnZpY2UnKS5TdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBfRy5EaXNkYW1hZ2UgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5Bc3NldHMuR1VJLkRhbWFnZUNvdW50ZXIuRW5hYmxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLkFzc2V0cy5HVUkuRGFtYWdlQ291bnRlci5FbmFibGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQpCiAgICBlbmQpCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCdSdW5TZXJ2aWNlJykuU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl06R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkN1cnZlZFJpbmciIG9yIHYuTmFtZSA9PSAiU2xhc2hIaXQiIG9yIHYuTmFtZSA9PSAiU3dvcmRTbGFzaCIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB2OkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCdSdW5TZXJ2aWNlJykuU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5FZmZlY3QuQ29udGFpbmVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkRlYXRoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpIAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCmVuZAoKZnVuY3Rpb24gQ29tKGNvbSwgLi4uKQpsb2NhbCBSZW1vdGUgPSBnYW1lOkdldFNlcnZpY2UoJ1JlcGxpY2F0ZWRTdG9yYWdlJykuUmVtb3RlczpGaW5kRmlyc3RDaGlsZCgiQ29tbSIgLi4gY29tKQppZiBSZW1vdGU6SXNBKCJSZW1vdGVFdmVudCIpIHRoZW4KUmVtb3RlOkZpcmVTZXJ2ZXIoLi4uKQplbHNlaWYgUmVtb3RlOklzQSgiUmVtb3RlRnVuY3Rpb24iKSB0aGVuClJlbW90ZTpJbnZva2VTZXJ2ZXIoLi4uKQplbmQKZW5kCgpsb2NhbCBhY3RpdmVUd2VlbnMgPSB7fQoKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS83ODc4d3F6L3NjMS9yZWZzL2hlYWRzL21haW4vZmF0YmJmZjInKSkoKQoKZnVuY3Rpb24gVFBCKENGZ28sIHZlaGljbGVTZWF0KQogICAgbG9jYWwgdHdlZW5fcyA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIikKICAgIGlmIHZlaGljbGVTZWF0IHRoZW4KICAgICAgICBwcmludCgiVFBCIGNhbGxlZCB0byIsIENGZ28uUG9zaXRpb24pCiAgICAgICAgbG9jYWwgaW5mbyA9IFR3ZWVuSW5mby5uZXcoKHZlaGljbGVTZWF0LkNGcmFtZS5Qb3NpdGlvbiAtIENGZ28uUG9zaXRpb24pLk1hZ25pdHVkZSAvIDM1MCwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpCiAgICAgICAgbG9jYWwgdHdlZW4gPSB0d2Vlbl9zOkNyZWF0ZSh2ZWhpY2xlU2VhdCwgaW5mbywge0NGcmFtZSA9IENGZ299KQogICAgICAgIHR3ZWVuOlBsYXkoKQogICAgICAgIHRhYmxlLmluc2VydChhY3RpdmVUd2VlbnMsIHR3ZWVuKQogICAgICAgIHJldHVybiB7IFN0b3AgPSBmdW5jdGlvbigpIHR3ZWVuOkNhbmNlbCgpIGVuZCB9CiAgICBlbmQKZW5kCgoKbG9jYWwgdHdlZW4gCgpsb2NhbCBmdW5jdGlvbiBHZXRJc0xhbmQoLi4uKQogICAgbG9jYWwgUmVhbHRhcmdldFBvcyA9IHsgLi4uIH0KICAgIGxvY2FsIHRhcmdldFBvcyA9IFJlYWx0YXJnZXRQb3NbMV0KICAgIGxvY2FsIFJlYWxUYXJnZXQKICAgIAogICAgaWYgdHlwZSh0YXJnZXRQb3MpID09ICJ2ZWN0b3IiIHRoZW4KICAgICAgICBSZWFsVGFyZ2V0ID0gdGFyZ2V0UG9zCiAgICBlbHNlaWYgdHlwZSh0YXJnZXRQb3MpID09ICJ1c2VyZGF0YSIgdGhlbgogICAgICAgIFJlYWxUYXJnZXQgPSB0YXJnZXRQb3MuUG9zaXRpb24KICAgIGVsc2VpZiB0eXBlKHRhcmdldFBvcykgPT0gIm51bWJlciIgdGhlbgogICAgICAgIFJlYWxUYXJnZXQgPSBDRnJhbWUubmV3KHVucGFjayhSZWFsdGFyZ2V0UG9zKSkKICAgICAgICBSZWFsVGFyZ2V0ID0gUmVhbFRhcmdldC5Qb3NpdGlvbgogICAgZW5kCgogICAgbG9jYWwgUmV0dXJuVmFsdWUKICAgIGxvY2FsIENoZWNrSW5PdXQgPSBtYXRoLmh1Z2UKICAgIAogICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLlRlYW0gdGhlbgogICAgICAgIGxvY2FsIHRlYW1TcGF3bnMgPSBnYW1lLldvcmtzcGFjZS5fV29ybGRPcmlnaW4uUGxheWVyU3Bhd25zOkZpbmRGaXJzdENoaWxkKHRvc3RyaW5nKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5UZWFtKSkKICAgICAgICBpZiB0ZWFtU3Bhd25zIHRoZW4KICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnModGVhbVNwYXduczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgUmVNYWduaXR1ZGUgPSAoUmVhbFRhcmdldCAtIHY6R2V0TW9kZWxDRnJhbWUoKS5Qb3NpdGlvbikuTWFnbml0dWRlIAogICAgICAgICAgICAgICAgaWYgUmVNYWduaXR1ZGUgPCBDaGVja0luT3V0IHRoZW4KICAgICAgICAgICAgICAgICAgICBDaGVja0luT3V0ID0gUmVNYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICBSZXR1cm5WYWx1ZSA9IHYuTmFtZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGlmIFJldHVyblZhbHVlIHRoZW4KICAgICAgICAgICAgcmV0dXJuIFJldHVyblZhbHVlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBHbG9iYWxFbnYgPSAoZ2V0Z2VudiBvciBnZXRyZW52IG9yIGdldGZlbnYpKCkKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFR3ZWVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIikKCkdsb2JhbEVudi5oYXNSb3RhdGVkID0gR2xvYmFsRW52Lmhhc1JvdGF0ZWQgb3IgZmFsc2UKCmxvY2FsIGZ1bmN0aW9uIHRvVGFyZ2V0KC4uLikKICAgIGxvY2FsIFJlYWx0YXJnZXRQb3MgPSB7IC4uLiB9CiAgICBsb2NhbCB0YXJnZXRQb3MgPSBSZWFsdGFyZ2V0UG9zWzFdCiAgICBsb2NhbCBSZWFsVGFyZ2V0CiAgICAKICAgIGlmIHR5cGUodGFyZ2V0UG9zKSA9PSAidmVjdG9yIiB0aGVuCiAgICAgICAgUmVhbFRhcmdldCA9IENGcmFtZS5uZXcodGFyZ2V0UG9zKQogICAgZWxzZWlmIHR5cGUodGFyZ2V0UG9zKSA9PSAidXNlcmRhdGEiIHRoZW4KICAgICAgICBSZWFsVGFyZ2V0ID0gdGFyZ2V0UG9zCiAgICBlbHNlaWYgdHlwZSh0YXJnZXRQb3MpID09ICJudW1iZXIiIHRoZW4KICAgICAgICBSZWFsVGFyZ2V0ID0gQ0ZyYW1lLm5ldyh1bnBhY2soUmVhbHRhcmdldFBvcykpCiAgICBlbmQKCiAgICAtLSDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguJXguLHguKfguKXguLDguITguKPguJXguLLguKLguKvguKPguLfguK3guYTguKHguYgKICAgIGlmIFBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKS5IZWFsdGggPT0gMCB0aGVuCiAgICAgICAgaWYgdHdlZW4gdGhlbiAKICAgICAgICAgICAgdHdlZW46Q2FuY2VsKCkgCiAgICAgICAgZW5kCiAgICAgICAgcmVwZWF0IAogICAgICAgICAgICB3YWl0KCkgCiAgICAgICAgdW50aWwgUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpLkhlYWx0aCA+IDAgCiAgICAgICAgd2FpdCgwLjIpCiAgICBlbmQKCiAgICBsb2NhbCB0d2VlbmZ1bmMgPSB7fQogICAgbG9jYWwgcGxheWVyUG9zID0gUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuUG9zaXRpb24KICAgIGxvY2FsIHRhcmdldFBvcyA9IFJlYWxUYXJnZXQuUG9zaXRpb24KICAgIAogICAgbG9jYWwgRGlzdGFuY2UgPSBtYXRoLnNxcnQoKHRhcmdldFBvcy5YIC0gcGxheWVyUG9zLlgpXjIgKyAodGFyZ2V0UG9zLlogLSBwbGF5ZXJQb3MuWileMikKICAgIGxvY2FsIFNwZWVkCiAgICAKICAgIGlmIG5vdCBHbG9iYWxFbnYuaGFzUm90YXRlZCBhbmQgRGlzdGFuY2UgPj0gMjAwIHRoZW4KICAgICAgICBQbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAxODAsIDApCiAgICAgICAgR2xvYmFsRW52Lmhhc1JvdGF0ZWQgPSB0cnVlCiAgICAgICAKICAgIGVuZAoKICAgIGlmIERpc3RhbmNlIDwgNSB0aGVuCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgU3RvcCA9IGZ1bmN0aW9uKCkgZW5kLAogICAgICAgICAgICBXYWl0ID0gZnVuY3Rpb24oKSBlbmQKICAgICAgICB9CiAgICBlbmQKICAgIAogICAgaWYgRGlzdGFuY2UgPCA1MCB0aGVuCiAgICAgICAgU3BlZWQgPSAxMDAwCiAgICAgICAgUmVhbFRhcmdldCA9IFJlYWxUYXJnZXQgKiBDRnJhbWUubmV3KDAsIDAsIDApCiAgICBlbHNlaWYgRGlzdGFuY2UgPCAxNTAgdGhlbgogICAgICAgIFNwZWVkID0gMTAwMAogICAgICAgIFJlYWxUYXJnZXQgPSBSZWFsVGFyZ2V0ICogQ0ZyYW1lLm5ldygwLCAxODAsIDApCiAgICBlbHNlaWYgRGlzdGFuY2UgPCAyNTAgdGhlbgogICAgICAgIFNwZWVkID0gNjAwIAogICAgICAgIFJlYWxUYXJnZXQgPSBSZWFsVGFyZ2V0ICogQ0ZyYW1lLm5ldygwLCAxODAsIDApCiAgICBlbHNlaWYgRGlzdGFuY2UgPCA1MDAgdGhlbgogICAgICAgIFNwZWVkID0gMzUwCiAgICAgICAgUmVhbFRhcmdldCA9IFJlYWxUYXJnZXQgKiBDRnJhbWUubmV3KDAsIDE4MCwgMCkKICAgIGVsc2VpZiBEaXN0YW5jZSA8IDc1MCB0aGVuCiAgICAgICAgU3BlZWQgPSAzMDAKICAgICAgICBSZWFsVGFyZ2V0ID0gUmVhbFRhcmdldCAqIENGcmFtZS5uZXcoMCwgMTgwLCAwKQogICAgZWxzZSAKICAgICAgICBTcGVlZCA9IDI1MAogICAgICAgIGxvY2FsIGN1cnJlbnRQb3MgPSBwbGF5ZXJQb3MKICAgICAgICBsb2NhbCBuZXdZID0gY3VycmVudFBvcy5ZICsgMTgwCiAgICAgICAgUmVhbFRhcmdldCA9IENGcmFtZS5uZXcoUmVhbFRhcmdldC5Qb3NpdGlvbi5YLCBuZXdZLCBSZWFsVGFyZ2V0LlBvc2l0aW9uLlopCiAgICBlbmQgCgogICAgbG9jYWwgaW5mbyA9IFR3ZWVuSW5mby5uZXcoCiAgICAgICAgRGlzdGFuY2UgLyBTcGVlZCwgCiAgICAgICAgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIKICAgICkKICAgIAogICAgbG9jYWwgdHdlZW53LCBlcnIgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgdHdlZW4gPSBUd2VlblNlcnZpY2U6Q3JlYXRlKFBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyWyJIdW1hbm9pZFJvb3RQYXJ0Il0sIGluZm8sIHsgQ0ZyYW1lID0gUmVhbFRhcmdldCB9KQogICAgICAgIHR3ZWVuOlBsYXkoKQogICAgICAgIAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgdHdlZW4gYW5kIHR3ZWVuLlBsYXliYWNrU3RhdGUgPT0gRW51bS5QbGF5YmFja1N0YXRlLlBsYXlpbmcgZG8KICAgICAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICAgICAgbG9jYWwgY3VycmVudFBvcyA9IFBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpLlBvc2l0aW9uCiAgICAgICAgICAgICAgICBsb2NhbCBjdXJyZW50RGlzdGFuY2UgPSBtYXRoLnNxcnQoKHRhcmdldFBvcy5YIC0gY3VycmVudFBvcy5YKV4yICsgKHRhcmdldFBvcy5aIC0gY3VycmVudFBvcy5aKV4yKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjdXJyZW50RGlzdGFuY2UgPCA1IHRoZW4KICAgICAgICAgICAgICAgICAgICB0d2VlbjpDYW5jZWwoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIC0tIOC4o+C4teC5gOC4i+C5h+C4lSBoYXNSb3RhdGVkIOC5gOC4oeC4t+C5iOC4rSBUd2VlbiDguYDguKrguKPguYfguIjguKrguLTguYnguJkgKOC4luC5ieC4suC4leC5ieC4reC4h+C4geC4suC4o+C5g+C4q+C5ieC4q+C4oeC4uOC4meC5hOC4lOC5ieC4reC4teC4geC4hOC4o+C4seC5ieC4h+C5g+C4mSBUd2VlbiDguJbguLHguJTguYTguJspCiAgICAgICAgICAgIEdsb2JhbEVudi5oYXNSb3RhdGVkID0gZmFsc2UKICAgICAgICBlbmQpCiAgICBlbmQpCiAgICAKICAgIGlmIG5vdCB0d2VlbncgdGhlbgogICAgICAgIHdhcm4oIlR3ZWVuIGNyZWF0aW9uIGZhaWxlZDogIiAuLiB0b3N0cmluZyhlcnIpKQogICAgZW5kCiAgICAKICAgIGZ1bmN0aW9uIHR3ZWVuZnVuYzpTdG9wKCkKICAgICAgICBpZiB0d2VlbiB0aGVuCiAgICAgICAgICAgIHR3ZWVuOkNhbmNlbCgpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgZnVuY3Rpb24gdHdlZW5mdW5jOldhaXQoKQogICAgICAgIGlmIHR3ZWVuIHRoZW4KICAgICAgICAgICAgdHdlZW4uQ29tcGxldGVkOldhaXQoKQogICAgICAgIGVuZAogICAgZW5kCgogICAgcmV0dXJuIHR3ZWVuZnVuYwplbmQKCmZ1bmN0aW9uIEdldERpc3RhbmNlKHRhcmdldCkKCXJldHVybiBtYXRoLmZsb29yKCh0YXJnZXQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSkKZW5kCgpsb2NhbCBhY3RpdmVUd2VlbnMgPSB7fQoKbG9jYWwgZnVuY3Rpb24gdHdlZW5Nb2RlbChtb2RlbCwgZ29Ub0NGcmFtZSkKICAgIGFjdGl2ZVR3ZWVucyA9IHt9CgogICAgbG9jYWwgb3duZXIgPSBtb2RlbDpGaW5kRmlyc3RDaGlsZCgiT3duZXIiKQogICAgaWYgb3duZXIgYW5kIG93bmVyOklzQSgiT2JqZWN0VmFsdWUiKSBhbmQgb3duZXIuVmFsdWUgdGhlbgogICAgICAgIGxvY2FsIG93bmVyTmFtZSA9IG93bmVyLlZhbHVlLk5hbWUKICAgICAgICBpZiBvd25lck5hbWUgPT0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWUgdGhlbgogICAgICAgICAgICBsb2NhbCBUd2VlblNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCiAgICAgICAgICAgIGZvciBfLCBwYXJ0IGluIHBhaXJzKG1vZGVsOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaW5mbyA9IFR3ZWVuSW5mby5uZXcoKHBhcnQuUG9zaXRpb24gLSBnb1RvQ0ZyYW1lLlBvc2l0aW9uKS5NYWduaXR1ZGUgLyAyMDAsIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHR3ZWVuID0gVHdlZW5TZXJ2aWNlOkNyZWF0ZShwYXJ0LCBpbmZvLCB7IENGcmFtZSA9IGdvVG9DRnJhbWUgfSkKICAgICAgICAgICAgICAgICAgICB0d2VlbjpQbGF5KCkKICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoYWN0aXZlVHdlZW5zLCB0d2VlbikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0b3BCb2F0RigpCiAgICBmb3IgXywgdHdlZW4gaW4gcGFpcnMoYWN0aXZlVHdlZW5zKSBkbwogICAgICAgIGlmIHR3ZWVuIHRoZW4KICAgICAgICAgICAgdHdlZW46Q2FuY2VsKCkKICAgICAgICBlbmQKICAgIGVuZAogICAgYWN0aXZlVHdlZW5zID0ge30gCmVuZAoKX0cuc3RvcEJvYXRGID0gc3RvcEJvYXRGCgoKCmZ1bmN0aW9uIEhvcCgpCnJlcGVhdCB3YWl0KCkgdW50aWwgZ2FtZTpJc0xvYWRlZCgpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgSHR0cFNlcnZpY2UsIFRQU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSAiSHR0cFNlcnZpY2UiLCBnYW1lOkdldFNlcnZpY2UgIlRlbGVwb3J0U2VydmljZSI7CmxvY2FsIE90aGVyU2VydmVycyA9IEh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoZ2FtZTpIdHRwR2V0KCJodHRwczovL2dhbWVzLnJvYmxveC5jb20vci9nYW1lcy8iIC4uCmdhbWUuUGxhY2VJZCAuLiAiL3NlcnZlcnMvUHVibGljP3NvcnRPcmRlcj1Bc2MmbGltaXQ9MTAwIikpCmZ1bmN0aW9uIGpvaW5OZXcoKQppZiBub3QgaXNmaWxlKCdzZXJ2ZXJzLnNzcycpIHRoZW4Kd3JpdGVmaWxlKCdzZXJ2ZXJzLnNzcycsIEh0dHBTZXJ2aWNlOkpTT05FbmNvZGUoe30pKQplbmQKbG9jYWwgZG9udEpvaW4gPSByZWFkZmlsZSgnc2VydmVycy5zc3MnKQpkb250Sm9pbiA9IEh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoZG9udEpvaW4pCgpmb3IgSW5kZXgsIFNlcnZlciBpbiBuZXh0LCBPdGhlclNlcnZlcnNbImRhdGEiXSBkbwppZiBTZXJ2ZXIgfj0gZ2FtZS5Kb2JJZCB0aGVuCiAgICBsb2NhbCBqID0gdHJ1ZQogICAgZm9yIGEsIGMgaW4gcGFpcnMoZG9udEpvaW4pIGRvCiAgICAgICAgaWYgYyA9PSBTZXJ2ZXIuaWQgdGhlbgogICAgICAgICAgICBqID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgaiB0aGVuCiAgICAgICAgdGFibGUuaW5zZXJ0KGRvbnRKb2luLCBTZXJ2ZXJbImlkIl0pCiAgICAgICAgd3JpdGVmaWxlKCJzZXJ2ZXJzLnNzcyIsIEh0dHBTZXJ2aWNlOkpTT05FbmNvZGUoZG9udEpvaW4pKQogICAgICAgIHdhaXQoKQogICAgICAgIHJldHVybiBTZXJ2ZXJbJ2lkJ10KICAgIGVuZAplbmQKZW5kCmVuZAoKbG9jYWwgc2VydmVyID0gam9pbk5ldygpCmlmIG5vdCBzZXJ2ZXIgdGhlbgp3cml0ZWZpbGUoInNlcnZlcnMuc3NzIiwgSHR0cFNlcnZpY2U6SlNPTkVuY29kZSh7fSkpCmxvY2FsIHNlcnZlciA9IGpvaW5OZXcoKQpUUFNlcnZpY2U6VGVsZXBvcnRUb1BsYWNlSW5zdGFuY2UoZ2FtZS5QbGFjZUlkLCBzZXJ2ZXIpCmVsc2UKVFBTZXJ2aWNlOlRlbGVwb3J0VG9QbGFjZUluc3RhbmNlKGdhbWUuUGxhY2VJZCwgc2VydmVyKQplbmQKZW5kCgpmdW5jdGlvbiBHZXRGaWdodGluZ1N0eWxlKFN0eWxlKQpSZXR1cm5UZXh0ID0gIiIKZm9yIGksIHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCmlmIHY6SXNBKCJUb29sIikgdGhlbgogICAgaWYgdi5Ub29sVGlwID09IFN0eWxlIHRoZW4KICAgICAgICBSZXR1cm5UZXh0ID0gdi5OYW1lCiAgICBlbmQKZW5kCmVuZApmb3IgaSwgdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldENoaWxkcmVuKCkpIGRvCmlmIHY6SXNBKCJUb29sIikgdGhlbgogICAgaWYgdi5Ub29sVGlwID09IFN0eWxlIHRoZW4KICAgICAgICBSZXR1cm5UZXh0ID0gdi5OYW1lCiAgICBlbmQKZW5kCmVuZAppZiBSZXR1cm5UZXh0IH49ICIiIHRoZW4KcmV0dXJuIFJldHVyblRleHQKZWxzZQpyZXR1cm4gIk5vdCBIYXZlIgplbmQKZW5kCgpmdW5jdGlvbiBDaGVja01hc3RlcnlXZWFwb24oTmFtZVdlLCBNYXNOdW0pCmlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZChOYW1lV2UpIHRoZW4KaWYgdG9udW1iZXIoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKE5hbWVXZSkuTGV2ZWwuVmFsdWUpIDwgdG9udW1iZXIoTWFzTnVtKSB0aGVuCiAgICByZXR1cm4gInRydWUgRG93blRvIgplbHNlaWYgdG9udW1iZXIoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKE5hbWVXZSkuTGV2ZWwuVmFsdWUpID49IHRvbnVtYmVyKE1hc051bSkgdGhlbgogICAgcmV0dXJuICJ0cnVlIFVwVG8iCmVuZAplbmQKaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChOYW1lV2UpIHRoZW4KaWYgdG9udW1iZXIoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChOYW1lV2UpLkxldmVsLlZhbHVlKSA8IHRvbnVtYmVyKE1hc051bSkgdGhlbgogICAgcmV0dXJuICJ0cnVlIERvd25UbyIKZWxzZWlmIHRvbnVtYmVyKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoTmFtZVdlKS5MZXZlbC5WYWx1ZSkgPj0gdG9udW1iZXIoTWFzTnVtKSB0aGVuCiAgICByZXR1cm4gInRydWUgVXBUbyIKZW5kCmVuZApyZXR1cm4gImVsc2UiCmVuZAoKbG9jYWwgQWxsTWF0ZXJpYWwKaWYgV29ybGQzIHRoZW4KICAgIEFsbE1hdGVyaWFsID0geyJNaW5pIFR1c2siLCJGaXNoIFRhaWwiLCJTY3JhcCBNZXRhbCIsIkRyYWdvbiBTY2FsZSIsIkNvbmp1cmVkIENvY29hIiwiRGVtb25pYyBXaXNwIiwiR3VucG93ZGVyIix9CmVuZAoKdGFibGUuc29ydChBbGxNYXRlcmlhbCkKCmxvY2FsIGZ1bmN0aW9uIEN1c3RvbUZpbmRGaXJzdENoaWxkKHRhYmxlbmFtZSkKZm9yIGksIHYgaW4gcGFpcnModGFibGVuYW1lKSBkbwppZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQodikgdGhlbgogICAgcmV0dXJuIHRydWUKZW5kCmVuZApyZXR1cm4gZmFsc2UKZW5kCgoKbG9jYWwgQWxsTWF0ZXJpYWwKaWYgV29ybGQzIHRoZW4KICAgIEFsbE1hdGVyaWFsID0geyJNaW5pIFR1c2siLCJGaXNoIFRhaWwiLCJTY3JhcCBNZXRhbCIsIkRyYWdvbiBTY2FsZSIsIkNvbmp1cmVkIENvY29hIiwiRGVtb25pYyBXaXNwIiwiR3VucG93ZGVyIix9CmVuZAp0YWJsZS5zb3J0KEFsbE1hdGVyaWFsKQpsb2NhbCBmdW5jdGlvbiBDdXN0b21GaW5kRmlyc3RDaGlsZCh0YWJsZW5hbWUpCmZvciBpLCB2IGluIHBhaXJzKHRhYmxlbmFtZSkgZG8KaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKHYpIHRoZW4KICAgIHJldHVybiB0cnVlCmVuZAplbmQKcmV0dXJuIGZhbHNlCmVuZApsb2NhbCBmdW5jdGlvbiBDaGVja01hdGVyaWFsKHYxKQppZiBXb3JsZDMgdGhlbgogICAgaWYgKHYxID09ICJNaW5pIFR1c2siKSB0aGVuCiAgICAgICAgTWF0ZXJpYWxNb2IgPSB7ICJNeXRob2xvZ2ljYWwgUGlyYXRlIiB9OwogICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTEzNTQ1LCA0NzAsIC02OTE3KTsKICAgIGVsc2VpZiAodjEgPT0gIkZpc2ggVGFpbCIpIHRoZW4KICAgICAgICBNYXRlcmlhbE1vYiA9IHsgIkZpc2htYW4gUmFpZGVyIiwgIkZpc2htYW4gQ2FwdGFpbiIgfTsKICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0xMDk5MywgMzMyLCAtODk0MCk7CiAgICBlbHNlaWYgKHYxID09ICJTY3JhcCBNZXRhbCIpIHRoZW4KICAgICAgICBNYXRlcmlhbE1vYiA9IHsgIkp1bmdsZSBQaXJhdGUiIH07CiAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMTIxMDcsIDMzMiwgLTEwNTQ5KTsKICAgIGVsc2VpZiAodjEgPT0gIkRyYWdvbiBTY2FsZSIpIHRoZW4KICAgICAgICBNYXRlcmlhbE1vYiA9IHsgIkRyYWdvbiBDcmV3IEFyY2hlciIsICJEcmFnb24gQ3JldyBXYXJyaW9yIiB9OwogICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoNjU5NCwgMzgzLCAxMzkpOwogICAgZWxzZWlmICh2MSA9PSAiQ29uanVyZWQgQ29jb2EiKSB0aGVuCiAgICAgICAgTWF0ZXJpYWxNb2IgPSB7ICJDb2NvYSBXYXJyaW9yIiwgIkNob2NvbGF0ZSBCYXIgQmF0dGxlciIsICJTd2VldCBUaGllZiIsCiAgICAgICAgICAgICJDYW5keSBSZWJlbCIgfTsKICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KDYyMC42MzQ0NjA0NDkyMTg4LCA3OC45MzY0NDcxNDM1NTQ2OSwgLTEyNTgxLjM2OTE0MDYyNSk7CiAgICBlbHNlaWYgKHYxID09ICJEZW1vbmljIFdpc3AiKSB0aGVuCiAgICAgICAgTWF0ZXJpYWxNb2IgPSB7ICJEZW1vbmljIFNvdWwiIH07CiAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtOTUwNywgMTcyLCA2MTU4KTsKICAgIGVsc2VpZiAodjEgPT0gIkd1bnBvd2RlciIpIHRoZW4KICAgICAgICBNYXRlcmlhbE1vYiA9IHsgIlBpc3RvbCBCaWxsaW9uYWlyZSIgfTsKICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC00NjksIDc0LCA1OTA0KTsKICAgIGVuZAogICAgZW5kCmVuZAogICAgbG9jYWwgVXBkYXRlID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9hamtkMmUyMTQxc2RmMTIxNDE1NjQzZGZ2YmN3MzQ3NTg0ZmdoM28vaG1tL3JlZnMvaGVhZHMvbWFpbi9zMiIpKSgpCiAgICBsb2NhbCBMaWJyYXJ5ID0gVXBkYXRlOldpbmRvdygiVmVjdG9yIEh1YiIsIiIsIiIsRW51bS5LZXlDb2RlLkYxKTsKICAgIGxvY2FsIHBhZ2UxNSA9IExpYnJhcnk6VGFiKCJTdGF0dXNcbuC4quC5gOC4leC4leC4seC4qiIsInJieGFzc2V0aWQ6Ly8xNjE0OTExMTczMSIpCiAgICBsb2NhbCBwYWdlMSA9IExpYnJhcnk6VGFiKCJHZW5lcmFsXG7guKvguJnguYnguLLguKvguKXguLHguIEiLCJyYnhhc3NldGlkOi8vNjAzNDc5ODQ2MSIpCiAgICBsb2NhbCBwYWdlMiA9IExpYnJhcnk6VGFiKCJTZXR0aW5nc1xu4LiV4Lix4LmJ4LiH4LiE4LmI4LiyIiwicmJ4YXNzZXRpZDovLzExNDQ2ODM1MzM2IikKICAgIGxvY2FsIHBhZ2UzID0gTGlicmFyeTpUYWIoIlN0YXRzXG7guKrguYHguJXguIQiLCJyYnhhc3NldGlkOi8vMTUwMTEyMTQyOTMiKQogICAgbG9jYWwgcGFnZTQgPSBMaWJyYXJ5OlRhYigiVGVsZXBvcnRcbuC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4lSIsInJieGFzc2V0aWQ6Ly8xMjY4OTk3ODU3NSIpCiAgICBsb2NhbCBwYWdlMTMgPSBMaWJyYXJ5OlRhYigiUHZQXG7guJXguYjguK3guKrguLnguYkiLCJyYnhhc3NldGlkOi8vNzQ4NTA1MTcxNSIpCiAgICBsb2NhbCBwYWdlNiA9IExpYnJhcnk6VGFiKCJNYXN0ZXJ5XG7guKHguLLguKrguYDguJXguK3guKPguLXguYgiLCJyYnhhc3NldGlkOi8vOTM0Mzg3NzcwNTQ1OTkiKQogICAgbG9jYWwgcGFnZTcgPSBMaWJyYXJ5OlRhYigiRGV2aWxGcnVpdFxu4Lic4Lil4Lib4Li14Lio4Liy4LiIIiwicmJ4YXNzZXRpZDovLzEzMDg4MjY0NiIpCiAgICBsb2NhbCBwYWdlOCA9IExpYnJhcnk6VGFiKCJSYWlkXG7guJTguLHguJnguYDguIjguLXguYnguKLguJkiLCJyYnhhc3NldGlkOi8vMTMxODAxNzkwNTUiKQogICAgbG9jYWwgcGFnZTkgPSBMaWJyYXJ5OlRhYigiTWlyYWdlSXNsYW5kXG7guYDguIHguLLguLDguKXguLHguJoiLCJyYnhhc3NldGlkOi8vMTI1OTg1OTQyNDMiKQogICAgbG9jYWwgcGFnZTEwID0gTGlicmFyeTpUYWIoIlJhY2VcbuC5gOC4nOC5iOC4siIsInJieGFzc2V0aWQ6Ly83NTU4NzgyNTkwIikKICAgIGxvY2FsIHBhZ2U1ID0gTGlicmFyeTpUYWIoIkl0ZW1zXG7guYTguK3guYDguJfguYfguKEiLCJyYnhhc3NldGlkOi8vMTI0OTk4NDI5MjAiKQogICAgbG9jYWwgcGFnZTE0ID0gTGlicmFyeTpUYWIoIlNlYSBFdmVudFxu4Lit4Li14LmA4Lin4LmJ4LiZ4LiX4LmM4LiX4Liw4LmA4LilIiwicmJ4YXNzZXRpZDovLzEyMjQyOTMxNzM4IikKICAgIGxvY2FsIHBhZ2UxNiA9IExpYnJhcnk6VGFiKCJEcmFnb24gRXZlbnRcbuC4reC4teC5gOC4p+C5ieC4meC4l+C5jOC4oeC4seC4h+C4geC4oyIsInJieGFzc2V0aWQ6Ly8xMjcwOTIyNTc1NiIpCiAgICBsb2NhbCBwYWdlMTEgPSBMaWJyYXJ5OlRhYigiU2hvcFxu4Lij4LmJ4Liy4LiZ4LiE4LmJ4LiyIiwicmJ4YXNzZXRpZDovLzYwMzEyNjU5NzYiKQogICAgbG9jYWwgcGFnZTEyID0gTGlicmFyeTpUYWIoIk90aGVyXG7guK3guLfguYjguJnguYYiLCJyYnhhc3NldGlkOi8vMTE0NDcwNjM3OTEiKQogICAgVGltZSA9IHBhZ2UxNTpMYWJlbCgiLi4iKQogICAgcGFnZTE1OkxhYmVsKCJbVXNlcm5hbWVdIDogIi4uZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkRpc3BsYXlOYW1lKQogICAgZnVuY3Rpb24gVXBkYXRlVGltZSgpCiAgICBsb2NhbCBHYW1lVGltZSA9IG1hdGguZmxvb3Iod29ya3NwYWNlLkRpc3RyaWJ1dGVkR2FtZVRpbWUrMC41KQogICAgbG9jYWwgSG91ciA9IG1hdGguZmxvb3IoR2FtZVRpbWUvKDYwXjIpKSUyNAogICAgbG9jYWwgTWludXRlID0gbWF0aC5mbG9vcihHYW1lVGltZS8oNjBeMSkpJTYwCiAgICBsb2NhbCBTZWNvbmQgPSBtYXRoLmZsb29yKEdhbWVUaW1lLyg2MF4wKSklNjAKICAgIFRpbWU6U2V0KCJbR2FtZVRpbWVdIDogSG91ciA6ICIuLkhvdXIuLiIgTWludXRlIDogIi4uTWludXRlLi4iIFNlY29uZCA6ICIuLlNlY29uZCkKICAgIGVuZAogICAgCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBVcGRhdGVUaW1lKCkKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICBDbGllbnQgPSBwYWdlMTU6TGFiZWwxKCJDbGllbnQiKQogICAgZnVuY3Rpb24gVXBkYXRlQ2xpZW50KCkKICAgIGxvY2FsIEZwcyA9IHdvcmtzcGFjZTpHZXRSZWFsUGh5c2ljc0ZQUygpCiAgICBDbGllbnQ6UmVmcmVzaCgiW0Zwc10gOiAiLi5GcHMpCiAgICBlbmQKICAgIAogICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRydWUgZG8gd2FpdCguMSkKICAgICAgICBVcGRhdGVDbGllbnQoKQogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICBDbGllbnQxID0gcGFnZTE1OkxhYmVsMSgiQ2xpZW50IikKICAgIGZ1bmN0aW9uIFVwZGF0ZUNsaWVudDEoKQogICAgbG9jYWwgUGluZyA9IGdhbWU6R2V0U2VydmljZSgiU3RhdHMiKS5OZXR3b3JrLlNlcnZlclN0YXRzSXRlbVsiRGF0YSBQaW5nIl06R2V0VmFsdWVTdHJpbmcoKQogICAgQ2xpZW50MTpSZWZyZXNoKCJbUGluZ10gOiAiLi5QaW5nKQogICAgZW5kCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdHJ1ZSBkbyB3YWl0KC4xKQogICAgICAgIFVwZGF0ZUNsaWVudDEoKQogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICBsb2NhbCBNaXJyYWdlY2hlY2sgPSBwYWdlMTU6TGFiZWwoJy4uLicpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICBpZiBnYW1lLldvcmtzcGFjZS5fV29ybGRPcmlnaW4uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCdNaXJhZ2UgSXNsYW5kJykgdGhlbgogICAgICAgICAgICAgICAgTWlycmFnZWNoZWNrOlNldCgnU3RhdHVzIE1pcmFnZUlzbGFuZCA6IPCfn6JcbuC4quC4luC4suC4meC4sOC5gOC4geC4suC4sOC4peC4seC4micpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIE1pcnJhZ2VjaGVjazpTZXQoJ1N0YXR1cyBNaXJhdGVJc2xhbmQgOiDwn5S0XG7guKrguJbguLLguJnguLDguYDguIHguLLguLDguKXguLHguJonKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgS2l0c3VuZWNoZWNrID0gcGFnZTE1OkxhYmVsKCcuLi4nKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgaWYgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnS2l0c3VuZSBJc2xhbmQnKSB0aGVuCiAgICAgICAgICAgICAgICBLaXRzdW5lY2hlY2s6U2V0KCdTdGF0dXMgS2l0c3VuZUlzbGFuZCA6IPCfn6JcbuC4quC4luC4suC4meC4sOC5gOC4geC4suC4sOC4iOC4tOC5ieC4h+C4iOC4reC4gScpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIEtpdHN1bmVjaGVjazpTZXQoJ1N0YXR1cyBLaXRzdW5lSXNsYW5kIDog8J+UtFxu4Liq4LiW4Liy4LiZ4Liw4LmA4LiB4Liy4Liw4LiI4Li04LmJ4LiH4LiI4Lit4LiBJykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmxvY2FsIFByZWhpc3RvcmljSXNsYW5kY2hlY2sgPSBwYWdlMTU6TGFiZWwoJy4uLicpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkgCiAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgaWYgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnUHJlaGlzdG9yaWMgSXNsYW5kJykgdGhlbgogICAgICAgICAgICAgICAgUHJlaGlzdG9yaWNJc2xhbmRjaGVjazpTZXQoJ1N0YXR1cyBQcmVoaXN0b3JpY0lzbGFuZCA6IPCfn6JcbuC4quC4luC4suC4meC4sOC5gOC4geC4suC4sOC4oOC4ueC5gOC4guC4suC5hOC4nycpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIFByZWhpc3RvcmljSXNsYW5kY2hlY2s6U2V0KCdTdGF0dXMgUHJlaGlzdG9yaWNJc2xhbmQgOiDwn5S0XG7guKrguJbguLLguJnguLDguYDguIHguLLguLDguKDguLnguYDguILguLLguYTguJ8nKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKCmxvY2FsIEZNID0gcGFnZTE1OkxhYmVsKCcuLi4nKQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikuU2t5Lk1vb25UZXh0dXJlSWQ9PSJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTk3MDkxNDk0MzEiIHRoZW4KICAgICAgICAgICAgICAgIEZNOlNldCgiU3RhdHVzIE1vb24gOiA1LzUg8J+MlVxu4Liq4LiW4Liy4LiZ4Liw4LiU4Lin4LiH4LiI4Lix4LiZ4LiX4Lij4LmMIikKICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKS5Ta3kuTW9vblRleHR1cmVJZD09Imh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9OTcwOTE0OTA1MiIgdGhlbgogICAgICAgICAgICAgICAgRk06U2V0KCJTdGF0dXMgTW9vbiA6IDQvNSDwn4yWXG7guKrguJbguLLguJnguLDguJTguKfguIfguIjguLHguJnguJfguKPguYwiKQogICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpLlNreS5Nb29uVGV4dHVyZUlkPT0iaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD05NzA5MTQzNzMzIiB0aGVuCiAgICAgICAgICAgICAgICBGTTpTZXQoIlN0YXR1cyBNb29uIDogMy81IPCfjJdcbuC4quC4luC4suC4meC4sOC4lOC4p+C4h+C4iOC4seC4meC4l+C4o+C5jCIpCiAgICAgICAgICAgIGVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikuU2t5Lk1vb25UZXh0dXJlSWQ9PSJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTk3MDkxNTA0MDEiIHRoZW4KICAgICAgICAgICAgICAgIEZNOlNldCgiU3RhdHVzIE1vb24gOiAyLzUg8J+MmFxu4Liq4LiW4Liy4LiZ4Liw4LiU4Lin4LiH4LiI4Lix4LiZ4LiX4Lij4LmMIikKICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKS5Ta3kuTW9vblRleHR1cmVJZD09Imh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9OTcwOTE0OTY4MCIgdGhlbgogICAgICAgICAgICAgICAgRk06U2V0KCJTdGF0dXMgTW9vbiA6IDEvNSDwn4yYXG7guKrguJbguLLguJnguLDguJTguKfguIfguIjguLHguJnguJfguKPguYwiKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBGTTpTZXQoIlN0YXR1cyBNb29uIDogMC81IPCfjJhcbuC4quC4luC4suC4meC4sOC4lOC4p+C4h+C4iOC4seC4meC4l+C4o+C5jCIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCnBhZ2UxNTpMYWJlbCgiSm9pbiBEaXNjb3JkIEZvciBOZXdzXG7guYDguILguYnguLLguJTguLTguKrguITguK3guKPguYzguJTguYDguJ7guLfguYjguK3guILguYjguLLguKfguKrguLLguKPguJXguYjguLLguIfguYYiKQpwYWdlMTU6QnV0dG9uKCJDb3B5IExpbmsgRGlzY29yZFxu4LiB4LmH4Lit4Lib4Lib4Li14LmJ4Lil4Li04LmJ4LiH4LiU4Li04Liq4LiE4Lit4Lij4LmM4LiUIixmdW5jdGlvbigpCiAgICBzZXRjbGlwYm9hcmQoImh0dHBzOi8vZGlzY29yZC5nZy85NzdKUVhYODJ3IikKZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIse1RpdGxlID0gIlZlY3Rvckh1YiIsVGV4dCA9ICLguITguLHguJTguKXguK3guIHguYDguKPguLXguKLguJrguKPguYnguK3guKLguYHguKXguYnguKciLEljb24gPSAicmJ4YXNzZXRpZDovLzE2MTI5MjM1MDU0IixEdXJhdGlvbiA9IDN9KQplbmQpCnBhZ2UxOlNlcGVyYXRvcigi8J+PoCIpCnBhZ2UxOlRvZ2dsZSgiQXV0b0Zhcm1MZXZlbFxu4Lit4Lit4LmC4LiV4LmJ4Lif4Liy4Lij4LmM4Lih4LmA4Lil4LmA4Lin4LilIiwgX0cuU2V0dGluZ3MuQXV0b0Zhcm0sIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b0Zhcm0gPSB2YWx1ZQogICAgX0cuU2V0dGluZ3MuQXV0b0Zhcm0gPSB2YWx1ZQogICAgU2F2ZVNldHRpbmdzKCkKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICBlbmQKZW5kKSAgCgpwYWdlMTpUb2dnbGUoIlNhZmVNb2RlXG7guYDguIvguJ/guYLguKvguKHguJQiLCBfRy5TZXR0aW5ncy5TYWZlTW9kZSwgZnVuY3Rpb24odmFsdWUpCl9HLlNhZmVNb2RlID0gdmFsdWUKX0cuU2V0dGluZ3MuU2FmZU1vZGUgPSB2YWx1ZQpTYXZlU2V0dGluZ3MoKQpsb2NhbCBIZWFsdGhQZXJjZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggLyBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLk1heEhlYWx0aCAqIDEwMAppZiBIZWFsdGhQZXJjZW50IDwgMjAgdGhlbgpWZWMoIjxDb2xvcj1DeWFuPlNhZmVNb2RlUnVubmluZy4uXG7guYDguIvguJ/guYLguKvguKHguJTguJfguLPguIfguLLguJkuLjxDb2xvcj0vPiIpICAKZW5kCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIF9HLlNldHRpbmdzLlNhZmVNb2RlIGRvIHRhc2sud2FpdCgpCiAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgIGlmIEhlYWx0aFBlcmNlbnQgPCAyMCB0aGVuCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgMTAwLCAwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB0YXNrLndhaXQoKQogICAgZW5kCmVuZCkKZW5kKQogICAgICAgICAgICAKcGFnZTE6VG9nZ2xlKCJOZWFyZWFzdEZhcm1cbuC4n+C4suC4o+C5jOC4oeC4oeC4reC4meC4o+C4reC4muC5hiIsIF9HLlNldHRpbmdzLk5lYXJlYXN0RmFybSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5OZWFyZWFzdEZhcm0gPSB2YWx1ZQogICAgX0cuU2V0dGluZ3MuTmVhcmVhc3RGYXJtID0gdmFsdWUKICAgIFNhdmVTZXR0aW5ncygpIAogICAgaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgogICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgIGVuZAplbmQpCiAgICAKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCguMSkgZG8KICAgICAgICBpZiBfRy5TZXR0aW5ncy5OZWFyZWFzdEZhcm0gdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA8PSAxNTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDp3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhc0J1c28iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSAiQnVzbyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsIDY3MikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLk5lYXJlYXN0RmFybSBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPT0gMCBvciBub3QgZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpGaW5kRmlyc3RDaGlsZCh2Lk5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCiAgICAgICAgICAgIAogICAgIAoKQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPSAxCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbyAKICAgICAgICBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9IG1hdGgucmFuZG9tKDEsNSkKICAgICAgICB3YWl0KDAuMikKICAgIGVuZAplbmQpICAgICAKX0cuQXV0b19DRnJhbWUgPSB0cnVlCmxvY2FsIFNldENGYXJtZSA9IDEKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBsb2NhbCBNeUxldmVsID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkRhdGEuTGV2ZWwuVmFsdWUKICAgICAgICBsb2NhbCBRdWVzdEMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdAogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuQXV0b0Zhcm0gdGhlbiAgCiAgICAgICAgICAgICAgICBpZiBRdWVzdEMuVmlzaWJsZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoUXVlc3RDaGVjaygpWzNdKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gUXVlc3RDaGVjaygpWzNdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b19DRnJhbWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldENGYXJtZSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQsIFF1ZXN0Q2hlY2soKVs2XSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkFiYW5kb25RdWVzdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNjAsNjAsNjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5CcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0Zhcm0gb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDwgMSBvciBRdWVzdEMuVmlzaWJsZSA9PSBmYWxzZSBvciBub3QgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvX0NGcmFtZSBhbmQgbm90IF9HLkF1dG9GYXJtRmFzdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bU2V0Q0Zhcm1lXSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUXVlc3RDaGVjaygpWzddW1NldENGYXJtZV0uUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBTZXRDRmFybWUgPT0gbmlsIG9yIFNldENGYXJtZSA9PSAnJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldENGYXJtZSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgU2V0Q0Zhcm1lID49ICNRdWVzdENoZWNrKClbN10gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXRDRmFybWUgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0Q0Zhcm1lID0gIFNldENGYXJtZSArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuQXV0b0Zhcm1GYXN0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygwLDMwLDIwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVs3XVsxXSAqIENGcmFtZS5uZXcoMCwzMCwtMjApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSAzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygyMCwzMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gNCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVs3XVsxXSAqIENGcmFtZS5uZXcoMCwzMCwtMjApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSA1IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygtMjAsMzAsMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bMV0gKiBDRnJhbWUubmV3KDAsMzAsMjApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVsyXSkKICAgICAgICAgICAgICAgICAgICBpZiAoUXVlc3RDaGVjaygpWzJdLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgX0cuQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuMikKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCdSZXBsaWNhdGVkU3RvcmFnZScpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RhcnRRdWVzdCIsIFF1ZXN0Q2hlY2soKVs0XSwgUXVlc3RDaGVjaygpWzFdKSB3YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bMV0gKiBDRnJhbWUubmV3KDAsMzAsMjApKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gMiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygwLDMwICwtMjApKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gMyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bMV0gKiBDRnJhbWUubmV3KDIwLDMwICwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIEF0dGFja1JhbmRvbVR5cGVfTW9uQ0ZyYW1lID09IDQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygwLDMwICwtMjApKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gNSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bMV0gKiBDRnJhbWUubmV3KC0yMCwzMCAsMCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVs3XVsxXSAqIENGcmFtZS5uZXcoMCwzMCAsMjApKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQogICAgCiAgICBwYWdlMTpTZXBlcmF0b3IoIkNoZXN0L+C4geC4peC5iOC4reC4hyIpCiAgICBwYWdlMTpUb2dnbGUoIkF1dG8gRmFybSBDaGVzdCBbVHdlZW5dXG7guJ/guLLguKPguYzguKHguIHguKXguYjguK3guIcgW+C4muC4tOC4meC5gOC4geC5h+C4ml0iLCBfRy5TZXR0aW5ncy5BdXRvRmFybUNoZXN0LCBmdW5jdGlvbih2YWx1ZSkKICAgICAgICBfRy5BdXRvRmFybUNoZXN0ID0gdmFsdWUKICAgICAgICBfRy5TZXR0aW5ncy5BdXRvRmFybUNoZXN0ID0gdmFsdWUKICAgICAgICAgICAgU2F2ZVNldHRpbmdzKCkKICAgICAgICBpZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgcGFnZTE6VG9nZ2xlKCJBdXRvIEZhcm0gQ2hlc3QgW0Zhc3Q6Umlza11cbuC4n+C4suC4o+C5jOC4oeC4geC4peC5iOC4reC4hyBb4LmA4Lij4LmH4LinOuC5gOC4quC4teC5iOC4ouC4h10iLCBfRy5DaGVzdEJ5cGFzcywgZnVuY3Rpb24odmFsdWUpCiAgICAgICAgX0cuQ2hlc3RCeXBhc3MgPSB2YWx1ZQogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBsb2NhbCBpc2xhbmRzID0ge30KICAgIGlmIFdvcmxkMyB0aGVuIAogICAgICAgIGlzbGFuZHMgPSB7CiAgICAgICAgICAgICJCb2F0IENhc3RsZSIsCiAgICAgICAgICAgICJDYWtlTG9hZiIsCiAgICAgICAgICAgICJDYWtlTG9hZiIsCiAgICAgICAgICAgICJGaXNobWVuIiwKICAgICAgICAgICAgIkNob2NvbGF0ZUlzbGFuZCIsCiAgICAgICAgICAgICJHcmVhdCBUcmVlIiwKICAgICAgICAgICAgIkhhdW50ZWQgQ2FzdGxlIiwKICAgICAgICAgICAgIkljZSBDcmVhbSBJc2xhbmQiLAogICAgICAgICAgICAiTWluaVNreSIsCiAgICAgICAgICAgICJQZWFudXQgSXNsYW5kIiwKICAgICAgICAgICAgIlBvcnQiLAogICAgICAgICAgICAiVGVtcGxlIG9mIFRpbWUiLAogICAgICAgICAgICAiVGlraU91dHBvc3QiLAogICAgICAgICAgICAiVHVydGxlIiwKICAgICAgICAgICAgIldhdGVyZmFsbCIKICAgICAgICB9CiAgICAgICAgZW5kCiAgICBfRy5NYWduaXR1ZGVBZGQgPSAwCiAgICBsb2NhbCBmdW5jdGlvbiBnZXREaXN0YW5jZShvYmpDRnJhbWUpCiAgICAgICAgbG9jYWwgaHJwID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgaWYgaHJwIGFuZCBvYmpDRnJhbWUgdGhlbgogICAgICAgICAgICByZXR1cm4gKG9iakNGcmFtZS5Qb3NpdGlvbiAtIGhycC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIG1hdGguaHVnZQogICAgZW5kCiAgICAKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICBpZiBfRy5BdXRvRmFybUNoZXN0IG9yIF9HLkNoZXN0QnlwYXNzIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikKICAgICAgICAgICAgICAgIGxvY2FsIGhycCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgaWYgbm90IGhycCB0aGVuIHdhaXQoKSBlbmQKICAgICAgICAgICAgICAgIGxvY2FsIGFsbENoZXN0cyA9IHt9CiAgICAgICAgICAgICAgICBmb3IgXywgaXNsYW5kTmFtZSBpbiBwYWlycyhpc2xhbmRzKSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIGlzbGFuZCA9IHdvcmtzcGFjZS5NYXA6RmluZEZpcnN0Q2hpbGQoaXNsYW5kTmFtZSkKICAgICAgICAgICAgICAgICAgICBpZiBpc2xhbmQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhpc2xhbmQ6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHYuTmFtZSwgIkNoZXN0IikgYW5kIHY6SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoYWxsQ2hlc3RzLCB2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBsb2NhbCBjaGVzdE1vZGVscyA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiQ2hlc3RNb2RlbHMiKQogICAgICAgICAgICAgICAgaWYgY2hlc3RNb2RlbHMgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGNoZXN0TW9kZWxzOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHYuTmFtZSwgIkNoZXN0IikgYW5kIHY6SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChhbGxDaGVzdHMsIHYpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YWJsZS5zb3J0KGFsbENoZXN0cywgZnVuY3Rpb24oYSwgYikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RGlzdGFuY2UoYS5DRnJhbWUpIDwgZ2V0RGlzdGFuY2UoYi5DRnJhbWUpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBmb3IgXywgY2hlc3QgaW4gaXBhaXJzKGFsbENoZXN0cykgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IGdldERpc3RhbmNlKGNoZXN0LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA8PSAoX0cuTWFnbml0dWRlQWRkICsgMzAwMCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRmFybUNoZXN0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHR3ZWVuRnVuYyA9IHRvVGFyZ2V0KGNoZXN0LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuRnVuYzpXYWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLk1hZ25pdHVkZUFkZCA9IF9HLk1hZ25pdHVkZUFkZCArIDE1MDAKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIF9HLkNoZXN0QnlwYXNzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhycC5DRnJhbWUgPSBjaGVzdC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLk1hZ25pdHVkZUFkZCA9IF9HLk1hZ25pdHVkZUFkZCArIDE1MDAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICBpZiBXb3JsZDMgdGhlbiAKICAgICAgICBwYWdlMTpTZXBlcmF0b3IoIlN0YXR1cyA6IFdvcmxkIDNcbuC4quC4luC4suC4meC4sCA6IOC5guC4peC4gSAzIikKICAgICAgICAgICAgcGFnZTE6VG9nZ2xlKCJBdXRvIFJhaW5ib3dIYWtpXG7guJfguLPguK7guLLguITguLTguKrguLXguKPguLjguYnguIciLCBfRy5BdXRvUmFpbmJvd0hha2ksZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgICAgICBfRy5BdXRvUmFpbmJvd0hha2kgPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9SYWluYm93SGFraSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygtMTE4OTIuMDcwMzEyNSwgOTMwLjU3NjcyMTE5MTQxLCAtODc2MC4xNTkxNzk2ODc1KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChWZWN0b3IzLm5ldygtMTE4OTIuMDcwMzEyNSwgOTMwLjU3NjcyMTE5MTQxLCAtODc2MC4xNTkxNzk2ODc1KSAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMzAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMS41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkhvcm5lZE1hbiIsIkJldCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gdHJ1ZSBhbmQgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCwgIlN0b25lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJTdG9uZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJTdG9uZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKF9HLlNlbGVjdFdlYXBvbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5GYXN0QXR0YWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b1JhaW5ib3dIYWtpIG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAgb3Igbm90IHYuUGFyZW50IG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xMDg2LjExNjIxLCAzOC44NDI1OTAzLCA2NzY4LjcxNDM2LCAwLjAyMzE0NjI3MTcsLTAuNTkyNjc2Njk5LDAuODA1MTA3NzcyLCAyLjAzMjUxODM5ZS0wNSwgMC44MDUzMjM4MzksIDAuNTkyODM1MTI4LCAtMC45OTk3MzIwNzcsLTAuMDEzNzA1NTUxNiwgMC4wMTg2NTIzMTk5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSA9PSB0cnVlIGFuZCBzdHJpbmcuZmluZChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0LCAiSXNsYW5kIEVtcHJlc3MiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCBFbXByZXNzIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIklzbGFuZCBFbXByZXNzIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoX0cuU2VsZWN0V2VhcG9uKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9HLkZhc3RBdHRhY2sgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsIDY3MikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg4MCwgODAsIDgwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSnVtcFBvd2VyID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDExKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvUmFpbmJvd0hha2kgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3Qgdi5QYXJlbnQgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSA9PSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoNTcxMy45ODg3NywgNjAxLjkyMjk3NCwgMjAyLjc1MTI1MSwgLTAuMTAxMDgwMjkxLCAtMCwtMC45OTQ4NzgyOTIsIC0wLCAxLCAtMCwgMC45OTQ4NzgyOTIsIDAsIC0wLjEwMTA4MDI5MSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQsICJLaWxvIEFkbWlyYWwiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIktpbG8gQWRtaXJhbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJLaWxvIEFkbWlyYWwiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChfRy5TZWxlY3RXZWFwb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc01vbiA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9SYWluYm93SGFraSBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIG5vdCB2LlBhcmVudCBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5WaXNpYmxlID09IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygyODc3LjYxNzQzLCA0MjMuNTU4Njg1LCAtNzIwNy4zMTAwNiwgLTAuOTg5NTkxNTk5LCAtMCwtMC4xNDM5MDQ5MDksIC0wLCAxLjAwMDAwMDEyLCAtMCwgMC4xNDM5MDQ5MjQsIDAsIC0wLjk4OTU5MTQ3OSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQsICJDYXB0YWluIEVsZXBoYW50IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDYXB0YWluIEVsZXBoYW50IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkNhcHRhaW4gRWxlcGhhbnQiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChfRy5TZWxlY3RXZWFwb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc01vbiA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9SYWluYm93SGFraSBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIG5vdCB2LlBhcmVudCBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5WaXNpYmxlID09IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTEzNDg1LjAyODMsIDMzMS43MDkyNTksIC04MDEyLjQ4NzMsIDAuNzE0NTIxMjg5LDcuOTg4NDk5MTFlLTA4LDAuNjk5NjEzNzUsIC0xLjAyMDY1NzQ4ZS0wNywgMSwgLTkuOTQzODMwNjVlLTA5LCAtMC42OTk2MTM3NSwgLTYuNDMwMTUyNDFlLTA4LDAuNzE0NTIxMjg5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCwgIkJlYXV0aWZ1bCBQaXJhdGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkJlYXV0aWZ1bCBQaXJhdGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiQmVhdXRpZnVsIFBpcmF0ZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKF9HLlNlbGVjdFdlYXBvbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5GYXN0QXR0YWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b1JhaW5ib3dIYWtpIG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAgb3Igbm90IHYuUGFyZW50IG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KDUzMTIuMzU5ODYzMjgxMywgMjAuMTQxMjAxMDE5Mjg3LCAtMTAuMTU4NTM4ODE4MzU5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xMTg5Mi4wNzAzMTI1LCA5MzAuNTc2NzIxMTkxNDEsIC04NzYwLjE1OTE3OTY4NzUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFZlY3RvcjMubmV3KC0xMTg5Mi4wNzAzMTI1LCA5MzAuNTc2NzIxMTkxNDEsIC04NzYwLjE1OTE3OTY4NzUpIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAzMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCgxLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiSG9ybmVkTWFuIiwiQmV0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKSAgICAgICAgIAogICAgICAgIAogICAgICAgIHBhZ2UxOlRvZ2dsZSgiQXV0byBIb2x5VG9yY2hcbm7guIjguLjguJTguITguJrguYDguJ7guKXguLTguIciLCBfRy5BdXRvSG9seVRvcmNoLCBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgX0cuQXV0b0hvbHlUb3JjaCA9IHZhbHVlCiAgICAgICAgICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgICAgICBpZiBfRy5BdXRvSG9seVRvcmNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJyaXBfaW5kcmEgVHJ1ZSBGb3JtIFtMdi4gNTAwMF0gW1JhaWQgQm9zc10iKSBvciBnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJyaXBfaW5kcmEgVHJ1ZSBGb3JtIFtMdi4gNTAwMF0gW1JhaWQgQm9zc10iKSBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlR1c2hpdGFHYXRlLlR1c2hpdGFHYXRlLlRyYW5zcGFyZW5jeSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJIb2x5IFRvcmNoIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oIkhvbHkgVG9yY2giKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSG9seSBUb3JjaCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2gxLlBhcnRpY2xlcy5NYWluLkVuYWJsZWQgfj0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2gxLlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPiAzMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb2x5VG9yY2h0d2VlbiA9IHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2gxLlBvc2l0aW9uLGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2gxLkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2gxLlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMzAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSG9seVRvcmNodHdlZW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSG9seVRvcmNodHdlZW46U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBnYW1lLldvcmtzcGFjZS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDEuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDIuUGFydGljbGVzLk1haW4uRW5hYmxlZCB+PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDIuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA+IDMwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvbHlUb3JjaHR3ZWVuID0gdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDIuUG9zaXRpb24sZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDIuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDIuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA8PSAzMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBIb2x5VG9yY2h0d2VlbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb2x5VG9yY2h0d2VlbjpTdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IGdhbWUuV29ya3NwYWNlLk1hcC5UdXJ0bGUuUXVlc3RUb3JjaGVzLlRvcmNoMi5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5UdXJ0bGUuUXVlc3RUb3JjaGVzLlRvcmNoMy5QYXJ0aWNsZXMuTWFpbi5FbmFibGVkIH49IHRydWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5UdXJ0bGUuUXVlc3RUb3JjaGVzLlRvcmNoMy5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlID4gMzAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSG9seVRvcmNodHdlZW4gPSB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5UdXJ0bGUuUXVlc3RUb3JjaGVzLlRvcmNoMy5Qb3NpdGlvbixnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5UdXJ0bGUuUXVlc3RUb3JjaGVzLlRvcmNoMy5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5UdXJ0bGUuUXVlc3RUb3JjaGVzLlRvcmNoMy5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDMwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEhvbHlUb3JjaHR3ZWVuIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvbHlUb3JjaHR3ZWVuOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gZ2FtZS5Xb3Jrc3BhY2UuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2gzLkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2g0LlBhcnRpY2xlcy5NYWluLkVuYWJsZWQgfj0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2g0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPiAzMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb2x5VG9yY2h0d2VlbiA9IHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2g0LlBvc2l0aW9uLGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2g0LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlR1cnRsZS5RdWVzdFRvcmNoZXMuVG9yY2g0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMzAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSG9seVRvcmNodHdlZW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSG9seVRvcmNodHdlZW46U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBnYW1lLldvcmtzcGFjZS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDUuUGFydGljbGVzLk1haW4uRW5hYmxlZCB+PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDUuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA+IDMwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvbHlUb3JjaHR3ZWVuID0gdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDUuUG9zaXRpb24sZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDUuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuVHVydGxlLlF1ZXN0VG9yY2hlcy5Ub3JjaDUuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA8PSAzMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBIb2x5VG9yY2h0d2VlbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb2x5VG9yY2h0d2VlbjpTdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IGdhbWUuV29ya3NwYWNlLk1hcC5UdXJ0bGUuUXVlc3RUb3JjaGVzLlRvcmNoNS5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5XYXRlcmZhbGwuU2VjcmV0Um9vbS5Sb29tLkRvb3IuRG9vci5IaXRib3guQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBFbGl0ZSgpCiAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRWxpdGVIdW50ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5WaXNpYmxlID09IHRydWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCwgIkRpYWJsbyIpIG9yIHN0cmluZy5maW5kKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0LCAiVXJiYW4iKSBvciBzdHJpbmcuZmluZChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCwgIkRlYW5kcmUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQodi5OYW1lLCAiRGlhYmxvIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbGl0ZUh1bnRlciA9IHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA8PSAxNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgRWxpdGVIdW50ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVsaXRlSHVudGVyOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gdgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZCh2Lk5hbWUsICJVcmJhbiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRWxpdGVIdW50ZXIgPSB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMTUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEVsaXRlSHVudGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbGl0ZUh1bnRlcjpTdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQodi5OYW1lLCAiRGVhbmRyZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRWxpdGVIdW50ZXIgPSB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMTUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEVsaXRlSHVudGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbGl0ZUh1bnRlcjpTdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRWxpdGVIdW50ZXIgYW5kIHN0cmluZy5maW5kKHYuTmFtZSwgIkRpYWJsbyIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA+IDE1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFybXR3ZWVuID0gdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMTUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBGYXJtdHdlZW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXJtdHdlZW46U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHYgLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvRWxpdGVIdW50ZXIgb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9FbGl0ZUh1bnRlciBhbmQgc3RyaW5nLmZpbmQodi5OYW1lLCAiVXJiYW4iKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPiAxNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhcm10d2VlbiA9IHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDE1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgRmFybXR3ZWVuIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFybXR3ZWVuOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSB2IC5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0VsaXRlSHVudGVyIG9yIG5vdCB2LlBhcmVudCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRWxpdGVIdW50ZXIgYW5kIHN0cmluZy5maW5kKHYuTmFtZSwgIkRlYW5kcmUiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPiAxNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhcm10d2VlbiA9IHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDE1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgRmFybXR3ZWVuIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFybXR3ZWVuOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSB2IC5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0VsaXRlSHVudGVyIG9yIG5vdCB2LlBhcmVudCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmluZ18xID0gIkVsaXRlSHVudGVyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldCA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzWyJDb21tRl8iXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRhcmdldDpJbnZva2VTZXJ2ZXIoc3RyaW5nXzEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmluZ18xID0gIkVsaXRlSHVudGVyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXNbIkNvbW1GXyJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYXJnZXQ6SW52b2tlU2VydmVyKHN0cmluZ18xKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGlmIF9HLkF1dG9FbGl0ZUh1bnRlckhvcCB0aGVuICAKICAgICAgICAgICAgICAgIGlmIG5vdCAoZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRGVhbmRyZSIpIG9yIGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlVyYmFuIikgb3IgZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRGlhYmxvIikgb3IgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCgiRGVhbmRyZSIpIG9yIGdhbWUuUmVwbGljYXRlZFN0b3JhZ2U6RmluZEZpcnN0Q2hpbGQoIlVyYmFuIikgb3IgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCgiRGlhYmxvIikpIHRoZW4KICAgICAgICAgICAgICAgICAgICB3YWl0KDEwKQogICAgICAgICAgICAgICAgICAgIEhvcCgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kICAgICAgIAogICAgICAgIAogICAgICAgIGxvY2FsIEVsaXRlX0h1bnRlcl9TdGF0dXMgPSBwYWdlMTpMYWJlbCgiU3RhdHVzIDogTi9RIikKICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJEaWFibG8iKSBvciBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIkRlYW5kcmUiKSBvciBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIlVyYmFuIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJEaWFibG8iKSBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkRlYW5kcmUiKSBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlVyYmFuIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgRWxpdGVfSHVudGVyX1N0YXR1czpTZXQoIlN0YXR1cyA6IPCfn6JcbuC4quC4luC4suC4meC4sCIpIAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbGl0ZV9IdW50ZXJfU3RhdHVzOlNldCgiU3RhdHVzIDog8J+UtFxu4Liq4LiW4Liy4LiZ4LiwIikgCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgbG9jYWwgRWxpdGVQcm9ncmVzcyA9IHBhZ2UxOkxhYmVsKCIiKQogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgICAgICAgICBFbGl0ZVByb2dyZXNzOlNldCgiS2lsbGVkIDogIiAuLiBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJFbGl0ZUh1bnRlciIsICJQcm9ncmVzcyIpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQpCiAgICAgICAgCiAgICBwYWdlMTpUb2dnbGUoIkF1dG8gRWxpdGVIdW50ZXIgSG9wXG7guK3guK3guYLguJXguYnguJXguLUg4Lit4Li14Lil4Li04LiX4Liu4Lix4LiZ4LmA4LiV4Lit4Lij4LmMIOC4ouC5ieC4suC4ouC5gOC4i+C4tOC4nyIsIF9HLkF1dG9FbGl0ZUh1bnRlckhvcCwgZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIF9HLkF1dG9FbGl0ZUh1bnRlckhvcCA9IHZhbHVlIAogICAgICAgICAgICBFbGl0ZSgpCiAgICAgICAgICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgIHRvVGFyZ2V0KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBwYWdlMTpUb2dnbGUoIkF1dG8gRWxpdGVIdW50ZXJcbuC4reC4reC5guC4leC5ieC4leC4tSDguK3guLXguKXguLTguJfguK7guLHguJnguYDguJXguK3guKPguYwiLCBfRy5BdXRvRWxpdGVIdW50ZXIsZnVuY3Rpb24odmFsdWUpCiAgICAgICAgX0cuQXV0b0VsaXRlSHVudGVyID0gdmFsdWUKICAgICAgICBFbGl0ZSgpCiAgICAgICAgICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgIHRvVGFyZ2V0KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBwYWdlMTpUb2dnbGUoIkF1dG8gQ2FzdGxlUmFpZFxu4Lit4Lit4LmC4LiV4LmJ4LiV4Li14LmC4LiI4Lij4LmA4LiB4Liy4Liw4LiB4Lil4Liy4LiHIiwgX0cuQXV0b0Nhc3RsZVJhaWQsIGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBfRy5BdXRvQ2FzdGxlUmFpZCA9IHZhbHVlCiAgICAgICAgICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b0Nhc3RsZVJhaWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ0ZyYW1lLm5ldygtNTExOC40ODY4MiwgMzE0LjU0MTI5LCAtMjk1OC42NDQwNCwgLTAuMzg3MjMyMTI1LCAxLjgxNTA3ODU4ZS0wOCwgMC45MjE5ODIyMjksIC03LjU0Mzg4OTA3ZS0wOCwgMSwgLTUuMTM3MDk5OTllLTA4LCAtMC45MjE5ODIyMjksIC04Ljk0NDU4MTk2ZS0wOCwgLTAuMzg3MjMyMTI1KS5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMjAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbi1nYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDEwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgd2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDYwLCA2MCwgNjApICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvQ2FzdGxlUmFpZCBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKENGcmFtZS5uZXcoLTUxMTguNDg2ODIsIDMxNC41NDEyOSwgLTI5NTguNjQ0MDQsIC0wLjM4NzIzMjEyNSwgMS44MTUwNzg1OGUtMDgsIDAuOTIxOTgyMjI5LCAtNy41NDM4ODkwN2UtMDgsIDEsIC01LjEzNzA5OTk5ZS0wOCwgLTAuOTIxOTgyMjI5LCAtOC45NDQ1ODE5NmUtMDgsIC0wLjM4NzIzMjEyNSkuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDIwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbi1nYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDEwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC01MTE4LjQ4NjgyLCAzMTQuNTQxMjksIC0yOTU4LjY0NDA0LCAtMC4zODcyMzIxMjUsIDEuODE1MDc4NThlLTA4LCAwLjkyMTk4MjIyOSwgLTcuNTQzODg5MDdlLTA4LCAxLCAtNS4xMzcwOTk5OWUtMDgsIC0wLjkyMTk4MjIyOSwgLTguOTQ0NTgxOTZlLTA4LCAtMC4zODcyMzIxMjUpKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkgIAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgbG9jYWwgY291bnRfbnVtYmVyID0gMAogICAgICAgIGxvY2FsIGNvdW50X3N0YWNrID0gcGFnZTE6TGFiZWwoJ0JvbmUgOiAnIC4uIGNvdW50X251bWJlciwgdHJ1ZSkKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBib25lU3RhdHVzID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQm9uZXMiLCAiQ2hlY2siKQogICAgICAgICAgICAgICAgY291bnRfc3RhY2s6U2V0KCdCb25lIDogJyAuLiBib25lU3RhdHVzKQogICAgICAgICAgICAgICAgd2FpdCgxKSAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIHBhZ2UxOlRvZ2dsZSgiQXV0byBGYXJtQm9uZVxu4Lif4Liy4Lij4LmM4Lih4LiB4Lij4Liw4LiU4Li54LiBIiwgX0cuU2V0dGluZ3MuQXV0b0Zhcm1Cb25lICwgZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIF9HLkF1dG9GYXJtQm9uZSAgPSB2YWx1ZQogICAgICAgICAgICBfRy5TZXR0aW5ncy5BdXRvRmFybUJvbmUgPSB2YWx1ZQogICAgICAgICAgICBTYXZlU2V0dGluZ3MoKSAKICAgICAgICAKICAgICAgICAgICAgaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBwYWdlMTpUb2dnbGUoIkF1dG8gUmFuZG9tQm9uZVxu4Liq4Li44LmI4Lih4LiB4Lij4Liw4LiU4Li54LiBIiwgX0cuQXV0b1JhbmRvbUJvbmUsIGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBfRy5BdXRvUmFuZG9tQm9uZSA9IHZhbHVlCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgd2FpdCguMSkgZG8KICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9SYW5kb21Cb25lIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCb25lcyIsICJCdXkiLCAxLCAxKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5CcmluZ01vYiBhbmQgX0cuQXV0b0Zhcm1Cb25lIGFuZCBTdGFydE1hZ25ldEJvbmVNb24gYW5kICh2Lk5hbWUgPT0gIlJlYm9ybiBTa2VsZXRvbiIgb3Igdi5OYW1lID09ICJMaXZpbmcgWm9tYmllIiBvciB2Lk5hbWUgPT0gIkRlbW9uaWMgU291bCIgb3Igdi5OYW1lID09ICJQb3Nlc3NlZCBNdW1teSIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uQm9uZS5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDEwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbkJvbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSnVtcFBvd2VyID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLDUwLDUwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsICBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGxvY2FsIE51bWJlcjIgPSAxCiAgICAgICAgbG9jYWwgQm9uZVRhYmVsID0gewogICAgICAgICAgICBbIk1vbiJdID0geyJSZWJvcm4gU2tlbGV0b24iLCJEZW1vbmljIFNvdWwiLCJMaXZpbmcgWm9tYmllIiwiUG9zZXNzZWQgTXVtbXkifSwKICAgICAgICAgICAgWyJCb3NzIl0gPSB7IlNvdWwgUmVhcGVyIn0sCiAgICAgICAgICAgIFsiSXRlbSJdID0gIkhhbGxvdyBFc3NlbmNlIiwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbG9jYWwgU2V0Q0Zhcm1lQm9uZSA9IDEKICAgICAgICBmdW5jdGlvbiBHZXRCb25lX0NGcmFtZV9Nb24oKQogICAgICAgICAgICBsb2NhbCBtYXRjaGluZ0NGcmFtZXMgPSB7fQogICAgICAgIAogICAgICAgICAgICBmb3IgXywgTW9uIGluIGlwYWlycyhCb25lVGFiZWxbIk1vbiJdKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgcmVzdWx0ID0gTW9uOmdzdWIoIkx2LiAiLCAiIik6Z3N1YigiWyVbJV1dIiwgIiIpOmdzdWIoIiVkKyIsICIiKTpnc3ViKCIlcysiLCAiIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gaXBhaXJzKGdhbWUud29ya3NwYWNlLkVuZW15U3Bhd25zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09IHJlc3VsdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChtYXRjaGluZ0NGcmFtZXMsIHYuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIG1hdGNoaW5nQ0ZyYW1lcwogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b0Zhcm1Cb25lIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIF9Cb3NzIGluIGlwYWlycyhCb25lVGFiZWxbIkJvc3MiXSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIF9JdGVtID0gQm9uZVRhYmVsWyJJdGVtIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZChfQm9zcykgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKF9Cb3NzKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIF9yIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZChfci5OYW1lLCBfQm9zcykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX3I6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIF9yOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIF9yLkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfci5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCwgNjAsIDYwKSAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChfci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9GYXJtQm9uZSBvciBfci5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3QgX3IuUGFyZW50IG9yIF9yLkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKF9JdGVtKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoX0l0ZW0pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0l0ZW0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHdvcmtzcGFjZS5NYXBbIkhhdW50ZWQgQ2FzdGxlIl0uU3VtbW9uZXIuRGV0ZWN0aW9uLkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBfTW9uIGluIG5leHQsIEJvbmVUYWJlbFsiTW9uIl0gZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlJlYm9ybiBTa2VsZXRvbiIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiTGl2aW5nIFpvbWJpZSIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRGVtb25pYyBTb3VsIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJQb3Nlc3NlZCBNdW1teSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHYuTmFtZSwgX01vbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHdhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCwgNjAsIDYwKSAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5GYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvRmFybUJvbmUgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoQ0ZyYW1lLm5ldygtOTUxMy44ODQ3NywgMTcyLjEzMDYsIDYwNzMuMzcwNjEsIC0wLjkwNjIyMTYyOCwgNy41NTUwODUwOWUtMDgsIDAuNDIyODAyOTg1LCA1Ljc5NDI2ODUzZS0wOCwgMSwgLTUuNDQ5ODA0ODdlLTA4LCAtMC40MjI4MDI5ODUsIC0yLjQ4ODg5NjkxZS0wOCwgLTAuOTA2MjIxNjI4KS5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPiAxMDAwIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gZmFsc2UgYW5kIF9HLkFjZWV0cFF1ZXN0Qm9uZSAgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtOTUxMy44ODQ3NywgMTcyLjEzMDYsIDYwNzMuMzcwNjEsIC0wLjkwNjIyMTYyOCwgNy41NTUwODUwOWUtMDgsIDAuNDIyODAyOTg1LCA1Ljc5NDI2ODUzZS0wOCwgMSwgLTUuNDQ5ODA0ODdlLTA4LCAtMC40MjI4MDI5ODUsIC0yLjQ4ODg5NjkxZS0wOCwgLTAuOTA2MjIxNjI4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgd2FpdCgpIHRvVGFyZ2V0KENGcmFtZU1vbikgdW50aWwgKENGcmFtZU1vbi5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMjAgb3IgIG5vdCBfRy5BdXRvRmFybUJvbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b19DRnJhbWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChHZXRCb25lX0NGcmFtZV9Nb24oKVtTZXRDRmFybWVCb25lXSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChHZXRCb25lX0NGcmFtZV9Nb24oKVtTZXRDRmFybWVCb25lXS5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2V0Q0Zhcm1lQm9uZSA9PSBuaWwgb3IgU2V0Q0Zhcm1lQm9uZSA9PSAnJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0Q0Zhcm1lQm9uZSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBTZXRDRmFybWVCb25lID49ICNHZXRCb25lX0NGcmFtZV9Nb24oKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0Q0Zhcm1lQm9uZSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0Q0Zhcm1lQm9uZSA9ICBTZXRDRmFybWVCb25lICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChHZXRCb25lX0NGcmFtZV9Nb24oKVsxXSAqIENGcmFtZS5uZXcoMCwzMCwyMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSAyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KEdldEJvbmVfQ0ZyYW1lX01vbigpWzFdICogQ0ZyYW1lLm5ldygwLDMwLC0yMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSAzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KEdldEJvbmVfQ0ZyYW1lX01vbigpWzFdICogQ0ZyYW1lLm5ldygyMCwzMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIEF0dGFja1JhbmRvbVR5cGVfTW9uQ0ZyYW1lID09IDQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoR2V0Qm9uZV9DRnJhbWVfTW9uKClbMV0gKiBDRnJhbWUubmV3KDAsMzAsLTIwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIEF0dGFja1JhbmRvbVR5cGVfTW9uQ0ZyYW1lID09IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoR2V0Qm9uZV9DRnJhbWVfTW9uKClbMV0gKiBDRnJhbWUubmV3KC0yMCwzMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoR2V0Qm9uZV9DRnJhbWVfTW9uKClbMV0gKiBDRnJhbWUubmV3KDAsMzAsMjApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGxvY2FsIE1vYktpbGxlZExhYmVsID0gcGFnZTE6TGFiZWwoIk5lZWQgdG8ga2lsbCA6IExvYWRpbmcuLi4iLCB0cnVlKQogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIGNha2VTdGF0dXMgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJDYWtlUHJpbmNlU3Bhd25lciIpCiAgICAgICAgICAgICAgICBpZiBzdHJpbmcubGVuKGNha2VTdGF0dXMpID09IDg4IHRoZW4KICAgICAgICAgICAgICAgICAgICBNb2JLaWxsZWRMYWJlbDpTZXQoIk5lZWQgdG8ga2lsbCA6ICIgLi4gc3RyaW5nLnN1YihjYWtlU3RhdHVzLCAzOSwgNDEpKQogICAgICAgICAgICAgICAgZWxzZWlmIHN0cmluZy5sZW4oY2FrZVN0YXR1cykgPT0gODcgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vYktpbGxlZExhYmVsOlNldCgiTmVlZCB0byBraWxsIDogIiAuLiBzdHJpbmcuc3ViKGNha2VTdGF0dXMsIDM5LCA0MCkpCiAgICAgICAgICAgICAgICBlbHNlaWYgc3RyaW5nLmxlbihjYWtlU3RhdHVzKSA9PSA4NiB0aGVuCiAgICAgICAgICAgICAgICAgICAgTW9iS2lsbGVkTGFiZWw6U2V0KCJOZWVkIHRvIGtpbGwgOiAiIC4uIHN0cmluZy5zdWIoY2FrZVN0YXR1cywgMzksIDM5KSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBNb2JLaWxsZWRMYWJlbDpTZXQoIkthdGFrdXJpIFNwYXduZWRcbuC4hOC4suC4leC4suC4hOC4uOC4o+C4tOC5gOC4geC4tOC4lOC5geC4peC5ieC4pyIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICB3YWl0KDEpCiAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIHBhZ2UxOlRvZ2dsZSgiQXV0byBLYXRha3VyaVxu4LiV4Li14LiE4Liy4LiV4Liy4LiE4Li44Lij4Li0IiwgX0cuQXV0b0Nha2VQcmluY2UgLGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBfRy5BdXRvQ2FrZVByaW5jZSAgPSB2YWx1ZQogICAgICAgICAgICBpZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b0Nha2VQcmluY2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJDYWtlIFByaW5jZSIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ2FrZSBQcmluY2UiKSBvciAgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCgiRG91Z2ggS2luZyIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRG91Z2ggS2luZyIpIHRoZW4gICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDYWtlIFByaW5jZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8seCBpbiBwYWlycyhnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOkdldENoaWxkcmVuKCkpIGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeC5OYW1lID09ICJDYWtlIFByaW5jZSIgb3IgeC5OYW1lID09ICJEb3VnaCBLaW5nIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHguSHVtYW5vaWRSb290UGFydC5DRnJhbWUuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMS41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0yMTQ1Ljg5NzIyLCA3MC4wMDg4MjcyLCAtMTIzOTkuNjAxNiwgMC45OTk5OTcwMiwgMS41ODI3NjM3OWUtMDgsIDAuMDAyNDUyNzc4ODYsIC0xLjU3OTgyOTc4ZS0wOCwgMSwgLTEuMTk4MTMwNTdlLTA4LCAtMC4wMDI0NTI3Nzg4NiwgMS4xOTQyNTE5OWUtMDgsIDAuOTk5OTk3MDIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkNha2UgUHJpbmNlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDEwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygtMjE0NS44OTcyMiwgNzAuMDA4ODI3MiwgLTEyMzk5LjYwMTYsIDAuOTk5OTk3MDIsIDEuNTgyNzYzNzllLTA4LCAwLjAwMjQ1Mjc3ODg2LCAtMS41Nzk4Mjk3OGUtMDgsIDEsIC0xLjE5ODEzMDU3ZS0wOCwgLTAuMDAyNDUyNzc4ODYsIDEuMTk0MjUxOTllLTA4LCAwLjk5OTk5NzAyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDYwLCA2MCwgNjApICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllciwiU2ltdWxhdGlvblJhZGl1cyIsbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvQ2FrZVByaW5jZSBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLHggaW4gcGFpcnMoZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpHZXRDaGlsZHJlbigpKSBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWUgPT0gIkNha2UgUHJpbmNlIiBvciB4Lk5hbWUgPT0gIkRvdWdoIEtpbmciIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHguSHVtYW5vaWRSb290UGFydC5DRnJhbWUuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0yMTQ1Ljg5NzIyLCA3MC4wMDg4MjcyLCAtMTIzOTkuNjAxNiwgMC45OTk5OTcwMiwgMS41ODI3NjM3OWUtMDgsIDAuMDAyNDUyNzc4ODYsIC0xLjU3OTgyOTc4ZS0wOCwgMSwgLTEuMTk4MTMwNTdlLTA4LCAtMC4wMDI0NTI3Nzg4NiwgMS4xOTQyNTE5OWUtMDgsIDAuOTk5OTk3MDIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkNha2UgUHJpbmNlIikgb3IgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCgiQ2FrZSBQcmluY2UiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLHggaW4gcGFpcnMoZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpHZXRDaGlsZHJlbigpKSBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHguTmFtZSA9PSAiQ2FrZSBQcmluY2UiIG9yIHguTmFtZSA9PSAiRG91Z2ggS2luZyIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDEwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0yMTQ1Ljg5NzIyLCA3MC4wMDg4MjcyLCAtMTIzOTkuNjAxNiwgMC45OTk5OTcwMiwgMS41ODI3NjM3OWUtMDgsIDAuMDAyNDUyNzc4ODYsIC0xLjU3OTgyOTc4ZS0wOCwgMSwgLTEuMTk4MTMwNTdlLTA4LCAtMC4wMDI0NTI3Nzg4NiwgMS4xOTQyNTE5OWUtMDgsIDAuOTk5OTk3MDIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkJha2luZyBTdGFmZiIpIG9yIGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkhlYWQgQmFrZXIiKSBvciBnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDYWtlIEd1YXJkIikgb3IgZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ29va2llIENyYWZ0ZXIiKSAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8gIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lk5hbWUgPT0gIkJha2luZyBTdGFmZiIgb3Igdi5OYW1lID09ICJIZWFkIEJha2VyIiBvciB2Lk5hbWUgPT0gIkNha2UgR3VhcmQiIG9yIHYuTmFtZSA9PSAiQ29va2llIENyYWZ0ZXIiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHdhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCwgNjAsIDYwKSAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5GYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIF9HLkF1dG9DYWtlUHJpbmNlID09IGZhbHNlIG9yIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZCgiQ2FrZSBQcmluY2UiKSBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KEdldENha2VfQ0ZyYW1lX01vbigpICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgICAgIHBhZ2UxOlNlcGVyYXRvcigiTWF0ZXJpYWwv4Lin4Lix4Liq4LiU4Li4IikKICAgICAgICBwYWdlMTpEcm9wZG93bigiU2VsZWN0IE1hdGVyaWFsXG7guYDguKXguLfguK3guIHguKfguLHguKrguJTguLgiLEFsbE1hdGVyaWFsLCBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgU2VsZWN0TW9kZU1hdGVyaWFsID0gdmFsdWUKICAgICAgICBlbmQpCiAgICAgICAgcGFnZTE6VG9nZ2xlKCJBdXRvIEZhcm1NYXRlcmlhbFxu4Lif4Liy4Lij4LmM4Lih4Lin4Lix4Liq4LiU4Li4IixBdXRvRmFybU1hdGVyaWFsLCBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgQXV0b0Zhcm1NYXRlcmlhbCA9IHZhbHVlCiAgICAgICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIHdhaXQoKSBkbyAKICAgICAgICAgICAgICAgICAgICBpZiBBdXRvRmFybU1hdGVyaWFsIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTZWxlY3RNb2RlTWF0ZXJpYWx+PSIiKSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoZWNrTWF0ZXJpYWwoU2VsZWN0TW9kZU1hdGVyaWFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEN1c3RvbUZpbmRGaXJzdENoaWxkKE1hdGVyaWFsTW9iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB2MCx2MSBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXV0b0Zhcm1NYXRlcmlhbCBhbmQgdGFibGUuZmluZChNYXRlcmlhbE1vYix2MS5OYW1lKSBhbmQgdjE6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdjE6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kICh2MS5IdW1hbm9pZC5IZWFsdGggPiAwKSkgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFzQnVzbyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gIkJ1c28iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc01vbiA9IHYxLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYxLkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYxLkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjEuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjEuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjEuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYxLkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2MS5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYxLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IEZhc3RBdHRhY2sgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsIDY3MikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBDdXN0b21GaW5kRmlyc3RDaGlsZChNYXRlcmlhbE1vYikgb3Igbm90IEF1dG9GYXJtTWF0ZXJpYWwgb3IgKHYxLkh1bWFub2lkLkhlYWx0aCA8PSAwKSBvciBub3QgdjEuUGFyZW50IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWVNb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCnBhZ2UyOlNlcGVyYXRvcigi4pqZ77iPIikKV2VhcG9uID0geyJNZWxlZSIsIlN3b3JkIiwiRnJ1aXQifQpwYWdlMjpEcm9wZG93bigiU2VsZWN0IFdlYXBvblxu4LmA4Lil4Li34Lit4LiB4Lit4Liy4Lin4Li44LiYIixXZWFwb24sIGZ1bmN0aW9uKHZhbHVlKQpTZWxlY3RXZWFwb24gPSB2YWx1ZQplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQp3aGlsZSB3YWl0KCkgZG8KcGNhbGwoZnVuY3Rpb24oKQogICAgaWYgU2VsZWN0V2VhcG9uID09ICJNZWxlZSIgdGhlbgogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiB2LlRvb2xUaXAgPT0gIk1lbGVlIiB0aGVuCiAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQodG9zdHJpbmcodi5OYW1lKSkgdGhlbgogICAgICAgICAgICAgICAgICAgIF9HLlNlbGVjdFdlYXBvbiA9IHYuTmFtZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZWlmIFNlbGVjdFdlYXBvbiA9PSAiU3dvcmQiIHRoZW4KICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgdi5Ub29sVGlwID09ICJTd29yZCIgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvc3RyaW5nKHYuTmFtZSkpIHRoZW4KICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb24gPSB2Lk5hbWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVsc2VpZiBTZWxlY3RXZWFwb24gPT0gIkZydWl0IiB0aGVuCiAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIHYuVG9vbFRpcCA9PSAiQmxveCBGcnVpdCIgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvc3RyaW5nKHYuTmFtZSkpIHRoZW4KICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb24gPSB2Lk5hbWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBmb3IgaSAsdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgdi5Ub29sVGlwID09ICJNZWxlZSIgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvc3RyaW5nKHYuTmFtZSkpIHRoZW4KICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb24gPSB2Lk5hbWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCmVuZAplbmQpCgpsb2NhbCBNZXRob2QgPSB7IlVwcGVyIiwiQmVoaW5kIiwiQmVsb3cifQppZiBfRy5NZXRob2QgPT0gbmlsIHRoZW4KX0cuTWV0aG9kID0gIlVwcGVyIgplbmQKaWYgIF9HLkRpc3RhbmNlQXV0b0Zhcm0gPT0gbmlsIHRoZW4KICAgIF9HLkRpc3RhbmNlQXV0b0Zhcm0gPSAzMAplbmQKICAKcGFnZTI6RHJvcGRvd24oIlNlbGVjdCBNZXRob2RcbuC5gOC4peC4t+C4reC4geC4leC4s+C5geC4q+C4meC5iOC4h+C4geC4suC4o+C4n+C4suC4o+C5jOC4oSIsTWV0aG9kLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLk1ldGhvZCA9IHZhbHVlCmVuZCkKICAgIApwYWdlMjpTbGlkZXIoIlNlbGVjdCBEaXN0YW5jZVxu4LmA4Lil4Li34Lit4LiB4Lij4Liw4Lii4Liw4LiB4Liy4Lij4Lif4Liy4Lij4LmM4LihIiwxLDgwLDMwLGZ1bmN0aW9uKHZhbHVlKQogX0cuRGlzdGFuY2VBdXRvRmFybSA9IHZhbHVlCmVuZCkKICAgIAp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCByYW5kb21PZmZzZXRYID0gbWF0aC5yYW5kb20oLTMwLCAzMCkgIC0tIOC4quC4uOC5iOC4oSBYIOC5gOC4peC5h+C4geC4meC5ieC4reC4ogogICAgICAgICAgICBsb2NhbCByYW5kb21PZmZzZXRZID0gbWF0aC5yYW5kb20oLTMwLCAzMCkgIC0tIOC4quC4uOC5iOC4oSBZCiAgICAgICAgICAgIGxvY2FsIHJhbmRvbU9mZnNldFogPSBtYXRoLnJhbmRvbSgtMzAsIDMwKSAgLS0g4Liq4Li44LmI4LihIFoKICAgICAgICAgICAgICAgIGlmIF9HLk1ldGhvZCA9PSAiQmVoaW5kIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgTWV0aG9kRmFybSA9IENGcmFtZS5uZXcocmFuZG9tT2Zmc2V0WCwgcmFuZG9tT2Zmc2V0WSwgX0cuRGlzdGFuY2VBdXRvRmFybSArIHJhbmRvbU9mZnNldFopCiAgICAgICAgICAgICAgICBlbHNlaWYgX0cuTWV0aG9kID09ICJCZWxvdyIgdGhlbgogICAgICAgICAgICAgICAgICAgIE1ldGhvZEZhcm0gPSBDRnJhbWUubmV3KHJhbmRvbU9mZnNldFgsIC0oX0cuRGlzdGFuY2VBdXRvRmFybSArIHJhbmRvbU9mZnNldFkpLCByYW5kb21PZmZzZXRaKSAqIENGcmFtZS5BbmdsZXMobWF0aC5yYWQoOTApLCAwLCAwKQogICAgICAgICAgICAgICAgZWxzZWlmIF9HLk1ldGhvZCA9PSAiVXBwZXIiIHRoZW4KICAgICAgICAgICAgICAgICAgICBNZXRob2RGYXJtID0gQ0ZyYW1lLm5ldyhyYW5kb21PZmZzZXRYLCBfRy5EaXN0YW5jZUF1dG9GYXJtICsgcmFuZG9tT2Zmc2V0WSwgcmFuZG9tT2Zmc2V0WikgKiBDRnJhbWUuQW5nbGVzKG1hdGgucmFkKDApLCAwLCAwKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIE1ldGhvZEZhcm0gPSBDRnJhbWUubmV3KHJhbmRvbU9mZnNldFgsIF9HLkRpc3RhbmNlQXV0b0Zhcm0gKyByYW5kb21PZmZzZXRZLCByYW5kb21PZmZzZXRaKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCnBhZ2UyOlRvZ2dsZSgiQXV0byBVc2VIYWtpXG7guK3guK3guYLguJXguYnguYDguJvguLTguJTguK7guLLguITguLQiLCB0cnVlLCBmdW5jdGlvbih2YWx1ZSkKX0cuQXV0b0hha2kgPSB2YWx1ZQplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIF9HLkF1dG9IYWtpIHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIYXNCdXNvIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1c28iKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCnBhZ2UyOlRvZ2dsZSgiQXV0byBVc2VIYWtpT2JzZXJ2YXRpb25cbuC4reC4reC5guC4leC5ieC5gOC4m+C4tOC4lOC4ruC4suC4hOC4tOC4quC4seC4h+C5gOC4geC4lSIsIHRydWUsIGZ1bmN0aW9uKHZhbHVlKQpfRy5BdXRvS2VuID0gdmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5BdXRvS2VuIHRoZW4KICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgIFsxXSA9ICJLZW4iLAogICAgICAgICAgICAgICAgWzJdID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1FOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnBhZ2UyOlRvZ2dsZSgiV2hpdGUgU2NyZWVuXG7guIjguK3guILguLLguKciLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCl9HLldoaXRlU2NyZWVuID0gdmFsdWUKaWYgdmFsdWUgdGhlbgogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIik6U2V0M2RSZW5kZXJpbmdFbmFibGVkKGZhbHNlKQplbHNlCiAgICBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKTpTZXQzZFJlbmRlcmluZ0VuYWJsZWQodHJ1ZSkKZW5kCmVuZCkKCnBhZ2UyOlRvZ2dsZSgiQmxhY2sgU2NyZWVuXG7guIjguK3guJTguLMiLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCl9HLkJsYWNrU2NyZWVuID0gdmFsdWUKaWYgdmFsdWUgdGhlbgogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIik6U2V0M2RSZW5kZXJpbmdFbmFibGVkKGZhbHNlKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uQmxhY2tzY3JlZW4uU2l6ZSA9IFVEaW0yLm5ldyg1MDAsIDAsIDUwMCwgNTAwKQplbHNlCiAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpOlNldDNkUmVuZGVyaW5nRW5hYmxlZCh0cnVlKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uQmxhY2tzY3JlZW4uU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCA1MDAsIDUwMCkKZW5kCmVuZCkKCnBhZ2UyOlRvZ2dsZSgiSGlkZU5vdGlmaWNhdGlvblxu4LiL4LmI4Lit4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiB4Liy4Lij4LmB4LiI4LmJ4LiH4LmA4LiV4Li34Lit4LiZIiwgZmFsc2UsIGZ1bmN0aW9uKHZhbHVlKQpnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTm90aWZpY2F0aW9ucy5FbmFibGVkID0gbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5Ob3RpZmljYXRpb25zLkVuYWJsZWQKZW5kKQoKcGFnZTI6VG9nZ2xlKCJCcmluZ01vblxu4Lij4Lin4Lih4Lio4Lix4LiV4Lij4Li5IiwgdHJ1ZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5CcmluZ01vYiA9IHZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIF9HLkJyaW5nTW9iIHRoZW4KICAgICAgICAgICAgICAgIFF1ZXN0Q2hlY2soKQogICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRmFybSBhbmQgX0cuQnJpbmdNb2IgYW5kIHYuTmFtZSA9PSBRdWVzdENoZWNrKClbM10gYW5kIChRdWVzdENoZWNrKClbM10gPT0gIkZhY3RvcnkgU3RhZmYiIG9yIFF1ZXN0Q2hlY2soKVszXSA9PSAiTW9ua2V5IiBvciBRdWVzdENoZWNrKClbM10gPT0gIkRyYWdvbiBDcmV3IFdhcnJpb3IiIG9yIFF1ZXN0Q2hlY2soKVszXSA9PSAiRHJhZ29uIENyZXcgQXJjaGVyIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAyMjAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLDUwLDUwKQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zTW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuQW5pbWF0b3I6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciwiU2ltdWxhdGlvblJhZGl1cyIsbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBfRy5BdXRvRmFybSBhbmQgX0cuQnJpbmdNb2IgYW5kIHYuTmFtZSA9PSBRdWVzdENoZWNrKClbM10gYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBfRy5CcmluZ01vZGUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLDUwLDUwKQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zTW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuQW5pbWF0b3I6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciwiU2ltdWxhdGlvblJhZGl1cyIsbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5CcmluZ01vYiB0aGVuCiAgICAgICAgICAgICAgIFF1ZXN0Q2hlY2soKQogICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRmFybSBhbmQgX0cuQnJpbmdNb2IgIGFuZCB2Lk5hbWUgPT0gUXVlc3RDaGVjaygpWzNdIGFuZCAoUXVlc3RDaGVjaygpWzNdID09ICJGYWN0b3J5IFN0YWZmIiBvciBRdWVzdENoZWNrKClbM10gPT0gIk1vbmtleSIgb3IgUXVlc3RDaGVjaygpWzNdID09ICJEcmFnb24gQ3JldyBXYXJyaW9yIiBvciBRdWVzdENoZWNrKClbM10gPT0gIkRyYWdvbiBDcmV3IEFyY2hlciIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMjUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldygxNTAsMTUwLDE1MCkKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbgogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIsIlNpbXVsYXRpb25SYWRpdXMiLG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgX0cuQXV0b0Zhcm0gYW5kIF9HLkJyaW5nTW9iICBhbmQgdi5OYW1lID09IFF1ZXN0Q2hlY2soKVszXSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IF9HLkJyaW5nTW9kZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoMTUwLDE1MCwxNTApCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBQb3NNb24KICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCJTaW11bGF0aW9uUmFkaXVzIixtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b0VjdG9wbGFzbSBhbmQgU3RhcnRFY3RvcGxhc21NYWduZXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZCh2Lk5hbWUsICJTaGlwIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gRWN0b3BsYXNtTW9uLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsNTAsNTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gRWN0b3BsYXNtTW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvUmVuZ29rdSBhbmQgU3RhcnRSZW5nb2t1TWFnbmV0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuTmFtZSA9PSAiU25vdyBMdXJrZXIiIG9yIHYuTmFtZSA9PSAiQXJjdGljIFdhcnJpb3IiKSBhbmQgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIFJlbmdva3VNb24uUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBfRy5CcmluZ01vZGUgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoMTUwMCwxNTAwLDE1MDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFJlbmdva3VNb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuQW5pbWF0b3I6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b011c2tldGVlckhhdCBhbmQgU3RhcnRNYWduZXRNdXNrZXRlZXJoYXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkZvcmVzdCBQaXJhdGUiIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gTXVza2V0ZWVySGF0TW9uLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLDUwLDUwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBNdXNrZXRlZXJIYXRNb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuQW5pbWF0b3I6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b09ic2VydmF0aW9uSGFraVYyIGFuZCBNYW5nbmV0Y2l0emVubW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJGb3Jlc3QgUGlyYXRlIiBhbmQgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIE11c2tldGVlckhhdE1vbi5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IF9HLkJyaW5nTW9kZSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCw1MCw1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zSGVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9fRXZvUmFjZSBhbmQgU3RhcnRFdm9NYWduZXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIlpvbWJpZSIgYW5kICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBQb3NNb25Fdm8uUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBfRy5CcmluZ01vZGUgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsNTAsNTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbkV2bwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvQmFydGlsbyBhbmQgQXV0b0JhcnRpbG9CcmluZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiU3dhbiBQaXJhdGUiIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uQmFydG8uUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBfRy5CcmluZ01vZGUgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsNTAsNTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbkJhcnRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9GYXJtRnJ1aXRNYXN0ZXJ5IGFuZCBTdGFydE1hc3RlcnlGcnVpdE1hZ25ldCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiTW9ua2V5IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uTWFzdGVyeUZydWl0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCw1MCw1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbk1hc3RlcnlGcnVpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgdi5OYW1lID09ICJGYWN0b3J5IFN0YWZmIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uTWFzdGVyeUZydWl0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCw1MCw1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbk1hc3RlcnlGcnVpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgdi5OYW1lID09IE1vbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uTWFzdGVyeUZydWl0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCw1MCw1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbk1hc3RlcnlGcnVpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRmFybUd1bk1hc3RlcnkgYW5kIFN0YXJ0TWFzdGVyeUd1bk1hZ25ldCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiTW9ua2V5IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uTWFzdGVyeUd1bi5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IF9HLkJyaW5nTW9kZSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsNTAsNTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBQb3NNb25NYXN0ZXJ5R3VuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuQW5pbWF0b3I6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiB2Lk5hbWUgPT0gIkZhY3RvcnkgU3RhZmYiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBQb3NNb25NYXN0ZXJ5R3VuLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCw1MCw1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbk1hc3RlcnlHdW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHYuTmFtZSA9PSBRdWVzdENoZWNrKClbM10gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIFBvc01vbk1hc3RlcnlHdW4uUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBfRy5CcmluZ01vZGUgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLDUwLDUwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zTW9uTWFzdGVyeUd1bgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvX0JvbmUgYW5kIFN0YXJ0TWFnbmV0Qm9uZU1vbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lk5hbWUgPT0gIlJlYm9ybiBTa2VsZXRvbiIgb3Igdi5OYW1lID09ICJMaXZpbmcgWm9tYmllIiBvciB2Lk5hbWUgPT0gIkRlbW9uaWMgU291bCIgb3Igdi5OYW1lID09ICJQb3Nlc3NlZCBNdW1teSIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uQm9uZS5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IF9HLkJyaW5nTW9kZSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCw1MCw1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zTW9uQm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRmFybUNhbmR5IGFuZCBTdGFydENhbmR5TWFnbmV0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuTmFtZSA9PSAiSWNlIENyZWFtIENoZWYiIG9yIHYuTmFtZSA9PSAiSWNlIENyZWFtIENvbW1hbmRlciIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gQ2FuZHlNb24uUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBfRy5CcmluZ01vZGUgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsNTAsNTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENhbmR5TW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIFN0YXJkRmFybSBhbmQgRmFybU1hZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lk5hbWUgPT0gIkNvY29hIFdhcnJpb3IiIG9yIHYuTmFtZSA9PSAiQ2hvY29sYXRlIEJhciBCYXR0bGVyIiBvciB2Lk5hbWUgPT0gIlN3ZWV0IFRoaWVmIiBvciB2Lk5hbWUgPT0gIkNhbmR5IFJlYmVsIikgYW5kICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBQb3NHRy5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDI1MCBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCw1MCw1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zR0cKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuQW5pbWF0b3I6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgX0cuRmFybWZhc3QgYW5kIFN0YXJkTWFnIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuTmFtZSA9PSAiU2hhbmRhIiBvciB2Lk5hbWUgPT0gIlNoYW5kYSIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gRmFzdE1vbi5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IF9HLkJyaW5nTW9kZSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCw1MCw1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gRmFzdE1vbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRG91Z2h0Qm9zcyBhbmQgTWFnbmV0RG91Z2h0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuTmFtZSA9PSAiQ29va2llIENyYWZ0ZXIiIG9yIHYuTmFtZSA9PSAiQ2FrZSBHdWFyZCIgb3Igdi5OYW1lID09ICJCYWtpbmcgU3RhZmYiIG9yIHYuTmFtZSA9PSAiSGVhZCBCYWtlciIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gUG9zTW9uRG91Z2h0T3BlbkRvb3IuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBfRy5CcmluZ01vZGUgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsNTAsNTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbkRvdWdodE9wZW5Eb29yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCXdoaWxlIHRydWUgZG8gd2FpdCgpCgkJaWYgc2V0c2NyaXB0YWJsZSB0aGVuCgkJCXNldHNjcmlwdGFibGUoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIHRydWUpCgkJZW5kCgkJaWYgc2V0aGlkZGVucHJvcGVydHkgdGhlbgoJCQlzZXRoaWRkZW5wcm9wZXJ0eShnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQoJCWVuZAoJZW5kCmVuZCkKCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCXdoaWxlIHRhc2sud2FpdCgpIGRvCgkJcGNhbGwoZnVuY3Rpb24oKQoJCQlpZiAgX0cuQnJpbmdNb2IgdGhlbgoJCQkJZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCgkJCQkJaWYgbm90IHN0cmluZy5maW5kKHYuTmFtZSwiQm9zcyIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIHRoZW4KCQkJCQkJaWYgSW5NeU5ldFdvcmsodi5IdW1hbm9pZFJvb3RQYXJ0KSB0aGVuCgkJCQkJCQl2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zR2F5CgkJCQkJCQl2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKCQkJCQkJCXYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAoJCQkJCQkJdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCw2MCw2MCkKCQkJCQkJCXYuSHVtYW5vaWRSb290UGFydC5UcmFuc3BhcmVuY3kgPSAxCgkJCQkJCQl2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCgkJCQkJCQl2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCgkJCQkJCQlpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KCQkJCQkJCQl2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQoJCQkJCQkJZW5kCgkJCQkJCQl2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDExKQoJCQkJCQkJdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJZW5kKQoJZW5kCmVuZCkKdGFzay5zcGF3bihmdW5jdGlvbigpCgl3aGlsZSB0YXNrLndhaXQoKSBkbwoJCXBjYWxsKGZ1bmN0aW9uKCkKCQkJaWYgX0cuQXV0b1N3b3JkTWFzdGVyeSBhbmQgQXV0b1N3b3JkTWFzdGVyeU1hZyBhbmQgX0cuQnJpbmdNb2IgdGhlbgoJCQkJZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCgkJCQkJaWYgbm90IHN0cmluZy5maW5kKHYuTmFtZSwiQm9zcyIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIHRoZW4KCQkJCQkJaWYgSW5NeU5ldFdvcmsodi5IdW1hbm9pZFJvb3RQYXJ0KSB0aGVuCgkJCQkJCQl2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zTW9uCgkJCQkJCQl2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKCQkJCQkJCXYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAoJCQkJCQkJdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCw2MCw2MCkKCQkJCQkJCXYuSHVtYW5vaWRSb290UGFydC5UcmFuc3BhcmVuY3kgPSAxCgkJCQkJCQl2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCgkJCQkJCQl2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCgkJCQkJCQlpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KCQkJCQkJCQl2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQoJCQkJCQkJZW5kCgkJCQkJCQl2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDExKQoJCQkJCQkJdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJZW5kKQoJZW5kCmVuZCkKdGFzay5zcGF3bihmdW5jdGlvbigpCgl3aGlsZSB0YXNrLndhaXQoKSBkbwoJCXBjYWxsKGZ1bmN0aW9uKCkKCQkJaWYgX0cuQnJpbmdNb2IgdGhlbgoJCQkJZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCgkJCQkJaWYgbm90IHN0cmluZy5maW5kKHYuTmFtZSwiQm9zcyIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIHRoZW4KCQkJCQkJaWYgSW5NeU5ldFdvcmsodi5IdW1hbm9pZFJvb3RQYXJ0KSB0aGVuCgkJCQkJCQl2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zTmFyYXRoaXdhdAoJCQkJCQkJdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCgkJCQkJCQl2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKCQkJCQkJCXYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNjAsNjAsNjApCgkJCQkJCQl2Lkh1bWFub2lkUm9vdFBhcnQuVHJhbnNwYXJlbmN5ID0gMQoJCQkJCQkJdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQoJCQkJCQkJdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQoJCQkJCQkJaWYgdi5IdW1hbm9pZDpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0b3IiKSB0aGVuCgkJCQkJCQkJdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKCQkJCQkJCWVuZAoJCQkJCQkJdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKCQkJCQkJCXYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZCkKCWVuZAplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQoJd2hpbGUgdGFzay53YWl0KCkgZG8KCQlwY2FsbChmdW5jdGlvbigpCgkJCWlmIF9HLkF1dG9GYXJtTmVhcmVzdCBhbmQgX0cuQnJpbmdNb2IgdGhlbgoJCQkJZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCgkJCQkJaWYgbm90IHN0cmluZy5maW5kKHYuTmFtZSwiQm9zcyIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gX0cuQnJpbmdNb2RlIHRoZW4KCQkJCQkJaWYgSW5NeU5ldFdvcmsodi5IdW1hbm9pZFJvb3RQYXJ0KSB0aGVuCgkJCQkJCQl2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zTW9uCgkJCQkJCQl2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKCQkJCQkJCXYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAoJCQkJCQkJdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCw2MCw2MCkKCQkJCQkJCXYuSHVtYW5vaWRSb290UGFydC5UcmFuc3BhcmVuY3kgPSAxCgkJCQkJCQl2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCgkJCQkJCQl2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCgkJCQkJCQlpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KCQkJCQkJCQl2Lkh1bWFub2lkLkFuaW1hdG9yOkRlc3Ryb3koKQoJCQkJCQkJZW5kCgkJCQkJCQl2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDExKQoJCQkJCQkJdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJZW5kKQoJZW5kCmVuZCkKX0cuQnJpbmdNb2RlID0gMTUwCgpfRy5BdXRvX0NGcmFtZSA9IHRydWUKcGFnZTI6VG9nZ2xlKCJEaXNhYmxlRGFtYWdlXG7guJvguLTguJTguJTguLLguYDguKHguIgiLCAgdHJ1ZSwgZnVuY3Rpb24odmFsdWUpCl9HLkRpc2RhbWFnZSA9IHZhbHVlCkRpc2FibGVkRGFtYWdlKCkKZW5kKQoKcGFnZTM6U2VwZXJhdG9yKCLwn5OKIikKcGFnZTM6RHJvcGRvd24oIlNlbGVjdCBTdGF0c1xu4LmA4Lil4Li34Lit4LiB4Liq4LmB4LiV4LiEIix7Ik1lbGVlIiwiRGVmZW5zZSIsIlN3b3JkIiwiR3VuIiwiRnJ1aXQifSxmdW5jdGlvbih2YWx1ZSkKICAgIF9HLlNlbGVjdFN0YXRzID0gdmFsdWUKZW5kKQoKcGFnZTM6VG9nZ2xlKCJBdXRvIFN0YXRzXG7guK3guK3guYLguJXguYnguK3guLHguJ7guKrguYHguJXguIQiLCBfRy5FbmFibGVkQXV0b1N0YXRzLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLkVuYWJsZWRBdXRvU3RhdHMgPSB2YWx1ZQplbmQpCgpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgaWYgX0cuRW5hYmxlZEF1dG9TdGF0cyB0aGVuCiAgICAgICAgICAgICAgICBpZiBfRy5TZWxlY3RTdGF0cyA9PSAiTWVsZWUiIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSAiQWRkUG9pbnQiLAogICAgICAgICAgICAgICAgICAgICAgICBbMl0gPSAiTWVsZWUiLAogICAgICAgICAgICAgICAgICAgICAgICBbM10gPSAxMDAwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgZWxzZWlmIF9HLlNlbGVjdFN0YXRzID09ICJEZWZlbnNlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gIkFkZFBvaW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgWzJdID0gIkRlZmVuc2UiLAogICAgICAgICAgICAgICAgICAgICAgICBbM10gPSAxMDAwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgZWxzZWlmIF9HLlNlbGVjdFN0YXRzID09ICJTd29yZCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJBZGRQb2ludCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFsyXSA9ICJTd29yZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFszXSA9IDEwMDAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBlbHNlaWYgX0cuU2VsZWN0U3RhdHMgPT0gIkd1biIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJBZGRQb2ludCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFsyXSA9ICJHdW4iLAogICAgICAgICAgICAgICAgICAgICAgICBbM10gPSAxMDAwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAg'
local runjvdupAemE = 'ZWxzZWlmIF9HLlNlbGVjdFN0YXRzID09ICJGcnVpdCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJBZGRQb2ludCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFsyXSA9ICJEZW1vbiBGcnVpdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFszXSA9IDEwMDAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCnBhZ2UzOlRvZ2dsZSgiQXV0byBTdGF0cyBLYWl0dW5cbuC4reC4seC4nuC4quC5geC4leC4hOC5geC4muC4muC5hOC4geC5iOC4leC4seC4mSIsIHRydWUsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b1N0YXRzS2FpdHVuID0gdmFsdWUKZW5kKQoKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBfRy5BdXRvU3RhdHNLYWl0dW4gdGhlbgogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YXRzLk1lbGVlLkxldmVsLlZhbHVlIDw9IDI2NDkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiQWRkUG9pbnQiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9ICJNZWxlZSIsCiAgICAgICAgICAgICAgICAgICAgWzNdID0gMTAwMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gIkFkZFBvaW50IiwKICAgICAgICAgICAgICAgICAgICBbMl0gPSAiRGVmZW5zZSIsCiAgICAgICAgICAgICAgICAgICAgWzNdID0gMTAwMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnBhZ2UzOlRvZ2dsZSgiQXV0byBSZWRlZW0gQ29kZVxu4Lit4Lit4LmC4LiV4LmJ4LmD4Liq4LmI4LmC4LiE4LmJ4LiUIiwgX0cuRW5hYmxlZEF1dG9SZWRlZW1Db2RlLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLkVuYWJsZWRBdXRvUmVkZWVtQ29kZSA9IHZhbHVlCmVuZCkKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgX0cuRW5hYmxlZEF1dG9SZWRlZW1Db2RlIG9yIF9HLkF1dG9GYXJtIHRoZW4KICAgICAgICAgICAgZnVuY3Rpb24gVXNlQ29kZShUZXh0KQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuUmVkZWVtOkludm9rZVNlcnZlcihUZXh0KQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgVXNlQ29kZSgiQURNSU5GSUdIVCIpCiAgICAgICAgICAgIFVzZUNvZGUoIkdJRlRJTkdfSE9VUlMiKQogICAgICAgICAgICBVc2VDb2RlKCJOT01PUkVIQUNLIikKICAgICAgICAgICAgVXNlQ29kZSgiRUFSTl9GUlVJVFMiKQogICAgICAgICAgICBVc2VDb2RlKCJGSUdIVDRGUlVJVCIpCiAgICAgICAgICAgIFVzZUNvZGUoIk5PRVhQTE9JVEVSIikKICAgICAgICAgICAgVXNlQ29kZSgiTk9PQjJBRE1JTiIpCiAgICAgICAgICAgIFVzZUNvZGUoIkNPREVTTElERSIpCiAgICAgICAgICAgIFVzZUNvZGUoIkFETUlOSEFDS0VEIikKICAgICAgICAgICAgVXNlQ29kZSgiQURNSU5EQVJFUyIpCiAgICAgICAgICAgIFVzZUNvZGUoImZydWl0Y29uY2VwdHMiKQogICAgICAgICAgICBVc2VDb2RlKCJrcmF6eWRhcmVzIikKICAgICAgICAgICAgVXNlQ29kZSgiVFJJUExFQUJVU0UiKQogICAgICAgICAgICBVc2VDb2RlKCJTRUFUUk9MTElORyIpCiAgICAgICAgICAgIFVzZUNvZGUoIjI0Tk9BRE1JTiIpCiAgICAgICAgICAgIFVzZUNvZGUoIlJFV0FSREZVTiIpCiAgICAgICAgICAgIFVzZUNvZGUoIk5FV1RST0xMIikKICAgICAgICAgICAgVXNlQ29kZSgiU0VDUkVUX0FETUlOIikKICAgICAgICAgICAgVXNlQ29kZSgiQkFORVhQTE9JVCIpCiAgICAgICAgICAgIFVzZUNvZGUoIk5PTU9SRUhBQ0siKQogICAgICAgICAgICBVc2VDb2RlKCJHZXRQcmFua2VkIikKICAgICAgICAgICAgVXNlQ29kZSgiRUFSTl9GUlVJVFMiKSAKICAgICAgICAgICAgVXNlQ29kZSgiTk9FWFBMT0lUIikKICAgICAgICAgICAgVXNlQ29kZSgiRklHSFQ0RlJVSVQiKQogICAgICAgICAgICBVc2VDb2RlKCJOT09CMkFETUlOIikKICAgICAgICAgICAgVXNlQ29kZSgiQ09ERVNMSURFIikKICAgICAgICAgICAgVXNlQ29kZSgiS0lUVF9SRVNFVCIpCiAgICAgICAgICAgIFVzZUNvZGUoIlN1YjJDYXB0YWluTWF1aSIpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKZnVuY3Rpb24gR2V0QWxsTWVsZWVGYXJtKCkKICAgIGlmIFN1cENvbXBsZXRlID09IGZhbHNlIHRoZW4KICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgWzFdID0gIkJ1eVN1cGVyaHVtYW4iCiAgICB9CiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgIGlmIENoZWNrTWFzdGVyeVdlYXBvbigiU3VwZXJodW1hbiIsIDQwMCkgPT0gInRydWUgVXBUbyIgdGhlbgogICAgICAgIFN1cENvbXBsZXRlID0gdHJ1ZQogICAgZW5kCiAgICBlbmQKICAgIHdhaXQoLjUpCiAgICBpZiBFQ2xhd0NvbXBsZXRlID09IGZhbHNlIHRoZW4KICAgIGxvY2FsIHN0cmluZ18xID0gIkJ1eUVsZWN0cmljQ2xhdyI7CiAgICBsb2NhbCBUYXJnZXQgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlc1siQ29tbUZfIl07CiAgICBUYXJnZXQ6SW52b2tlU2VydmVyKHN0cmluZ18xKTsKICAgIAogICAgaWYgQ2hlY2tNYXN0ZXJ5V2VhcG9uKCJFbGVjdHJpYyBDbGF3IiwgNDAwKSA9PSAidHJ1ZSBVcFRvIiB0aGVuCiAgICAgICAgRUNsYXdDb21wbGV0ZSA9IHRydWUKICAgIGVuZAogICAgZW5kCiAgICB3YWl0KC41KQogICAgaWYgVGFsQ29tcGxldGUgPT0gZmFsc2UgdGhlbgogICAgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eURyYWdvblRhbG9uIikKICAgIAogICAgaWYgQ2hlY2tNYXN0ZXJ5V2VhcG9uKCJEcmFnb24gVGFsb24iLCA0MDApID09ICJ0cnVlIFVwVG8iIHRoZW4KICAgICAgICBUYWxDb21wbGV0ZSA9IHRydWUKICAgIGVuZAogICAgZW5kCiAgICB3YWl0KC41KQogICAgaWYgU2hhcmtDb21wbGV0ZSA9PSBmYWxzZSB0aGVuCiAgICBsb2NhbCBhcmdzID0gewogICAgICAgIFsxXSA9ICJCdXlTaGFya21hbkthcmF0ZSIKICAgIH0KICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgCiAgICBpZiBDaGVja01hc3RlcnlXZWFwb24oIlNoYXJrbWFuIEthcmF0ZSIsIDQwMCkgPT0gInRydWUgVXBUbyIgdGhlbgogICAgICAgIFNoYXJrQ29tcGxldGUgPSB0cnVlCiAgICBlbmQKICAgIGVuZAogICAgd2FpdCguNSkKICAgIGlmIERlYXRoQ29tcGxldGUgPT0gZmFsc2UgdGhlbgogICAgbG9jYWwgYXJncyA9IHsKICAgICAgICBbMV0gPSAiQnV5RGVhdGhTdGVwIgogICAgfQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAKICAgIGlmIENoZWNrTWFzdGVyeVdlYXBvbigiRGVhdGggU3RlcCIsIDQwMCkgPT0gInRydWUgVXBUbyIgdGhlbgogICAgICAgIERlYXRoQ29tcGxldGUgPSB0cnVlCiAgICBlbmQKICAgIGVuZAogICAgaWYgR29kQ29tcGxldGUgPT0gZmFsc2UgdGhlbgogICAgbG9jYWwgYXJncyA9IHsKICAgICAgICBbMV0gPSAiQnV5R29kaHVtYW4iCiAgICB9CiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgIAogICAgaWYgQ2hlY2tNYXN0ZXJ5V2VhcG9uKCJHb2RodW1hbiIsIDM1MCkgPT0gInRydWUgVXBUbyIgdGhlbgogICAgICAgIEdvZENvbXBsZXRlID0gdHJ1ZQogICAgZW5kCiAgICBlbmQKICAgIGVuZApwYWdlMzpTZXBlcmF0b3IoIvCfpYsiKSAKcGFnZTM6VG9nZ2xlKCJBdXRvIEdvZEh1bWFuXG7guK3guK3guYLguJXguYnguJfguLPguKvguKHguLHguJTguIHguYfguK3guJXguK7guLTguKfguYHguKHguJkiLCBfRy5BdXRvR29kSHVtYW4sIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b0dvZEh1bWFuID0gdmFsdWUKICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUdvZGh1bWFuIiwgdHJ1ZSkKICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUdvZGh1bWFuIikKICAgIEJ1eUdvZGh1bWFuID0gdG9udW1iZXIoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5R29kaHVtYW4iLCB0cnVlKSkKICAgIGlmIEJ1eUdvZGh1bWFuIHRoZW4KICAgICAgICBpZiBCdXlHb2RodW1hbiB+PSAxIHRoZW4KICAgICAgICAgICAgR2V0QWxsTWVsZWVGYXJtKCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgX0cuQXV0b19Hb2RfSHVtYW4gdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTdXBlcmh1bWFuIikgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTdXBlcmh1bWFuIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkJsYWNrIExlZyIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkRlYXRoIFN0ZXAiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRlYXRoIFN0ZXAiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmlzaG1hbiBLYXJhdGUiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlNoYXJrbWFuIEthcmF0ZSIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU2hhcmttYW4gS2FyYXRlIikgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJvIikgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRWxlY3RybyIpIG9yIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRWxlY3RyaWMgQ2xhdyIpIG9yIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkVsZWN0cmljIENsYXciKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRHJhZ29uIENsYXciKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBUYWxvbiIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRHJhZ29uIFRhbG9uIikgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiR29kaHVtYW4iKSBvciBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkdvZGh1bWFuIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eVN1cGVyaHVtYW4iLHRydWUpID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlN1cGVyaHVtYW4iKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTdXBlcmh1bWFuIikuTGV2ZWwuVmFsdWUgPj0gNDAwIG9yIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlN1cGVyaHVtYW4iKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU3VwZXJodW1hbiIpLkxldmVsLlZhbHVlID49IDQwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEZWF0aFN0ZXAiKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuU3RhcnRlckd1aTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwge1RpdGxlID0gIk5vdGlmaWNhdGlvbiIsIFRleHQgPSAiTm90IEhhdmUgU3VwZXJodW1hbiIgLEljb24gPSAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD0xNjEyOTIzNTA1NCIsRHVyYXRpb24gPSAyLjV9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eURlYXRoU3RlcCIsdHJ1ZSkgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRGVhdGggU3RlcCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkRlYXRoIFN0ZXAiKS5MZXZlbC5WYWx1ZSA+PSA0MDAgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRGVhdGggU3RlcCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJEZWF0aCBTdGVwIikuTGV2ZWwuVmFsdWUgPj0gNDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eVNoYXJrbWFuS2FyYXRlIikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHtUaXRsZSA9ICJOb3RpZmljYXRpb24iLCBUZXh0ID0gIk5vdCBIYXZlIERlYXRoIFN0ZXAiICxJY29uID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTYxMjkyMzUwNTQiLER1cmF0aW9uID0gMi41fSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlTaGFya21hbkthcmF0ZSIsdHJ1ZSkgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiU2hhcmttYW4gS2FyYXRlIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiU2hhcmttYW4gS2FyYXRlIikuTGV2ZWwuVmFsdWUgPj0gNDAwIG9yIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlNoYXJrbWFuIEthcmF0ZSIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTaGFya21hbiBLYXJhdGUiKS5MZXZlbC5WYWx1ZSA+PSA0MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RWxlY3RyaWNDbGF3IikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHtUaXRsZSA9ICJOb3RpZmljYXRpb24iLCBUZXh0ID0gIk5vdCBIYXZlIFNoYXJrTWFuIEthcmF0ZSIgLEljb24gPSAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD0xNjEyOTIzNTA1NCIsRHVyYXRpb24gPSAyLjV9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUVsZWN0cmljQ2xhdyIsdHJ1ZSkgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRWxlY3RyaWMgQ2xhdyIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkVsZWN0cmljIENsYXciKS5MZXZlbC5WYWx1ZSA+PSA0MDAgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRWxlY3RyaWMgQ2xhdyIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJpYyBDbGF3IikuTGV2ZWwuVmFsdWUgPj0gNDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eURyYWdvblRhbG9uIikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHtUaXRsZSA9ICJOb3RpZmljYXRpb24iLCBUZXh0ID0gIk5vdCBIYXZlIEVsZWN0cmljIENsYXciICxJY29uID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTYxMjkyMzUwNTQiLER1cmF0aW9uID0gMi41fSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEcmFnb25UYWxvbiIsdHJ1ZSkgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRHJhZ29uIFRhbG9uIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRHJhZ29uIFRhbG9uIikuTGV2ZWwuVmFsdWUgPj0gNDAwIG9yIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBUYWxvbiIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJEcmFnb24gVGFsb24iKS5MZXZlbC5WYWx1ZSA+PSA0MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5R29kaHVtYW4iLHRydWUpLCAiQnJpbmciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5TdGFydGVyR3VpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7VGl0bGUgPSAiTm90aWZpY2F0aW9uIiwgVGV4dCA9ICJOb3QgSGF2ZSBFbm91Z2ggTWF0ZXJpYWwiICxJY29uID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTYxMjkyMzUwNTQiLER1cmF0aW9uID0gMi41fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlHb2RodW1hbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHtUaXRsZSA9ICJOb3RpZmljYXRpb24iLCBUZXh0ID0gIk5vdCBIYXZlIERyYWdvbiBUYWxvbiIgLEljb24gPSAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD0xNjEyOTIzNTA1NCIsRHVyYXRpb24gPSAyLjV9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eVN1cGVyaHVtYW4iKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgoKcGFnZTM6VG9nZ2xlKCJBdXRvIFN1cGVySHVtYW5cbuC4reC4reC5guC4leC5ieC4l+C4s+C4q+C4oeC4seC4lOC4iuC4uOC4m+C5gOC4m+C4reC4o+C5jOC4ruC4tOC4p+C5geC4oeC4mSIsIF9HLkF1dG9TdXBlcmh1bWFuLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLkF1dG9TdXBlcmh1bWFuID0gdmFsdWUKZW5kKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuQXV0b1N1cGVyaHVtYW4gdGhlbgogICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ29tYmF0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gIkJ1eUJsYWNrTGVnIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIC0tIFN0ZXAgMTogQmxhY2sgTGVnIExldmVsIDMwMCDihpIgRWxlY3RybwogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikuTGV2ZWwuVmFsdWUgPj0gMzAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJCdXlFbGVjdHJvIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkJsYWNrIExlZyIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJCbGFjayBMZWciKS5MZXZlbC5WYWx1ZSA+PSAzMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gIkJ1eUVsZWN0cm8iCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIC0tIFN0ZXAgMjogRWxlY3RybyBMZXZlbCAzMDAg4oaSIEZpc2htYW4gS2FyYXRlCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJvIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRWxlY3RybyIpLkxldmVsLlZhbHVlID49IDMwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSAiQnV5RmlzaG1hbkthcmF0ZSIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJvIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkVsZWN0cm8iKS5MZXZlbC5WYWx1ZSA+PSAzMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gIkJ1eUZpc2htYW5LYXJhdGUiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIC0tIFN0ZXAgMzogRmlzaG1hbiBLYXJhdGUgTGV2ZWwgMzAwIOKGkiBEcmFnb24gQ2xhdyAo4LiV4LmJ4Lit4LiHIDE1MDAgRnJhZ21lbnRzKQogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmlzaG1hbiBLYXJhdGUiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGaXNobWFuIEthcmF0ZSIpLkxldmVsLlZhbHVlID49IDMwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSAiQmxhY2tiZWFyZFJld2FyZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMl0gPSAiRHJhZ29uQ2xhdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbM10gPSAiMiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBIYXZlRHJhZ29uQ2xhdyA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLS0g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li1IEZyYWdtZW50cyDguJ7guK0g4LmE4LibIFJhaWQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b1N1cGVyaHVtYW4gYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EYXRhLkZyYWdtZW50cy5WYWx1ZSA8PSAxNTAwIGFuZCBIYXZlRHJhZ29uQ2xhdyA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EYXRhLkxldmVsLlZhbHVlID4gMTEwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuU2VsZWN0UmFpZHMgPSAiRmxhbWUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuQXV0b1JhaWRzID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9GYXJtIHRoZW4gX0cuQXV0b0Zhcm0gPSBmYWxzZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5BdXRvUmFpZHMgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b0Zhcm0gdGhlbiBfRy5BdXRvRmFybSA9IHRydWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJCbGFja2JlYXJkUmV3YXJkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMl0gPSAiRHJhZ29uQ2xhdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzNdID0gIjIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLkF1dG9SYWlkcyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRmFybSB0aGVuIF9HLkF1dG9GYXJtID0gdHJ1ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmlzaG1hbiBLYXJhdGUiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmlzaG1hbiBLYXJhdGUiKS5MZXZlbC5WYWx1ZSA+PSAzMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gIkJsYWNrYmVhcmRSZXdhcmQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzJdID0gIkRyYWdvbkNsYXciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzNdID0gIjIiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgSGF2ZURyYWdvbkNsYXcgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC0tIOC4luC5ieC4suC5hOC4oeC5iOC4oeC4tSBGcmFnbWVudHMg4Lie4LitIOC5hOC4myBSYWlkCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9TdXBlcmh1bWFuIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuRGF0YS5GcmFnbWVudHMuVmFsdWUgPD0gMTUwMCBhbmQgSGF2ZURyYWdvbkNsYXcgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuRGF0YS5MZXZlbC5WYWx1ZSA+IDExMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLkdldF9GcnVpdCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RSYWlkcyA9ICJGbGFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5BdXRvUmFpZHMgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b0Zhcm0gdGhlbiBfRy5BdXRvRmFybSA9IGZhbHNlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLkF1dG9SYWlkcyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5HZXRfRnJ1aXQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b0Zhcm0gdGhlbiBfRy5BdXRvRmFybSA9IHRydWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJCbGFja2JlYXJkUmV3YXJkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMl0gPSAiRHJhZ29uQ2xhdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzNdID0gIjIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLkF1dG9SYWlkcyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRmFybSB0aGVuIF9HLkF1dG9GYXJtID0gdHJ1ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIC0tIFN0ZXAgNDogRHJhZ29uIENsYXcgTGV2ZWwgMzAwIOKGkiBTdXBlcmh1bWFuCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJEcmFnb24gQ2xhdyIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3IikuTGV2ZWwuVmFsdWUgPj0gMzAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJCdXlTdXBlcmh1bWFuIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3IikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3IikuTGV2ZWwuVmFsdWUgPj0gMzAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJCdXlTdXBlcmh1bWFuIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKCmlmIF9HLkdldF9GcnVpdCB0aGVuCmlmIEludmVudG9yeV9GcnVpdCB0aGVuCiAgICBJbnZlbnRvcnlfRnJ1aXQgPSBuaWwKZW5kClRhYmVsRGV2aWxGcnVpdFN0b3JlID0ge30KCmZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzWyJDb21tRl8iXTpJbnZva2VTZXJ2ZXIoImdldEludmVudG9yeUZydWl0cyIpKSBkbwogICAgZm9yIGkxLCByIGluIHBhaXJzKHYpIGRvCiAgICAgICAgaWYgaTEgPT0gIk5hbWUiIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KFRhYmVsRGV2aWxGcnVpdFN0b3JlLCByKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKZnJ1aXQgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJnZXRJbnZlbnRvcnlGcnVpdHMiKQpmb3IgaTEsIHYgaW4gcGFpcnMoVGFiZWxEZXZpbEZydWl0U3RvcmUpIGRvCiAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKFRhYmVsRGV2aWxGcnVpdFN0b3JlKSB0aGVuCiAgICAgICAgZm9yIGksdiBpbiBwYWlycyhmcnVpdCkgZG8KICAgIGlmIHZbIlByaWNlIl0gPCAxMDAwMDAwMCB0aGVuCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiTG9hZEZydWl0Iix2WyJOYW1lIl0pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgZW5kCmVuZAoKcGFnZTM6VG9nZ2xlKCJBdXRvIEVsZWN0cmljQ2xhd1xu4Lit4Lit4LmC4LiV4LmJ4LiX4Liz4Lir4Lih4Lix4LiU4Liq4Liy4Lii4Lif4LmJ4LiyIiwgX0cuQXV0b0VsZWN0cmljQ2xhdywgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvRWxlY3RyaWNDbGF3ID0gdmFsdWUKICAgIGlmIF9HLkF1dG9FbGVjdHJpY0NsYXcgdGhlbgogICAgICAgIENvbSgiRl8iLCAiQnV5RWxlY3RybyIpCiAgICBlbmQKZW5kKQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5BdXRvRWxlY3RyaWNDbGF3IHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiV2VhcG9uQXNzZXRDYWNoZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkVsZWN0cm8iKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJvIikuTGV2ZWwuVmFsdWUgPCA0MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb24gPSAiRWxlY3RybyIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJvIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkVsZWN0cm8iKS5MZXZlbC5WYWx1ZSA8IDQwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLlNlbGVjdFdlYXBvbiA9ICJFbGVjdHJvIgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRWxlY3RybyIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkVsZWN0cm8iKS5MZXZlbC5WYWx1ZSA+PSA0MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByNzUgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RWxlY3RyaWNDbGF3IiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHI3NSA9PSA0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHI3NiA9IGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlFbGVjdHJpY0NsYXciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTdGFydCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcjc2ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLmxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTEyNTQ4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzMzcsIC03NDgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmluZ18xID0gIkJ1eUVsZWN0cmljQ2xhdyI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXQgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlc1siQ29tbUZfIl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYXJnZXQ6SW52b2tlU2VydmVyKHN0cmluZ18xKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRWxlY3RybyIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJvIikuTGV2ZWwuVmFsdWUgPj0gNDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcjc1ID0gZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUVsZWN0cmljQ2xhdyIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiByNzUgPT0gNCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByNzYgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RWxlY3RyaWNDbGF3IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU3RhcnQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHI3NiA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5sb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0xMjU0OCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMzM3LCAtNzQ4MSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzdHJpbmdfMSA9ICJCdXlFbGVjdHJpY0NsYXciOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXNbIkNvbW1GXyJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFyZ2V0Okludm9rZVNlcnZlcihzdHJpbmdfMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCiAgCnBhZ2UzOlRvZ2dsZSgiQXV0byBEZWF0aFN0ZXBcbuC4reC4reC5guC4leC5ieC4l+C4s+C4q+C4oeC4seC4lOC4guC4suC4lOC4syIsIF9HLkF1dG9EZWF0aFN0ZXAsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b0RlYXRoU3RlcCA9IHZhbHVlCiAgICBpZiBfRy5BdXRvRGVhdGhTdGVwIHRoZW4KICAgICAgICBDb20oIkZfIiwgIkJ1eUJsYWNrTGVnIikKICAgIGVuZAplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIF9HLkF1dG9EZWF0aFN0ZXAgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJXZWFwb25Bc3NldENhY2hlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikuTGV2ZWwuVmFsdWUgPj0gNDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJCdXlEZWF0aFN0ZXAiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLlNlbGVjdFdlYXBvbiA9ICJEZWF0aCBTdGVwIgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkJsYWNrIExlZyIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJCbGFjayBMZWciKS5MZXZlbC5WYWx1ZSA+PSA0MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gIkJ1eURlYXRoU3RlcCIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLlNlbGVjdFdlYXBvbiA9ICJEZWF0aCBTdGVwIgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikuTGV2ZWwuVmFsdWUgPCA0MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb24gPSAiQmxhY2sgTGVnIgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2VpZiBfRy5BdXRvRnVsbHlEZWF0aFN0ZXAgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkJsYWNrIExlZyIpLkxldmVsLlZhbHVlID49IDQwMCBvciBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkJsYWNrIExlZyIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkJsYWNrIExlZyIpLkxldmVsLlZhbHVlID49IDQwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuSWNlQ2FzdGxlLkhhbGwuTGlicmFyeURvb3IuUGhvZXl1RG9vci5UcmFuc3BhcmVuY3kgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGlicmFyeSBLZXkiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiTGlicmFyeSBLZXkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbigiTGlicmFyeSBLZXkiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KDYzNzEuMjAwMTk1MzEyNSwgMjk2LjYzNDMzODM3ODkwNjI1LCAtNjg0MS4xODExNTIzNDM3NSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCAoQ0ZyYW1lLm5ldyg2MzcxLjIwMDE5NTMxMjUsIDI5Ni42MzQzMzgzNzg5MDYyNSwgLTY4NDEuMTgxMTUyMzQzNzUpLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAzIG9yIG5vdCBfRy5BdXRvRGVhdGhTdGVwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ0ZyYW1lLm5ldyg2MzcxLjIwMDE5NTMxMjUsIDI5Ni42MzQzMzgzNzg5MDYyNSwgLTY4NDEuMTgxMTUyMzQzNzUpLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDEuMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEZWF0aFN0ZXAiLHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RGVhdGhTdGVwIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCbGFjayBMZWciKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCbGFjayBMZWciKS5MZXZlbC5WYWx1ZSA+PSA0NTAgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkJsYWNrIExlZyIpLkxldmVsLlZhbHVlID49IDQ1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIkF3YWtlbmVkIEljZSBBZG1pcmFsIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJBd2FrZW5lZCBJY2UgQWRtaXJhbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkF3YWtlbmVkIEljZSBBZG1pcmFsIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiQXdha2VuZWQgSWNlIEFkbWlyYWwiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpGaW5kRmlyc3RDaGlsZCh2Lk5hbWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA+IDIwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFybXR3ZWVuID0gdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMjAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBGYXJtdHdlZW4gdGhlbiBGYXJtdHdlZW46U3RvcCgpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoX0cuU2VsZWN0V2VhcG9uKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDYwLCA2MCwgNjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkJsYWNrIExlZyIpLkxldmVsLlZhbHVlID49IDE1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudCh0cnVlLCAiViIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQoZmFsc2UsICJWIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAgb3IgX0cuQXV0b0RlYXRoU3RlcCA9PSBmYWxzZSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxpYnJhcnkgS2V5Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkxpYnJhcnkgS2V5IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZCgiQXdha2VuZWQgSWNlIEFkbWlyYWwiKS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlCbGFja0xlZyIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKICAKcGFnZTM6VG9nZ2xlKCJBdXRvIFNoYXJrbWFuS2FyYXRlXG7guK3guK3guYLguJXguYnguJfguLPguKvguKHguLHguJTguKHguJnguLjguKnguKLguYzguYDguIfguLfguK3guIEiLF9HLkF1dG9TaGFya01hbkthcmF0ZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvU2hhcmtNYW5LYXJhdGUgPSB2YWx1ZQogICAgaWYgX0cuQXV0b1NoYXJrTWFuS2FyYXRlIHRoZW4KICAgICAgICBDb20oIkZfIiwgIkJ1eVNoYXJrbWFuS2FyYXRlIikKICAgIGVuZAplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIF9HLkF1dG9TaGFya01hbkthcmF0ZSB0aGVuCiAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIldlYXBvbkFzc2V0Q2FjaGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGaXNobWFuIEthcmF0ZSIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTaGFya21hbiBLYXJhdGUiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlNoYXJrbWFuIEthcmF0ZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGaXNobWFuIEthcmF0ZSIpLkxldmVsLlZhbHVlID49IDQwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlTaGFya21hbkthcmF0ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuU2VsZWN0V2VhcG9uICA9ICJTaGFya21hbiBLYXJhdGUiCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmlzaG1hbiBLYXJhdGUiKS5MZXZlbC5WYWx1ZSA+PSA0MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5U2hhcmttYW5LYXJhdGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlNlbGVjdFdlYXBvbiAgPSAiU2hhcmttYW4gS2FyYXRlIgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGaXNobWFuIEthcmF0ZSIpLkxldmVsLlZhbHVlIDw9IDQwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb24gPSAiRmlzaG1hbiBLYXJhdGUiCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RmlzaG1hbkthcmF0ZSIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZWlmIF9HLkF1dG9GdWxseVNoYXJrTWFuS2FyYXRlIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikuTGV2ZWwuVmFsdWUgPj0gNDAwIG9yIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmlzaG1hbiBLYXJhdGUiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGaXNobWFuIEthcmF0ZSIpLkxldmVsLlZhbHVlID49IDQwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5U2hhcmttYW5LYXJhdGUiKSwgImtleXMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2F0ZXIgS2V5Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIldhdGVyIEtleSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoLTI2MDQuNjk1OCwgMjM5LjQzMjUyNiwgLTEwMzE1LjE5ODIsIDAuMDQyNTcwMTM2NSwgMCwgLTAuOTk5MDkzNDEzLDAsIDEsMCwgMC45OTkwOTM0MTMsIDAsIDAuMDQyNTcwMTM2NSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIChDRnJhbWUubmV3KC0yNjA0LjY5NTgsIDIzOS40MzI1MjYsIC0xMDMxNS4xOTgyLCAwLjA0MjU3MDEzNjUsIDAsIC0wLjk5OTA5MzQxMywgMCwgMSwgMCwgMC45OTkwOTM0MTMsIDAsIDAuMDQyNTcwMTM2NSkuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDMgb3Igbm90IF9HLkF1dG9fRnVsbHlfU2hhcmtNYW5fS2FyYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ0ZyYW1lLm5ldygtMjYwNC42OTU4LCAyMzkuNDMyNTI2LCAtMTAzMTUuMTk4MiwgMC4wNDI1NzAxMzY1LCAwLCAtMC45OTkwOTM0MTMsIDAsIDEsIDAsIDAuOTk5MDkzNDEzLCAwLCAwLjA0MjU3MDEzNjUpLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDEuMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlTaGFya21hbkthcmF0ZSIsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5U2hhcmttYW5LYXJhdGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmlzaG1hbiBLYXJhdGUiKS5MZXZlbC5WYWx1ZSA+PSA0MDAgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGaXNobWFuIEthcmF0ZSIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZpc2htYW4gS2FyYXRlIikuTGV2ZWwuVmFsdWUgPj0gNDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZCgiVGlkZSBLZWVwZXIiKSBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlRpZGUgS2VlcGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiVGlkZSBLZWVwZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJUaWRlIEtlZXBlciIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKHYuTmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlID4gMjAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXJtdHdlZW4gPSB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA8PSAyMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEZhcm10d2VlbiB0aGVuIEZhcm10d2VlbjpTdG9wKCkgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChfRy5TZWxlY3RXZWFwb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5GYXN0QXR0YWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNjAsIDYwLCA2MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJCbGFjayBMZWciKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikuTGV2ZWwuVmFsdWUgPj0gMTUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KHRydWUsICJWIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudChmYWxzZSwgIlYiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBfRy5BdXRvRGVhdGhTdGVwID09IGZhbHNlIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGlicmFyeSBLZXkiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiTGlicmFyeSBLZXkiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gZmFsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIlRpZGUgS2VlcGVyIikuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlTaGFya21hbkthcmF0ZSIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RmlzaG1hbkthcmF0ZSIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKICAgICAgCnBhZ2UzOlRvZ2dsZSgiQXV0byBEcmFnb25UYWxvblxu4Lit4Lit4LmC4LiV4LmJ4LiX4Liz4Lir4Lih4Lix4LiU4Lih4Lix4LiH4LiB4LijIiwgIF9HLkF1dG9EcmFnb25UYWxvbiAsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b0RyYWdvblRhbG9uID0gdmFsdWUKICAgIGlmIF9HLkF1dG9EcmFnb25UYWxvbiB0aGVuCiAgICAgICAgQ29tKCJGXyIsICJCbGFja2JlYXJkUmV3YXJkIiwgIkRyYWdvbkNsYXciLCAiMiIpCiAgICBlbmQKZW5kKQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5BdXRvRHJhZ29uVGFsb24gdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJXZWFwb25Bc3NldENhY2hlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRHJhZ29uIENsYXciKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJEcmFnb24gQ2xhdyIpLkxldmVsLlZhbHVlIDw9IDM5OSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgX0cuU2VsZWN0V2VhcG9uID0gIkRyYWdvbiBDbGF3IgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3IikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3IikuTGV2ZWwuVmFsdWUgPD0gMzk5IGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb24gPSAiRHJhZ29uIENsYXciCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRHJhZ29uIENsYXciKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJEcmFnb24gQ2xhdyIpLkxldmVsLlZhbHVlID49IDQwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgX0cuU2VsZWN0V2VhcG9uID0gIkRyYWdvbiBDbGF3IgogICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RHJhZ29uVGFsb24iLCB0cnVlKSA9PSAzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmluZ18xID0gIkJvbmVzIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmluZ18yID0gIkJ1eSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBudW1iZXJfMSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBudW1iZXJfMiA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXQgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlc1siQ29tbUZfIl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYXJnZXQ6SW52b2tlU2VydmVyKHN0cmluZ18xLCBzdHJpbmdfMiwgbnVtYmVyXzEsIG51bWJlcl8yKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzdHJpbmdfMSA9ICJCdXlEcmFnb25UYWxvbiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBib29sXzEgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXNbIkNvbW1GXyJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFyZ2V0Okludm9rZVNlcnZlcihzdHJpbmdfMSwgYm9vbF8xKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEcmFnb25UYWxvbiIsIHRydWUpID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eURyYWdvblRhbG9uIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3RyaW5nXzEgPSAiQnV5RHJhZ29uVGFsb24iO2xvY2FsIGJvb2xfMSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXQgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlc1siQ29tbUZfIl07VGFyZ2V0Okludm9rZVNlcnZlcihzdHJpbmdfMSwgYm9vbF8xKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmluZ18xID0gIkJ1eURyYWdvblRhbG9uIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldCA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzWyJDb21tRl8iXTtUYXJnZXQ6SW52b2tlU2VydmVyKHN0cmluZ18xKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3IikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3IikuTGV2ZWwuVmFsdWUgPj0gNDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb24gPSAiRHJhZ29uIENsYXciCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEcmFnb25UYWxvbiIsIHRydWUpID09IDMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3RyaW5nXzEgPSAiQm9uZXMiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3RyaW5nXzIgPSAiQnV5IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG51bWJlcl8xID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG51bWJlcl8yID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldCA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzWyJDb21tRl8iXTtUYXJnZXQ6SW52b2tlU2VydmVyKHN0cmluZ18xLCBzdHJpbmdfMiwgbnVtYmVyXzEsIG51bWJlcl8yKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzdHJpbmdfMSA9ICJCdXlEcmFnb25UYWxvbiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBib29sXzEgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXNbIkNvbW1GXyJdO1RhcmdldDpJbnZva2VTZXJ2ZXIoc3RyaW5nXzEsIGJvb2xfMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RHJhZ29uVGFsb24iLCB0cnVlKSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEcmFnb25UYWxvbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmluZ18xID0gIkJ1eURyYWdvblRhbG9uIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJvb2xfMSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXQgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlc1siQ29tbUZfIl07VGFyZ2V0Okludm9rZVNlcnZlcihzdHJpbmdfMSwgYm9vbF8xKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmluZ18xID0gIkJ1eURyYWdvblRhbG9uIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldCA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzWyJDb21tRl8iXTtUYXJnZXQ6SW52b2tlU2VydmVyKHN0cmluZ18xKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCnBhZ2U0OlNlcGVyYXRvcigi8J+agCIpCgpwYWdlNDpCdXR0b24oIlRlbGVwb3J0IFRvIFdvcmxkMVxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4LiX4Liw4LmA4LilIDEiLCBmdW5jdGlvbih2YWx1ZSkKICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlRyYXZlbE1haW4iKQplbmQpCgpwYWdlNDpCdXR0b24oIlRlbGVwb3J0IFRvIFdvcmxkMlxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4LiX4Liw4LmA4LilIDIiLCBmdW5jdGlvbih2YWx1ZSkKICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlRyYXZlbERyZXNzcm9zYSIpCmVuZCkKCnBhZ2U0OkJ1dHRvbigiVGVsZXBvcnQgVG8gV29ybGQzXG7guYDguJfguYDguKXguJ7guK3guKPguYzguJXguYTguJvguJfguLDguYDguKUgMyIsIGZ1bmN0aW9uKHZhbHVlKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiVHJhdmVsWm91IikKZW5kKQoKVGVsZXBvcnRUYWJsZSA9IHt9CmlmIFdvcmxkMyB0aGVuClRlbGVwb3J0VGFibGUgPSB7ICJQb3J0IFRvd24iLCAiSHlkcmEgSXNsYW5kIiwgIkdhaW50IFRyZWUiLCAiTWFuc2lvbiIsICJDYXN0bGUgb24gdGhlIFNlYSIsICJIYXVudGVkIENhc3RsZSIsIkljZWNyZWFtIElzbGFuZCIsICJQZWFudXQgSXNsYW5kIiwgIkNha2UgTG9hZiIsICJDYW5keSBJc2FuZCIsICJUaWtpT3V0cG9zdCIgfQplbmQKcGFnZTQ6U2VwZXJhdG9yKCLwn4+d77iPIikKCnBhZ2U0OkRyb3Bkb3duKCJTZWxlY3RJc2xhbmRcbuC5gOC4peC4t+C4reC4geC5gOC4geC4suC4sCIsVGVsZXBvcnRUYWJsZSwgZnVuY3Rpb24odmFsdWUpCl9HLlNlbGVjdExvY2FsVGVsZXBvcnQgPSB2YWx1ZQplbmQpCgpwYWdlNDpUb2dnbGUoIlRlbGVwb3J0IFRvIFNlbGVjdGVkXG7guYDguJfguYDguKXguJ7guK3guKPguYzguJXguYTguJvguJfguLXguYjguYDguKXguLfguK3guIHguYTguKfguYkiLCBfRy5UZWxlcG9ydElzbGFuZCxmdW5jdGlvbih2YWx1ZSkKX0cuVGVsZXBvcnRJc2xhbmQgPSB2YWx1ZQppZiBfRy5UZWxlcG9ydElzbGFuZCB0aGVuCmlmIFdvcmxkMyAgdGhlbgogICAgaWYgX0cuU2VsZWN0TG9jYWxUZWxlcG9ydCA9PSAiUG9ydCBUb3duIiB0aGVuCiAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygtMjc1LjIxNjE1NjAwNTg2LCA0My43NTU3MzczMDQ2ODgsIDU0NTEuMDY1OTE3OTY4OCkpCiAgICBlbmQKICAgIGlmIF9HLlNlbGVjdExvY2FsVGVsZXBvcnQgPT0gIk1hbnNpb24iIHRoZW4KICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICBbMV0gPSAicmVxdWVzdEVudHJhbmNlIiwKICAgICAgICAgICAgWzJdID0gVmVjdG9yMy5uZXcoLTEyNTQ4LjU5NTcwMzEyNSwgMzM3LjE3MDAxMzQyNzczLCAtNzU1NC42MTAzNTE1NjI1KQogICAgICAgIH0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgIGVuZAogICAgaWYgX0cuU2VsZWN0TG9jYWxUZWxlcG9ydCA9PSAiQ2FzdGxlIG9uIHRoZSBTZWEiIHRoZW4KICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICBbMV0gPSAicmVxdWVzdEVudHJhbmNlIiwKICAgICAgICAgICAgWzJdID0gVmVjdG9yMy5uZXcoLTUwNzkuNDQ2Nzc3MzQzNzUsIDMxMy43MjkzMzk1OTk2MDk0LCAtMzE1MS4wNjUxODU1NDY4NzUpCiAgICAgICAgfQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgZW5kCiAgICBpZiBfRy5TZWxlY3RMb2NhbFRlbGVwb3J0ID09ICJIeWRyYSBJc2xhbmQiIHRoZW4KICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KDU1NDEuMjY4NTU0Njg3NSwgNjY4LjMwNDU2NTQyOTY5LCAxOTUuNDgwNjk3NjMxODQpKQogICAgZW5kCiAgICBpZiBfRy5TZWxlY3RMb2NhbFRlbGVwb3J0ID09ICJHYWludCBUcmVlIiB0aGVuCiAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygyMjc2LjA4NTkzNzUsIDI1Ljg3ODUwMTg5MjA5LCAtNjQ5My4wMzEyNSkpCiAgICBlbmQKICAgIGlmIF9HLlNlbGVjdExvY2FsVGVsZXBvcnQgPT0gIkhhdW50ZWQgQ2FzdGxlIiB0aGVuCiAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygtOTUxNS4wNzMyNCwgMTQyLjEzMDYxNSwgNTUzNy41ODM5OCkpCiAgICBlbmQKICAgIGlmIF9HLlNlbGVjdExvY2FsVGVsZXBvcnQgPT0gIkljZWNyZWFtIElzbGFuZCIgdGhlbgogICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTg4MC44OTQ1MzEsIDExOC4yNDUzNTQsIC0xMTAzMC43NjA3LCAtMC44NjcxNzQ5ODMsIDEuNDg1MDEyMzRlLTA5LCAwLjQ5ODAwMzU3MiwKICAgICAgICAgICAgMi43MDQ1Nzc4OWUtMDgsIDEsIDQuNDExMjk1ODZlLTA4LCAtMC40OTgwMDM1NzIsIDUuMTcyMjU0OGUtMDgsIC0wLjg2NzE3NDk4MykpCiAgICBlbmQKICAgIGlmIF9HLlNlbGVjdExvY2FsVGVsZXBvcnQgPT0gIlBlYW51dCBJc2xhbmQiIHRoZW4KICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0yMTI0LjA2NzM4LCA0NC4wNzIzNDk1LCAtMTAxNzkuODI4MSwgLTAuNjIzMTI1NDk0LCAtMi41NTkwODE5MWUtMDcsIC0wLjc4MjEyMTgzNywKICAgICAgICAgICAgLTEuNDA1MzA1NzRlLTA3LCAxLCAtMi4xNTIzNTAwNWUtMDcsIDAuNzgyMTIxODM3LCAtMi40MjA2MzkzM2UtMDgsIC0wLjYyMzEyNTQ5NCkpCiAgICBlbmQKICAgIGlmIF9HLlNlbGVjdExvY2FsVGVsZXBvcnQgPT0gIkxhYiIgdGhlbgogICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTUwNTcuMTQ2NDg0Mzc1LCAzMTQuNTQxMzIwODAwNzgsIC0yOTM0Ljc5OTU2MDU0NjkpKQogICAgZW5kCiAgICBpZiBfRy5TZWxlY3RMb2NhbFRlbGVwb3J0ID09ICJDYWtlIExvYWYiIHRoZW4KICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xOTc3LjM2NzY3NTc4MTI1LCAyNTEuNTA5NTIxNDg0Mzc1LCAtMTIzODAuNDE4OTQ1MzEyNSkpCiAgICBlbmQKICAgIGlmIF9HLlNlbGVjdExvY2FsVGVsZXBvcnQgPT0gIkNhbmR5IElzYW5kIiB0aGVuCiAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygtMTA2Ny4wMjI0NiwgMTQuNjQwNDIyOCwgLTE0NDQ4LjE0NTUsIDAuOTA3NjM1MjcyLCAtNy4yOTM0MDQ5OWUtMDgsIDAuNDE5NzU5NzIxLCA2LjczNjY5NjE4ZS0wOCwgMSwgMi44MDg2MTEzZS0wOCwgLTAuNDE5NzU5NzIxLCAyLjc4NTk4OTQ0ZS0wOSwgMC45MDc2MzUyNzIpICogQ0ZyYW1lLm5ldygwLDEwMCwwKSkKICAgIGVuZAogICAgaWYgX0cuU2VsZWN0TG9jYWxUZWxlcG9ydCA9PSAiVGlraU91dHBvc3QiIHRoZW4KICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xNjc1My41OTc3LCAxODkuNTI4MTA3LCA0NTEuNzk3MzMzLCAtMC43NzcxNDU1MDUsIDAsIC0wLjYyOTMyMTAzOSwgMCwgMSwgMCwgMC42MjkzMjEwMzksIDAsIC0wLjc3NzE0NTUwNSkpCiAgICBlbmQKZW5kCmVuZAplbmQpCiAKcGFnZTQ6QnV0dG9uKCJTdG9wIFRlbGVwb3J0XG7guKvguKLguLjguJTguIHguLLguKPguYDguJfguYDguKXguJ7guK3guKPguYzguJUiLCBmdW5jdGlvbih2YWx1ZSkKICAgIHRvVGFyZ2V0KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCmVuZCkKCnBhZ2UxOlNlcGVyYXRvcigiT2JzZXJ2YXRpb24v4Liu4Liy4LiE4Li04Liq4Lix4LiH4LmA4LiB4LiVIikKbG9jYWwgT2JzZXJ2YXRpb25SYW5nZSA9IHBhZ2UxOkxhYmVsKCIuLi4iKQpzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIE9ic2VydmF0aW9uUmFuZ2U6U2V0KCJMdk9ic2VydmF0aW9uIDogIi4ubWF0aC5mbG9vcihnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5WaXNpb25SYWRpdXMuVmFsdWUpKQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQpCgogICAgcGFnZTE6VG9nZ2xlKCJBdXRvIE9ic2VydmF0aW9uVjJcbuC4l+C4s+C4ruC4suC4hOC4tOC4quC4seC4h+C5gOC4geC4leC4guC4seC5ieC4meC4quC4reC4hyIsX0cuQXV0b0tlbkhha2lWMiwgZnVuY3Rpb24odmFsdWUpCiAgICAgICAgX0cuQXV0b0tlbkhha2lWMiA9IHZhbHVlCiAgICAgICAgICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBfRy5BdXRvS2VuSGFraVYyIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5WaXNpYmxlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xMjQ0NC43ODUxNTYyNSwgMzMyLjQwMzk2MTE4MTY0LCAtNzY3My4xODA2NjQwNjI1KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvS2VuSGFraVYyIG9yIChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBWZWN0b3IzLm5ldygtMTI0NDQuNzg1MTU2MjUsIDMzMi40MDM5NjExODE2NCwgLTc2NzMuMTgwNjY0MDYyNSkpLk1hZ25pdHVkZSA8PSAxMAogICAgICAgICAgICAgICAgICAgICAgICB3YWl0KC41KQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJDaXRpemVuUXVlc3RQcm9ncmVzcyIsIkNpdGl6ZW4iKQogICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0YXJ0UXVlc3QiLCJDaXRpemVuUXVlc3QiLCAxKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCYW5hbmEiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJBcHBsZSIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlBpbmVhcHBsZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTEyNDQ0Ljc4NTE1NjI1LCAzMzIuNDAzOTYxMTgxNjQsIC03NjczLjE4MDY2NDA2MjUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0tlbkhha2lWMiBvciAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gVmVjdG9yMy5uZXcoLTEyNDQ0Ljc4NTE1NjI1LCAzMzIuNDAzOTYxMTgxNjQsIC03NjczLjE4MDY2NDA2MjUpKS5NYWduaXR1ZGUgPD0gMTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJDaXRpemVuUXVlc3RQcm9ncmVzcyIsICJDaXRpemVuIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRnJ1aXQgQm93bCIpIG9yIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZydWl0IEJvd2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xMDkyMC4xMjUsIDYyNC4yMDI3NTg3ODkwNiwgLTEwMjY2Ljk5NTExNzE4OCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvS2VuSGFraVYyIG9yIChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBWZWN0b3IzLm5ldygtMTA5MjAuMTI1LCA2MjQuMjAyNzU4Nzg5MDYsIC0xMDI2Ni45OTUxMTcxODgpKS5NYWduaXR1ZGUgPD0gMTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJLZW5UYWxrMiIsIlN0YXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIktlblRhbGsyIiwiQnV5IikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQsICJEZWZlYXQgNTAgRm9yZXN0IFBpcmF0ZXMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkZvcmVzdCBQaXJhdGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiRm9yZXN0IFBpcmF0ZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKF9HLlNlbGVjdFdlYXBvbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5GYXN0QXR0YWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0tlbkhha2lWMiBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTEzMjc3LjU2ODM1OTM3NSwgMzcwLjM0MTg1NzkxMDE2LCAtNzgyMS4xNTcyMjY1NjI1KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0tlbkhha2lWMiBvciAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gVmVjdG9yMy5uZXcoLTEzMjc3LjU2ODM1OTM3NSwgMzcwLjM0MTg1NzkxMDE2LCAtNzgyMS4xNTcyMjY1NjI1KSkuTWFnbml0dWRlIDw9IDEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQgPT0gIkRlZmVhdCAgQ2FwdGFpbiBFbGVwaGFudCAoMC8xKSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDYXB0YWluIEVsZXBoYW50IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkNhcHRhaW4gRWxlcGhhbnQiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChfRy5TZWxlY3RXZWFwb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc01vbiA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9LZW5IYWtpVjIgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xMzQ5My4xMjg5MDYyNSwgMzE4Ljg5NTUzODMzMDA4LCAtODM3My43OTE5OTIxODc1KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0tlbkhha2lWMiBvciAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gVmVjdG9yMy5uZXcoLTEzNDkzLjEyODkwNjI1LCAzMTguODk1NTM4MzMwMDgsIC04MzczLjc5MTk5MjE4NzUpKS5NYWduaXR1ZGUgPD0gMTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiQXBwbGUiIG9yIHYuTmFtZSA9PSAiQmFuYW5hIiBvciB2Lk5hbWUgPT0gIlBpbmVhcHBsZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhhbmRsZS5DRnJhbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAxLCAxMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCx2LkhhbmRsZSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kKQpwYWdlMTpUb2dnbGUoIkF1dG8gRmFybU9ic2VydmF0aW9uXG7guJ/guLLguKPguYzguKHguK7guLLguITguLTguKrguLHguIfguYDguIHguJUiLF9HLlNldHRpbmdzLkF1dG9PYnNlcnZhdGlvbixmdW5jdGlvbih2YWx1ZSkKICAgIF9HLkF1dG9PYnNlcnZhdGlvbiA9IHZhbHVlCiAgICBfRy5TZXR0aW5ncy5BdXRvT2JzZXJ2YXRpb24gPSB2YWx1ZQogICAgU2F2ZVNldHRpbmdzKCkgCiAgICBpZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgdGFzay53YWl0KCkKICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgdGFzay53YWl0KCkKICAgIGVuZAplbmQpCgpzcGF3bihmdW5jdGlvbigpCndoaWxlIHdhaXQoKSBkbwogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5TZXR0aW5ncy5BdXRvT2JzZXJ2YXRpb24gdGhlbgogICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlNjcmVlbkd1aTpGaW5kRmlyc3RDaGlsZCgiSW1hZ2VMYWJlbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCg1KQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6U2V0S2V5RG93bigiMHg2NSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMikKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOlNldEtleVVwKCIweDY1IikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHVudGlsIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5TY3JlZW5HdWk6RmluZEZpcnN0Q2hpbGQoIkltYWdlTGFiZWwiKSBvciBub3QgX0cuQXV0b09ic2VydmF0aW9uCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgpwYWdlMTpUb2dnbGUoIkF1dG8gRmFybU9ic2VydmF0aW9uIEhvcFxu4Lif4Liy4Lij4LmM4Lih4Liu4Liy4LiE4Li04Liq4Lix4LiH4LmA4LiB4LiV4Lii4LmJ4Liy4Lii4LmA4LiL4Li04LifIiwgX0cuQXV0b09ic2VydmF0aW9uX0hvcCwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvT2JzZXJ2YXRpb25fSG9wID0gdmFsdWUKZW5kKQoKc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIF9HLlNldHRpbmdzLkF1dG9PYnNlcnZhdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlZpc2lvblJhZGl1cy5WYWx1ZSA+PSA2MDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLHtJY29uID0gInJieGFzc2V0aWQ6Ly8xNjEyOTIzNTA1NCIsVGl0bGUgPSAiT2JzZXJ2YXRpb24iLFRleHQgPSAiWW91IEhhdmUgTWF4IE9ic2VydmF0aW9uIn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgV29ybGQzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkdpYW50IElzbGFuZGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlNjcmVlbkd1aTpGaW5kRmlyc3RDaGlsZCgiSW1hZ2VMYWJlbCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiR2lhbnQgSXNsYW5kZXIiKS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMywgMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIF9HLkF1dG9PYnNlcnZhdGlvbiA9PSBmYWxzZSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuU2NyZWVuR3VpOkZpbmRGaXJzdENoaWxkKCJJbWFnZUxhYmVsIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkdpYW50IElzbGFuZGVyIikuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDUwLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlNjcmVlbkd1aTpGaW5kRmlyc3RDaGlsZCgiSW1hZ2VMYWJlbCIpIGFuZCBfRy5BdXRvT2JzZXJ2YXRpb25fSG9wID09IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlRlbGVwb3J0U2VydmljZSIpOlRlbGVwb3J0KGdhbWUuUGxhY2VJZCxnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIF9HLkF1dG9PYnNlcnZhdGlvbiA9PSBmYWxzZSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5TY3JlZW5HdWk6RmluZEZpcnN0Q2hpbGQoIkltYWdlTGFiZWwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoNDUzMC4zNTQwMDM5MDYzLCA2NTYuNzU2OTU4MDA3ODEsIC0xMzEuNjA5NTI3NTg3ODkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQpCgpwYWdlMTpTZXBlcmF0b3IoIkJvc3NcbuC4muC4reC4qiIpIApsb2NhbCBCb3NzID0ge30KbG9jYWwgQm9zc05hbWUgPSBwYWdlMTpEcm9wZG93bigiU2VsZWN0Qm9zc1xu4LmA4Lil4Li34Lit4LiB4Lia4Lit4LiqIixCb3NzLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLlNlbGVjdEJvc3MgPSB2YWx1ZQplbmQpCnBhZ2UxOkJ1dHRvbigiUmVmcmVzaFxu4Lij4Li14LmA4Lif4Lij4LiKIixmdW5jdGlvbigpCkJvc3NOYW1lOkNsZWFyKCkKICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuUmVwbGljYXRlZFN0b3JhZ2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2Lk5hbWUgPT0gIkN5Ym9yZyIgb3Igdi5OYW1lID09ICJUaGUgR29yaWxsYSBLaW5nIiBvciB2Lk5hbWUgPT0gIld5c3BlciIgb3Igdi5OYW1lID09ICJUaHVuZGVyIEdvZCIgb3Igdi5OYW1lID09ICJNb2IgTGVhZGVyIiBvciB2Lk5hbWUgPT0gIkJvYmJ5IiBvciB2Lk5hbWUgPT0gIlNhYmVyIEV4cGVydCIgb3Igdi5OYW1lID09ICJXYXJkZW4iIG9yIHYuTmFtZSA9PSAiQ2hpZWYgV2FyZGVuIiBvciB2Lk5hbWUgPT0gIlN3YW4iIG9yIHYuTmFtZSA9PSAiTWFnbWEgQWRtaXJhbCIgIG9yIHYuTmFtZSA9PSAiRmlzaG1hbiBMb3JkIiBvciB2Lk5hbWUgPT0gIld5c3BlciIgb3Igdi5OYW1lID09ICJJY2UgQWRtaXJhbCIgb3Igdi5OYW1lID09ICJEaWFtb25kIiBvciB2Lk5hbWUgPT0gIkplcmVteSIgb3Igdi5OYW1lID09ICJGYWppdGEiIG9yIHYuTmFtZSA9PSAiRG9uIFN3YW4iIG9yIHYuTmFtZSA9PSAiU21va2UgQWRtaXJhbCIgb3Igdi5OYW1lID09ICJBd2FrZW5lZCBJY2UgQWRtaXJhbCIgb3Igdi5OYW1lID09ICJUaWRlIEtlZXBlciIgb3Igdi5OYW1lID09ICJEYXJrYmVhcmQiIG9yIHYuTmFtZSA9PSAiU3RvbmUiIG9yIHYuTmFtZSA9PSAiSXNsYW5kIEVtcHJlc3MiIG9yIHYuTmFtZSA9PSAiS2lsbyBBZG1pcmFsIiBvciB2Lk5hbWUgPT0gIkNhcHRhaW4gRWxlcGhhbnQiIG9yIHYuTmFtZSA9PSAiQmVhdXRpZnVsIFBpcmF0ZSIgb3Igdi5OYW1lID09ICJMb25nbWEiIG9yIHYuTmFtZSA9PSAiQ2FrZSBRdWVlbiIgb3Igdi5OYW1lID09ICJHcmV5YmVhcmQiIG9yIHYuTmFtZSA9PSAiT3JkZXIiIG9yIHYuTmFtZSA9PSAiQ3Vyc2VkIENhcHRhaW4iIG9yIHYuTmFtZSA9PSAiU291bCBSZWFwZXIiIG9yIHYuTmFtZSA9PSAiUmlwIGluZHJhIiBvciB2Lk5hbWUgPT0gIk1paGF3ayBCb3NzIiBvciB2Lk5hbWUgPT0gIkNha2UgUHJpbmNlIiBvciB2Lk5hbWUgPT0gIkRvdWdoIEtpbmciIG9yIHYuTmFtZSA9PSAiQ3Vyc2VkIFNrZWxldG9uIEJvc3MiIG9yIHYuTmFtZSA9PSAiRmFjdG9yeSIgIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoQm9zcywgdi5OYW1lKQogICAgICAgIEJvc3NOYW1lOkFkZCh2Lk5hbWUpIAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnBhZ2UxOlRvZ2dsZSgiQXV0byBGYXJtQm9zc1xu4Lif4Liy4Lij4LmM4Lih4Lia4Lit4LiqIiwgX0cuQXV0b0Zhcm1Cb3NzLCBmdW5jdGlvbih2YWx1ZSkKX0cuQXV0b0Zhcm1Cb3NzID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0YXNrLndhaXQoKQogICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICB0YXNrLndhaXQoKQogICAgZW5kCmVuZCkKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBfRy5BdXRvRmFybUJvc3MgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoX0cuU2VsZWN0Qm9zcykgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gX0cuU2VsZWN0Qm9zcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvRmFybUJvc3Mgb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoX0cuU2VsZWN0Qm9zcykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoX0cuU2VsZWN0Qm9zcykuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDM1LCAwKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKcGFnZTE6VG9nZ2xlKCJBdXRvIEZhcm1Cb3NzQWxsXG7guJ/guLLguKPguYzguKHguJrguK3guKrguJfguLHguYnguIfguKvguKHguJQiLCBfRy5BdXRvQWxsQm9zcywgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvQWxsQm9zcyA9IHZhbHVlCiAgICAgICAgaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgogICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgICAgIHRhc2sud2FpdCgpCiAgICBlbmQKZW5kKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9BbGxCb3NzIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiQ3lib3JnIiBvciB2Lk5hbWUgPT0gIlRoZSBHb3JpbGxhIEtpbmciIG9yIHYuTmFtZSA9PSAiV3lzcGVyIiBvciB2Lk5hbWUgPT0gIlRodW5kZXIgR29kIiBvciB2Lk5hbWUgPT0gIk1vYiBMZWFkZXIiIG9yIHYuTmFtZSA9PSAiQm9iYnkiIG9yIHYuTmFtZSA9PSAiU2FiZXIgRXhwZXJ0IiBvciB2Lk5hbWUgPT0gIldhcmRlbiIgb3Igdi5OYW1lID09ICJDaGllZiBXYXJkZW4iIG9yIHYuTmFtZSA9PSAiU3dhbiIgb3Igdi5OYW1lID09ICJNYWdtYSBBZG1pcmFsIiAgb3Igdi5OYW1lID09ICJGaXNobWFuIExvcmQiIG9yIHYuTmFtZSA9PSAiV3lzcGVyIiBvciB2Lk5hbWUgPT0gIkljZSBBZG1pcmFsIiBvciB2Lk5hbWUgPT0gIkRpYW1vbmQiIG9yIHYuTmFtZSA9PSAiSmVyZW15IiBvciB2Lk5hbWUgPT0gIkZhaml0YSIgb3Igdi5OYW1lID09ICJEb24gU3dhbiIgb3Igdi5OYW1lID09ICJTbW9rZSBBZG1pcmFsIiBvciB2Lk5hbWUgPT0gIkF3YWtlbmVkIEljZSBBZG1pcmFsIiBvciB2Lk5hbWUgPT0gIlRpZGUgS2VlcGVyIiBvciB2Lk5hbWUgPT0gIkRhcmtiZWFyZCIgb3Igdi5OYW1lID09ICJTdG9uZSIgb3Igdi5OYW1lID09ICJJc2xhbmQgRW1wcmVzcyIgb3Igdi5OYW1lID09ICJLaWxvIEFkbWlyYWwiIG9yIHYuTmFtZSA9PSAiQ2FwdGFpbiBFbGVwaGFudCIgb3Igdi5OYW1lID09ICJCZWF1dGlmdWwgUGlyYXRlIiBvciB2Lk5hbWUgPT0gIkNha2UgUXVlZW4iIG9yIHYuTmFtZSA9PSAiR3JleWJlYXJkIiBvciB2Lk5hbWUgPT0gIk9yZGVyIiBvciB2Lk5hbWUgPT0gIkN1cnNlZCBDYXB0YWluIiBvciB2Lk5hbWUgPT0gIlNvdWwgUmVhcGVyIiBvciB2Lk5hbWUgPT0gIlJpcCBpbmRyYSIgb3Igdi5OYW1lID09ICJNaWhhd2sgQm9zcyIgb3Igdi5OYW1lID09ICJDYWtlIFByaW5jZSIgb3Igdi5OYW1lID09ICJEb3VnaCBLaW5nIiBvciB2Lk5hbWUgPT0gIkN1cnNlZCBTa2VsZXRvbiBCb3NzIiBvciB2Lk5hbWUgPT0gIkZhY3RvcnkiIAogICAgICAgICAgICAgICAgICAgIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBGYXN0QXR0YWNrIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIF9HLkF1dG9BbGxCb3NzID09IGZhbHNlIG9yIG5vdCB2LlBhcmVudCAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpsb2NhbCBTdXBDb21wbGV0ZSA9IGZhbHNlCmxvY2FsIEVDbGF3Q29tcGxldGUgPSBmYWxzZQpsb2NhbCBUYWxDb21wbGV0ZSA9IGZhbHNlCmxvY2FsIFNoYXJrQ29tcGxldGUgPSBmYWxzZQpsb2NhbCBEZWF0aENvbXBsZXRlID0gZmFsc2UKbG9jYWwgR29kQ29tcGxldGUgPSBmYWxzZQoKcGFnZTU6U2VwZXJhdG9yKCLwn5K8IikKCgpsb2NhbCBtYXAKbG9jYWwgdHJvcGhpZXMKbG9jYWwgdGFibGV0cwpsb2NhbCB0YXJnZXRDRnJhbWUgPSBDRnJhbWUubmV3KC05NTQ0LjI2ODU1LCA2LjEzMTM2NzIxLCA2MDM1LjM5MjA5LCAtMC45NzQxMjY2OTcsIC04LjAwNjIzNTY3ZS0wOSwgMC4yMjYwMDI2MTksIC0xLjQ4NTQ5NjE3ZS0wOCwgMSwgLTIuODYwMzExNjNlLTA4LCAtMC4yMjYwMDI2MTksIC0zLjEyMjAzMjA2ZS0wOCwgLTAuOTc0MTI2Njk3KQpsb2NhbCB0cm9waHlTZWdtZW50TWFwID0gewogICAge3Ryb3BoeSA9ICJUcm9waHkxIiwgc2VnbWVudCA9ICJTZWdtZW50MSJ9LAogICAge3Ryb3BoeSA9ICJUcm9waHkyIiwgc2VnbWVudCA9ICJTZWdtZW50MyJ9LAogICAge3Ryb3BoeSA9ICJUcm9waHkzIiwgc2VnbWVudCA9ICJTZWdtZW50NCJ9LAogICAge3Ryb3BoeSA9ICJUcm9waHk0Iiwgc2VnbWVudCA9ICJTZWdtZW50NyJ9LAogICAge3Ryb3BoeSA9ICJUcm9waHk1Iiwgc2VnbWVudCA9ICJTZWdtZW50MTAifQp9Cgpsb2NhbCB0cm9waHlSb3RhdGlvbnMgPSB7fQpsb2NhbCBzZWdtZW50VGFyZ2V0cyA9IHsKICAgIFNlZ21lbnQxID0ge3RhcmdldCA9IG5pbCwgZG9uZSA9IGZhbHNlfSwKICAgIFNlZ21lbnQyID0ge3RhcmdldCA9IFZlY3RvcjMubmV3KDAsIDAsIDApLCBkb25lID0gZmFsc2V9LAogICAgU2VnbWVudDMgPSB7dGFyZ2V0ID0gbmlsLCBkb25lID0gZmFsc2V9LAogICAgU2VnbWVudDQgPSB7dGFyZ2V0ID0gbmlsLCBkb25lID0gZmFsc2V9LAogICAgU2VnbWVudDUgPSB7dGFyZ2V0ID0gVmVjdG9yMy5uZXcoMCwgMCwgMCksIGRvbmUgPSBmYWxzZX0sCiAgICBTZWdtZW50NiA9IHt0YXJnZXQgPSBWZWN0b3IzLm5ldygwLCAwLCAwKSwgZG9uZSA9IGZhbHNlfSwKICAgIFNlZ21lbnQ3ID0ge3RhcmdldCA9IG5pbCwgZG9uZSA9IGZhbHNlfSwKICAgIFNlZ21lbnQ4ID0ge3RhcmdldCA9IFZlY3RvcjMubmV3KDAsIDAsIDApLCBkb25lID0gZmFsc2V9LAogICAgU2VnbWVudDkgPSB7dGFyZ2V0ID0gVmVjdG9yMy5uZXcoMCwgMCwgMCksIGRvbmUgPSBmYWxzZX0sCiAgICBTZWdtZW50MTAgPSB7dGFyZ2V0ID0gbmlsLCBkb25lID0gZmFsc2V9Cn0KCmxvY2FsIGxhYlRhcmdldHMgPSB7CiAgICBQYXJ0MyA9IHt0YXJnZXQgPSBDb2xvcjMuZnJvbVJHQigxNjMsIDc1LCA3NSksIGRvbmUgPSBmYWxzZX0sCiAgICBQYXJ0NCA9IHt0YXJnZXQgPSBDb2xvcjMuZnJvbVJHQig1MSwgODgsIDEzMCksIGRvbmUgPSBmYWxzZX0sCiAgICBQYXJ0NiA9IHt0YXJnZXQgPSBDb2xvcjMuZnJvbVJHQig0NCwgMTAxLCAyOSksIGRvbmUgPSBmYWxzZX0sCiAgICBQYXJ0OCA9IHt0YXJnZXQgPSBDb2xvcjMuZnJvbVJHQigxNjMsIDc1LCA3NSksIGRvbmUgPSBmYWxzZX0sCiAgICBQYXJ0MTAgPSB7dGFyZ2V0ID0gQ29sb3IzLmZyb21SR0IoNTEsIDg4LCAxMzApLCBkb25lID0gZmFsc2V9Cn0KCi0tIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5gOC4nuC4t+C5iOC4reC4o+C4reC5g+C4q+C5iSBIYXVudGVkIENhc3RsZSDguYLguKvguKXguJQKbG9jYWwgZnVuY3Rpb24gd2FpdEZvckhhdW50ZWRDYXN0bGUoKQogICAgbG9jYWwgbWF4QXR0ZW1wdHMgPSAzMAogICAgbG9jYWwgYXR0ZW1wdCA9IDAKCiAgICB3aGlsZSBub3QgV29ya3NwYWNlLk1hcDpGaW5kRmlyc3RDaGlsZCgiSGF1bnRlZCBDYXN0bGUiKSBhbmQgYXR0ZW1wdCA8IG1heEF0dGVtcHRzIGRvCiAgICAgICAgcHJpbnQoIkhhdW50ZWQgQ2FzdGxlIG5vdCBsb2FkZWQsIG1vdmluZyB0byB0YXJnZXQgcG9zaXRpb24iKQogICAgICAgIHRvVGFyZ2V0KHRhcmdldENGcmFtZSkKICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICBhdHRlbXB0ID0gYXR0ZW1wdCArIDEKICAgIGVuZAoKICAgIG1hcCA9IFdvcmtzcGFjZS5NYXA6RmluZEZpcnN0Q2hpbGQoIkhhdW50ZWQgQ2FzdGxlIikKICAgIGlmIG5vdCBtYXAgdGhlbgogICAgICAgIHdhcm4oIkZhaWxlZCB0byBsb2FkIEhhdW50ZWQgQ2FzdGxlIGFmdGVyICIgLi4gbWF4QXR0ZW1wdHMgLi4gIiBhdHRlbXB0cyIpCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICB0cm9waGllcyA9IG1hcDpXYWl0Rm9yQ2hpbGQoIlRyb3BoaWVzIiwgNSk6RmluZEZpcnN0Q2hpbGQoIlF1ZXN0IikKICAgIHRhYmxldHMgPSBtYXA6V2FpdEZvckNoaWxkKCJUYWJsZXQiLCA1KQogICAgaWYgbm90IHRyb3BoaWVzIG9yIG5vdCB0YWJsZXRzIHRoZW4KICAgICAgICB3YXJuKCJUcm9waGllcyBvciBUYWJsZXRzIG5vdCBmb3VuZCBpbiBIYXVudGVkIENhc3RsZSIpCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICBwcmludCgiSGF1bnRlZCBDYXN0bGUgbG9hZGVkIHN1Y2Nlc3NmdWxseSIpCiAgICByZXR1cm4gdHJ1ZQplbmQKCi0tIOC4m+C4o+C4sOC4oeC4p+C4peC4nOC4pSB0cm9waHkg4LmB4Lil4LiwIHNlZ21lbnQKbG9jYWwgZnVuY3Rpb24gaW5pdGlhbGl6ZVRyb3BoaWVzKCkKICAgIGZvciBfLCBwYWlyIGluIGlwYWlycyh0cm9waHlTZWdtZW50TWFwKSBkbwogICAgICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgdHJvcGh5ID0gdHJvcGhpZXM6RmluZEZpcnN0Q2hpbGQocGFpci50cm9waHkpCiAgICAgICAgICAgIGlmIHRyb3BoeSBhbmQgdHJvcGh5OkZpbmRGaXJzdENoaWxkKCJIYW5kbGUiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCByb3RhdGlvbiA9IHRyb3BoeS5IYW5kbGUuUm90YXRpb24KICAgICAgICAgICAgICAgIHRyb3BoeVJvdGF0aW9uc1twYWlyLnNlZ21lbnRdID0gcm90YXRpb24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgcm90YXRpb24gPT0gVmVjdG9yMy5uZXcoMCwgLTkwLCAwKSBvciByb3RhdGlvbiA9PSBWZWN0b3IzLm5ldygwLCA5MCwgMCkgdGhlbgogICAgICAgICAgICAgICAgICAgIHNlZ21lbnRUYXJnZXRzW3BhaXIuc2VnbWVudF0udGFyZ2V0ID0gVmVjdG9yMy5uZXcoMTgwLCAwLCAwKQogICAgICAgICAgICAgICAgZWxzZWlmIHJvdGF0aW9uID09IFZlY3RvcjMubmV3KDAsIDAsIDApIHRoZW4KICAgICAgICAgICAgICAgICAgICBzZWdtZW50VGFyZ2V0c1twYWlyLnNlZ21lbnRdLnRhcmdldCA9IFZlY3RvcjMubmV3KDAsIDAsIC05MCkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZWdtZW50VGFyZ2V0c1twYWlyLnNlZ21lbnRdLnRhcmdldCA9IHJvdGF0aW9uCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgd2FybihwYWlyLnRyb3BoeSAuLiAiIG9yIEhhbmRsZSBub3QgZm91bmQiKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgICAgICB3YXJuKCJFcnJvciBwcm9jZXNzaW5nIHRyb3BoeSAiIC4uIHBhaXIudHJvcGh5IC4uICI6ICIgLi4gcmVzdWx0KQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gYWRqdXN0U2VnbWVudChzZWdtZW50TmFtZSwgdGFyZ2V0RGF0YSkKICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBzZWdtZW50ID0gdGFibGV0czpGaW5kRmlyc3RDaGlsZChzZWdtZW50TmFtZSkKICAgICAgICBpZiBzZWdtZW50IGFuZCBzZWdtZW50OkZpbmRGaXJzdENoaWxkKCJMaW5lIikgdGhlbgogICAgICAgICAgICBpZiB0YXJnZXREYXRhLmRvbmUgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgZWxzZWlmIHNlZ21lbnQuTGluZS5Sb3RhdGlvbiA9PSB0YXJnZXREYXRhLnRhcmdldCB0aGVuCiAgICAgICAgICAgICAgICBwcmludChzZWdtZW50TmFtZSAuLiAiOiDguKrguLPguYDguKPguYfguIgiKQogICAgICAgICAgICAgICAgdGFyZ2V0RGF0YS5kb25lID0gdHJ1ZQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcHJpbnQoc2VnbWVudE5hbWUgLi4gIjog4LmE4Lih4LmI4Liq4Liz4LmA4Lij4LmH4LiIIEZpcmVjbGlja2RldGVjdG9yIOC4reC4teC4geC4o+C4reC4miIpCiAgICAgICAgICAgICAgICBsb2NhbCBjbGlja0RldGVjdG9yID0gc2VnbWVudDpGaW5kRmlyc3RDaGlsZCgiQ2xpY2tEZXRlY3RvciIpCiAgICAgICAgICAgICAgICBpZiBjbGlja0RldGVjdG9yIHRoZW4KICAgICAgICAgICAgICAgICAgICBmaXJlY2xpY2tkZXRlY3RvcihjbGlja0RldGVjdG9yKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHdhcm4oc2VnbWVudE5hbWUgLi4gIjogQ2xpY2tEZXRlY3RvciBub3QgZm91bmQiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICB3YXJuKHNlZ21lbnROYW1lIC4uICI6IFNlZ21lbnQgb3IgTGluZSBub3QgZm91bmQiKQogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZCkKICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4KICAgICAgICB3YXJuKCJFcnJvciBhZGp1c3Rpbmcgc2VnbWVudCAiIC4uIHNlZ21lbnROYW1lIC4uICI6ICIgLi4gcmVzdWx0KQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICByZXR1cm4gcmVzdWx0CmVuZAoKbG9jYWwgZnVuY3Rpb24gYWRqdXN0TGFiUGFydChwYXJ0TmFtZSwgdGFyZ2V0RGF0YSkKICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBwYXJ0ID0gV29ya3NwYWNlLk1hcFsiSGF1bnRlZCBDYXN0bGUiXVsiTGFiIFB1enpsZSJdLkNvbG9yRmxvb3IuTW9kZWw6RmluZEZpcnN0Q2hpbGQocGFydE5hbWUpCiAgICAgICAgaWYgcGFydCB0aGVuCiAgICAgICAgICAgIHRvVGFyZ2V0KHBhcnQuQ0ZyYW1lKQogICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICBpZiB0YXJnZXREYXRhLmRvbmUgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgZWxzZWlmIHBhcnQuQ29sb3IgPT0gdGFyZ2V0RGF0YS50YXJnZXQgdGhlbgogICAgICAgICAgICAgICAgcHJpbnQocGFydE5hbWUgLi4gIjog4Liq4Li14Liq4Liz4LmA4Lij4LmH4LiIIikKICAgICAgICAgICAgICAgIHRhcmdldERhdGEuZG9uZSA9IHRydWUKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHByaW50KHBhcnROYW1lIC4uICI6IOC4quC4teC5hOC4oeC5iOC4quC4s+C5gOC4o+C5h+C4iCBGaXJlY2xpY2tkZXRlY3RvciDguK3guLXguIHguKPguK3guJoiKQogICAgICAgICAgICAgICAgbG9jYWwgY2xpY2tEZXRlY3RvciA9IHBhcnQ6RmluZEZpcnN0Q2hpbGQoIkNsaWNrRGV0ZWN0b3IiKQogICAgICAgICAgICAgICAgaWYgY2xpY2tEZXRlY3RvciB0aGVuCiAgICAgICAgICAgICAgICAgICAgZmlyZWNsaWNrZGV0ZWN0b3IoY2xpY2tEZXRlY3RvcikKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB3YXJuKHBhcnROYW1lIC4uICI6IENsaWNrRGV0ZWN0b3Igbm90IGZvdW5kIikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgd2FybihwYXJ0TmFtZSAuLiAiOiBQYXJ0IG5vdCBmb3VuZCIpCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIGVuZAogICAgZW5kKQogICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgIHdhcm4oIkVycm9yIGFkanVzdGluZyBsYWIgcGFydCAiIC4uIHBhcnROYW1lIC4uICI6ICIgLi4gcmVzdWx0KQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICByZXR1cm4gcmVzdWx0CmVuZAoKLS0gVG9nZ2xlIOC4quC4s+C4q+C4o+C4seC4miBBdXRvU291bEd1aXRhcgpwYWdlNTpUb2dnbGUoIkF1dG9Tb3VsR3VpdGFyXG7guK3guK3guYLguJXguYnguKvguLLguIHguLXguJXguYnguLLguKPguYzguJrguKPguLnguYrguIQiLCBfRy5BdXRvU291bEd1aXRhciwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvU291bEd1aXRhciA9IHZhbHVlCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KDAuNSkgZG8KICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9Tb3VsR3VpdGFyIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBpZiBub3Qgcm9vdFBhcnQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlVG9DYXN0bGUgPSAoQ0ZyYW1lLm5ldygtOTY4MS40NiwgNi4xNCwgNjM0MS4zNykuUG9zaXRpb24gLSByb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZVRvQ2FzdGxlID4gNTAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlRvbyBmYXIgZnJvbSBIYXVudGVkIENhc3RsZSwgbW92aW5nIHRvIHBvc2l0aW9uIikKICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC05NjgxLjQ2LCA2LjE0LCA2MzQxLjM3KSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSDguJXguKPguKfguIjguKrguK3guJrguYHguKXguLDguYLguKvguKXguJQgSGF1bnRlZCBDYXN0bGUKICAgICAgICAgICAgICAgIGlmIG5vdCBtYXAgYW5kIG5vdCB3YWl0Rm9ySGF1bnRlZENhc3RsZSgpIHRoZW4KICAgICAgICAgICAgICAgICAgICBwcmludCgiQ2Fubm90IHByb2NlZWQ6IEhhdW50ZWQgQ2FzdGxlIGZhaWxlZCB0byBsb2FkIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIC0tIOC5gOC4o+C4tOC5iOC4oeC4leC5ieC4mSB0cm9waHkg4LmB4Lil4LiwIHNlZ21lbnQg4LiE4Lij4Lix4LmJ4LiH4LmB4Lij4LiB4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZCiAgICAgICAgICAgICAgICBpZiBub3QgR2xvYmFsRW52LnRyb3BoaWVzSW5pdGlhbGl6ZWQgdGhlbgogICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVUcm9waGllcygpCiAgICAgICAgICAgICAgICAgICAgR2xvYmFsRW52LnRyb3BoaWVzSW5pdGlhbGl6ZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAtLSDguJXguKPguKfguIjguKrguK3guJogU2tlbGV0b24gTWFjaGluZQogICAgICAgICAgICAgICAgaWYgV29ya3NwYWNlLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIlNrZWxldG9uIE1hY2hpbmUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJzb3VsR3VpdGFyQnV5IiwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIC0tIOC4iOC4seC4lOC4geC4suC4oyBncmF2ZXN0b25lRXZlbnQKICAgICAgICAgICAgICAgIGxvY2FsIGdyYXZlUmVzdWx0ID0gUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJncmF2ZXN0b25lRXZlbnQiLCAyKQogICAgICAgICAgICAgICAgaWYgZ3JhdmVSZXN1bHQgYW5kIGdyYXZlUmVzdWx0OmZpbmQoIk5vdGhpbmciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIldhaXQgTmV4dCBOaWdodCIpCiAgICAgICAgICAgICAgICBlbHNlaWYgZ3JhdmVSZXN1bHQgdGhlbgogICAgICAgICAgICAgICAgICAgIHByaW50KCJHbyB0byBHcmF2ZSIpCiAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygtODY1My4yMSwgMTQwLjk4LCA2MTYwLjAzKSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoImdyYXZlc3RvbmVFdmVudCIsIDIsIHRydWUpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAtLSDguIjguLHguJTguIHguLLguKMgR2hvc3Qg4LmB4Lil4LiwIExpdmluZyBab21iaWUKICAgICAgICAgICAgICAgIGlmIFdvcmtzcGFjZS5OUENzOkZpbmRGaXJzdENoaWxkKCJHaG9zdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkd1aXRhclB1enpsZVByb2dyZXNzIiwgIkdob3N0IikKICAgICAgICAgICAgICAgIGVsc2VpZiBXb3Jrc3BhY2UuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiTGl2aW5nIFpvbWJpZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhXb3Jrc3BhY2UuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkxpdmluZyBab21iaWUiIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCwgNjAsIDYwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSnVtcFBvd2VyID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAyMCwgMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsVXNlcjpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xMDE2MC43OSwgMTM4LjY2LCA1OTU1LjAzKSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIC0tIOC4leC4o+C4p+C4iOC4quC4reC4miBDYW5kbGVzIOC5geC4peC4sOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4geC4teC5iOC4ouC4p+C4guC5ieC4reC4h+C4geC4seC4miBIYXVudGVkIENhc3RsZQogICAgICAgICAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIG1hcC5DYW5kbGVzLkNhbmRsZTEuVHJhbnNwYXJlbmN5ID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtYXAuUGxhY2FyZDEuTGVmdC5QYXJ0LlRyYW5zcGFyZW5jeSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBsYWNhcmRPcmRlciA9IHsiUGxhY2FyZDcuTGVmdCIsICJQbGFjYXJkNi5MZWZ0IiwgIlBsYWNhcmQ1LkxlZnQiLCAiUGxhY2FyZDQuUmlnaHQiLCAiUGxhY2FyZDMuTGVmdCIsICJQbGFjYXJkMi5SaWdodCIsICJQbGFjYXJkMS5SaWdodCJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC04NzYyLjY5LCAxNzYuODUsIDYxNzEuMzEpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvb3RQYXJ0LlBvc2l0aW9uIC0gVmVjdG9yMy5uZXcoLTg3NjIuNjksIDE3Ni44NSwgNjE3MS4zMSkpLk1hZ25pdHVkZSA8PSAzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgcGxhY2FyZCBpbiBpcGFpcnMocGxhY2FyZE9yZGVyKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwYXJ0cyA9IHBsYWNhcmQ6c3BsaXQoIi4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBvYmogPSBtYXBbcGFydHNbMV1dW3BhcnRzWzJdXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvYmo6RmluZEZpcnN0Q2hpbGQoIkNsaWNrRGV0ZWN0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlY2xpY2tkZXRlY3RvcihvYmouQ2xpY2tEZXRlY3RvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1hcC5UYWJsZXQuU2VnbWVudDE6RmluZEZpcnN0Q2hpbGQoIkNsaWNrRGV0ZWN0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh0YXJnZXRDRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbGxTZWdtZW50c0RvbmUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3Igc2VnbWVudE5hbWUsIHRhcmdldERhdGEgaW4gcGFpcnMoc2VnbWVudFRhcmdldHMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFkanVzdFNlZ21lbnQoc2VnbWVudE5hbWUsIHRhcmdldERhdGEpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsU2VnbWVudHNEb25lID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhbGxTZWdtZW50c0RvbmUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLguJfguLjguIEgU2VnbWVudCDguKrguLPguYDguKPguYfguIghIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhbGxTZWdtZW50c0RvbmUgYW5kIG1hcFsiTGFiIFB1enpsZSJdLkNvbG9yRmxvb3IuTW9kZWwuUGFydDE6RmluZEZpcnN0Q2hpbGQoIkNsaWNrRGV0ZWN0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYWxsTGFiRG9uZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcGFydE5hbWUsIHRhcmdldERhdGEgaW4gcGFpcnMobGFiVGFyZ2V0cykgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFkanVzdExhYlBhcnQocGFydE5hbWUsIHRhcmdldERhdGEpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbExhYkRvbmUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhbGxMYWJEb25lIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuC4l+C4uOC4gSBMYWIgUHV6emxlIOC4quC4teC4quC4s+C5gOC4o+C5h+C4iCEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgICAgICAgICAgICAgIHdhcm4oIkVycm9yIGluIEhhdW50ZWQgQ2FzdGxlIHB1enpsZSBzZWN0aW9uOiAiIC4uIHJlc3VsdCkKICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh0YXJnZXRDRnJhbWUpIC0tIOC5gOC4hOC4peC4t+C5iOC4reC4meC5hOC4m+C4ouC4seC4hyBIYXVudGVkIENhc3RsZSDguJbguYnguLLguKHguLXguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCnBhZ2U1OlRvZ2dsZSgiQXV0byBIYWxsb3cgU2N5dGhlXG7guK3guK3guYLguJXguYnguKvguLLguYDguITguLXguKLguKfguJzguLUiLCBfRy5BdXRvRmFybUJvc3NIYWxsb3csIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b0Zhcm1Cb3NzSGFsbG93ID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0YXNrLndhaXQoKQogICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICB0YXNrLndhaXQoKQogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9GYXJtQm9zc0hhbGxvdyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiU291bCBSZWFwZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHYuTmFtZSAsICJTb3VsIFJlYXBlciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlJ1ZpcnR1YWxVc2VyJzpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDYwLDYwLDYwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIG5vdCBfRy5BdXRvRmFybUJvc3NIYWxsb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC05NTI0Ljc4OTA2MjUsIDMxNS44MDQyOTA3NzE0OCwgNjY1NS43MTkyMzgyODEzKSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCnBhZ2U1OlRvZ2dsZSgiQXV0byBCdWRkeSBTd29yZHNcbuC4reC4reC5guC4leC5ieC4q+C4suC4lOC4suC4muC4muC4tOC5iuC4geC4oeC4seC4oSIsIF9HLkF1dG9CdWRkeVN3b3JkcywgZnVuY3Rpb24odmFsdWUpCl9HLkF1dG9CdWRkeVN3b3JkcyA9IHZhbHVlCmlmIHZhbHVlID09IGZhbHNlIHRoZW4KdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQplbmQKdGFzay5zcGF3bihmdW5jdGlvbigpCndoaWxlIHRhc2sud2FpdCgpIGRvCnBjYWxsKGZ1bmN0aW9uKCkKICAgIGlmIF9HLkF1dG9CdWRkeVN3b3JkcyB0aGVuCiAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDYWtlIFF1ZWVuIikgdGhlbgogICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAoIkNha2UgUXVlZW4iIG9yIHYuTmFtZSA9PSAiQ2FrZSBRdWVlbiIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIHY6SXNBKCJNb2RlbCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoX0cuU2VsZWN0V2VhcG9uKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg4MCwgODAsIDgwKQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNikKICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9CdWRkeVN3b3JkcyBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKZW5kCmVuZCkKZW5kKQoKcGFnZTU6VG9nZ2xlKCJBdXRvIE11c2tldGVlckhhdFxu4Lit4Lit4LmC4LiV4LmJ4Lir4Liy4Lir4Lih4Lin4LiB4Lih4Lix4Liq4LmA4LiB4LmH4LiV4LmA4LiV4Li14Lii4Lij4LmMIiwgX0cuQXV0b011c2tldGVlckhhdCwgZnVuY3Rpb24odmFsdWUpCl9HLkF1dG9NdXNrZXRlZXJIYXQgPSB2YWx1ZQppZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCnRhc2sud2FpdCgpCnRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKdGFzay53YWl0KCkKZW5kCnRhc2suc3Bhd24oZnVuY3Rpb24oKQp3aGlsZSB0YXNrLndhaXQoKSBkbwpwY2FsbChmdW5jdGlvbigpCiAgICBpZiBfRy5BdXRvTXVza2V0ZWVySGF0IHRoZW4KICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLkxldmVsLlZhbHVlID49IDE4MDAgYW5kIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkNpdGl6ZW5RdWVzdFByb2dyZXNzIikuS2lsbGVkQmFuZGl0cyA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQsICJGb3Jlc3QgUGlyYXRlIikgYW5kIHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQsICI1MCIpIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5WaXNpYmxlID09IHRydWUgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJGb3Jlc3QgUGlyYXRlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkZvcmVzdCBQaXJhdGUiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChfRy5TZWxlY3RXZWFwb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc01vbiA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9NdXNrZXRlZXJIYXQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3Qgdi5QYXJlbnQgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSA9PSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTEzMjA2LjQ1MjE0ODQzOCwgNDI1Ljg5MTk5ODI5MTAyLCAtNzk2NC41NTM3MTA5Mzc1KSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xMjQ0My44NjcxODc1LCAzMzIuNDAzOTYxMTgxNjQsIC03Njc1LjQ4OTI1NzgxMjUpKQogICAgICAgICAgICAgICAgaWYgKFZlY3RvcjMubmV3KC0xMjQ0My44NjcxODc1LCAzMzIuNDAzOTYxMTgxNjQsIC03Njc1LjQ4OTI1NzgxMjUpIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAzMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgd2FpdCgxLjUpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RhcnRRdWVzdCIsIkNpdGl6ZW5RdWVzdCIsIDEpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuTGV2ZWwuVmFsdWUgPj0gMTgwMCBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQ2l0aXplblF1ZXN0UHJvZ3Jlc3MiKS5LaWxsZWRCb3NzID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSBhbmQgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCwgIkNhcHRhaW4gRWxlcGhhbnQiKSBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ2FwdGFpbiBFbGVwaGFudCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJDYXB0YWluIEVsZXBoYW50IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPbGRDRnJhbWVFbGVwaGFudCA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChfRy5TZWxlY3RXZWFwb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc01vbiA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9NdXNrZXRlZXJIYXQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3Qgdi5QYXJlbnQgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSA9PSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTEzMzc0Ljg4OTY0ODQzOCwgNDIxLjI3NzUyNjg1NTQ3LCAtODIyNS4yMDg5ODQzNzUpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTEyNDQzLjg2NzE4NzUsIDMzMi40MDM5NjExODE2NCwgLTc2NzUuNDg5MjU3ODEyNSkpCiAgICAgICAgICAgICAgICBpZiAoQ0ZyYW1lLm5ldygtMTI0NDMuODY3MTg3NSwgMzMyLjQwMzk2MTE4MTY0LCAtNzY3NS40ODkyNTc4MTI1KS5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNCB0aGVuCiAgICAgICAgICAgICAgICAgICAgd2FpdCgxLjUpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQ2l0aXplblF1ZXN0UHJvZ3Jlc3MiLCAiQ2l0aXplbiIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuTGV2ZWwuVmFsdWUgPj0gMTgwMCBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQ2l0aXplblF1ZXN0UHJvZ3Jlc3MiLCAiQ2l0aXplbiIpID09IDIgdGhlbgogICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC0xMjUxMi4xMzg2NzE4NzUsIDM0MC4zOTI3OTE3NDgwNSwgLTk4NzIuODIwMzEyNSkpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQplbmQKZW5kKQplbmQpCgpwYWdlNTpUb2dnbGUoIkF1dG8gQ2F2YW5kZXJcbuC4reC4reC5guC4leC5ieC4q+C4suC4lOC4suC4muC4hOC4suC5gOC4p+C4meC5gOC4lOC4reC4o+C5jCIsIF9HLkF1dG9DYXZhbmRlciwgZnVuY3Rpb24odmFsdWUpCl9HLkF1dG9DYXZhbmRlciA9IHZhbHVlCmlmIHZhbHVlID09IGZhbHNlIHRoZW4KdGFzay53YWl0KCkKdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQp0YXNrLndhaXQoKQplbmQKdGFzay5zcGF3bihmdW5jdGlvbigpCndoaWxlIHRhc2sud2FpdCgpIGRvCnBjYWxsKGZ1bmN0aW9uKCkKICAgIGlmIF9HLkF1dG9DYXZhbmRlciB0aGVuCiAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJCZWF1dGlmdWwgUGlyYXRlIikgdGhlbgogICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAoIkJlYXV0aWZ1bCBQaXJhdGUiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCB2OklzQSgiTW9kZWwiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKF9HLlNlbGVjdFdlYXBvbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIFBvc01vbiA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9HLkZhc3RBdHRhY2sgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTYpCiAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5BdXRvQ2F2YW5kZXIgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoNTI4My42MDkzNzUsIDIyLjU2MjIzNDg3ODU0LCAtMTEwLjc4Mjg1MjE3Mjg1KSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCmVuZAplbmQpCmVuZCkKCnBhZ2U1OlRvZ2dsZSgiQXV0byBZYW1hIFN3b3JkXG7guK3guK3guYLguJXguYnguKvguLLguJTguLLguJrguKLguLLguKHguLAiLCBfRy5BdXRvWWFtYVN3b3JkLCBmdW5jdGlvbih2YWx1ZSkKX0cuQXV0b1lhbWFTd29yZCA9IHZhbHVlCnNwYXduKGZ1bmN0aW9uKCkKd2hpbGUgdGFzay53YWl0KCkgZG8KaWYgX0cuQXV0b1lhbWFTd29yZCB0aGVuCiAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJFbGl0ZUh1bnRlciIsICJQcm9ncmVzcyIpID49IDMwIHRoZW4KICAgICAgICByZXBlYXQKICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgZmlyZWNsaWNrZGV0ZWN0b3IoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuV2F0ZXJmYWxsLlNlYWxlZEthdGFuYS5IYW5kbGUuQ2xpY2tEZXRlY3RvcikKICAgICAgICB1bnRpbCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIllhbWEiKSBvciBub3QgQXV0b1lhbWEKICAgIGVuZAplbmQKZW5kCmVuZCkKZW5kKQoKcGFnZTU6VG9nZ2xlKCJBdXRvIFR1c2hpdGEgU3dvcmRcbuC4reC4reC5guC4leC5ieC4q+C4suC4lOC4suC4muC4l+C4ueC4iuC4tOC4leC4sCIsIF9HLkF1dG9UdXNoaXRhU3dvcmQsIGZ1bmN0aW9uKHZhbHVlKQpfRy5BdXRvVHVzaGl0YVN3b3JkID0gdmFsdWUKaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgp0YXNrLndhaXQoKQp0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCnRhc2sud2FpdCgpCmVuZAp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKd2hpbGUgdGFzay53YWl0KCkgZG8KaWYgX0cuQXV0b1R1c2hpdGFTd29yZCB0aGVuCiAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkxvbmdtYSIpIHRoZW4KICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgdi5OYW1lID09ICgiTG9uZ21hIiBvciB2Lk5hbWUgPT0gIkxvbmdtYSIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIHY6SXNBKCJNb2RlbCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKF9HLlNlbGVjdFdlYXBvbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5GYXN0QXR0YWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTYpCiAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b1R1c2hpdGFTd29yZCBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTEwMjM4Ljg3NTk3NjU2MywgMzg5Ljc5MTI5MDI4MzIsIC05NTQ5Ljc5Mzk0NTMxMjUpKQogICAgZW5kCmVuZAplbmQKZW5kKQplbmQpCgpwYWdlNTpUb2dnbGUoIkF1dG8gU2VycGVudCBCb3dcbuC4reC4reC5guC4leC5ieC4q+C4suC4mOC4meC4ueC4h+C4ueC4nuC4tOC4qSIsIF9HLkF1dG9TZXJwZW50Qm93LCBmdW5jdGlvbih2YWx1ZSkKX0cuQXV0b1NlcnBlbnRCb3cgPSB2YWx1ZQppZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCnRhc2sud2FpdCgpCnRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKdGFzay53YWl0KCkKZW5kCnRhc2suc3Bhd24oZnVuY3Rpb24oKQp3aGlsZSB0YXNrLndhaXQoKSBkbwppZiBfRy5BdXRvU2VycGVudEJvdyB0aGVuCiAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCBFbXByZXNzIikgdGhlbgogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiB2Lk5hbWUgPT0gKCJJc2xhbmQgRW1wcmVzcyIgb3Igdi5OYW1lID09ICJJc2xhbmQgRW1wcmVzcyIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIHY6SXNBKCJNb2RlbCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKF9HLlNlbGVjdFdlYXBvbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5GYXN0QXR0YWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTYpCiAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b1NlcnBlbnRCb3cgb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gZmFsc2UKICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KDU1NDMuODYzMjgxMjUsIDY2OC45NzM5OTkwMjM0NCwgMTk5LjAzNDE3OTY4NzUpKQogICAgZW5kCmVuZAplbmQKZW5kKQplbmQpCnBhZ2U1OlRvZ2dsZSgiQXV0byBEYXJrIERhZ2dlclxu4Lit4Lit4LmC4LiV4LmJ4Lir4Liy4LmC4Lii4Lij4Li44LiI4Li04LmL4LinIiwgX0cuQXV0b0RhcmtEYWdnZXIsIGZ1bmN0aW9uKHZhbHVlKQpfRy5BdXRvRGFya0RhZ2dlciA9IHZhbHVlCmlmIHZhbHVlID09IGZhbHNlIHRoZW4KdGFzay53YWl0KCkKdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQp0YXNrLndhaXQoKQplbmQKdGFzay5zcGF3bihmdW5jdGlvbigpCndoaWxlIHRhc2sud2FpdCgpIGRvCnBjYWxsKGZ1bmN0aW9uKCkKICAgIGlmIF9HLkF1dG9EYXJrRGFnZ2VyIHRoZW4KICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoInJpcF9pbmRyYSBUcnVlIEZvcm0iKSB0aGVuCiAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICgicmlwX2luZHJhIFRydWUgRm9ybSIgb3Igdi5OYW1lID09ICJyaXBfaW5kcmEgVHJ1ZSBGb3JtIikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgdjpJc0EoIk1vZGVsIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChfRy5TZWxlY3RXZWFwb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5GYXN0QXR0YWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsIDY3MikpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSnVtcFBvd2VyID0gMAogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDExKQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE2KQogICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0RhcmtEYWdnZXIgb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygtNTM0NC44MjIyNjU2MjUsIDQyMy45ODU0MTI1OTc2NiwgLTI3MjUuMDkzMDE3NTc4MSkpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQplbmQKZW5kKQplbmQpCgpzcGF3bihmdW5jdGlvbigpCglsb2NhbCBnZyA9IGdldHJhd21ldGF0YWJsZShnYW1lKQoJbG9jYWwgb2xkID0gZ2cuX19uYW1lY2FsbAoJc2V0cmVhZG9ubHkoZ2csZmFsc2UpCglnZy5fX25hbWVjYWxsID0gbmV3Y2Nsb3N1cmUoZnVuY3Rpb24oLi4uKQoJCWxvY2FsIG1ldGhvZCA9IGdldG5hbWVjYWxsbWV0aG9kKCkKCQlsb2NhbCBhcmdzID0gey4uLn0KCQlpZiB0b3N0cmluZyhtZXRob2QpID09ICJGaXJlU2VydmVyIiB0aGVuCgkJCWlmIHRvc3RyaW5nKGFyZ3NbMV0pID09ICJSZW1vdGVFdmVudCIgdGhlbgoJCQkJaWYgdG9zdHJpbmcoYXJnc1syXSkgfj0gInRydWUiIGFuZCB0b3N0cmluZyhhcmdzWzJdKSB+PSAiZmFsc2UiIHRoZW4KCQkJCQlpZiBfRy5Vc2VTa2lsbCBhbmQgX0cuQXV0b0Zhcm1GcnVpdE1hc3RlcnkgdGhlbgoJCQkJCQlpZiB0eXBlKGFyZ3NbMl0pID09ICJ2ZWN0b3IiIHRoZW4gCgkJCQkJCQlhcmdzWzJdID0gUG9zaXRpb25Ta2lsbE1hc3RlcnlEZXZpbEZydWl0CgkJCQkJCWVsc2UKCQkJCQkJCWFyZ3NbMl0gPSBDRnJhbWUubmV3KFBvc2l0aW9uU2tpbGxNYXN0ZXJ5RGV2aWxGcnVpdCkKCQkJCQkJZW5kCgkJCQkJCXJldHVybiBvbGQodW5wYWNrKGFyZ3MpKQoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZAoJCXJldHVybiBvbGQoLi4uKQoJZW5kKQplbmQpCgpzcGF3bihmdW5jdGlvbigpCglsb2NhbCBndCA9IGdldHJhd21ldGF0YWJsZShnYW1lKQoJbG9jYWwgb2xkID0gZ3QuX19uYW1lY2FsbAoJc2V0cmVhZG9ubHkoZ3QsZmFsc2UpCglndC5fX25hbWVjYWxsID0gbmV3Y2Nsb3N1cmUoZnVuY3Rpb24oLi4uKQoJCWxvY2FsIGFyZ3MgPSB7Li4ufQoJCWlmIGdldG5hbWVjYWxsbWV0aG9kKCkgPT0gIkludm9rZVNlcnZlciIgdGhlbiAKCQkJaWYgX0cuU2VsZWN0V2VhcG9uR3VuIHRoZW4KCQkJCWlmIF9HLlNlbGVjdFdlYXBvbkd1biA9PSAiU291bCBHdWl0YXIiIHRoZW4KCQkJCQlpZiB0b3N0cmluZyhhcmdzWzJdKSA9PSAiVEFQIiB0aGVuCgkJCQkJCWlmIEF1dG9GYXJtR3VuTWFzdGVyeSBhbmQgX0cuVXNlU2tpbGwgdGhlbgoJCQkJCQkJYXJnc1szXSA9IFBvc2l0aW9uU2tpbGxNYXN0ZXJ5R3VuCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZAoJCXJldHVybiBvbGQodW5wYWNrKGFyZ3MpKQoJZW5kKQoJc2V0cmVhZG9ubHkoZ3QsdHJ1ZSkKZW5kKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCgl3aGlsZSB3YWl0KCkgZG8KCQlmb3IgaSx2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbyAgCgkJCWlmIHY6SXNBKCJUb29sIikgdGhlbgoJCQkJaWYgdjpGaW5kRmlyc3RDaGlsZCgiUmVtb3RlRnVuY3Rpb25TaG9vdCIpIHRoZW4gCgkJCQkJX0cuU2VsZWN0V2VhcG9uR3VuID0gdi5OYW1lCgkJCQllbmQKCQkJZW5kCgkJZW5kCgllbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbyAgCiAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgaWYgdi5Ub29sVGlwID09ICJHdW4iIHRoZW4KICAgICAgICAgICAgICAgICAgICBfRy5TZWxlY3RXZWFwb25HdW4gPSB2Lk5hbWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0Q2hpbGRyZW4oKSkgZG8gIAogICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgIGlmIHYuVG9vbFRpcCA9PSAiR3VuIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgX0cuU2VsZWN0V2VhcG9uR3VuID0gdi5OYW1lCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgQ2FtID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKbG9jYWwgaG90a2V5ID0gdHJ1ZQpmdW5jdGlvbiBsb29rQXQodGFyZ2V0LCBleWUpCiAgICBDYW0uQ0ZyYW1lID0gQ0ZyYW1lLm5ldyh0YXJnZXQsIGV5ZSkKZW5kCmZ1bmN0aW9uIENoZWNrTW9uRkYodHJnX3BhcnQpCiAgICBsb2NhbCBuZWFyZXN0ID0gbmlsCiAgICBsb2NhbCBsYXN0ID0gbWF0aC5odWdlCiAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHYuTmFtZSA9PSBRdWVzdENoZWNrKClbM10gdGhlbgogICAgICAgICAgICBsb2NhbCBlUG9zLCB2aXNzc3MgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYTpXb3JsZFRvVmlld3BvcnRQb2ludCh2W3RyZ19wYXJ0XS5Qb3NpdGlvbikKICAgICAgICAgICAgbG9jYWwgQWNjUG9zID0gVmVjdG9yMi5uZXcoZVBvcy54LCBlUG9zLnkpCiAgICAgICAgICAgIGxvY2FsIG1vdXNlUG9zID0gVmVjdG9yMi5uZXcod29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuVmlld3BvcnRTaXplLnggLyAyLCB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5WaWV3cG9ydFNpemUueSAvIDIpCiAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKEFjY1BvcyAtIG1vdXNlUG9zKS5tYWduaXR1ZGUKICAgICAgICAgICAgaWYgZGlzdGFuY2UgPCBsYXN0IGFuZCB2aXNzc3MgYW5kIGhvdGtleSA9PSB0cnVlIGFuZCBkaXN0YW5jZSA8IDE1MDAgdGhlbgogICAgICAgICAgICAgICAgbGFzdCA9IGRpc3RhbmNlCiAgICAgICAgICAgICAgICBuZWFyZXN0ID0gdgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIG5lYXJlc3QKZW5kCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9GYXJtR3VuTWFzdGVyeSBhbmQgX0cuVXNlU2tpbGwgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNsb3Nlc3QgPSBDaGVja01vbkZGKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgbG9va0F0KENhbS5DRnJhbWUucCwgY2xvc2VzdDpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpLlBvc2l0aW9uKQogICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgWzFdID0gUG9zaXRpb25Ta2lsbE1hc3RlcnlHdW4KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyW19HLlNlbGVjdFdlYXBvbkd1bl0uUmVtb3RlcGFnZTE0OkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICBpZiBub3Qgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCwgUXVlc3RDaGVjaygpWzZdKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJBYmFuZG9uUXVlc3QiKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9GYXJtR3VuTWFzdGVyeSBhbmQgX0cuVXNlU2tpbGwgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICBbMV0gPSBQb3NpdGlvblNraWxsTWFzdGVyeUd1biwKICAgICAgICAgICAgICAgIFsyXSA9IE1vbkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgfQogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXJbX0cuU2VsZWN0V2VhcG9uR3VuXS5SZW1vdGVGdW5jdGlvblNob290Okludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5BdXRvRmFybUd1bk1hc3RlcnkgdGhlbgogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpwYWdlNjpTZXBlcmF0b3IoIuKcqCIpCl9HLkhlYWx0aE1zID0gMjUKcGFnZTY6VG9nZ2xlKCJBdXRvIEZhcm1HdW5NYXN0ZXJ5XG7guJ/guLLguKPguYzguKHguKHguLLguKrguYDguJXguK3guKPguLXguYjguJvguLfguJkiLCBfRy5TZXR0aW5ncy5BdXRvRmFybUd1bk1hc3RlcnksIGZ1bmN0aW9uKHZhbHVlKQpfRy5BdXRvRmFybUd1bk1hc3RlcnkgPSB2YWx1ZQpfRy5TZXR0aW5ncy5BdXRvRmFybUd1bk1hc3RlcnkgPSB2YWx1ZQpTYXZlU2V0dGluZ3MoKQogICAgaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgogICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgZW5kCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIGxvY2FsIE15TGV2ZWwgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuRGF0YS5MZXZlbC5WYWx1ZQogICAgICAgICAgICBsb2NhbCBRdWVzdEMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdAogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBfRy5BdXRvRmFybUd1bk1hc3RlcnkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzdHJpbmcuZmluZChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0LCBRdWVzdENoZWNrKClbNl0pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQWJhbmRvblF1ZXN0IikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBRdWVzdEMuVmlzaWJsZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKFF1ZXN0Q2hlY2soKVszXSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gUXVlc3RDaGVjaygpWzNdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9uSHVtYW5vaWRSb290UGFydCA9IHYuSHVtYW5vaWRSb290UGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb25Ta2lsbE1hc3RlcnlHdW4gPSB2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBQb3NNb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkLkhlYWx0aCA8PSB2Lkh1bWFub2lkLk1heEhlYWx0aCAqIF9HLkhlYWx0aE1zLzEwMCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5Vc2VTa2lsbCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoMTIwLDEyMCwxMjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uR3VuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoX0cuU2VsZWN0V2VhcG9uR3VuKSBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKF9HLlNlbGVjdFdlYXBvbkd1bik6RmluZEZpcnN0Q2hpbGQoIlJlbW90ZUZ1bmN0aW9uU2hvb3QiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VzZTFjbGljaygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gdi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMl0gPSB2Lkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyW19HLlNlbGVjdFdlYXBvbkd1bl0uUmVtb3RlRnVuY3Rpb25TaG9vdDpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5Ta2lsbFogYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudCh0cnVlLCAiWiIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCguMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudChmYWxzZSwgIloiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLlNraWxsWCBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KHRydWUsICJYIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KGZhbHNlLCAiWCIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlVzZVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldygxMjAsMTIwLDEyMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLDY3MikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9GYXJtR3VuTWFzdGVyeSBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBRdWVzdEMuVmlzaWJsZSA9PSBmYWxzZSBvciBub3QgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlVzZVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9fQ0ZyYW1lIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bU2V0Q0Zhcm1lXSAqIENGcmFtZS5uZXcoMCwzMCw1KSkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFF1ZXN0Q2hlY2soKVs3XVtTZXRDRmFybWVdLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSA1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFNldENGYXJtZSA9PSBuaWwgb3IgU2V0Q0Zhcm1lID09ICcnIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldENGYXJtZSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KFNldENGYXJtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIFNldENGYXJtZSA+PSAjUXVlc3RDaGVjaygpWzddIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldENGYXJtZSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KFNldENGYXJtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldENGYXJtZSA9ICBTZXRDRmFybWUgKyAxCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoU2V0Q0Zhcm1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygwLDMwLDIwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVs3XVsxXSAqIENGcmFtZS5uZXcoMCwzMCwtMjApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSAzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygyMCwzMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gNCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVs3XVsxXSAqIENGcmFtZS5uZXcoMCwzMCwtMjApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSA1IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygtMjAsMzAsMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bMV0gKiBDRnJhbWUubmV3KDAsMzAsMjApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzJdKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoUXVlc3RDaGVjaygpWzJdLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMC4yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCdSZXBsaWNhdGVkU3RvcmFnZScpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RhcnRRdWVzdCIsIFF1ZXN0Q2hlY2soKVs0XSwgUXVlc3RDaGVjaygpWzFdKSB3YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVs3XVsxXSAqIENGcmFtZS5uZXcoMCwzMCw1KSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpwYWdlNjpUb2dnbGUoIkF1dG8gRmFybUZydWl0TWFzdGVyeVxu4Lif4Liy4Lij4LmM4Lih4Lih4Liy4Liq4LmA4LiV4Lit4Lij4Li14LmI4Lic4Lil4Lib4Li14Lio4Liy4LiIIiwgX0cuU2V0dGluZ3MuQXV0b0Zhcm1GcnVpdE1hc3RlcnksIGZ1bmN0aW9uKHZhbHVlKQpfRy5BdXRvRmFybUZydWl0TWFzdGVyeSA9IHZhbHVlCl9HLlNldHRpbmdzLkF1dG9GYXJtRnJ1aXRNYXN0ZXJ5ID0gdmFsdWUKU2F2ZVNldHRpbmdzKCkKaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgogICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQplbmQKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgbG9jYWwgTXlMZXZlbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EYXRhLkxldmVsLlZhbHVlCiAgICAgICAgbG9jYWwgUXVlc3RDID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIF9HLkF1dG9GYXJtRnJ1aXRNYXN0ZXJ5IHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCBzdHJpbmcuZmluZChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0LCBRdWVzdENoZWNrKClbNl0pIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJBYmFuZG9uUXVlc3QiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBRdWVzdEMuVmlzaWJsZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoUXVlc3RDaGVjaygpWzNdKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gUXVlc3RDaGVjaygpWzNdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uU2tpbGxNYXN0ZXJ5RGV2aWxGcnVpdCA9IHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzdHJpbmcuZmluZChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0LCBRdWVzdENoZWNrKClbNl0pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJBYmFuZG9uUXVlc3QiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQuSGVhbHRoIDw9IHYuSHVtYW5vaWQuTWF4SGVhbHRoICogX0cuSGVhbHRoTXMvMTAwIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlVzZVNraWxsID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcEJsb3hGcnVpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNjAsNjAsNjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuRGF0YS5EZXZpbEZydWl0LlZhbHVlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXN0ZXJ5RGV2aWxGcnVpdCA9IHJlcXVpcmUoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyW2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EYXRhLkRldmlsRnJ1aXQuVmFsdWVdLkRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXZpbEZydWl0TWFzdGVyeSA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcltnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuRGF0YS5EZXZpbEZydWl0LlZhbHVlXS5MZXZlbC5WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkRhdGEuRGV2aWxGcnVpdC5WYWx1ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWFzdGVyeURldmlsRnJ1aXQgPSByZXF1aXJlKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrW2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EYXRhLkRldmlsRnJ1aXQuVmFsdWVdLkRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXZpbEZydWl0TWFzdGVyeSA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrW2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EYXRhLkRldmlsRnJ1aXQuVmFsdWVdLkxldmVsLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbi1EcmFnb24iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5Ta2lsbFogYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCBEZXZpbEZydWl0TWFzdGVyeSA+PSBNYXN0ZXJ5RGV2aWxGcnVpdC5MdmwuWiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KHRydWUsICJaIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCguMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQoZmFsc2UsICJaIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLlNraWxsWiBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIERldmlsRnJ1aXRNYXN0ZXJ5ID49IE1hc3RlcnlEZXZpbEZydWl0Lkx2bC5YIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIlgiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudChmYWxzZSwgIlgiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbi1IdW1hbjogQnVkZGhhIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuU2tpbGxaIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPT0gVmVjdG9yMy5uZXcoNy42LCA3LjY3NiwgMy42ODYpIGFuZCBEZXZpbEZydWl0TWFzdGVyeSA+PSBNYXN0ZXJ5RGV2aWxGcnVpdC5MdmwuWiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudCh0cnVlLCAiWiIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KGZhbHNlLCAiWiIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5Ta2lsbFggYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCBEZXZpbEZydWl0TWFzdGVyeSA+PSBNYXN0ZXJ5RGV2aWxGcnVpdC5MdmwuWCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KHRydWUsICJYIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCguMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQoZmFsc2UsICJYIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLlNraWxsQyBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIERldmlsRnJ1aXRNYXN0ZXJ5ID49IE1hc3RlcnlEZXZpbEZydWl0Lkx2bC5DIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIkMiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudChmYWxzZSwgIkMiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJWZW5vbS1WZW5vbSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLlNraWxsWiBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIERldmlsRnJ1aXRNYXN0ZXJ5ID49IE1hc3RlcnlEZXZpbEZydWl0Lkx2bC5aIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIloiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KGZhbHNlLCAiWiIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5Ta2lsbFggYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCBEZXZpbEZydWl0TWFzdGVyeSA+PSBNYXN0ZXJ5RGV2aWxGcnVpdC5MdmwuWCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KHRydWUsICJYIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCguMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQoZmFsc2UsICJYIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLlNraWxsQyBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIERldmlsRnJ1aXRNYXN0ZXJ5ID49IE1hc3RlcnlEZXZpbEZydWl0Lkx2bC5DIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIkMiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudChmYWxzZSwgIkMiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EYXRhLkRldmlsRnJ1aXQuVmFsdWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuRGF0YS5EZXZpbEZydWl0LlZhbHVlKS5Nb3VzZVBvcy5WYWx1ZSA9IHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuU2tpbGxaIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgRGV2aWxGcnVpdE1hc3RlcnkgPj0gTWFzdGVyeURldmlsRnJ1aXQuTHZsLlogdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudCh0cnVlLCAiWiIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KGZhbHNlLCAiWiIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5Ta2lsbFggYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCBEZXZpbEZydWl0TWFzdGVyeSA+PSBNYXN0ZXJ5RGV2aWxGcnVpdC5MdmwuWCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KHRydWUsICJYIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCguMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQoZmFsc2UsICJYIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLlNraWxsQyBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIERldmlsRnJ1aXRNYXN0ZXJ5ID49IE1hc3RlcnlEZXZpbEZydWl0Lkx2bC5DIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOnNlcnZpY2UoJ1ZpcnR1YWxJbnB1dE1hbmFnZXInKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIkMiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudChmYWxzZSwgIkMiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuU2tpbGxWIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgRGV2aWxGcnVpdE1hc3RlcnkgPj0gTWFzdGVyeURldmlsRnJ1aXQuTHZsLlYgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudCh0cnVlLCAiViIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KGZhbHNlLCAiViIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5Ta2lsbEYgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCBEZXZpbEZydWl0TWFzdGVyeSA+PSBNYXN0ZXJ5RGV2aWxGcnVpdC5MdmwuRiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KHRydWUsICJGIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KGZhbHNlLCAiRiIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuVXNlU2tpbGwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNjAsNjAsNjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCw2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0Zhcm1GcnVpdE1hc3Rlcnkgb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAgb3IgUXVlc3RDLlZpc2libGUgPT0gZmFsc2Ugb3Igbm90IHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgX0cuVXNlU2tpbGwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvX0NGcmFtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bU2V0Q0Zhcm1lXSAqIENGcmFtZS5uZXcoMCwzMCw1KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChRdWVzdENoZWNrKClbN11bU2V0Q0Zhcm1lXS5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFNldENGYXJtZSA9PSBuaWwgb3IgU2V0Q0Zhcm1lID09ICcnIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0Q0Zhcm1lID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChTZXRDRmFybWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIFNldENGYXJtZSA+PSAjUXVlc3RDaGVjaygpWzddIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0Q0Zhcm1lID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChTZXRDRmFybWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0Q0Zhcm1lID0gIFNldENGYXJtZSArIDEKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoU2V0Q0Zhcm1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEF0dGFja1JhbmRvbVR5cGVfTW9uQ0ZyYW1lID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVs3XVsxXSAqIENGcmFtZS5uZXcoMCwzMCwyMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygwLDMwLC0yMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQXR0YWNrUmFuZG9tVHlwZV9Nb25DRnJhbWUgPT0gMyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoUXVlc3RDaGVjaygpWzddWzFdICogQ0ZyYW1lLm5ldygyMCwzMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSA0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bMV0gKiBDRnJhbWUubmV3KDAsMzAsLTIwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBBdHRhY2tSYW5kb21UeXBlX01vbkNGcmFtZSA9PSA1IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bMV0gKiBDRnJhbWUubmV3KC0yMCwzMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChRdWVzdENoZWNrKClbN11bMV0gKiBDRnJhbWUubmV3KDAsMzAsMjApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVsyXSkKICAgICAgICAgICAgICAgICAgICBpZiAoUXVlc3RDaGVjaygpWzJdLlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuMikKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCdSZXBsaWNhdGVkU3RvcmFnZScpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RhcnRRdWVzdCIsIFF1ZXN0Q2hlY2soKVs0XSwgUXVlc3RDaGVjaygpWzFdKSB3YWl0KDAuNSkgCiAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KFF1ZXN0Q2hlY2soKVs3XVsxXSAqIENGcmFtZS5uZXcoMCwzMCw1KSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5BdXRvRmFybUZydWl0TWFzdGVyeSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBPbiA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSBGcnVpdFBvcy5Qb3NpdGlvbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyW2dhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuRGV2aWxGcnVpdC5WYWx1ZV0uUmVtb3RlcGFnZTE0OkZpcmVTZXJ2ZXIodW5wYWNrKE9uKSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICBsb2NhbCBPZmYgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gbmlsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXJbZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5EZXZpbEZydWl0LlZhbHVlXS5SZW1vdGVwYWdlMTQ6RmlyZVNlcnZlcih1bnBhY2soT2ZmKSkgCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCnBhZ2U2OlNsaWRlcigiS2lsbCBBdCAoJSlcbuC4huC5iOC4suC5gOC4oeC4t+C5iOC4rSAoJSkiLDEsMTAwLDI1LGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuSGVhbHRoTXMgPSB2YWx1ZQplbmQpCgpwYWdlNjpTZXBlcmF0b3IoIlNraWxsXG7guKPguLLguKLguIHguLLguKPguKrguIHguLTguKUiKQpwYWdlNjpUb2dnbGUoIlNraWxsIFpcbuC4quC4geC4tOC4pSBaIiwgX0cuU2tpbGxaLCBmdW5jdGlvbih2YWx1ZSkKX0cuU2tpbGxaID0gdmFsdWUKZW5kKQpwYWdlNjpUb2dnbGUoIlNraWxsIFhcbuC4quC4geC4tOC4pSBYIiwgX0cuU2tpbGxYLCBmdW5jdGlvbih2YWx1ZSkKX0cuU2tpbGxYID0gdmFsdWUKZW5kKQoKcGFnZTY6VG9nZ2xlKCJTa2lsbCBDXG7guKrguIHguLTguKUgQyIsIF9HLlNraWxsQywgZnVuY3Rpb24odmFsdWUpCl9HLlNraWxsQyA9IHZhbHVlCmVuZCkKCnBhZ2U2OlRvZ2dsZSgiU2tpbGwgVlxu4Liq4LiB4Li04LilIFYiLCBfRy5Ta2lsbFYsIGZ1bmN0aW9uKHZhbHVlKQpfRy5Ta2lsbFYgPSB2YWx1ZQplbmQpCgpwYWdlNjpUb2dnbGUoIlNraWxsIEZcbuC4quC4geC4tOC4pSBGIiwgX0cuU2tpbGxGLCBmdW5jdGlvbih2YWx1ZSkKX0cuU2tpbGxGID0gdmFsdWUKZW5kKQoKaWYgX0cuQXV0b0Zhcm1HdW5NYXN0ZXJ5IG9yIF9HLkF1dG9GYXJtRnJ1aXRNYXN0ZXJ5IHRoZW4KX0cuRmFzdFR5cGUgPSAiU2xvdyIKZWxzZQpfRy5GYXN0VHlwZSA9ICJGYXN0IgplbmQKcGFnZTc6U2VwZXJhdG9yKCLwn42IIikKCnBhZ2U3OlRvZ2dsZSgiQXV0byBCcmluZ0ZydWl0XG7guJTguLbguIfguJzguKXguYTguKHguYnguJvguLXguKjguLLguIgiLF9HLkF1dG9fQnJpbmdfRnJ1aXQgLCBmdW5jdGlvbih2YWx1ZSkKICAgICBfRy5BdXRvX0JyaW5nX0ZydWl0ICA9IHZhbHVlCmVuZCkKcGFnZTc6VG9nZ2xlKCJBdXRvIFJhbmRvbUZydWl0c1xu4Liq4Li44LmI4Lih4Lic4Lil4LmE4Lih4LmJ4Lib4Li14Lio4Liy4LiIIiwgX0cuQXV0b0J1eVJhbmRvbUZydWl0cywgZnVuY3Rpb24odmFsdWUpCl9HLkF1dG9CdXlSYW5kb21GcnVpdHMgPSB2YWx1ZQplbmQpCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9CdXlSYW5kb21GcnVpdHMgdGhlbgogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJDb3VzaW4iLCAiQnV5IikKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpwYWdlNzpUb2dnbGUoIkF1dG8gU3RvcmVGcnVpdHNcbuC5gOC4geC5h+C4muC4nOC4peC5hOC4oeC5ieC4m+C4teC4qOC4suC4iOC5gOC4guC5ieC4suC4geC4o+C4sOC5gOC4m+C5i+C4siIsIF9HLkF1dG9TdG9yZUZydWl0cywgZnVuY3Rpb24odmFsdWUpCl9HLkF1dG9TdG9yZUZydWl0cyA9IHZhbHVlCmVuZCkKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9fQnJpbmdfRnJ1aXQgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIik6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIGFuZCBzdHJpbmcuZmluZCh2Lk5hbWUsIkZydWl0IikgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHYuSGFuZGxlLkNGcmFtZSAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKc3Bhd24oZnVuY3Rpb24oKQp3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgaWYgX0cuQXV0b1N0b3JlRnJ1aXRzIHRoZW4KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQm9tYiBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCb21iIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJCb21iLUJvbWIiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQm9tYiBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCb21iIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlNwaWtlIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlNwaWtlIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJTcGlrZS1TcGlrZSIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTcGlrZSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTcGlrZSBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJDaG9wIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkNob3AgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIkNob3AtQ2hvcCIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJDaG9wIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkNob3AgRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU3ByaW5nIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlNwcmluZyBGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCAiU3ByaW5nLVNwcmluZyIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTcHJpbmcgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiU3ByaW5nIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIktpbG8gRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiS2lsbyBGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCAiS2lsby1LaWxvIiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIktpbG8gRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiS2lsbyBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTbW9rZSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTbW9rZSBGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCAiU21va2UtU21va2UiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU21va2UgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiU21va2UgRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU3BpbiBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTcGluIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJTcGluLVNwaW4iLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU3BpbiBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTcGluIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZsYW1lIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZsYW1lIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJGbGFtZS1GbGFtZSIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGbGFtZSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGbGFtZSBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJCaXJkOiBGYWxjb24gRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmlyZDogRmFsY29uIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJCaXJkLUJpcmQ6IEZhbGNvbiIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJCaXJkOiBGYWxjb24gRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmlyZDogRmFsY29uIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkljZSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJJY2UgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIkljZS1JY2UiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSWNlIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkljZSBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTYW5kIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlNhbmQgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIlNhbmQtU2FuZCIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTYW5kIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlNhbmQgRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRGFyayBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJEYXJrIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJEYXJrLURhcmsiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRGFyayBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJEYXJrIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJldml2ZSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJSZXZpdmUgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIlJldml2ZS1SZXZpdmUiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmV2aXZlIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlJldml2ZSBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJEaWFtb25kIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkRpYW1vbmQgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIkRpYW1vbmQtRGlhbW9uZCIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJEaWFtb25kIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkRpYW1vbmQgRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGlnaHQgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiTGlnaHQgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIkxpZ2h0LUxpZ2h0IiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxpZ2h0IEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkxpZ2h0IEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxvdmUgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiTG92ZSBGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCAiTG92ZS1Mb3ZlIiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxvdmUgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiTG92ZSBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSdWJiZXIgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUnViYmVyIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJSdWJiZXItUnViYmVyIiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJ1YmJlciBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJSdWJiZXIgRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmFycmllciBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCYXJyaWVyIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJCYXJyaWVyLUJhcnJpZXIiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmFycmllciBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCYXJyaWVyIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIk1hZ21hIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIk1hZ21hIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJNYWdtYS1NYWdtYSIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJNYWdtYSBGcnVpdCIpIG9yCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIk1hZ21hIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRvb3IgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRG9vciBGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCAiRG9vci1Eb29yIiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRvb3IgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRG9vciBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJRdWFrZSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJRdWFrZSBGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCAiUXVha2UtUXVha2UiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUXVha2UgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUXVha2UgRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW4tSHVtYW46IEJ1ZGRoYSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJIdW1hbi1IdW1hbjogQnVkZGhhIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJIdW1hbi1IdW1hbjogQnVkZGhhIiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFuLUh1bWFuOiBCdWRkaGEgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiSHVtYW4tSHVtYW46IEJ1ZGRoYSBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTdHJpbmcgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiU3RyaW5nIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJTdHJpbmctU3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlN0cmluZyBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTdHJpbmcgRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmlyZDogUGhvZW5peCBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCaXJkOiBQaG9lbml4IEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJCaXJkLUJpcmQ6IFBob2VuaXgiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmlyZDogUGhvZW5peCBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJCaXJkOiBQaG9lbml4IEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJ1bWJsZSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJSdW1ibGUgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIlJ1bWJsZS1SdW1ibGUiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUnVtYmxlIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlJ1bWJsZSBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQYXcgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUGF3IEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJQYXctUGF3IiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlBhdyBGcnVpdCIpIG9yCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlBhdyBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJHcmF2aXR5IEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkdyYXZpdHkgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIkdyYXZpdHktR3Jhdml0eSIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJHcmF2aXR5IEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkdyYXZpdHkgRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRG91Z2ggRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRG91Z2ggRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIkRvdWdoLURvdWdoIiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRvdWdoIEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkRvdWdoIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlNoYWRvdyBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTaGFkb3cgRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIlNoYWRvdy1TaGFkb3ciLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU2hhZG93IEZydWl0Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlNoYWRvdyBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJWZW5vbSBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJWZW5vbSBGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCAiVmVub20tVmVub20iLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiVmVub20gRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiVmVub20gRnJ1aXQiKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQ29udHJvbCBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJDb250cm9sIEZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsICJDb250cm9sLUNvbnRyb2wiLAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQ29udHJvbCBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJDb250cm9sIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBGcnVpdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJEcmFnb24gRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0IiwgIkRyYWdvbi1EcmFnb24iLAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJEcmFnb24gRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRHJhZ29uIEZydWl0IikpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlb3BhcmQgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiTGVvcGFyZCBGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCAiTGVvcGFyZC1MZW9wYXJkIiwKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlb3BhcmQgRnJ1aXQiKSBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiTGVvcGFyZCBGcnVpdCIpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kCmVuZCkKCmxvY2FsIFJlbW90ZV9HZXRGcnVpdHMgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJSZW1vdGVzIikuQ29tbUZfOkludm9rZVNlcnZlcigiR2V0RnJ1aXRzIik7CgkKVGFibGVfRGV2aWxGcnVpdFNuaXBlciA9IHt9ClNob3BEZXZpbFNlbGwgPSB7fQoKZm9yIGksdiBpbiBuZXh0LFJlbW90ZV9HZXRGcnVpdHMgZG8KICAgIHRhYmxlLmluc2VydChUYWJsZV9EZXZpbEZydWl0U25pcGVyLHYuTmFtZSkKICAgIGlmIHYuT25TYWxlIHRoZW4gCiAgICAgICAgdGFibGUuaW5zZXJ0KFNob3BEZXZpbFNlbGwsdi5OYW1lKQogICAgZW5kCmVuZAoKcGFnZTc6RHJvcGRvd24oIlNlbGVjdCBEZXZpbEZydWl0c1xu4LmA4Lil4Li34Lit4LiB4Lic4Lil4LmE4Lih4LmJ4Lib4Li14Lio4Liy4LiIIixUYWJsZV9EZXZpbEZydWl0U25pcGVyLGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuU2VsZWN0X0RldmlsX0ZydWl0ID0gdmFsdWUKZW5kKQpwYWdlNzpUb2dnbGUoIkF1dG8gQnV5IERldmlsRnJ1aXRzIFNlbGVjdGVkXG7guK3guK3guYLguJXguYnguIvguLfguYnguK3guJzguKXguYTguKHguYnguJvguLXguKjguLLguIjguJfguLXguYjguYDguKXguLfguK3guIEiLF9HLkF1dG9fQnV5X0RldmlsX0ZydWl0LGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b19CdXlfRGV2aWxfRnJ1aXQgPSB2YWx1ZSAKZW5kKQoKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9fQnV5X0RldmlsX0ZydWl0IHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgc3RyaW5nXzEgPSAiUHVyY2hhc2VSYXdGcnVpdCI7CiAgICAgICAgICAgICAgICBsb2NhbCBzdHJpbmdfMiA9IF9HLlNlbGVjdF9EZXZpbF9GcnVpdDsKICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldCA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzWyJDb21tRl8iXTsKICAgICAgICAgICAgICAgIFRhcmdldDpJbnZva2VTZXJ2ZXIoc3RyaW5nXzEsIHN0cmluZ18yKTsKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgZW5kCmVuZCkKcGFnZTg6U2VwZXJhdG9yKCLwn5uh77iPIikKbG9jYWwgUmFpZHNsaXN0ID0geyJGbGFtZSIsIkljZSIsIlF1YWtlIiwiTGlnaHQiLCJEYXJrIiwiU3RyaW5nIiwiUnVtYmxlIiwiTWFnbWEiLCJIdW1hbjogQnVkZGhhIiwiU2FuZCIsIkJpcmQ6IFBob2VuaXgiLCJEb3VnaCJ9CnBhZ2U4OkRyb3Bkb3duKCJTZWxlY3QgUmFpZHNcbuC5gOC4peC4t+C4reC4geC4lOC4seC4meC5gOC4iOC4teC5ieC4ouC4mSIsIFJhaWRzbGlzdCwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5TZWxlY3RSYWlkcyA9IHZhbHVlCmVuZCkKcGFnZTg6VG9nZ2xlKCJBdXRvIFJhaWRzXG7guKXguIfguJTguLHguJnguYDguIjguLXguYnguKLguJkiLCBfRy5BdXRvUmFpZHMsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b1JhaWRzID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0YXNrLndhaXQoKQogICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICB0YXNrLndhaXQoKQogICAgZW5kCmVuZCkKcGFnZTg6VG9nZ2xlKCJLaWxsQXVyYShubyByZWNvbW1lbmQpXG7guK3guK3guKPguYjguLLguIbguYjguLLguKHguK3guJnguKPguK3guJrguJXguLHguKco4LmE4Lih4LmI4LmB4LiZ4Liw4LiZ4LizKSIsIF9HLktpbGxBdXJhLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLktpbGxBdXJhID0gdmFsdWUKZW5kKQpwYWdlODpUb2dnbGUoIkF1dG8gTmV4dElzbGFuZFxu4Lit4Lit4LmC4LiV4LmJ4LmE4Lib4LmA4LiB4Liy4Liw4LiW4Lix4LiU4LmE4LibIiwgX0cuQXV0b05leHRQbGFjZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvTmV4dFBsYWNlID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICBlbmQKZW5kKQpwYWdlODpUb2dnbGUoIkJ1eSBBd2FrZW5lZFNraWxsXG7guIvguLfguYnguK3guKrguIHguLTguKXguJXguLfguYjguJkiLCBfRy5BdXRvQXdha2VuZWQsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b0F3YWtlbmVkID0gdmFsdWUKZW5kKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9SYWlkcyB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTcGVjaWFsIE1pY3JvY2hpcCIpIG9yIAogICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTcGVjaWFsIE1pY3JvY2hpcCIpIG9yIAogICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCA1Iikgb3IgCiAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgi'
local ifizXwpuctAu = 'V29ya3NwYWNlIilbIl9Xb3JsZE9yaWdpbiJdLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgiSXNsYW5kIDQiKSBvciAKICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCJJc2xhbmQgMyIpIG9yIAogICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCAyIikgb3IgCiAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIilbIl9Xb3JsZE9yaWdpbiJdLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgiSXNsYW5kIDEiKSB0aGVuCiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTcGVjaWFsIE1pY3JvY2hpcCIpIG9yIAogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlNwZWNpYWwgTWljcm9jaGlwIikpIGFuZCAKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5Ub3BIVURMaXN0LlJhaWRUaW1lci5WaXNpYmxlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgV29ybGQzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHdvcmtzcGFjZS5NYXBbIkJvYXQgQ2FzdGxlIl0uUmFpZFN1bW1vbjIuQnV0dG9uLk1haW4uQ2xpY2tEZXRlY3RvciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KC01MDU4LjA3NzE1LCAzMTQuNDk0MzU0LCAtMjk1Ni4yNjc1OCwgMC45NTQ0MzcwNzcsIDEuMzU3NDAyNzVlLTA5LCAwLjI5ODQxMjMyMywgLTIuNTUyMDQ5OWUtMDksIDEsIDMuNjEzNjg1MzVlLTA5LCAtMC4yOTg0MTIzMjMsIC00LjIxMDU5ODU0ZS0wOSwgMC45NTQ0MzcwNzcpKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlY2xpY2tkZXRlY3Rvcih3b3Jrc3BhY2UuTWFwWyJCb2F0IENhc3RsZSJdLlJhaWRTdW1tb24yLkJ1dHRvbi5NYWluLkNsaWNrRGV0ZWN0b3IpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlRvcEhVRExpc3QuUmFpZFRpbWVyLlZpc2libGUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2hhcmFjdGVyIG9yIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgb3Igbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0SXNsYW5kID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBpc2xhbmRDRnJhbWUgPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGlzbGFuZE5hbWUgPSBuaWwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSA9IDUsIDEsIC0xIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaXNsYW5kID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCJJc2xhbmQgIiAuLiBpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzbGFuZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldElzbGFuZCA9IGlzbGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc2xhbmROYW1lID0gIklzbGFuZCAiIC4uIGkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNsYW5kQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhpc2xhbmQuQ0ZyYW1lLlgsIDYwLCBpc2xhbmQuQ0ZyYW1lLlopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXRJc2xhbmQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKHRhcmdldElzbGFuZC5Qb3NpdGlvbiAtIGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA+IDM1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhcm10d2VlbiA9IHRvVGFyZ2V0KGlzbGFuZENGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZGlzdGFuY2UgPD0gMTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBGYXJtdHdlZW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFybXR3ZWVuOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvUmFpZHMgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlRvcEhVRExpc3QuUmFpZFRpbWVyLlZpc2libGUgPT0gdHJ1ZSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gY2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSA0MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCguMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDEgb3Igbm90IHYuUGFyZW50IG9yIG5vdCBfRy5BdXRvUmFpZHMgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5BdXRvQXdha2VuZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkF3YWtlbmVyIiwgIkF3YWtlbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIilbIl9Xb3JsZE9yaWdpbiJdLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgiSXNsYW5kIDUiKSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCA0IikgYW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCJJc2xhbmQgMyIpIGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIilbIl9Xb3JsZE9yaWdpbiJdLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgiSXNsYW5kIDIiKSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCAxIikgb3IgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlRvcEhVRExpc3QuUmFpZFRpbWVyLlZpc2libGUgPT0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgX0cuQXV0b0F3YWtlbmVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkF3YWtlbmVyIiwgIkF3YWtlbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZiBfRy5BdXRvQXdha2VuZWQgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkF3YWtlbmVyIiwgIkF3YWtlbiIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiUmFpZHNOcGMiLCJTZWxlY3QiLF9HLlNlbGVjdFJhaWRzKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwKSBkbwogICAgICAgIGlmIF9HLktpbGxBdXJhIHRoZW4KICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBpZiAgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpICB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSGVhbHRoID0gMAogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuS2lsbEF1cmEgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3Qgdi5QYXJlbnQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgICAgIGlmIF9HLkF1dG9OZXh0UGxhY2UgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIilbIkxvY2FsUGxheWVyIl0uUGxheWVyR3VpLk1haW4uVGltZXIuVmlzaWJsZSA9PSB0cnVlIGFuZCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCA1Iikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCJJc2xhbmQgNCIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIilbIl9Xb3JsZE9yaWdpbiJdLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgiSXNsYW5kIDMiKSBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCAyIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCJJc2xhbmQgMSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCA1IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnNbIklzbGFuZCA1Il0uQ0ZyYW1lICogQ0ZyYW1lLm5ldyg0LCA2NSwgMTApKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIklzbGFuZCA0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnNbIklzbGFuZCA0Il0uQ0ZyYW1lICogIENGcmFtZS5uZXcoNCwgNjUsIDEwKSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCJJc2xhbmQgMyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zWyJJc2xhbmQgMyJdLkNGcmFtZSAqIENGcmFtZS5uZXcoNCwgNjUsIDEwKSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCJJc2xhbmQgMiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zWyJJc2xhbmQgMiJdLkNGcmFtZSAqIENGcmFtZS5uZXcoNCwgNjUsIDEwKSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCJJc2xhbmQgMSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zWyJJc2xhbmQgMSJdLkNGcmFtZSAqIENGcmFtZS5uZXcoNCwgNjUsIDEwKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBXb3JsZDIgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTY0MzguNzM1MzUsIDI1MC42NDUzNTUsIC00NTAxLjUwNjg0KSkKICAgICAgICAgICAgICAgIGVsc2VpZiBXb3JsZDMgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoLTUwNTcuMTQ2NDg0Mzc1LCAzMTQuNTQxMzIwODAwNzgsIC0yOTM0Ljc5OTU2MDU0NjkpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBwbHIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjsKbG9jYWwgZ2V0cGxheWVycyA9IHt9CmxvY2FsIGdldGl0ZW1zID0ge30KbG9jYWwgZ2V0d2ViID0ge30KCnBhZ2UxMzpTZXBlcmF0b3IoIuKalO+4jyIpCmRvCiAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkNoYXJhY3RlcnM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2Lk5hbWUgfj0gcGxyLk5hbWUgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQoZ2V0cGxheWVycywgdi5OYW1lKQogICAgICAgIGVuZAogICAgZW5kCiAgICBmb3IgaSwgdiBpbiBwYWlycyhwbHIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2OklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGdldHdlYiwgdi5OYW1lKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCmxvY2FsIFBsYXllckRyb3AgPSBwYWdlMTM6RHJvcGRvd24oIlNlbGVjdCBQbGF5ZXJzXG7guYDguKXguLfguK3guIHguYDguJ7guKXguKLguYzguYDguKLguK3guKPguYwiLGdldHBsYXllcnMsIGZ1bmN0aW9uKHZhbHVlKQogICAgU2VsZWN0UGxheWVyID0gdmFsdWUKZW5kKQpwYWdlMTM6QnV0dG9uKCJSZWZyZXNoXG7guKPguLXguYDguJ/guIrguKMiLCBmdW5jdGlvbigpCiAgICBQbGF5ZXJEcm9wOkNsZWFyKCkKICAgIGZvciBpLCB2IGluIG5leHQsIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQ2hhcmFjdGVyczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgaWYgdi5OYW1lIH49IHBsci5OYW1lIHRoZW4KICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgIFBsYXllckRyb3A6QWRkKHYuTmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQogICAgCnBhZ2UxMzpUb2dnbGUoIlRlbGVwb3J0IFRvIFBsYXllcnNcbuC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4leC5hOC4m+C4q+C4suC5gOC4nuC4peC4ouC5jOC5gOC4ouC4reC4o+C5jCIsIHRlbGVwb3J0dG9wLCBmdW5jdGlvbih2YWx1ZSkKICAgIHRlbGVwb3J0dG9wID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0YXNrLndhaXQoKQogICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICB0YXNrLndhaXQoKQogICAgZW5kCmVuZCkKcGFnZTEzOlRvZ2dsZSgiU3BlY3RhdGUgUGxheWVyXG7guYHguK3guJrguJTguLnguYDguJ7guKXguKLguYzguYDguKLguK3guKPguYwiLCBTcGVjdGF0ZVBseXMsIGZ1bmN0aW9uKHZhbHVlKQogICAgU3BlY3RhdGVQbHlzID0gdmFsdWUKICAgIGxvY2FsIHBscjEgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQKICAgIGxvY2FsIHBscjIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKTpGaW5kRmlyc3RDaGlsZChTZWxlY3RQbGF5ZXIpCiAgICByZXBlYXQKICAgICAgICB3YWl0KC4xKQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQ2FtZXJhLkNhbWVyYVN1YmplY3QgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKTpGaW5kRmlyc3RDaGlsZChTZWxlY3RQbGF5ZXIpCiAgICAgICAgICAgIC5DaGFyYWN0ZXIuSHVtYW5vaWQKICAgIHVudGlsIFNwZWN0YXRlUGx5cyA9PSBmYWxzZQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5DYW1lcmEuQ2FtZXJhU3ViamVjdCA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgdGVsZXBvcnR0b3AgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnM6RmluZEZpcnN0Q2hpbGQoU2VsZWN0UGxheWVyKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoZ2FtZS5QbGF5ZXJzW1NlbGVjdFBsYXllcl0uQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnBhZ2UxMzpUb2dnbGUoIkFpbWJvdCBHdW5cbuC4reC4tOC4oeC4muC4reC4l+C4m+C4t+C4mSIsIGZhbHNlLCBmdW5jdGlvbih2YWx1ZSkKICAgIEFpbWJvdEd1biA9IHZhbHVlCmVuZCkKCnBhZ2UxMzpUb2dnbGUoIkFpbWJvdCBTa2lsbFxu4Lit4Li04Lih4Lia4Lit4LiX4Liq4LiB4Li04LilIiwgZmFsc2UsIGZ1bmN0aW9uKHZhbHVlKQogICAgU2tpbGxhaW1ib3QgPSB2YWx1ZQplbmQpCgpsb2NhbCBnZyA9IGdldHJhd21ldGF0YWJsZShnYW1lKQpsb2NhbCBvbGQgPSBnZy5fX25hbWVjYWxsCnNldHJlYWRvbmx5KGdnLCBmYWxzZSkKZ2cuX19uYW1lY2FsbCA9IG5ld2NjbG9zdXJlKGZ1bmN0aW9uKC4uLikKbG9jYWwgbWV0aG9kID0gZ2V0bmFtZWNhbGxtZXRob2QoKQpsb2NhbCBhcmdzID0geyAuLi4gfQppZiB0b3N0cmluZyhtZXRob2QpID09ICJGaXJlU2VydmVyIiB0aGVuCmlmIHRvc3RyaW5nKGFyZ3NbMV0pID09ICJSZW1vdGVFdmVudCIgdGhlbgogICAgaWYgdG9zdHJpbmcoYXJnc1syXSkgfj0gInRydWUiIGFuZCB0b3N0cmluZyhhcmdzWzJdKSB+PSAiZmFsc2UiIHRoZW4KICAgICAgICBpZiBTa2lsbGFpbWJvdCB0aGVuCiAgICAgICAgICAgIGFyZ3NbMl0gPSBBaW1Cb3RTa2lsbFBvc2l0aW9uCiAgICAgICAgICAgIHJldHVybiBvbGQodW5wYWNrKGFyZ3MpKQogICAgICAgIGVuZAogICAgZW5kCmVuZAplbmQKcmV0dXJuIG9sZCguLi4pCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQp3aGlsZSB0YXNrLndhaXQoKSBkbwpmb3IgaSwgdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgIGlmIHY6SXNBKCJUb29sIikgdGhlbgogICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIlJlbW90ZUZ1bmN0aW9uU2hvb3QiKSB0aGVuCiAgICAgICAgICAgIFNlbGVjdFRvb2xXZWFwb25HdW4gPSB2Lk5hbWUKICAgICAgICBlbmQKICAgIGVuZAplbmQKZm9yIGksIHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgaWYgdjpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiUmVtb3RlRnVuY3Rpb25TaG9vdCIpIHRoZW4KICAgICAgICAgICAgU2VsZWN0VG9vbFdlYXBvbkd1biA9IHYuTmFtZQogICAgICAgIGVuZAogICAgZW5kCmVuZAplbmQKZW5kKQotLVthaW1ib3Qgc2tpbGxdCnRhc2suc3Bhd24oZnVuY3Rpb24oKQp3aGlsZSB0YXNrLndhaXQoKSBkbwppZiBTa2lsbGFpbWJvdCBhbmQgU2VsZWN0UGxheWVyIHRoZW4KICAgIGlmIGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChTZWxlY3RQbGF5ZXIpIGFuZCBnYW1lLlBsYXllcnM6RmluZEZpcnN0Q2hpbGQoU2VsZWN0UGxheWVyKS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgZ2FtZS5QbGF5ZXJzOkZpbmRGaXJzdENoaWxkKFNlbGVjdFBsYXllcikuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBnYW1lLlBsYXllcnM6RmluZEZpcnN0Q2hpbGQoU2VsZWN0UGxheWVyKS5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgQWltQm90U2tpbGxQb3NpdGlvbiA9IGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChTZWxlY3RQbGF5ZXIpLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpLlBvc2l0aW9uCiAgICBlbmQKZW5kCmVuZAplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQp3aGlsZSB0YXNrLndhaXQoKSBkbwppZiBTa2lsbGFpbWJvdCBhbmQgQWxsUGxheWVyc1RhYmxlU2tpcEZhcm0gIHRoZW4KICAgIGlmIGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChBbGxQbGF5ZXJzVGFibGVTa2lwRmFybSkgYW5kIGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChBbGxQbGF5ZXJzVGFibGVTa2lwRmFybSkuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChBbGxQbGF5ZXJzVGFibGVTa2lwRmFybSkuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBnYW1lLlBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQWxsUGxheWVyc1RhYmxlU2tpcEZhcm0pLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICBBaW1Cb3RTa2lsbFBvc2l0aW9uID0gZ2FtZS5QbGF5ZXJzOkZpbmRGaXJzdENoaWxkKEFsbFBsYXllcnNUYWJsZVNraXBGYXJtKS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKS5Qb3NpdGlvbgogICAgZW5kCmVuZAplbmQKZW5kKQotLVthaW1ib3QgZ3VuXQoKbG9jYWwgbHAgPSBnYW1lOkdldFNlcnZpY2UoJ1BsYXllcnMnKS5Mb2NhbFBsYXllcgpsb2NhbCBtb3VzZSA9IGxwOkdldE1vdXNlKCkKbW91c2UuQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbigpCiAgICBpZiBBaW1ib3RHdW4gdGhlbgogICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgIFsxXSA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkZpbmRGaXJzdENoaWxkKFNlbGVjdFBsYXllcikuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24sCiAgICAgICAgICAgIFsyXSA9IHtbMV0gPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKTpGaW5kRmlyc3RDaGlsZChTZWxlY3RQbGF5ZXIpLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0fQogICAgICAgIH0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJNb2R1bGVzIik6V2FpdEZvckNoaWxkKCJOZXQiKTpXYWl0Rm9yQ2hpbGQoIlJFL1Nob290R3VuRXZlbnQiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSkKICAgIGVuZAplbmQpCi0tW0VTUF0KbG9jYWwgRVNQT2JqZWN0cyA9IHt9IApsb2NhbCBOdW1iZXIgPSBtYXRoLnJhbmRvbSgxLCAxMDAwMDAwKQoKbG9jYWwgZnVuY3Rpb24gaXNuaWwodGhpbmcpCiAgICByZXR1cm4gdGhpbmcgPT0gbmlsCmVuZAoKbG9jYWwgZnVuY3Rpb24gcm91bmQobikKICAgIHJldHVybiBtYXRoLmZsb29yKHRvbnVtYmVyKG4pICsgMC41KQplbmQKCmxvY2FsIGZ1bmN0aW9uIENyZWF0ZUVTUCh0YXJnZXQsIGFkb3JuZWUsIG5hbWUsIGNvbG9yLCBkaXN0YW5jZUZ1bmMsIGV4dHJhVGV4dEZ1bmMpCiAgICBpZiBFU1BPYmplY3RzW3RhcmdldF0gdGhlbiByZXR1cm4gZW5kCgogICAgbG9jYWwgYmlsbCA9IEluc3RhbmNlLm5ldygiQmlsbGJvYXJkR3VpIikKICAgIGJpbGwuTmFtZSA9ICJOYW1lRXNwIiAuLiBOdW1iZXIKICAgIGJpbGwuRXh0ZW50c09mZnNldCA9IFZlY3RvcjMubmV3KDAsIDEsIDApCiAgICBiaWxsLlNpemUgPSBVRGltMi5uZXcoMSwgMjAwLCAxLCAzMCkKICAgIGJpbGwuQWRvcm5lZSA9IGFkb3JuZWUKICAgIGJpbGwuQWx3YXlzT25Ub3AgPSB0cnVlCiAgICBiaWxsLkVuYWJsZWQgPSBmYWxzZSAKCiAgICBsb2NhbCBuYW1lTGFiZWwgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIsIGJpbGwpCiAgICBuYW1lTGFiZWwuRm9udCA9ICJDb2RlIgogICAgbmFtZUxhYmVsLkZvbnRTaXplID0gIlNpemUxNCIKICAgIG5hbWVMYWJlbC5UZXh0V3JhcHBlZCA9IHRydWUKICAgIG5hbWVMYWJlbC5TaXplID0gVURpbTIubmV3KDEsIDAsIDEsIDApCiAgICBuYW1lTGFiZWwuVGV4dFlBbGlnbm1lbnQgPSAiVG9wIgogICAgbmFtZUxhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICBuYW1lTGFiZWwuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDAuNQogICAgbmFtZUxhYmVsLlRleHRDb2xvcjMgPSBjb2xvcgoKICAgIEVTUE9iamVjdHNbdGFyZ2V0XSA9IHsKICAgICAgICBCaWxsYm9hcmQgPSBiaWxsLAogICAgICAgIExhYmVsID0gbmFtZUxhYmVsLAogICAgICAgIERpc3RhbmNlRnVuYyA9IGRpc3RhbmNlRnVuYywKICAgICAgICBFeHRyYVRleHRGdW5jID0gZXh0cmFUZXh0RnVuYywKICAgICAgICBUYXJnZXQgPSB0YXJnZXQKICAgIH0KCiAgICBiaWxsLlBhcmVudCA9IGFkb3JuZWUKZW5kCgpsb2NhbCBmdW5jdGlvbiBSZW1vdmVFU1AodGFyZ2V0KQogICAgaWYgRVNQT2JqZWN0c1t0YXJnZXRdIHRoZW4KICAgICAgICBpZiBFU1BPYmplY3RzW3RhcmdldF0uQmlsbGJvYXJkIHRoZW4KICAgICAgICAgICAgRVNQT2JqZWN0c1t0YXJnZXRdLkJpbGxib2FyZDpEZXN0cm95KCkKICAgICAgICBlbmQKICAgICAgICBFU1BPYmplY3RzW3RhcmdldF0gPSBuaWwKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIFVwZGF0ZUFsbEVTUCgpCiAgICBmb3IgdGFyZ2V0LCBlc3AgaW4gcGFpcnMoRVNQT2JqZWN0cykgZG8KICAgICAgICBpZiBub3QgdGFyZ2V0IG9yIG5vdCB0YXJnZXQuUGFyZW50IHRoZW4KICAgICAgICAgICAgUmVtb3ZlRVNQKHRhcmdldCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIG5vdCBlc3AuQmlsbGJvYXJkLkFkb3JuZWUgdGhlbgogICAgICAgICAgICAgICAgUmVtb3ZlRVNQKHRhcmdldCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBlbmFibGVkID0gZmFsc2UKICAgICAgICAgICAgbG9jYWwgbGFiZWxUZXh0ID0gIiIKCiAgICAgICAgICAgIGlmIHRhcmdldDpJc0EoIlBsYXllciIpIGFuZCBFU1BQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgZW5hYmxlZCA9IHRydWUKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gIk4vQSIKICAgICAgICAgICAgICAgIGxvY2FsIGhlYWx0aFBlcmNlbnQgPSAiTi9BIgogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gZXNwLkRpc3RhbmNlRnVuYygpCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0LkNoYXJhY3RlciBhbmQgdGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gdGFyZ2V0LkNoYXJhY3Rlci5IdW1hbm9pZAogICAgICAgICAgICAgICAgICAgICAgICBoZWFsdGhQZXJjZW50ID0gcm91bmQoaHVtYW5vaWQuSGVhbHRoICogMTAwIC8gaHVtYW5vaWQuTWF4SGVhbHRoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgbGFiZWxUZXh0ID0gdGFyZ2V0Lk5hbWUgLi4gIiB8ICIgLi4gZGlzdGFuY2UgLi4gIiBNXG5IZWFsdGg6ICIgLi4gaGVhbHRoUGVyY2VudCAuLiAiJSIKICAgICAgICAgICAgZWxzZWlmIHRhcmdldC5QYXJlbnQgPT0gV29ya3NwYWNlLkNoZXN0TW9kZWxzIGFuZCBDaGVzdEVTUCB0aGVuCiAgICAgICAgICAgICAgICBlbmFibGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAiTi9BIgogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gZXNwLkRpc3RhbmNlRnVuYygpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBsYWJlbFRleHQgPSB0YXJnZXQuTmFtZSAuLiAiXG4iIC4uIGRpc3RhbmNlIC4uICIgTSIKICAgICAgICAgICAgICAgIGVzcC5MYWJlbC5Gb250ID0gIkFyaWFsIgogICAgICAgICAgICAgICAgZXNwLkxhYmVsLkZvbnRTaXplID0gIlNpemUxOCIKICAgICAgICAgICAgICAgIGVzcC5MYWJlbC5UZXh0U2NhbGVkID0gdHJ1ZQogICAgICAgICAgICBlbHNlaWYgc3RyaW5nLmZpbmQodGFyZ2V0Lk5hbWUsICJGcnVpdCIpIGFuZCBEZXZpbEZydWl0RVNQIHRoZW4KICAgICAgICAgICAgICAgIGVuYWJsZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9ICJOL0EiCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBlc3AuRGlzdGFuY2VGdW5jKCkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGxhYmVsVGV4dCA9IHRhcmdldC5OYW1lIC4uICJcbiIgLi4gZGlzdGFuY2UgLi4gIiBNIgogICAgICAgICAgICBlbHNlaWYgKHRhcmdldC5OYW1lID09ICJGbG93ZXIxIiBvciB0YXJnZXQuTmFtZSA9PSAiRmxvd2VyMiIpIGFuZCBGbG93ZXJFU1AgdGhlbgogICAgICAgICAgICAgICAgZW5hYmxlZCA9IHRydWUKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gIk4vQSIKICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IGVzcC5EaXN0YW5jZUZ1bmMoKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgbGFiZWxUZXh0ID0gKHRhcmdldC5OYW1lID09ICJGbG93ZXIxIiBhbmQgIkJsdWUgRmxvd2VyIiBvciAiUmVkIEZsb3dlciIpIC4uICJcbiIgLi4gZGlzdGFuY2UgLi4gIiBNIgogICAgICAgICAgICBlbHNlaWYgdGFyZ2V0LlBhcmVudCA9PSBXb3Jrc3BhY2VbIl9Xb3JsZE9yaWdpbiJdLkxvY2F0aW9ucyBhbmQgSXNsYW5kRVNQIHRoZW4KICAgICAgICAgICAgICAgIGVuYWJsZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9ICJOL0EiCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBlc3AuRGlzdGFuY2VGdW5jKCkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGxhYmVsVGV4dCA9IHRhcmdldC5OYW1lIC4uICJcbiIgLi4gZGlzdGFuY2UgLi4gIiBNIgogICAgICAgICAgICBlbHNlaWYgdGFyZ2V0LlBhcmVudCA9PSBXb3Jrc3BhY2UuU2VhQmVhc3RzIGFuZCBTZWFCZWFzdHNFU1AgdGhlbgogICAgICAgICAgICAgICAgZW5hYmxlZCA9IHRydWUKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gIk4vQSIKICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IGVzcC5EaXN0YW5jZUZ1bmMoKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgbGFiZWxUZXh0ID0gdGFyZ2V0Lk5hbWUgLi4gIlxuIiAuLiBkaXN0YW5jZSAuLiAiIE0iCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZXNwLkJpbGxib2FyZC5FbmFibGVkID0gZW5hYmxlZAogICAgICAgICAgICBpZiBlbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIGVzcC5MYWJlbC5UZXh0ID0gbGFiZWxUZXh0CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gU2NhblRhcmdldHMoKQogICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIik6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2IH49IExvY2FsUGxheWVyIGFuZCB2LkNoYXJhY3RlciBhbmQgdi5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuCiAgICAgICAgICAgIGlmIG5vdCBFU1BPYmplY3RzW3ZdIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIFBsYXllcnBhcnQgPSB2LkNoYXJhY3Rlci5IZWFkCiAgICAgICAgICAgICAgICBsb2NhbCBjb2xvciA9IENvbG9yMy5uZXcoMCwgMCwgMjU1KQogICAgICAgICAgICAgICAgaWYgdi5UZWFtIGFuZCBMb2NhbFBsYXllci5UZWFtIHRoZW4KICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICh2LlRlYW0gPT0gTG9jYWxQbGF5ZXIuVGVhbSkgYW5kIENvbG9yMy5uZXcoMjU1LCAwLCAwKSBvciBDb2xvcjMubmV3KDAsIDAsIDI1NSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgQ3JlYXRlRVNQKHYsIFBsYXllcnBhcnQsIHYuTmFtZSwgY29sb3IsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIGFuZCB2LkNoYXJhY3RlciBhbmQgdi5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3VuZCgoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24gLSB2LkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uKS5NYWduaXR1ZGUgLyAzKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJOL0EiCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQsIG5pbCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiBFU1BPYmplY3RzW3ZdIHRoZW4KICAgICAgICAgICAgICAgIFJlbW92ZUVTUCh2KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGNoZXN0Rm9sZGVyID0gV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJDaGVzdE1vZGVscyIpCiAgICBpZiBjaGVzdEZvbGRlciB0aGVuCiAgICAgICAgZm9yIF8sIGNoZXN0IGluIHBhaXJzKGNoZXN0Rm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGxvY2FsIGNoZXN0UGFydCA9IGNoZXN0LlByaW1hcnlQYXJ0IG9yIGNoZXN0OkZpbmRGaXJzdENoaWxkKCJCYXNlIikgb3IgY2hlc3Q6RmluZEZpcnN0Q2hpbGQoIlJvb3QiKSBvciBjaGVzdDpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJCYXNlUGFydCIpCiAgICAgICAgICAgIGlmIGNoZXN0UGFydCBhbmQgbm90IEVTUE9iamVjdHNbY2hlc3RdIHRoZW4KICAgICAgICAgICAgICAgIENyZWF0ZUVTUChjaGVzdCwgY2hlc3RQYXJ0LCBjaGVzdC5OYW1lLCBDb2xvcjMuZnJvbVJHQigxODYsIDE4NiwgMjgpLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3VuZCgoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24gLSBjaGVzdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSAvIDMpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIk4vQSIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCwgbmlsKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZvciBfLCBmcnVpdCBpbiBwYWlycyhXb3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBzdHJpbmcuZmluZChmcnVpdC5OYW1lLCAiRnJ1aXQiKSBhbmQgZnJ1aXQ6RmluZEZpcnN0Q2hpbGQoIkhhbmRsZSIpIGFuZCBub3QgRVNQT2JqZWN0c1tmcnVpdF0gdGhlbgogICAgICAgICAgICBDcmVhdGVFU1AoZnJ1aXQsIGZydWl0LkhhbmRsZSwgZnJ1aXQuTmFtZSwgQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiByb3VuZCgoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24gLSBmcnVpdC5IYW5kbGUuUG9zaXRpb24pLk1hZ25pdHVkZSAvIDMpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJOL0EiCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kLCBuaWwpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgXywgZmxvd2VyIGluIHBhaXJzKFdvcmtzcGFjZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIChmbG93ZXIuTmFtZSA9PSAiRmxvd2VyMSIgb3IgZmxvd2VyLk5hbWUgPT0gIkZsb3dlcjIiKSBhbmQgbm90IEVTUE9iamVjdHNbZmxvd2VyXSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNvbG9yID0gZmxvd2VyLk5hbWUgPT0gIkZsb3dlcjEiIGFuZCBDb2xvcjMuZnJvbVJHQigwLCAwLCAyNTUpIG9yIENvbG9yMy5mcm9tUkdCKDI1NSwgMCwgMCkKICAgICAgICAgICAgQ3JlYXRlRVNQKGZsb3dlciwgZmxvd2VyLCBmbG93ZXIuTmFtZSA9PSAiRmxvd2VyMSIgYW5kICJCbHVlIEZsb3dlciIgb3IgIlJlZCBGbG93ZXIiLCBjb2xvciwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdW5kKChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbiAtIGZsb3dlci5Qb3NpdGlvbikuTWFnbml0dWRlIC8gMykKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIk4vQSIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQsIG5pbCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZvciBfLCBpc2xhbmQgaW4gcGFpcnMoV29ya3NwYWNlWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBpc2xhbmQuTmFtZSB+PSAiU2VhIiBhbmQgbm90IEVTUE9iamVjdHNbaXNsYW5kXSB0aGVuCiAgICAgICAgICAgIENyZWF0ZUVTUChpc2xhbmQsIGlzbGFuZCwgaXNsYW5kLk5hbWUsIENvbG9yMy5mcm9tUkdCKDY3LCAxODYsIDI4KSwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdW5kKChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbiAtIGlzbGFuZC5Qb3NpdGlvbikuTWFnbml0dWRlIC8gMykKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIk4vQSIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQsIG5pbCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZvciBfLCBzZWFCZWFzdCBpbiBwYWlycyhXb3Jrc3BhY2UuU2VhQmVhc3RzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgc2VhQmVhc3QuTmFtZSB+PSAiU2VhQmVhc3QxIiBhbmQgbm90IEVTUE9iamVjdHNbc2VhQmVhc3RdIHRoZW4KICAgICAgICAgICAgQ3JlYXRlRVNQKHNlYUJlYXN0LCBzZWFCZWFzdCwgc2VhQmVhc3QuTmFtZSwgQ29sb3IzLmZyb21SR0IoODAsIDI0NSwgMjQ1KSwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdW5kKChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbiAtIHNlYUJlYXN0LlBvc2l0aW9uKS5NYWduaXR1ZGUgLyAzKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiTi9BIgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCwgbmlsKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBpZiBFU1BQbGF5ZXIgb3IgQ2hlc3RFU1Agb3IgRGV2aWxGcnVpdEVTUCBvciBGbG93ZXJFU1Agb3IgSXNsYW5kRVNQIG9yIFNlYUJlYXN0c0VTUCB0aGVuCiAgICAgICAgICAgIFNjYW5UYXJnZXRzKCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpmb3IgXywgcGxheWVyIGluIHBhaXJzKGdhbWUuUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXJhY3RlcikKICAgICAgICAgICAgaWYgRVNQUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpIAogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgU2NhblRhcmdldHMoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQKCmdhbWUuUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgcGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hhcmFjdGVyKQogICAgICAgICAgICBpZiBFU1BQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkgCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBTY2FuVGFyZ2V0cygpIAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgpsb2NhbCBsYXN0VXBkYXRlID0gMApSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbihkZWx0YVRpbWUpCiAgICBsYXN0VXBkYXRlID0gbGFzdFVwZGF0ZSArIGRlbHRhVGltZQogICAgaWYgbGFzdFVwZGF0ZSA+PSAwLjEgdGhlbiAKICAgICAgICBVcGRhdGVBbGxFU1AoKQogICAgICAgIGxhc3RVcGRhdGUgPSAwCiAgICBlbmQKZW5kKQoKcGFnZTEzOlNlcGVyYXRvcigiRVNQXG7guKHguK3guIfguJfguLDguKXguLgiKQpwYWdlMTM6VG9nZ2xlKCJFU1AgUGxheWVyc1xu4Lih4Lit4LiH4LiX4Liw4Lil4Li44Lir4Liy4LmA4Lie4Lil4Lii4LmM4LmA4Lii4Lit4Lij4LmMIiwgX0cuRVNQUGxheWVyLCBmdW5jdGlvbih2YWx1ZSkKICAgIEVTUFBsYXllciA9IHZhbHVlCmVuZCkKcGFnZTEzOlRvZ2dsZSgiRVNQIENoZXN0XG7guKHguK3guIfguJfguLDguKXguLjguKvguLLguIHguKXguYjguK3guIfguKrguKHguJrguLHguJXguLQiLCBfRy5DaGVzdEVzcCwgZnVuY3Rpb24odmFsdWUpCiAgICBDaGVzdEVTUCA9IHZhbHVlCmVuZCkKcGFnZTEzOlRvZ2dsZSgiRVNQIERldmlsIEZydWl0XG7guKHguK3guIfguJfguLDguKXguLjguKvguLLguJzguKXguJvguLXguKjguLLguIgiLCBfRy5EZXZpbEZydWl0RVNQLCBmdW5jdGlvbih2YWx1ZSkKICAgIERldmlsRnJ1aXRFU1AgPSB2YWx1ZQplbmQpCnBhZ2UxMzpUb2dnbGUoIkVTUCBSZWFsIEZydWl0XG7guKHguK3guIfguJfguLDguKXguLjguKvguLLguJzguKXguYTguKHguYnguIjguKPguLTguIfguYYiLCBfRy5EZXZpbEZydWl0UmVhbEVTUCwgZnVuY3Rpb24odmFsdWUpCiAgICBEZXZpbEZydWl0UmVhbEVTUCA9IHZhbHVlCmVuZCkKcGFnZTEzOlRvZ2dsZSgiRVNQIEZsb3dlcnNcbuC4oeC4reC4h+C4l+C4sOC4peC4uOC4q+C4suC4lOC4reC4geC5hOC4oeC5iSIsIF9HLkZsb3dlckVTUCwgZnVuY3Rpb24odmFsdWUpCiAgICBGbG93ZXJFU1AgPSB2YWx1ZQplbmQpCnBhZ2UxMzpUb2dnbGUoIkVTUCBJc2xhbmRcbuC4oeC4reC4h+C4l+C4sOC4peC4uOC4q+C4suC5gOC4geC4suC4sCIsIF9HLklzbGFuZEVTUCwgZnVuY3Rpb24odmFsdWUpCiAgICBJc2xhbmRFU1AgPSB2YWx1ZQplbmQpCnBhZ2UxMzpUb2dnbGUoIkVTUCBTZWFCZWFzdHNcbuC4oeC4reC4h+C4l+C4sOC4peC4uOC4q+C4suC4quC4seC4leC4p+C5jOC4l+C4sOC5gOC4pSIsIF9HLlNlYUJlYXN0c0VTUCwgZnVuY3Rpb24odmFsdWUpCiAgICBTZWFCZWFzdHNFU1AgPSB2YWx1ZQplbmQpCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIFVwZGF0ZUFsbEVTUCgpCiAgICBlbmQKZW5kKQpwYWdlOTpTZXBlcmF0b3IoIvCfj53vuI8iKQpwYWdlOTpUb2dnbGUoIlRlbGVwb3J0IFRvIE1pcmFnZUlzbGFuZFxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4Lir4Liy4LmA4LiB4Liy4Liw4Lil4Lix4LiaIiwgIF9HLlNldHRpbmdzLkF1dG9NaXJhZ2VJc2xhbmQsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuTWlyYWdlID0gdmFsdWUKICAgIF9HLlNldHRpbmdzLk1pcmFnZSA9IHZhbHVlCiAgICBTYXZlU2V0dGluZ3MoKSAKICAgIF9HLkF1dG9NaXJhZ2VJc2xhbmQgPSB2YWx1ZSAKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICBlbmQKZW5kKQogICAgCnBhZ2U5OlRvZ2dsZSgiQXV0byBNaXJhZ2VJc2xhbmQgW0hvcF1cbuC4reC4reC5guC4leC5ieC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4leC5hOC4m+C4q+C4suC5gOC4geC4suC4sOC4peC4seC4miBb4Lii4LmJ4Liy4Lii4LmA4LiL4Li04LifXSIsIF9HLlNldHRpbmdzLk1pcmFnZUhvcCwgZnVuY3Rpb24odmFsdWUpCl9HLk1pcmFnZUhvcCA9IHZhbHVlCl9HLlNldHRpbmdzLk1pcmFnZUhvcCA9IHZhbHVlCl9HLkF1dG9NaXJhZ2VJc2xhbmRIb3AgPSB2YWx1ZQplbmQpCgpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgaWYgX0cuQXV0b01pcmFnZUlzbGFuZCBvciBfRy5NaXJhZ2UgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXA6RmluZEZpcnN0Q2hpbGQoIk15c3RpY0lzbGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh3b3Jrc3BhY2UuTWFwLk15c3RpY0lzbGFuZC5QcmltYXJ5UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDMwMCwgMCkpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIse1RpdGxlID0gIlZlY3Rvckh1YiIsVGV4dCA9ICLguYDguIHguLLguLDguKXguLHguJrguYTguKHguYjguYDguIHguLTguJQiLEljb24gPSAicmJ4YXNzZXRpZDovLzE2MTI5MjM1MDU0IixEdXJhdGlvbiA9IDF9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKd2hpbGUgdGFzay53YWl0KClkbwogICAgaWYgX0cuTWlyYWdlSG9wIGFuZCBub3QgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnTWlyYWdlIElzbGFuZCcpIHRoZW4KICAgICAgICBIb3AoKQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLHtUaXRsZSA9ICJWZWN0b3JIdWIiLFRleHQgPSAiTWlyYWdlSXNsYW5kIE5vdCBTcGF3blxu4LmA4LiB4Liy4Liw4Lil4Lix4Lia4LmE4Lih4LmI4LmA4LiB4Li04LiUIixJY29uID0gInJieGFzc2V0aWQ6Ly8xNjEyOTIzNTA1NCIsRHVyYXRpb24gPSAxfSkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIix7VGl0bGUgPSAiVmVjdG9ySHViIixUZXh0ID0gIkhvcFNlcnZlclxu4Lii4LmJ4Liy4Lii4LmA4LiL4Li04LifIixJY29uID0gInJieGFzc2V0aWQ6Ly8xNjEyOTIzNTA1NCIsRHVyYXRpb24gPSA1fSkKICAgIGVsc2VpZiBfRy5NaXJhZ2VIb3AgYW5kIGdhbWUuV29ya3NwYWNlLl9Xb3JsZE9yaWdpbi5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoJ01pcmFnZSBJc2xhbmQnKSB0aGVuCiAgICAgICAgdG9UYXJnZXQod29ya3NwYWNlLk1hcC5NeXN0aWNJc2xhbmQuUHJpbWFyeVBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAzMDAsIDApKQogICAgZW5kCmVuZAplbmQpCgpsb2NhbCBmdW5jdGlvbiByb3VuZChuKQpyZXR1cm4gbWF0aC5mbG9vcih0b251bWJlcihuKSArIDAuNSkKZW5kCgpOdW1iZXIgPSBtYXRoLnJhbmRvbSgxLCAxMDAwMDAwKQpmdW5jdGlvbiBFU1BNaXJhZ2VJc2xhbmQoKQpwY2FsbChmdW5jdGlvbigpCiAgICBpZiBfRy5FU1BNaXJhZ2VJc2xhbmQgdGhlbgogICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuTXlzdGljSXNsYW5kOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAnQ2VudGVyJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHY6RmluZEZpcnN0Q2hpbGQoJ0VzcE1pcmFnZScpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYmlsbCA9IEluc3RhbmNlLm5ldygnQmlsbGJvYXJkR3VpJyx2KQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLk5hbWUgPSAnRXNwTWlyYWdlJwogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLkV4dGVudHNPZmZzZXQgPSBWZWN0b3IzLm5ldygwLCAxLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLlNpemUgPSBVRGltMi5uZXcoMSwyMDAsMSwzMCkKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbC5BZG9ybmVlID0gdgogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLkFsd2F5c09uVG9wID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnLGJpbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuRm9udCA9ICJHb3RoYW1Cb2xkIgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLkZvbnRTaXplID0gIlNpemUxNCIKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0V3JhcHBlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5TaXplID0gVURpbTIubmV3KDEsMCwxLDApCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dFlBbGlnbm1lbnQgPSAnVG9wJwogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDAuNQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHQgPSAoIk1pcmFnZSBJc2xhbmQiIC4uJyBcbicuLiIgWyAiLi5yb3VuZCgoZ2FtZTpHZXRTZXJ2aWNlKCdQbGF5ZXJzJykuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24gLSB2LlBvc2l0aW9uKS5NYWduaXR1ZGUvMykgLi4nIE0nLi4iIF0gIikKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHYuRXNwTWlyYWdlLlRleHRMYWJlbC5UZXh0ID0gKCJNaXJhZ2UgSXNsYW5kIiAuLicgXG4nLi4iIFsgIi4ucm91bmQoKGdhbWU6R2V0U2VydmljZSgnUGxheWVycycpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uIC0gdi5Qb3NpdGlvbikuTWFnbml0dWRlLzMpIC4uJyBNJy4uIiBdICIpCiAgICAgICAgICAgICAgICAgICAgICAgIHYuRXNwTWlyYWdlLlRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5NeXN0aWNJc2xhbmQ6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgdi5OYW1lID09ICdDZW50ZXInIHRoZW4KICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoJ0VzcE1pcmFnZScpIHRoZW4KICAgICAgICAgICAgICAgICAgICB2OkZpbmRGaXJzdENoaWxkKCdFc3BNaXJhZ2UnKTpEZXN0cm95KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCmVuZAoKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgpIGRvIAogICAgICAgIGlmIF9HLkVTUE1pcmFnZUlzbGFuZCB0aGVuCiAgICAgICAgICAgIEVTUE1pcmFnZUlzbGFuZCgpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKcGFnZTk6VG9nZ2xlKCJFU1AgTWlyYWdlSXNsYW5kXG7guKHguK3guIfguJfguLDguKXguLjguKvguLLguYDguIHguLLguLDguKXguLHguJoiLCBfRy5FU1BNaXJhZ2VJc2xhbmQsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuRVNQTWlyYWdlSXNsYW5kID0gdmFsdWUKICAgIEVTUE1pcmFnZUlzbGFuZCgpCmVuZCkKCnBhZ2U5OlRvZ2dsZSgiVGVsZXBvcnQgVG8gQWR2YW5jZWRGcnVpdERlYWxlclxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4Lir4Liy4LiE4LiZ4LiC4Liy4Lii4Lic4Lil4LmE4Lih4LmJ4Lib4Li14Lio4Liy4LiI4LmA4LiB4Liy4Liw4Lil4Lix4LiaIiwgX0cuVFBOUENERiwgZnVuY3Rpb24odmFsdWUpCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICBpZiBfRy5UUE5QQ0RGIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTlBDczpGaW5kRmlyc3RDaGlsZCgiQWR2YW5jZWQgRnJ1aXQgRGVhbGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5OUENzWyJBZHZhbmNlZCBGcnVpdCBEZWFsZXIiXS5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCmVuZCkKcGFnZTk6VG9nZ2xlKCJUZWxlcG9ydCBUbyBHZWFyXG7guYDguJfguYDguKXguJ7guK3guKPguYzguJXguYTguJvguKvguLLguJ/guLHguJnguYDguJ/guLfguK3guIciLCBfRy5TZXR0aW5ncy5BdXRvX0dlYXIsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b19HZWFyID0gdmFsdWUKICAgIF9HLlNldHRpbmdzLkF1dG9fR2VhciA9IHZhbHVlCiAgICAgICAgU2F2ZVNldHRpbmdzKCkgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoLjAxKSBkbwogICAgICAgICAgICBpZiBfRy5BdXRvX0dlYXIgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcDpGaW5kRmlyc3RDaGlsZCgnTXlzdGljSXNsYW5kJyk6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIlBhcnQiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5DbGFzc05hbWUgPT0gIk1lc2hQYXJ0IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuVHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQpmdW5jdGlvbiBMb2NrTW9vbigpCmxvY2FsIExpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCmxvY2FsIENhbSA9IGdhbWUuV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKbG9jYWwgQ0ZOZXcsIENGQW5nID0gQ0ZyYW1lLm5ldywgQ0ZyYW1lLkFuZ2xlcwpsb2NhbCBhc2luID0gbWF0aC5hc2luCgpsb2NhbCBDYW1lcmEgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYQpsb2NhbCBQbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgQ2hhcmFjdGVyID0gUGxheWVyLkNoYXJhY3Rlcgpsb2NhbCBSb290ID0gQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCmxvY2FsIE5lY2sgPSBDaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIk5lY2siLCB0cnVlKQpsb2NhbCBZT2Zmc2V0ID0gTmVjay5DMC5ZCmdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCmlmIF9HLkxvY2tNb29uIHRoZW4KICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1FOkZpcmVTZXJ2ZXIoIkFjdGl2YXRlQWJpbGl0eSIpCgogICAgbG9jYWwgcG9zID0gVmVjdG9yMy5uZXcoMCwgMCwgMCkKICAgIGxvY2FsIGxvb2tBdCA9IExpZ2h0aW5nOkdldE1vb25EaXJlY3Rpb24oKQogICAgbG9jYWwgY2FtZXJhQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhwb3MsIGxvb2tBdCkKICAgIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZSA9IGNhbWVyYUNGcmFtZQogICAgbG9jYWwgQ2FtZXJhRGlyZWN0aW9uID0gUm9vdC5DRnJhbWU6dG9PYmplY3RTcGFjZShjYW1lcmFDRnJhbWUpLmxvb2tWZWN0b3IudW5pdAogICAgaWYgTmVjayBhbmQgTG9jayB0aGVuCiAgICAgICAgTmVjay5DMCA9IENGTmV3KDAsIFlPZmZzZXQsIDApICogQ0ZBbmcoMCwgLWFzaW4oQ2FtZXJhRGlyZWN0aW9uLngpLCAwKSAqIENGQW5nKGFzaW4oQ2FtZXJhRGlyZWN0aW9uLnkpLCAwLCAwKQogICAgZW5kCmVsc2UKICAgIENhbS5GaWVsZE9mVmlldyA9IDcwCmVuZAplbmQpCmVuZAoKcGFnZTk6VG9nZ2xlKCJMb2NrTW9vblxu4Lih4Lit4LiH4Lie4Lij4Liw4LiI4Lix4LiZ4LiX4Lij4LmMIiwgX0cuTG9ja01vb24gLCBmdW5jdGlvbih2YWx1ZSkKX0cuTG9ja01vb24gPSB2YWx1ZQpMb2NrTW9vbigpCmVuZCkKcGFnZTEwOlNlcGVyYXRvcigi8J+QsCIpCnBhZ2UxMDpUb2dnbGUoIkF1dG8gQWN0aXZlUmFjZVYzXG7guK3guK3guYLguJXguYnguYDguJvguLTguJTguYPguIrguYnguIfguLLguJnguYDguJzguYjguLLguKfguLXguKrguLLguKEiLF9HLkF1dG9BY3RpdmVSYWNlLGZ1bmN0aW9uKHZhbHVlKSAgCiAgICBfRy5BdXRvQWN0aXZlUmFjZSA9IHZhbHVlCiAgICAgICAgd2hpbGUgX0cuQXV0b0FjdGl2ZVJhY2UgZG8gd2FpdCgpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLEVudW0uS2V5Q29kZS5ULGZhbHNlLGdhbWUpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSxFbnVtLktleUNvZGUuVCxmYWxzZSxnYW1lKQogICAgICAgIGVuZAogICAgZW5kKQpwYWdlMTA6VG9nZ2xlKCJBdXRvQWN0aXZlUmFjZVY0XG7guK3guK3guYLguJXguYnguYDguJvguLTguJTguYPguIrguYnguIfguLLguJnguYDguJzguYjguLLguKfguLXguKrguLXguYgiLCBfRy5BdXRvQWN0aXZlUmFjZVY0LCBmdW5jdGlvbih2YWx1ZSkKX0cuQXV0b0FjdGl2ZVJhY2VWNCA9IHZhbHVlCiAgICB3aGlsZSBfRy5BdXRvQWN0aXZlUmFjZVY0IGRvIHdhaXQoKQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLEVudW0uS2V5Q29kZS5ZLGZhbHNlLGdhbWUpCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLEVudW0uS2V5Q29kZS5ZLGZhbHNlLGdhbWUpCiAgICBlbmQKZW5kKQoKcGFnZTEwOkJ1dHRvbigiVGVsZXBvcnQgVG8gVG9wIEdyZWF0IFRyZWVcbuC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4leC5hOC4m+C4muC4meC4leC5ieC4meC5hOC4oeC5ieC5g+C4q+C4jeC5iCIsIGZ1bmN0aW9uKCkKICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoMjk0Ny41NTY4ODQ3NjU2MjUsIDIyODEuNjMwNjE1MjM0Mzc1LCAtNzIxMy41NDkzMTY0MDYyNSkpCmVuZCkKCnBhZ2UxMDpCdXR0b24oIlRlbGVwb3J0IFRvIFRpbXBsZSBPZiBUaW1lXG7guYDguJfguYDguKXguJ7guK3guKPguYzguJXguYTguJvguKLguLHguIfguJfguLXguYjguJfguLPguYDguJzguYjguLLguKfguLXguKrguLXguYgiLCBmdW5jdGlvbigpCiAgICBHYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDI4Mjg2LjM1NTQ2ODc1LDE0ODk1LjMwMTc1NzgxMjUsIDEwMi42MjQ2OTQ4MjQyMTg3NSkKZW5kKQoKcGFnZTEwOkJ1dHRvbigiVGVsZXBvcnQgVG8gTGV2ZXIgUHVsbFxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4LiX4Li14LmI4LiE4Lix4LiZ4LmC4Lii4LiBIiwgZnVuY3Rpb24oKQogICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygyODU3NS4xODE2NDA2MjUsIDE0OTM2LjYyNzkyOTY4NzUsIDcyLjMxNjM2ODEwMzAyNzM0KSkKZW5kKQoKcGFnZTEwOkJ1dHRvbigiVW5sb2NrIExldmVyXG7guJvguKXguJTguKXguYfguK3guITguITguLHguJnguYLguKLguIEiLCBmdW5jdGlvbigpCiAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcFsiVGVtcGxlIG9mIFRpbWUiXS5MZXZlci5Qcm9tcHQ6RmluZEZpcnN0Q2hpbGQoIlByb3hpbWl0eVByb21wdCIpIHRoZW4KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcFsiVGVtcGxlIG9mIFRpbWUiXS5MZXZlci5Qcm9tcHQ6RmluZEZpcnN0Q2hpbGQoIlByb3hpbWl0eVByb21wdCIpOlJlbW92ZSgpCiAgICBlbHNlCiAgICBlbmQKICAgIHdhaXQoMC4xKQogICAgbG9jYWwgUHJveGltaXR5UHJvbXB0ID0gSW5zdGFuY2UubmV3KCJQcm94aW1pdHlQcm9tcHQiKQogICAgUHJveGltaXR5UHJvbXB0LlBhcmVudCA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwWyJUZW1wbGUgb2YgVGltZSJdLkxldmVyLlByb21wdAogICAgUHJveGltaXR5UHJvbXB0Lk1heEFjdGl2YXRpb25EaXN0YW5jZSA9IDEwCiAgICBQcm94aW1pdHlQcm9tcHQuQWN0aW9uVGV4dCA9ICJTZWNyZXRzIEJlaG9sZHMgSW5zaWRlIgogICAgUHJveGltaXR5UHJvbXB0Lk9iamVjdFRleHQgPSAiQW4gdW5rbm93biBsZXZlciBvZiB0aW1lIgogICAgZnVuY3Rpb24gb25Qcm94aW1pdHkoKQogICAgICAgIGxvY2FsIHBhcnQgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcFsiVGVtcGxlIG9mIFRpbWUiXS5NYWluRG9vcjEKICAgICAgICBsb2NhbCBUd2VlblNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCiAgICAgICAgbG9jYWwgc3RhcnRQb3NpdGlvbiA9IHBhcnQuUG9zaXRpb24KICAgICAgICBsb2NhbCBlbmRQb3NpdGlvbiA9IHN0YXJ0UG9zaXRpb24gKyBWZWN0b3IzLm5ldygwLCAtNTAsIDApCiAgICAgICAgbG9jYWwgdHdlZW5JbmZvID0gVHdlZW5JbmZvLm5ldygxMCwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCkKICAgICAgICBsb2NhbCB0d2VlbiA9IFR3ZWVuU2VydmljZTpDcmVhdGUocGFydCwgdHdlZW5JbmZvLCB7UG9zaXRpb24gPSBlbmRQb3NpdGlvbn0pCiAgICAgICAgdHdlZW46UGxheSgpCiAgICAgICAgbG9jYWwgcGFydG5ldyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwWyJUZW1wbGUgb2YgVGltZSJdLk1haW5Eb29yMgogICAgICAgIGxvY2FsIFR3ZWVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIikKICAgICAgICBsb2NhbCBzdGFydFBvc2l0aW9uID0gcGFydG5ldy5Qb3NpdGlvbgogICAgICAgIGxvY2FsIGVuZFBvc2l0aW9uID0gc3RhcnRQb3NpdGlvbiArIFZlY3RvcjMubmV3KDAsIC01MCwgMCkKICAgICAgICBsb2NhbCB0d2VlbkluZm8gPSBUd2VlbkluZm8ubmV3KDEwLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KQogICAgICAgIGxvY2FsIHR3ZWVuID0gVHdlZW5TZXJ2aWNlOkNyZWF0ZShwYXJ0bmV3LCB0d2VlbkluZm8sIHtQb3NpdGlvbiA9IGVuZFBvc2l0aW9ufSkKICAgICAgICB0d2VlbjpQbGF5KCkKICAgICAgICBsb2NhbCBTb3VuZFNGWCA9IEluc3RhbmNlLm5ldygiU291bmQiKQogICAgICAgIFNvdW5kU0ZYLlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgIFNvdW5kU0ZYLlNvdW5kSWQgPSAicmJ4YXNzZXRpZDovLzE5MDQ4MTMwNDEiCiAgICAgICAgU291bmRTRlg6UGxheSgpCiAgICAgICAgU291bmRTRlguTmFtZSA9ICJQT3dmcHh6eHpmRmZGRiIKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcFsiVGVtcGxlIG9mIFRpbWUiXS5MZXZlci5Qcm9tcHQ6RmluZEZpcnN0Q2hpbGQoIlByb3hpbWl0eVByb21wdCIpOlJlbW92ZSgpCiAgICAgICAgd2FpdCg1KQogICAgICAgIHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiUE93ZnB4enh6ZkZmRkYiKTpSZW1vdmUoKQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwWyJUZW1wbGUgb2YgVGltZSJdLk5vR2xpdGNoaW5nOlJlbW92ZSgpCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXBbIlRlbXBsZSBvZiBUaW1lIl0uTm9HbGl0Y2hpbmc6UmVtb3ZlKCkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcFsiVGVtcGxlIG9mIFRpbWUiXS5Ob0dsaXRjaGluZzpSZW1vdmUoKQogICAgZW5kCiAgICBQcm94aW1pdHlQcm9tcHQuVHJpZ2dlcmVkOkNvbm5lY3Qob25Qcm94aW1pdHkpCmVuZCkKCnBhZ2UxMDpCdXR0b24oIlRlbGVwb3J0IFRvIFJhY2UgRG9vclxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4LiX4Li14LmI4Lib4Lij4Liw4LiV4Li54LmA4Lic4LmI4LiyIiwgZnVuY3Rpb24oKQppZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlJhY2UuVmFsdWUgPT0gIkN5Ym9yZyIgdGhlbgogICAgdG9UYXJnZXQoQ0ZyYW1lLm5ldygyODQ5Mi40MTQwNjI1LCAxNDg5NC40MjY3NTc4MTI1LCAtNDIyLjExMDAxNTg2OTE0MDYpKQplbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5SYWNlLlZhbHVlID09ICJGaXNobWFuIiB0aGVuCiAgICB0b1RhcmdldChDRnJhbWUubmV3KDI4MjI0LjA1NjY0MDYyNSwgMTQ4ODkuNDI2NzU3ODEyNSwgLTIxMC41ODcyMDM5Nzk0OTIyKSkKZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuUmFjZS5WYWx1ZSA9PSAiR2hvdWwiIHRoZW4KICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoMjg2NzIuNzIwNzAzMTI1LCAxNDg4OS4xMjc5Mjk2ODc1LCA0NTQuNTk2MTYwODg4NjcxOSkpCmVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlJhY2UuVmFsdWUgPT0gIkh1bWFuIiB0aGVuCiAgICB0b1RhcmdldChDRnJhbWUubmV3KDI5MjM3LjI5NDkyMTg3NSwgMTQ4ODkuNDI2NzU3ODEyNSwgLTIwNi45NDk1NTQ0NDMzNTkzOCkpCmVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlJhY2UuVmFsdWUgPT0gIk1pbmsiIHRoZW4KICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoMjkwMjAuNjYwMTU2MjUsIDE0ODg5LjQyNjc1NzgxMjUsIC0zNzkuMjY4MjgwMDI5Mjk2OSkpCmVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlJhY2UuVmFsdWUgPT0gIlNreXBpZWEiIHRoZW4KICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoMjg5NjcuNDA4MjAzMTI1LCAxNDkxOC4wNzUxOTUzMTI1LCAyMzQuMzExOTgxMjAxMTcxODgpKQogICAgZW5kCmVuZCkKCnBhZ2UxMDpCdXR0b24oIkNsb2NrIEFjY2Vzc1xu4LmA4LiC4LmJ4Liy4LiW4Li24LiH4Lir4LmJ4Lit4LiH4LiZ4Liy4Lis4Li04LiB4Liy4LmE4LiU4LmJIiwgZnVuY3Rpb24oKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXBbIlRlbXBsZSBvZiBUaW1lIl0uRG9Ob3RFbnRlcjpSZW1vdmUoKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXBbIlRlbXBsZSBvZiBUaW1lIl0uQ2xvY2tSb29tRXhpdDpSZW1vdmUoKQplbmQpCgpwYWdlMTA6QnV0dG9uKCJEaXNhYmxlZCBJbmYgU3RhaXJzXG7guJvguLTguJTguJrguLHguJnguYTguJTguK3guLTguJnguJ/guLTguJnguLTguJXguLXguYkiLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkluZmluaXRlU3RhaXJzLkRpc2FibGVkID0gdHJ1ZQplbmQpCgpwYWdlMTA6QnV0dG9uKCJUZWxlcG9ydCBUbyBBY2llbnQgT25lXG7guYDguJfguYDguKXguJ7guK3guKPguYzguJXguYTguJvguJfguLXguYjguKXguLnguIHguYHguIHguYnguKfguYHguJTguIciLCBmdW5jdGlvbigpCiAgICB0b1RhcmdldChDRnJhbWUubmV3KDI4OTgxLjU1MjczNDM3NSwgMTQ4ODguNDI2NzU3ODEyNSwgLTEyMC4yNDU4NDk2MDkzNzUpKQplbmQpCgpwYWdlMTA6QnV0dG9uKCJCdXkgQW5jaWVudCBPbmUgUXVlc3RcbuC4i+C4t+C5ieC4reC5gOC4hOC4p+C4quC4peC4ueC4geC5geC4geC5ieC4pyIsIGZ1bmN0aW9uKCkKICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoJ1VwZ3JhZGVSYWNlJywnQnV5JykKZW5kKQoKcGFnZTEwOlRvZ2dsZSgiQXV0byBUcmFpbFxu4Lit4Lit4LmC4LiV4LmJ4Lic4LmI4Liy4LiZ4LiU4LmI4Liy4LiZIiwgZmFsc2UsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b1JhY2VRdWVzdCA9IHZhbHVlCiAgICBpZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgdG9UYXJnZXQoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgaWYgX0cuQXV0b1JhY2VRdWVzdCB0aGVuCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlJhY2UuVmFsdWUgPT0gIkh1bWFuIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5IZWFsdGggPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b1JhY2VRdWVzdCBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlJhY2UuVmFsdWUgPT0gIlNreXBpZWEiIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlNreVRyaWFsLk1vZGVsOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAgInNub3dpc2xhbmRfQ3lsaW5kZXIuMDgxIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2LkNGcmFtZSogQ0ZyYW1lLm5ldygwLDAsMCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuUmFjZS5WYWx1ZSA9PSAiRmlzaG1hbiIgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5TZWFCZWFzdHMuU2VhQmVhc3QxOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAgIkh1bWFub2lkUm9vdFBhcnQiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuQ0ZyYW1lKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2LlRvb2xUaXAgPT0gIk1lbGVlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsMTIyLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwxMjIsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCguMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDEyMCxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsMTIwLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSw5OSxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsOTksZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5Ub29sVGlwID09ICJCbG94IEZydWl0IiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDEyMixmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsMTIyLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwxMjAsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLDEyMCxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KC4yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsOTksZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLDk5LGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5Ub29sVGlwID09ICJTd29yZCIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwxMjIsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLDEyMixmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KC4yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsMTIwLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwxMjAsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCguMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDk5LGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSw5OSxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuVG9vbFRpcCA9PSAiR3VuIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsMTIyLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwxMjIsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCguMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDEyMCxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsMTIwLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoLjIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSw5OSxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsOTksZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlJhY2UuVmFsdWUgPT0gIkN5Ym9yZyIgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoMjg2NTQsIDE0ODk4Ljc4MzIsIC0zMCwgMSwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMSkpCiAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5SYWNlLlZhbHVlID09ICJHaG91bCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHdhaXQoLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSGVhbHRoID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IF9HLkF1dG9SYWNlUXVlc3Qgb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5SYWNlLlZhbHVlID09ICJNaW5rIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiU3RhcnRQb2ludCIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5DRnJhbWUqIENGcmFtZS5uZXcoMCwxMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCiAgICAgICAgCnBhZ2UxMDpUb2dnbGUoIkF1dG8gQnV5IEdlYXJcbuC4reC4reC5guC4leC5ieC4i+C4t+C5ieC4reC5gOC4geC4teC4ouC4o+C5jCIsIGZhbHNlLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLkJnID0gdmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgwLjEpIGRvCiAgICAgICAgICAgIGlmIF9HLkJnIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICBbMV0gPSB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgIFsxXSA9ICJVcGdyYWRlUmFjZSIsCiAgICAgICAgICAgICAgICAgICAgWzJdID0gIkJ1eSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCAKICAgIGVuZCkgIAplbmQpCgpwYWdlMTA6VG9nZ2xlKCJBdXRvIEFuY2llbnQgT25lIFF1ZXN0XG7guK3guK3guYLguJXguYnguYDguITguKfguKrguKXguLnguIHguYHguIHguYnguKciLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvVHJhbkZyb20gPSB2YWx1ZQogICAgX0cuQXV0b0FuY2llbnRPbmVRdWVzdCA9IHZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICBpZiBfRy5BdXRvVHJhbkZyb20gdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SYWNlVHJhbnNmb3JtZWQuVmFsdWUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgX0cuQXV0b0FuY2llbnRPbmVRdWVzdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgQVR3ZWVuKENGcmFtZS5uZXcoMjE2LjIxMTE4MTY0MDYyNSwgMTI2LjkzNTIwMzU1MjI0NjEsIC0xMjU5OS4wNzMyNDIxODc1KSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8gCiAgICAgICAgaWYgX0cuQXV0b0FuY2llbnRPbmVRdWVzdCB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ29jb2EgV2FycmlvciIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ2hvY29sYXRlIEJhciBCYXR0bGVyIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJTd2VldCBUaGllZiIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ2FuZHkgUmViZWwiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJDb2NvYSBXYXJyaW9yIiBvciB2Lk5hbWUgPT0gIkNob2NvbGF0ZSBCYXIgQmF0dGxlciIgb3Igdi5OYW1lID09ICJTd2VldCBUaGllZiIgb3Igdi5OYW1lID09ICJDYW5keSBSZWJlbCIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b0FuY2llbnRPbmVRdWVzdCBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChDRnJhbWUubmV3KDIxNi4yMTExODE2NDA2MjUsIDEyNi45MzUyMDM1NTIyNDYxLCAtMTI1OTkuMDczMjQyMTg3NSkpCiAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6R2V0Q2hpbGRyZW4oKSkgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiQ29jb2EgV2FycmlvciIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMiwyMCwyKSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHYuTmFtZSA9PSAiQ2hvY29sYXRlIEJhciBCYXR0bGVyIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygyLDIwLDIpKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgdi5OYW1lID09ICJTd2VldCBUaGllZiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMiwyMCwyKSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHYuTmFtZSA9PSAiQ2FuZHkgUmViZWwiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDIsMjAsMikpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgaWYgX0cuQXV0b1RyYW5Gcm9tIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmFjZVRyYW5zZm9ybWVkLlZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICBfRy5BdXRvQW5jaWVudE9uZVF1ZXN0ID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuQXV0b1RyYW5Gcm9tIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLCJZIixmYWxzZSxnYW1lKQogICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsIlkiLGZhbHNlLGdhbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgpwYWdlMTA6VG9nZ2xlKCJBdXRvIEtpbGwgUGxheWVyIE9uIFRyYWlsXG7guK3guK3guYLguJXguYnguIbguYjguLLguYDguJ7guKXguKLguYzguYDguKLguK3guKPguYwiLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRva2lsbFAgPSB2YWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9raWxsUCB0aGVuCiAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5DaGFyYWN0ZXJzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgYW5kICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsMCw1KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlVzZXNraWxsID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCwgNjAsIDYwKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgX0cuQXV0b2tpbGxQIG9yIG5vdCB2LlBhcmVudCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwIAogICAgICAgICAgICAgICAgICAgICAgICBfRy5Vc2Vza2lsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKcGFnZTEwOkJ1dHRvbigiVGVsZXBvcnQgVG8gQXJlYSBQVlBcbuC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4leC5hOC4m+C4l+C4teC5iOC4leC5iOC4reC4quC4ueC5iSIsIGZ1bmN0aW9uKCkKICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoMjg3NjYuNjgxNjQwNjI1LCAxNDk2Ny4xNDU1MDc4MTI1LCAtMTY0LjEzMjkwNDA1MjczNDM4KSkKZW5kKQpwYWdlMTA6QnV0dG9uKCJUZWxlcG9ydCBUbyBBcmVhIFNhZmVcbuC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4leC4reC4reC4geC4iOC4suC4geC4l+C4teC5iOC4leC5iOC4reC4quC4ueC5iSIsIGZ1bmN0aW9uKCkKICAgIHRvVGFyZ2V0KENGcmFtZS5uZXcoMjgyNzMuMDg1OTM3NSwgMTQ4OTYuNTA3ODEyNSwgMTU3LjQyMDYzOTAzODA4NTk0KSkKZW5kKQpwYWdlMTQ6U2VwZXJhdG9yKCLwn4yKIikKcGFnZTE0OlRvZ2dsZSgiVGVsZXBvcnQgdG8gS2lzdW5lIElzbGFuZFxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4Lir4Liy4LmA4LiB4Liy4Liw4LiI4Li04LmJ4LiH4LiI4Lit4LiBIiwgX0cuVHB0b0tpc3VuZUlzbGFuZCwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5UcHRvS2lzdW5lSXNsYW5kID0gdmFsdWUKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICBpZiBfRy5UcHRvS2lzdW5lSXNsYW5kIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGsgPSB0b1RhcmdldChnYW1lLndvcmtzcGFjZS5NYXAuS2l0c3VuZUlzbGFuZC5TaHJpbmVBY3RpdmUuV29ybGRQaXZvdCAqIENGcmFtZS5uZXcoMCwwLDIwKSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgazpTdG9wKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKICAgICAgICAKcGFnZTE0OlRvZ2dsZSgiQXV0byBDb2xsZWN0IFNwaXJpdCBGaXJlXG7guK3guK3guYLguJXguYnguYDguIHguYfguJrguKXguLnguIHguYTguJ/guKfguLTguI3guI3guLLguJMiLCBfRy5FeiwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5FeiA9IHZhbHVlCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgX0cuRXogZG8gd2FpdCgpCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiRW1iZXJUZW1wbGF0ZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gd29ya3NwYWNlLkVtYmVyVGVtcGxhdGUuUGFydC5DRnJhbWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCnBhZ2UxNDpTZXBlcmF0b3IoIkZhcm1TZWEv4Lif4Liy4Lij4LmM4Lih4LiX4Liw4LmA4LilIikKCmZ1bmN0aW9uIENoZWNrUGlyYXRlQm9hdCgpCiAgICBsb2NhbCBjaGVja21tcGIgPSB7IlBpcmF0ZUdyYW5kQnJpZ2FkZSIsICJQaXJhdGVCcmlnYWRlIn0KICAgIGZvciByLCB2IGluIG5leHQsIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgaWYgdGFibGUuZmluZChjaGVja21tcGIsIHYuTmFtZSkgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkhlYWx0aCIpIGFuZCB2LkhlYWx0aC5WYWx1ZSA+IDAgdGhlbgogICAgICAgICAgICByZXR1cm4gdgogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gQ2hlY2tQaXJhdGVCb2F0KCkKICAgIGxvY2FsIGNoZWNrbW1wYiA9IHsiRmlzaEJvYXQifQogICAgZm9yIHIsIHYgaW4gbmV4dCwgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkgZG8KICAgICAgICBpZiB0YWJsZS5maW5kKGNoZWNrbW1wYiwgdi5OYW1lKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSGVhbHRoIikgYW5kIHYuSGVhbHRoLlZhbHVlID4gMCB0aGVuCiAgICAgICAgICAgIHJldHVybiB2CiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBjaGVja3RlYW0gPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5UZWFtCmxvY2FsIEFsbEJvYXQgPSAoY2hlY2t0ZWFtID09IGdhbWUuVGVhbXNbIk1hcmluZXMiXSBhbmQgeyJEaW5naHkiLCAiTWFyaW5lU2xvb3AiLCAiTWFyaW5lQnJpZ2FkZSIsICJNYXJpbmVHcmFuZEJyaWdhZGUifSkgb3IgeyJEaW5naHkiLCAiUGlyYXRlU2xvb3AiLCAiUGlyYXRlQnJpZ2FkZSIsICJQaXJhdGVHcmFuZEJyaWdhZGUifQoKbG9jYWwgU2VsZWN0Qm9hdCA9ICJNYXJpbmVHcmFuZEJyaWdhZGUiCnBhZ2UxNDpEcm9wZG93bigi4LmA4Lil4Li34Lit4LiB4LmA4Lij4Li34LitIiwgQWxsQm9hdCwgZnVuY3Rpb24odmFsdWUpCiAgICBTZWxlY3RCb2F0ID0gdmFsdWUKICAgIHByaW50KCJTZWxlY3RlZCBib2F0OiIsIFNlbGVjdEJvYXQpCmVuZCkKCmxvY2FsIGFjdGl2ZVR3ZWVucyA9IHt9CiAgICAKcGFnZTE0OlRvZ2dsZSgiQXV0byBGaW5kIElzbGFuZCBLaXRzdW5lLE1pcmFnZSxWb2xjYW5vXG7guK3guK3guYLguJXguYnguKvguLIg4LmA4LiB4Liy4Liw4Lil4Lix4LiaLOC5gOC4geC4suC4sOC4iOC4tOC5ieC4h+C4iOC4reC4gSzguYDguIHguLLguLDguKDguLnguYDguILguLLguYTguJ8iLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvRmluZElzbGFuZCA9IHZhbHVlCiAgICBfRy5Ob2NsaXByb2NrID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICBmb3IgXywgVHdlZW4gaW4gcGFpcnMoYWN0aXZlVHdlZW5zKSBkbwogICAgICAgICAgICBpZiBUd2VlbiB0aGVuIFR3ZWVuOkNhbmNlbCgpIGVuZAogICAgICAgIGVuZAogICAgICAgIGFjdGl2ZVR3ZWVucyA9IHt9CiAgICAgICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgZW5kCmVuZCkKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9GaW5kSXNsYW5kIGFuZCBTZWxlY3RCb2F0IHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBsb2NhbCBib2F0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5Cb2F0czpGaW5kRmlyc3RDaGlsZChTZWxlY3RCb2F0KQogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnUHJlaGlzdG9yaWMgSXNsYW5kJykgb3IgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnTWlyYWdlIElzbGFuZCcpICBvciAgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnS2l0c3VuZSBJc2xhbmQnKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBib2F0IG9yIChib2F0IGFuZCBib2F0Lk93bmVyLlZhbHVlLk5hbWUgfj0gcGxheWVyLk5hbWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJ1eVBvcyA9IENGcmFtZS5uZXcoLTE2OTI3LjQ1MTE3MTg3NSwgOS4wODYzNjE4ODUwNzA4LCA0MzMuODY0Mjg4MzMwMDc4MSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJ1eVR3ZWVuID0gdG9UYXJnZXQoYnV5UG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1eVBvcy5Qb3NpdGlvbiAtIGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJ1eVR3ZWVuIHRoZW4gYnV5VHdlZW46U3RvcCgpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUJvYXQiLCBTZWxlY3RCb2F0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBib2F0IGFuZCBib2F0Lk93bmVyLlZhbHVlLk5hbWUgPT0gcGxheWVyLk5hbWUgYW5kIGNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmVoaWNsZVNlYXQgPSBib2F0OkZpbmRGaXJzdENoaWxkKCJWZWhpY2xlU2VhdCIsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2ZWhpY2xlU2VhdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodmVoaWNsZVNlYXQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAxLCAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgYm9hdCBhbmQgYm9hdC5Pd25lci5WYWx1ZS5OYW1lID09IHBsYXllci5OYW1lIGFuZCBjaGFyYWN0ZXIuSHVtYW5vaWQuU2l0ID09IHRydWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmVoaWNsZVNlYXQgPSBib2F0OkZpbmRGaXJzdENoaWxkKCJWZWhpY2xlU2VhdCIsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2ZWhpY2xlU2VhdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcG9zaXRpb25zID0ge0NGcmFtZS5uZXcoLTE3MDQwLjQ0MzQsIDEyLjc5NDY5MywgNTA2Ljk2MjI1LCAtMC4yMDk5MTIzMywgMi43NjkxNzA2N2UtMDgsIDAuOTc3NzIwMjAxLCAtMS4zOTg0ODUzM2UtMDgsIDEsIC0zLjEzMjUyMjE1ZS0wOCwgLTAuOTc3NzIwMjAxLCAtMi4wMjQ4ODIzMWUtMDgsIC0wLjIwOTkxMjMzKSAqIENGcmFtZS5uZXcoMCwgMCwgLTk5OTk5OTkpLENGcmFtZS5uZXcoLTE3MDQwLjQ0MzQsIDEyLjc5NDY5MywgNTA2Ljk2MjI1LCAtMC4yMDk5MTIzMywgMi43NjkxNzA2N2UtMDgsIDAuOTc3NzIwMjAxLCAtMS4zOTg0ODUzM2UtMDgsIDEsIC0zLjEzMjUyMjE1ZS0wOCwgLTAuOTc3NzIwMjAxLCAtMi4wMjQ4ODIzMWUtMDgsIC0wLjIwOTkxMjMzKSAqIENGcmFtZS5uZXcoMCwgMCwgLTk5OTk5OSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksIHBvcyBpbiBpcGFpcnMocG9zaXRpb25zKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuQXV0b0ZpbmRJc2xhbmQgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnUHJlaGlzdG9yaWNJc2xhbmQnKSBvciBnYW1lLldvcmtzcGFjZS5fV29ybGRPcmlnaW4uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCdNaXJhZ2UgSXNsYW5kJykgb3IgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnS2l0c3VuZSBJc2xhbmQnKSB0aGVuICBpZiBnYW1lLldvcmtzcGFjZS5fV29ybGRPcmlnaW4uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCdQcmVoaXN0b3JpY0lzbGFuZCcpIHRoZW4gVmVjKCI8Q29sb3I9Q3lhbj5Gb3VuZCBWb2NhbG5vIElzbGFuZFxu4LmA4LiI4Lit4LmA4LiB4Liy4Liw4Lig4Li54LmA4LiC4Liy4LmE4LifPENvbG9yPS8+IikgZW5kICBpZiBnYW1lLldvcmtzcGFjZS5fV29ybGRPcmlnaW4uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCdNaXJhZ2UgSXNsYW5kJykgdGhlbiBWZWMoIjxDb2xvcj1DeWFuPkZvdW5kIE1pcmFnZSBJc2xhbmRcbuC5gOC4iOC4reC5gOC4geC4suC4sOC4peC4seC4mjxDb2xvcj0vPiIpIGVuZCBpZiAgZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgnS2l0c3VuZSBJc2xhbmQnKSB0aGVuIFZlYygiPENvbG9yPUN5YW4+Rm91bmQgS2l0c3VuZUlzbGFuZFxu4LmA4LiI4Lit4LmA4LiB4Liy4Liw4LiI4Li04LmJ4LiH4LiI4Lit4LiBPENvbG9yPS8+IikgZW5kIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9ICh2ZWhpY2xlU2VhdC5Qb3NpdGlvbiAtIHBvcy5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRpc3RhbmNlID4gMTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYm9hdFR3ZWVuID0gVFBCKHBvcywgdmVoaWNsZVNlYXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgd2FpdCgpIHVudGlsICh2ZWhpY2xlU2VhdC5Qb3NpdGlvbiAtIHBvcy5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDEwIG9yIG5vdCBfRy5BdXRvRmluZElzbGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYm9hdFR3ZWVuIHRoZW4gYm9hdFR3ZWVuOlN0b3AoKSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKcGFnZTE0OlRvZ2dsZSgiQXV0byBTZWEgQmVhc3RcbuC4reC4reC5guC4leC5ieC4leC4teC5gOC4iOC5ieC4suC4l+C4sOC5gOC4pSIsIGZhbHNlLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLkF1dG9TZWFiZXN0RmFybSA9IHZhbHVlCiAgICBfRy5Ob2NsaXByb2NrID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICBlbmQKZW5kKQpsb2NhbCBhY3RpdmVUd2VlbnMgPSB7fQpwYWdlMTQ6VG9nZ2xlKCJBdXRvIEZhcm0gU2VhIEV2ZW50XG7guK3guK3guYLguJXguYnguJ/guLLguKPguYzguKHguK3guLXguYDguKfguYnguJnguJfguLDguYDguKUiLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5mYXJtc2VhZXZlbnQgPSB2YWx1ZQogICAgX0cuTm9jbGlwcm9jayA9IHZhbHVlCiAgICBfRy5XYWxrV2F0ZXIgPSB2YWx1ZQogICAgaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgogICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgIGVuZAplbmQpCiAgICAKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgaWYgX0cuZmFybXNlYWV2ZW50IGFuZCBTZWxlY3RCb2F0IHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBsb2NhbCBib2F0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5Cb2F0czpGaW5kRmlyc3RDaGlsZChTZWxlY3RCb2F0KQogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBub3QgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiU2hhcmsiKSBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlRlcnJvcnNoYXJrIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJQaXJhbmhhIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJGaXNoIENyZXcgTWVtYmVyIikpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGJvYXQgb3IgKGJvYXQgYW5kIGJvYXQuT3duZXIuVmFsdWUuTmFtZSB+PSBwbGF5ZXIuTmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYnV5UG9zID0gQ0ZyYW1lLm5ldygtMTY5MjcuNDUxMTcxODc1LCA5LjA4NjM2MTg4NTA3MDgsIDQzMy44NjQyODgzMzAwNzgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYnV5VHdlZW4gPSB0b1RhcmdldChidXlQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnV5UG9zLlBvc2l0aW9uIC0gY2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnV5VHdlZW4gdGhlbiBidXlUd2VlbjpTdG9wKCkgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5Qm9hdCIsIFNlbGVjdEJvYXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGJvYXQgYW5kIGJvYXQuT3duZXIuVmFsdWUuTmFtZSA9PSBwbGF5ZXIuTmFtZSBhbmQgY2hhcmFjdGVyLkh1bWFub2lkLlNpdCA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB2ZWhpY2xlU2VhdCA9IGJvYXQ6RmluZEZpcnN0Q2hpbGQoIlZlaGljbGVTZWF0IiwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZlaGljbGVTZWF0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2ZWhpY2xlU2VhdC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDEsIDApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBib2F0IGFuZCBib2F0Lk93bmVyLlZhbHVlLk5hbWUgPT0gcGxheWVyLk5hbWUgYW5kIGNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB2ZWhpY2xlU2VhdCA9IGJvYXQ6RmluZEZpcnN0Q2hpbGQoIlZlaGljbGVTZWF0IiwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZlaGljbGVTZWF0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwb3NpdGlvbnMgPSB7Q0ZyYW1lLm5ldygtNDUxNTUuMDk3NywgNC4xODIwNDM1NSwgLTYwMC45MzM4MzgsIDAuMDgzNzYzNjU5LCAtMS42NTY2ODQ4ZS0wNSwgMC45OTY0ODU2NTEsIDAuMDAwMTc4OTc4MTA5LCAwLjk5OTk5OTk0LCAxLjU4MDUxODk4ZS0wNiwgLTAuOTk2NDg1NTkxLCAwLjAwMDE3ODIxNjczOCwgMC4wODM3NjM2NTE1KSxDRnJhbWUubmV3KC00MjI1MC4yMjI3LCAtMC4zMjIxNzQ0LCA5MjQ3LjA3NzE1LCAtMC40NTkxNjQ0NywgNi4zOTA0MzIzNmUtMDgsIDAuODg4MzUxMjYyLCAtMy4zNjcxMTQyM2UtMDgsIDEsIC04LjkzMzk1NjUxZS0wOCwgLTAuODg4MzUxMjYyLCAtNy4wOTMzMzYwNWUtMDgsIC0wLjQ1OTE2NDQ3KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgcG9zIGluIGlwYWlycyhwb3NpdGlvbnMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5mYXJtc2VhZXZlbnQgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAodmVoaWNsZVNlYXQuUG9zaXRpb24gLSBwb3MuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA+IDEwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJvYXRUd2VlbiA9IFRQQihwb3MsIHZlaGljbGVTZWF0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHdhaXQoKSB1bnRpbCAodmVoaWNsZVNlYXQuUG9zaXRpb24gLSBwb3MuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMCBvciBub3QgX0cuZmFybXNlYWV2ZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBib2F0VHdlZW4gdGhlbiBib2F0VHdlZW46U3RvcCgpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICBpZiBfRy5mYXJtc2VhZXZlbnQgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJTaGFyayIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiVGVycm9yc2hhcmsiKSBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlBpcmFuaGEiKSBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkZpc2ggQ3JldyBNZW1iZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpwYWdlMTQ6VG9nZ2xlKCJCdXlCb2F0XG7guIvguLfguYnguK3guYDguKPguLfguK0iLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5CdXlCb2F0ID0gdmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5CdXlCb2F0IGFuZCBTZWxlY3RCb2F0IHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBsb2NhbCBib2F0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5Cb2F0czpGaW5kRmlyc3RDaGlsZChTZWxlY3RCb2F0KQogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBub3QgYm9hdCBvciAoYm9hdCBhbmQgYm9hdC5Pd25lci5WYWx1ZS5OYW1lIH49IHBsYXllci5OYW1lKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJ1eVBvcyA9IENGcmFtZS5uZXcoLTE2OTI3LjQ1MTE3MTg3NSwgOS4wODYzNjE4ODUwNzA4LCA0MzMuODY0Mjg4MzMwMDc4MSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYnV5VHdlZW4gPSB0b1RhcmdldChidXlQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidXlQb3MuUG9zaXRpb24gLSBjaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDEwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJ1eVR3ZWVuIHRoZW4gYnV5VHdlZW46U3RvcCgpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5Qm9hdCIsIFNlbGVjdEJvYXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBib2F0IGFuZCBib2F0Lk93bmVyLlZhbHVlLk5hbWUgPT0gcGxheWVyLk5hbWUgYW5kIGNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB2ZWhpY2xlU2VhdCA9IGJvYXQ6RmluZEZpcnN0Q2hpbGQoIlZlaGljbGVTZWF0IiwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmVoaWNsZVNlYXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodmVoaWNsZVNlYXQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAxLCAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnBhZ2UxNDpTZXBlcmF0b3IoIkVuZW1pZXNTZWxlY3Qv4LmA4Lil4Li34Lit4LiB4Lio4Lix4LiV4Lij4Li5IikKcGFnZTE0OlRvZ2dsZSgiVGVycm9yIFNoYXJrXG7guJrguK3guKrguInguKXguLLguKEiLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvVGVycm9yc2hhcmsgPSB2YWx1ZQogICAgaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgogICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmICBfRy5BdXRvVGVycm9yc2hhcmsgIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJUZXJyb3JzaGFyayIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIlRlcnJvcnNoYXJrIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLm1hZ25pdHVkZSA8PSAyMDAgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBNZXRob2RGYXJtKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgIF9HLkF1dG9UZXJyb3JzaGFyayBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHYuSHVtYW5vaWQuVmFsdWUgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLm5jcCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJUZXJyb3JzaGFyayIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJUZXJyb3JzaGFyayIpLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygyLDIwLDIpKQogICAgICAgICAgICAgICAgICAgICAgICBfRy5uY3AgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBfRy5uY3AgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAgX0cuQXV0b1RlcnJvcnNoYXJraG9wIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpwYWdlMTQ6VG9nZ2xlKCJTaGFya1xu4LiJ4Lil4Liy4LihIiwgZmFsc2UsIGZ1bmN0aW9uKHZhbHVlKQogICAgRmFybVNoYXJrID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiAgRmFybVNoYXJrIGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlNoYXJrIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiU2hhcmsiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDIwMCBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5uY3AgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCw2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCAgRmFybVNoYXJrIG9yIG5vdCB2LlBhcmVudCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdi5IdW1hbm9pZC5WYWx1ZSA8PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIlRlcnJvcnNoYXJrIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIlRlcnJvcnNoYXJrIikuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDIsMjAsMikpCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLm5jcCA9IHRydWUKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLm5jcCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICBfRy5BdXRvVGVycm9yc2hhcmtob3AgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgSG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnBhZ2UxNDpUb2dnbGUoIlBpcmFuaGFcbuC4m+C4tOC4o+C4seC4meC4ouC5iOC4siIsIGZhbHNlLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLmZhcm1waXJhbnlhID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiAgX0cuZmFybXBpcmFueWEgIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJQaXJhbmhhIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiUGlyYW5oYSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMjAwIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLm5jcCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLDY3MikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90ICBfRy5mYXJtcGlyYW55YSBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHYuSHVtYW5vaWQuVmFsdWUgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLm5jcCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJQaXJhbmhhIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIlBpcmFuaGEiKS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMiwyMCwyKSkKICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIF9HLkF1dG9UZXJyb3JzaGFya2hvcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb3AoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKcGFnZTE0OlRvZ2dsZSgiRmlzaCBDcmV3IE1lbWJlclxu4Liq4Lih4Liy4LiK4Li04LiB4Lil4Li54LiB4LmA4Lij4Li34Lit4Lih4LiZ4Li44Lip4Lii4LmM4LmA4LiH4Li34Lit4LiBIiwgZmFsc2UsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuRmlzaF9DcmV3X01lbWJlciA9IHZhbHVlCiAgICBpZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgdG9UYXJnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgaWYgIF9HLkZpc2hfQ3Jld19NZW1iZXIgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRmlzaCBDcmV3IE1lbWJlciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkZpc2ggQ3JldyBNZW1iZXIiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDIwMCBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5uY3AgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCw2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCAgX0cuRmlzaF9DcmV3X01lbWJlciBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHYuSHVtYW5vaWQuVmFsdWUgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLm5jcCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJGaXNoIENyZXcgTWVtYmVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIkZpc2ggQ3JldyBNZW1iZXIiKS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMiwyMCwyKSkKICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIF9HLkF1dG9UZXJyb3JzaGFya2hvcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb3AoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKcGFnZTE0OlRvZ2dsZSgiUmFpZCBTaGlwXG7guKXguLnguIHguYDguKPguLfguK0iLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5LaWxsR2hvc3RTaGlwID0gdmFsdWUKICAgIGlmIHZhbHVlID09IGZhbHNlIHRoZW4KICAgICAgICB0b1RhcmdldChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5LaWxsR2hvc3RTaGlwIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgQ2hlY2tQaXJhdGVCb2F0KCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDMyLGZhbHNlLGdhbWUpCiAgICAgICAgICAgICAgICAgICAgd2FpdCguNSkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsMzIsZmFsc2UsZ2FtZSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCB2ID0gQ2hlY2tQaXJhdGVCb2F0KCkKICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduKHRvVGFyZ2V0KHYuRW5naW5lLkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgLTIwLCAwKSksIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIEFpbUJvdFNraWxsUG9zaXRpb24gPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAtNSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBTa2lsbGFpbWJvdCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgX0cuVXNlc2tpbGwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCB2IG9yIG5vdCB2LlBhcmVudCBvciB2LkhlYWx0aC5WYWx1ZSA8PSAwIG9yIG5vdCBDaGVja1BpcmF0ZUJvYXQoKQogICAgICAgICAgICAgICAgICAgIFNraWxsYWltYm90ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIF9HLlVzZXNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBfRy5uY3AgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpwYWdlMTQ6VG9nZ2xlKCJHaG9zdCBTaGlwXG7guYDguKPguLfguK3guJzguLUiLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5iamlyRmlzaEJvYXQgPSB2YWx1ZQogICAgaWYgdmFsdWUgPT0gZmFsc2UgdGhlbgogICAgICAgIHRvVGFyZ2V0KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuYmppckZpc2hCb2F0IHRoZW4KICAgICAgICAgICAgICAgIGlmIENoZWNrUGlyYXRlQm9hdCgpIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwgMzIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwgMzIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHYgPSBDaGVja1BpcmF0ZUJvYXQoKQogICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICB3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgc3Bhd24odG9UYXJnZXQodi5FbmdpbmUuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAtMjAsIDApLCAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBfRy5Vc2Vza2lsbCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIEFpbUJvdFNraWxsUG9zaXRpb24gPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAtNSwgMCkKICAgICAgICAgICAgICAgICAgICB1bnRpbCB2LlBhcmVudCBvciB2LkhlYWx0aC5WYWx1ZSA8PSAwIG9yIG5vdCBDaGVja1BpcmF0ZUJvYXQoKQogICAgICAgICAgICAgICAgICAgIF9HLlVzZXNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBfRy5uY3AgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIFNraWxsYWltYm90ID0gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKSAgIApzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5iamlyRmlzaEJvYXQgdGhlbgogICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBDaGVja1BpcmF0ZUJvYXQoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCw2NzIpKQogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5Ub29sVGlwID09ICJNZWxlZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsMTIyLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsMTIyLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICB3YWl0KC4yKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDEyMCxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLDEyMCxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgd2FpdCguMikKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSw5OSxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLDk5LGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICB3YWl0KC4yKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwiQyIsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5Ub29sVGlwID09ICJCbG94IEZydWl0IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwxMjIsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwxMjIsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIHdhaXQoLjIpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsMTIwLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsMTIwLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICB3YWl0KC4yKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDk5LGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsOTksZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIHdhaXQoLjIpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsIlYiLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsIlYiLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICB3YWl0KDAuNikKICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuVG9vbFRpcCA9PSAiU3dvcmQiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDEyMixmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLDEyMixmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgd2FpdCguMikKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwxMjAsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwxMjAsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIHdhaXQoLjIpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsOTksZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSw5OSxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2LlRvb2xUaXAgPT0gIkd1biIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLDEyMixmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLDEyMixmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICAgICAgd2FpdCguMikKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwxMjAsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwxMjAsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIHdhaXQoLjIpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsOTksZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSw5OSxmYWxzZSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCgpsb2NhbCBnZyA9IGdldHJhd21ldGF0YWJsZShnYW1lKQpsb2NhbCBvbGQgPSBnZy5fX25hbWVjYWxsCnNldHJlYWRvbmx5KGdnLGZhbHNlKQpnZy5fX25hbWVjYWxsID0gbmV3Y2Nsb3N1cmUoZnVuY3Rpb24oLi4uKQoJbG9jYWwgbWV0aG9kID0gZ2V0bmFtZWNhbGxtZXRob2QoKQoJbG9jYWwgYXJncyA9IHsuLi59CglpZiB0b3N0cmluZyhtZXRob2QpID09ICJGaXJlU2VydmVyIiB0aGVuCgkJaWYgdG9zdHJpbmcoYXJnc1sxXSkgPT0gIlJlbW90ZUV2ZW50IiB0aGVuCgkJCWlmIHRvc3RyaW5nKGFyZ3NbMl0pIH49ICJ0cnVlIiBhbmQgdG9zdHJpbmcoYXJnc1syXSkgfj0gImZhbHNlIiB0aGVuCgkJCQlpZiBTa2lsbGFpbWJvdCB0aGVuCgkJCQkJYXJnc1syXSA9IEFpbUJvdFNraWxsUG9zaXRpb24KCQkJCQlyZXR1cm4gb2xkKHVucGFjayhhcmdzKSkKCQkJCWVuZAoJCQllbmQKCQllbmQKCWVuZAoJcmV0dXJuIG9sZCguLi4pCmVuZCkKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9TZWFiZXN0RmFybSBhbmQgU2VsZWN0Qm9hdCB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgbG9jYWwgYm9hdCA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQm9hdHM6RmluZEZpcnN0Q2hpbGQoU2VsZWN0Qm9hdCkKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuU2VhQmVhc3RzOkZpbmRGaXJzdENoaWxkKCJTZWFCZWFzdCIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuU2VhQmVhc3RzOkZpbmRGaXJzdENoaWxkKCJTZWFCZWFzdDEiKSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgYm9hdCBvciAoYm9hdCBhbmQgYm9hdC5Pd25lci5WYWx1ZS5OYW1lIH49IHBsYXllci5OYW1lKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBidXlQb3MgPSBDRnJhbWUubmV3KC0xNjkyNy40NTExNzE4NzUsIDkuMDg2MzYxODg1MDcwOCwgNDMzLjg2NDI4ODMzMDA3ODEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBidXlUd2VlbiA9IHRvVGFyZ2V0KGJ1eVBvcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidXlQb3MuUG9zaXRpb24gLSBjaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDEwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBidXlUd2VlbiB0aGVuIGJ1eVR3ZWVuOlN0b3AoKSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlCb2F0IiwgU2VsZWN0Qm9hdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgYm9hdCBhbmQgYm9hdC5Pd25lci5WYWx1ZS5OYW1lID09IHBsYXllci5OYW1lIGFuZCBjaGFyYWN0ZXIuSHVtYW5vaWQuU2l0ID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHZlaGljbGVTZWF0ID0gYm9hdDpGaW5kRmlyc3RDaGlsZCgiVmVoaWNsZVNlYXQiLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmVoaWNsZVNlYXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHZlaGljbGVTZWF0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgMSwgMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGJvYXQgYW5kIGJvYXQuT3duZXIuVmFsdWUuTmFtZSA9PSBwbGF5ZXIuTmFtZSBhbmQgY2hhcmFjdGVyLkh1bWFub2lkLlNpdCA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHZlaGljbGVTZWF0ID0gYm9hdDpGaW5kRmlyc3RDaGlsZCgiVmVoaWNsZVNlYXQiLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmVoaWNsZVNlYXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBvc2l0aW9ucyA9IHtDRnJhbWUubmV3KC00NTE1NS4wOTc3LCA0LjE4MjA0MzU1LCAtNjAwLjkzMzgzOCwgMC4wODM3NjM2NTksIC0xLjY1NjY4NDhlLTA1LCAwLjk5NjQ4NTY1MSwgMC4wMDAxNzg5NzgxMDksIDAuOTk5OTk5OTQsIDEuNTgwNTE4OThlLTA2LCAtMC45OTY0ODU1OTEsIDAuMDAwMTc4MjE2NzM4LCAwLjA4Mzc2MzY1MTUpLENGcmFtZS5uZXcoLTQyMjUwLjIyMjcsIC0wLjMyMjE3NDQsIDkyNDcuMDc3MTUsIC0wLjQ1OTE2NDQ3LCA2LjM5MDQzMjM2ZS0wOCwgMC44ODgzNTEyNjIsIC0zLjM2NzExNDIzZS0wOCwgMSwgLTguOTMzOTU2NTFlLTA4LCAtMC44ODgzNTEyNjIsIC03LjA5MzMzNjA1ZS0wOCwgLTAuNDU5MTY0NDcpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCBwb3MgaW4gaXBhaXJzKHBvc2l0aW9ucykgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9TZWFiZXN0RmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9ICh2ZWhpY2xlU2VhdC5Qb3NpdGlvbiAtIHBvcy5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRpc3RhbmNlID4gMTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYm9hdFR3ZWVuID0gVFBCKHBvcywgdmVoaWNsZVNlYXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgd2FpdCgpIHVudGlsICh2ZWhpY2xlU2VhdC5Qb3NpdGlvbiAtIHBvcy5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDEwIG9yIG5vdCBfRy5BdXRvU2VhYmVzdEZhcm0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJvYXRUd2VlbiB0aGVuIGJvYXRUd2VlbjpTdG9wKCkgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLlNlYUJlYXN0czpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgd2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikuU2l0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLDUwMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBBbGxXZWFwb24oKSAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlVzZXNraWxsID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5uY3AgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFpbUJvdFNraWxsUG9zaXRpb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBvciBfRy5BdXRvU2VhYmVzdEZhcm0gPT0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5Vc2Vza2lsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cubmNwID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTa2lsbGFpbWJvdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnBhZ2UxNDpUb2dnbGUoIlRlbGVwb3J0IFRvIFNlYSBCZWFzdFxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4Lir4Liy4LmA4LiI4LmJ4Liy4LiX4Liw4LmA4LilIiwgZmFsc2UsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b1NlYUJlc3QgPSB2YWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLkF1dG9TZWFCZXN0IHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLlNlYUJlYXN0czpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLm5jcCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oX0cuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldCh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLDMwMCwwKSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsNjcyKSkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLm5jcCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9TZWFCZXN0SG9wIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnBhZ2UxNDpTZXBlcmF0b3IoIkJvYXRNb2RpZnkv4LmA4Lij4Li34Lit4LmB4LiV4LmI4LiHIikKCnBhZ2UxNDpUb2dnbGUoIkluY3JlYXNlQm9hdFNwZWVkXG7guYDguJ7guLTguYjguKHguITguKfguLLguKHguYDguKPguYfguKfguYDguKPguLfguK0iLF9HLmluY3JlYXNlYm9hdHNwZWVkLCBmdW5jdGlvbih2YWx1ZSkKX0cuaW5jcmVhc2Vib2F0c3BlZWQgPSB2YWx1ZQogICAgbG9jYWwgdmVoaWNsZVNlYXRzID0ge30KICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlLkJvYXRzOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgdjpJc0EoIlZlaGljbGVTZWF0IikgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQodmVoaWNsZVNlYXRzLCB2KQogICAgICAgIGVuZAogICAgZW5kCiAgICBpZiBfRy5pbmNyZWFzZWJvYXRzcGVlZCB0aGVuCiAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnModmVoaWNsZVNlYXRzKSBkbwogICAgICAgICAgICB2Lk1heFNwZWVkID0gMzUwCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnModmVoaWNsZVNlYXRzKSBkbwogICAgICAgICAgICB2Lk1heFNwZWVkID0gMTAwCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKcGFnZTE0OlRvZ2dsZSgiQm9hdCBOb2NsaXBSb2NrXG7guYDguKPguLfguK3guJfguLDguKXguLjguKvguLTguJkiLCBfRy5Ob2NsaXByb2NrLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLk5vY2xpcHJvY2sgPSB2YWx1ZQplbmQpCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5Ob2NsaXByb2NrIHRoZW4KICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5Cb2F0czpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJCYXNlUGFydCIpIGFuZCB2LkNhbkNvbGxpZGUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHYuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiQmFzZVBhcnQiKSBhbmQgdi5DYW5Db2xsaWRlID09IHRydWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB2LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2VpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlNpdCA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5Cb2F0czpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJCYXNlUGFydCIpIGFuZCB2LkNhbkNvbGxpZGUgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB2LkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiQmFzZVBhcnQiKSBhbmQgdi5DYW5Db2xsaWRlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdi5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKcGFnZTE0OlNlcGVyYXRvcigiT3RoZXJCb2F0L+C4reC4t+C5iOC4meC5huC5gOC4geC4teC5iOC4ouC4p+C4geC4seC4muC5gOC4o+C4t+C4rSIpClNlYXRhYmxlID0geyJTZWExW0xvd10iLCJTZWEyW01lZGl1bV0iLCJTZWEzW0hpZ2hdIiwiU2VhNFtFeHRyZW1lXSIsIlNlYTVbQ3JhenldIiwiU2VhNls/Pz9dIn0KcGFnZTE0OkRyb3Bkb3duKCJTZWxlY3QgTGV2ZWwgU2VhXG7guYDguKXguLfguK3guIHguKPguLDguJTguLHguJrguJfguLDguYDguKUiLCAgIFNlYXRhYmxlICwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5TZWxlY3RMb2NhbFRlbGVwb3J0U2VhID0gdmFsdWUKZW5kKQoKcGFnZTE0OlRvZ2dsZSgiVGVsZXBvcnQgVG8gU2VsZWN0IFNlYVxu4LmA4LiX4LmA4Lil4Lie4Lit4Lij4LmM4LiV4LmE4Lib4Lii4Lix4LiH4LiX4Liw4LmA4Lil4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBIiwgX0cuVGVsZXBvcnRTZWEsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuVGVsZXBvcnRTZWEgPSB2YWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgX0cuVGVsZXBvcnRTZWEgdGhlbgogICAgICAgICAgICBpZiBTZWxlY3RCb2F0IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIEJvYXQgPSBnYW1lLldvcmtzcGFjZS5Cb2F0c1tTZWxlY3RCb2F0XQogICAgICAgICAgICAgICAgcmVwZWF0IHdhaXQoKQogICAgICAgICAgICAgICAgaWYgX0cuU2VsZWN0TG9jYWxUZWxlcG9ydFNlYSA9PSAiU2VhMVtMb3ddIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdHdlZW5Nb2RlbChCb2F0LCBDRnJhbWUubmV3KC0yMjUyNi4wMDk4LCAtMC4zMjIxNzQ0LCAxNzE2Ljg5MTg1LCAtMC4yMTA3MDcyMDMsIDEuMTAwOTgxZS0wNywgMC45Nzc1NDkxOTUsIDIuNzQ2MzE0NTFlLTA5LCAxLCAtMS4xMjAzNDY5OGUtMDcsIC0wLjk3NzU0OTE5NSwgLTIuMDkyMTg1OThlLTA4LCAtMC4yMTA3MDcyMDMpKQogICAgICAgICAgICAgICAgZWxzZWlmIF9HLlNlbGVjdExvY2FsVGVsZXBvcnRTZWEgPT0gIlNlYTJbTWVkaXVtXSIgdGhlbgogICAgICAgICAgICAgICAgICAgIHR3ZWVuTW9kZWwoQm9hdCwgQ0ZyYW1lLm5ldygtMjU2NDUuMzUzNSwgLTAuMzIyMTc0NCwgMjU1NC40MTAxNiwgLTAuMzM0ODc2MzI5LCAtNS4wNTUyMjQ1MWUtMDgsIDAuOTQyMjYyMTEzLCAtMy4xMzM0NjQ2OWUtMDgsIDEsIDQuMjUxMzY2MTllLTA4LCAtMC45NDIyNjIxMTMsIC0xLjUyODg2MzA4ZS0wOCwgLTAuMzM0ODc2MzI5KSkKICAgICAgICAgICAgICAgIGVsc2VpZiBfRy5TZWxlY3RMb2NhbFRlbGVwb3J0U2VhID09ICJTZWEzW0hpZ2hdIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdHdlZW5Nb2RlbChCb2F0LCBDRnJhbWUubmV3KC0yOTg0Mi4yMjI3LCAtMC4zMjIxNzQ0LCA0MDcwLjg1NzY3LCAtMC4yNzA2MDk1ODcsIDMuNjA5Njg2MDZlLTA4LCAwLjk2MjY4OTE2MSwgLTQuNDcxOTM0MjllLTA4LCAxLCAtNS4wMDY2MzYxN2UtMDgsIC0wLjk2MjY4OTE2MSwgLTUuNjU5OTI2NTdlLTA4LCAtMC4yNzA2MDk1ODcpKQogICAgICAgICAgICAgICAgZWxzZWlmIF9HLlNlbGVjdExvY2FsVGVsZXBvcnRTZWEgPT0gIlNlYTRbRXh0cmVtZV0iIHRoZW4KICAgICAgICAgICAgICAgICAgICB0d2Vlbk1vZGVsKEJvYXQsIENGcmFtZS5uZXcoLTMyNjU0LjcxODgsIC0wLjMyMjE3NDQsIDQ3ODguMTQ2OTcsIC0wLjE4MzI3NjIyMSwgMi4wMDMzMjMyZS0wOCwgMC45ODMwNjE0MzMsIDMuNjY2Njk0MzNlLTA4LCAxLCAtMS4zNTQyNDQxOGUtMDgsIC0wLjk4MzA2MTQzMywgMy4zNTYzODUwNGUtMDgsIC0wLjE4MzI3NjIyMSkpCiAgICAgICAgICAgICAgICBlbHNlaWYgX0cuU2VsZWN0TG9jYWxUZWxlcG9ydFNlYSA9PSAiU2VhNVtDcmF6eV0iIHRoZW4KICAgICAgICAgICAgICAgICAgICB0d2Vlbk1vZGVsKEJvYXQsIENGcmFtZS5uZXcoLTM3ODEzLjY5NTMsIC0wLjMyMjE3NDQsIDYxMDUuMTY4OTUsIC0wLjI1MjM2Mjk5NiwgNC4xMzYyMTU4MWUtMDksIDAuOTY3NjMyNjUxLCAyLjg3MzIwNzA5ZS0wOCwgMSwgMy4yMTg4ODI0OWUtMDksIC0wLjk2NzYzMjY1MSwgMi44NjE0NDE3NWUtMDgsIC0wLjI1MjM2Mjk5NikpCiAgICAgICAgICAgICAgICBlbHNlaWYgX0cuU2VsZWN0TG9jYWxUZWxlcG9ydFNlYSA9PSAiU2VhNls/Pz9dIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdHdlZW5Nb2RlbChCb2F0LCBDRnJhbWUubmV3KC00MjI1MC4yMjI3LCAtMC4zMjIxNzQ0LCA5MjQ3LjA3NzE1LCAtMC40NTkxNjQ0NywgNi4zOTA0MzIzNmUtMDgsIDAuODg4MzUxMjYyLCAtMy4zNjcxMTQyM2UtMDgsIDEsIC04LjkzMzk1NjUxZS0wOCwgLTAuODg4MzUxMjYyLCAtNy4wOTMzMzYwNWUtMDgsIC0wLjQ1OTE2NDQ3KSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHVudGlsIG5vdCBfRy5UZWxlcG9ydFNlYQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBWZWMoIjxDb2xvcj1DeWFuPlNlbGVjdEJvYXQg4LmA4Lil4Li34Lit4LiB4LmA4Lij4Li34LitPENvbG9yPS8+IikKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpCb2F0c05hbWUgPSB7fQpmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQm9hdHM6R2V0Q2hpbGRyZW4oKSkgZG8gIAogICAgdGFibGUuaW5zZXJ0KEJvYXRzTmFtZSAsdi5OYW1lKQplbmQKCmxvY2FsIEJvYXRzID0gcGFnZTE0OkRyb3Bkb3duKCJTZWxlY3QgQm9hdHMgVGFyZ2V0XG7guYDguKXguLfguK3guIHguYDguKPguLfguK3guJfguLXguYjguJXguYnguK3guIfguIHguLLguKMiLCBCb2F0c05hbWUsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuU2VsZWN0QiA9IHZhbHVlCmVuZCkKCnBhZ2UxNDpCdXR0b24oIlJlZnJlc2ggQm9hdHMgTGlzdFxu4Lij4Li14LmA4Lif4Lij4LiK4Lij4Liy4Lii4LiK4Li34LmI4Lit4LmA4Lij4Li34LitIiwgZnVuY3Rpb24oKQogICAgQm9hdHNOYW1lID0ge30KICAgIEJvYXRzOkNsZWFyKCkKICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5Cb2F0czpHZXRDaGlsZHJlbigpKSBkbyAgCiAgICAgICBCb2F0czpBZGQodi5OYW1lKQogICAgZW5kCmVuZCkKCnBhZ2UxNDpUb2dnbGUoIlRlbGVwb3J0IFRvIFNlbGVjdGVkIEJvYXRzXG7guYDguJfguYDguKXguJ7guK3guKPguYzguJXguYTguJvguKLguLHguIfguYDguKPguLfguK3guJfguLXguYjguYDguKXguLfguK3guIEiLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5UUEIgPSBib29sICAgICAgIAogICAgU3RvcFR3ZWVuKF9HLlRQQikKICAgIGlmIF9HLlRQQiB0aGVuCiAgICAgICAgX0cuQm9hdHMgPSB0cnVlCiAgICAgICAgd2hpbGUgX0cuQm9hdHMgZG8gd2FpdCgpCiAgICAgICAgICAgIERpc3RhbmNlID0gKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQm9hdHNbX0cuU2VsZWN0Ql0uVmVoaWNsZVNlYXQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICBTcGVlZCA9IDIyMAogICAgICAgICAgICB0d2VlblNlcnZpY2UsIHR3ZWVuSW5mbyA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIiksIFR3ZWVuSW5mby5uZXcoRGlzdGFuY2UvU3BlZWQsIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKQogICAgICAgICAgICB0d2VlbiA9IHR3ZWVuU2VydmljZTpDcmVhdGUoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIilbIkxvY2FsUGxheWVyIl0uQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQsIHR3ZWVuSW5mbywge0NGcmFtZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQm9hdHNbX0cuU2VsZWN0Ql0uVmVoaWNsZVNlYXQuQ0ZyYW1lfSkKICAgICAgICAgICAgdHdlZW46UGxheSgpCiAgICAgICAgICAgIF9HLm5jcCA9IHRydWUKICAgICAgICAgICAgd2FpdChEaXN0YW5jZS9TcGVlZCkKICAgICAgICBlbmQKICAgIGVsc2VpZiBfRy5UUEIgPT0gZmFsc2UgdGhlbgogICAgICAgIF9HLkJvYXRzID0gZmFsc2UKICAgICAgICB3aGlsZSBfRy5Cb2F0cyBkbyB3YWl0KCkKICAgICAgICAgICAgRGlzdGFuY2UgPSAoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5Cb2F0c1tfRy5TZWxlY3RCXS5WZWhpY2xlU2VhdC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgIFNwZWVkID0gMjIwCiAgICAgICAgICAgIHR3ZWVuU2VydmljZSwgdHdlZW5JbmZvID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKSwgVHdlZW5JbmZvLm5ldyhEaXN0YW5jZS9TcGVlZCwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpCiAgICAgICAgICAgIHR3ZWVuID0gdHdlZW5TZXJ2aWNlOkNyZWF0ZShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKVsiTG9jYWxQbGF5ZXIiXS5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCwgdHdlZW5JbmZvLCB7Q0ZyYW1lID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5Cb2F0c1tfRy5TZWxlY3RCXS5WZWhpY2xlU2VhdC5DRnJhbWV9KQogICAgICAgICAgICB0d2VlbjpQbGF5KCkKICAgICAgICAgICAgX0cubmNwID0gdHJ1ZQogICAgICAgICAgICB3YWl0KERpc3RhbmNlL1NwZWVkKQogICAgICAgIGVuZAogICAgICAgIHR3ZWVuU2VydmljZSwgdHdlZW5JbmZvID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKSwgVHdlZW5JbmZvLm5ldyguMSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpCiAgICAgICAgdHdlZW4gPSB0d2VlblNlcnZpY2U6Q3JlYXRlKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpWyJMb2NhbFBsYXllciJdLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LCB0d2VlbkluZm8sIHtDRnJhbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lfSkKICAgICAgICB0d2VlbjpQbGF5KCkKICAgICAgICBfRy5uY3AgPSBmYWxzZQogICAgZW5kCmVuZCkKCnBhZ2UxNDpUb2dnbGUoIlNwZWN0YXRlIFNlbGVjdGVkIEJvYXRzXG7guYHguK3guJrguKrguYjguK3guIfguYDguKPguLfguK3guJfguLXguYjguYDguKXguLfguK3guIEiLCBmYWxzZSwgZnVuY3Rpb24odmFsdWUpCiAgICBTcCA9IHZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBTcCB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBscjEgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkCiAgICAgICAgICAgIGxvY2FsIHBscjIgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkJvYXRzOkZpbmRGaXJzdENoaWxkKF9HLlNlbGVjdEIpCiAgICAgICAgICAgICAgICByZXBlYXQgd2FpdCguMSkKICAgICAgICAgICAgICAgICAgICBnYW1lLldvcmtzcGFjZS5DYW1lcmEuQ2FtZXJhU3ViamVjdCA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQm9hdHNbX0cuU2VsZWN0Ql0uVmVoaWNsZVNlYXQKICAgICAgICAgICAgICAgIHVudGlsIFNwID09IGZhbHNlIAogICAgICAgICAgICBnYW1lLldvcmtzcGFjZS5DYW1lcmEuQ2FtZXJhU3ViamVjdCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnBhZ2UxNDpCdXR0b24oIkJyaW5nIFNlbGVjdGVkIEJvYXRzXG7guJTguLbguIfguYDguKPguLfguK3guJfguLXguYjguYDguKXguLfguK3guIHguKHguLIiLCBmdW5jdGlvbigpCiAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKVsiTG9jYWxQbGF5ZXIiXS5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkJvYXRzW19HLlNlbGVjdEJdLlZlaGljbGVTZWF0LkNGcmFtZQplbmQpCnBhZ2UxNjpTZXBlcmF0b3IoIkRvam8gUXVlc3RcbuC5gOC4hOC4p+C4quC4guC4reC4h+C5guC4lOC5guC4iiIpCnBhZ2UxNjpUb2dnbGUoIlRlbGVwb3J0IFRvIERvam9cbuC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4leC5hOC4m+C4l+C4teC5iOC5guC4lOC5guC4iCIsX0cuVG9Eb2pvLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLlRvRG9qbyA9IHZhbHVlCiAgICBpZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgdG9UYXJnZXQoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgIGVuZAplbmQpCgpsb2NhbCBwb3NpdGlvbkQgPSBDRnJhbWUubmV3KDU4NjYuNTE4MDcsIDEyMDguMjU4NzksIDg3MC4yNTAxODMsIC0wLjQzNjQ2MDU1NSwgOC44OTEwNDQ3ZS0wOCwgLTAuODk5NzIzNDExLCAtMS4wMzQ5Nzg5NWUtMDgsIDEsIDEuMDM4NDA0OTllLTA3LCAwLjg5OTcyMzQxMSwgNS40NjM0MjI3OGUtMDgsIC0wLjQzNjQ2MDU1NSkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBfRy5Ub0Rvam8gdGhlbgogICAgICAgICAgICB0b1RhcmdldChwb3NpdGlvbkQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpwYWdlMTY6VG9nZ2xlKCJDaGVja1Byb2dlc3NRdWVzdFxu4LmA4LiK4LmH4LiE4Lin4LmI4Liy4LmA4LiE4Lin4Liq4Liq4Liz4LmA4Lij4LmH4LiI4Lij4Li24Lii4Lix4LiHIixfRy5GaW5pc2hRLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLkZpbmlzaFEgPSB2YWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCguMSkgZG8KICAgICAgICAgICAgaWYgX0cuRmluaXNoUSB0aGVuCiAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KC4xKQogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9ICBDRnJhbWUubmV3KDU4NjYuNTE4MDcsIDEyMDguMjU4NzksIDg3MC4yNTAxODMsIC0wLjQzNjQ2MDU1NSwgOC44OTEwNDQ3ZS0wOCwgLTAuODk5NzIzNDExLCAtMS4wMzQ5Nzg5NWUtMDgsIDEsIDEuMDM4NDA0OTllLTA3LCAwLjg5OTcyMzQxMSwgNS40NjM0MjI3OGUtMDgsIC0wLjQzNjQ2MDU1NSkKICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IAogICAgICAgICAgICAgICAgICAgIFsxXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgWyJOUEMiXSA9ICJEb2pvIFRyYWluZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBbIkNvbW1hbmQiXSA9ICJDbGFpbVF1ZXN0IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiTW9kdWxlcyIpOldhaXRGb3JDaGlsZCgiTmV0Iik6V2FpdEZvckNoaWxkKCJSRi9JbnRlcmFjdERyYWdvblF1ZXN0Iik6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgdW50aWwgbm90IF9HLkZpbmlzaFEgCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIFJlbW90ZXMgPSBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKQpsb2NhbCBDb21tRl8gPSBSZW1vdGVzOldhaXRGb3JDaGlsZCgiQ29tbUZfIikKCmxvY2FsIGN1cnJlbnROb3RpZmljYXRpb24gPSBuaWwKbG9jYWwgbGFzdE5vdGlmaWNhdGlvblRleHQgPSBuaWwKZnVuY3Rpb24gRGVidWcodGV4dCkKICAgIGlmIGxhc3ROb3RpZmljYXRpb25UZXh0ID09IHRleHQgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgaWYgY3VycmVudE5vdGlmaWNhdGlvbiB0aGVuCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBjdXJyZW50Tm90aWZpY2F0aW9uOkRlc3Ryb3koKQogICAgICAgIGVuZCkKICAgICAgICBjdXJyZW50Tm90aWZpY2F0aW9uID0gbmlsCiAgICBlbmQKCiAgICBsb2NhbCBzdWNjZXNzLCBOb3RpZmljYXRpb24gPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgcmV0dXJuIHJlcXVpcmUoZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCgiTm90aWZpY2F0aW9uIikpCiAgICBlbmQpCiAgICBpZiBub3Qgc3VjY2VzcyBvciBub3QgTm90aWZpY2F0aW9uIHRoZW4KICAgICAgICB3YXJuKCJGYWlsZWQgdG8gbG9hZCBOb3RpZmljYXRpb24gbW9kdWxlOiAiIC4uIHRvc3RyaW5nKE5vdGlmaWNhdGlvbikpCiAgICAgICAgcHJpbnQoIltEZWJ1Z10gIiAuLiB0ZXh0KQogICAgICAgIGxhc3ROb3RpZmljYXRpb25UZXh0ID0gdGV4dAogICAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgY29sb3JlZFRleHQgPSB0ZXh0CiAgICBsb2NhbCBub3RpZmljYXRpb24KICAgIGxvY2FsIHN1Y2Nlc3MsIGVyciA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBub3RpZmljYXRpb24gPSBOb3RpZmljYXRpb24ubmV3KGNvbG9yZWRUZXh0KQogICAgICAgIG5vdGlmaWNhdGlvbi5EdXJhdGlvbiA9IDk5OTk5CiAgICAgICAgbm90aWZpY2F0aW9uOkRpc3BsYXkoKQogICAgZW5kKQogICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgIHdhcm4oIkZhaWxlZCB0byBkaXNwbGF5IG5vdGlmaWNhdGlvbjogIiAuLiB0b3N0cmluZyhlcnIpKQogICAgICAgIHByaW50KCJbRGVidWddICIgLi4gdGV4dCkKICAgICAgICBsYXN0Tm90aWZpY2F0aW9uVGV4dCA9IHRleHQKICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGN1cnJlbnROb3RpZmljYXRpb24gPSBub3RpZmljYXRpb24KICAgIGxhc3ROb3RpZmljYXRpb25UZXh0ID0gdGV4dAplbmQKCmxvY2FsIGZ1bmN0aW9uIFJ1bkF1dG9RdWVzdERvam8oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8gCiAgICAgICAgaWYgbm90IF9HLkF1dG9RdWVzdERvam8gdGhlbgogICAgICAgICAgICBpZiBjdXJyZW50Tm90aWZpY2F0aW9uIHRoZW4KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm90aWZpY2F0aW9uOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgY3VycmVudE5vdGlmaWNhdGlvbiA9IG5pbAogICAgICAgICAgICAgICAgbGFzdE5vdGlmaWNhdGlvblRleHQgPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGxvY2FsIG5vdGlmaWNhdGlvbnMgPSBMb2NhbFBsYXllci5QbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIk5vdGlmaWNhdGlvbnMiKQogICAgICAgICAgICBpZiBub3RpZmljYXRpb25zIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCBub3RpZmljYXRpb24gaW4gcGFpcnMobm90aWZpY2F0aW9uczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdGlmaWNhdGlvbi5OYW1lID09ICJOb3RpZmljYXRpb25UZW1wbGF0ZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb246RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgYnJlYWsgCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgaW52ZW50b3J5RGF0YSA9IENvbW1GXzpJbnZva2VTZXJ2ZXIoImdldEludmVudG9yeSIpCiAgICAgICAgaWYgbm90IGludmVudG9yeURhdGEgdGhlbgogICAgICAgICAgICB3YXJuKCJGYWlsZWQgdG8gcmV0cmlldmUgaW52ZW50b3J5IGRhdGEuIikKICAgICAgICAgICAgRGVidWcoIkVycm9yOiBDYW5ub3QgcmV0cmlldmUgaW52ZW50b3J5IGRhdGEuIikKICAgICAgICAgICAgX0cuQXV0b1F1ZXN0RG9qbyA9IGZhbHNlCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGhhc1doaXRlID0gZmFsc2UKICAgICAgICBsb2NhbCBoYXNZZWxsb3cgPSBmYWxzZQogICAgICAgIGxvY2FsIGhhc09yYW5nZSA9IGZhbHNlCiAgICAgICAgbG9jYWwgaGFzR3JlZW4gPSBmYWxzZQogICAgICAgIGxvY2FsIGhhc0JsdWUgPSBmYWxzZQogICAgICAgIGxvY2FsIGhhc1B1cnBsZSA9IGZhbHNlCiAgICAgICAgbG9jYWwgaGFzUmVkID0gZmFsc2UKICAgICAgICBsb2NhbCBoYXNCbGFjayA9IGZhbHNlCgogICAgICAgIGZvciBfLCBpdGVtIGluIHBhaXJzKGludmVudG9yeURhdGEpIGRvCiAgICAgICAgICAgIGlmIGl0ZW0uTmFtZSA9PSAiRG9qbyBCZWx0IChXaGl0ZSkiIHRoZW4KICAgICAgICAgICAgICAgIGhhc1doaXRlID0gdHJ1ZQogICAgICAgICAgICBlbHNlaWYgaXRlbS5OYW1lID09ICJEb2pvIEJlbHQgKFllbGxvdykiIHRoZW4KICAgICAgICAgICAgICAgIGhhc1llbGxvdyA9IHRydWUKICAgICAgICAgICAgZWxzZWlmIGl0ZW0uTmFtZSA9PSAiRG9qbyBCZWx0IChPcmFuZ2UpIiB0aGVuCiAgICAgICAgICAgICAgICBoYXNPcmFuZ2UgPSB0cnVlCiAgICAgICAgICAgIGVsc2VpZiBpdGVtLk5hbWUgPT0gIkRvam8gQmVsdCAoR3JlZW4pIiB0aGVuCiAgICAgICAgICAgICAgICBoYXNHcmVlbiA9IHRydWUKICAgICAgICAgICAgZWxzZWlmIGl0ZW0uTmFtZSA9PSAiRG9qbyBCZWx0IChCbHVlKSIgdGhlbgogICAgICAgICAgICAgICAgaGFzQmx1ZSA9IHRydWUKICAgICAgICAgICAgZWxzZWlmIGl0ZW0uTmFtZSA9PSAiRG9qbyBCZWx0IChQdXJwbGUpIiB0aGVuCiAgICAgICAgICAgICAgICBoYXNQdXJwbGUgPSB0cnVlCiAgICAgICAgICAgIGVsc2VpZiBpdGVtLk5hbWUgPT0gIkRvam8gQmVsdCAoUmVkKSIgdGhlbgogICAgICAgICAgICAgICAgaGFzUmVkID0gdHJ1ZQogICAgICAgICAgICBlbHNlaWYgaXRlbS5OYW1lID09ICJEb2pvIEJlbHQgKEJsYWNrKSIgdGhlbgogICAgICAgICAgICAgICAgaGFzQmxhY2sgPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgaGFzV2hpdGUgdGhlbgogICAgICAgICAgICBEZWJ1ZygiV2hpdGUgQmVsdCBGYXJtIDMgUXVlc3RcbuC4q+C4suC4quC4teC4guC4suC4py4u4Lif4Liy4Lij4LmM4Lih4LmA4Lin4LilM+C5gOC4hOC4p+C4qiIpCiAgICAgICAgICAgIGlmIF9HLkF1dG9RdWVzdERvam8gdGhlbgogICAgICAgICAgICAgICAgX0cuQXV0b0Zhcm0gPSB0cnVlCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9HLkF1dG9GYXJtID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIGhhc1doaXRlIGFuZCBub3QgaGFzWWVsbG93IHRoZW4KICAgICAgICAgICAgRGVidWcoIlllbGxvdyBCZWx0IEtpbGwgRmlzaCA1IGFtb3VudFxu4Lir4Liy4Liq4Li14LmA4Lir4Lil4Li34Lit4LiHLi7guJXguLXguJvguKXguLLguJfguLA14LiV4Lix4LinIikKICAgICAgICAgICAgaWYgX0cuQXV0b1F1ZXN0RG9qbyB0aGVuCiAgICAgICAgICAgICAgICBfRy5mYXJtc2VhZXZlbnQgPSB0cnVlCiAgICAgICAgICAgICAgICBfRy5BdXRvVGVycm9yc2hhcmsgPSB0cnVlCiAgICAgICAgICAgICAgICBfRy5GYXJtU2hhcmsgPSB0cnVlCiAgICAgICAgICAgICAgICBfRy5mYXJtcGlyYW55YSA9IHRydWUKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX0cuZmFybXNlYWV2ZW50ID0gZmFsc2UKICAgICAgICAgICAgICAgIF9HLkF1dG9UZXJyb3JzaGFyayA9IGZhbHNlCiAgICAgICAgICAgICAgICBfRy5GYXJtU2hhcmsgPSBmYWxzZQogICAgICAgICAgICAgICAgX0cuZmFybXBpcmFueWEgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgaGFzV2hpdGUgYW5kIGhhc1llbGxvdyBhbmQgbm90IGhhc09yYW5nZSB0aGVuCiAgICAgICAgICAgIERlYnVnKCJPcmFuZ2UgQmVsdCBUcmFkZSBvbiB5b3VyIG93blxu4Lir4Liy4Liq4Li14Liq4LmJ4LihLi7guYDguJfguKPguJTguJzguKXguJTguYnguKfguKLguJXguLHguKfguYDguK3guIciKQogICAgICAgIGVsc2VpZiBoYXNXaGl0ZSBhbmQgaGFzWWVsbG93IGFuZCBoYXNPcmFuZ2UgYW5kIG5vdCBoYXNHcmVlbiB0aGVuCiAgICAgICAgICAgIERlYnVnKCJHcmVlbiBCZWx0IERyaXZlIEJvYXQgNUsgTVxu4Lir4Liy4Liq4Li14LmA4LiC4Li14Lii4LinLi7guILguLHguJrguYDguKPguLfguK3guKvguYjguLLguIfguIjguLLguIHguYDguIHguLLguLDguKvguYnguLLguJ7guLHguJnguYDguKHguJXguKMiKQogICAgICAgICAgICBpZiBfRy5BdXRvUXVlc3REb2pvIHRoZW4KICAgICAgICAgICAgICAgIF9HLkF1dG9GaW5kSXNsYW5kID0gdHJ1ZQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfRy5BdXRvRmluZElzbGFuZCA9IGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBoYXNXaGl0ZSBhbmQgaGFzWWVsbG93IGFuZCBoYXNPcmFuZ2UgYW5kIGhhc0dyZWVuIGFuZCBub3QgaGFzQmx1ZSB0aGVuCiAgICAgICAgICAgIERlYnVnKCJCbHVlIEJlbHQgRHJvcCBGcnVpdCBXaXRoIFNvbWVvbmVcbuC4q+C4suC4quC4teC4meC5ieC4s+C5gOC4h+C4tOC4mS4u4LmC4Lii4LiZ4Lic4Lil4LmD4Lir4LmJ4LiB4Lix4LiZ4LiU4LmJ4Lin4Lii4LiV4Lix4Lin4LmA4Lit4LiHIikKICAgICAgICBlbHNlaWYgaGFzV2hpdGUgYW5kIGhhc1llbGxvdyBhbmQgaGFzT3JhbmdlIGFuZCBoYXNHcmVlbiBhbmQgaGFzQmx1ZSBhbmQgbm90IGhhc1B1cnBsZSB0aGVuCiAgICAgICAgICAgIERlYnVnKCJQdXJwbGUgQmVsdCBLaWxsIEVsaXRlIDMgYW1vdW50XG7guKvguLLguKrguLXguKHguYjguKfguIcuLuC4peC5iOC4suC4reC4teC4peC4tOC4l+C4ruC4seC4meC5gOC4leC4reC4o+C5jDPguJXguLHguKciKQogICAgICAgICAgICBpZiBfRy5BdXRvUXVlc3REb2pvIHRoZW4KICAgICAgICAgICAgICAgIF9HLkF1dG9FbGl0ZUh1bnRlciA9IHRydWUKICAgICAgICAgICAgICAgIF9HLkF1dG9FbGl0ZUh1bnRlckhvcCA9IHRydWUKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX0cuQXV0b0VsaXRlSHVudGVyID0gZmFsc2UKICAgICAgICAgICAgICAgIF9HLkF1dG9FbGl0ZUh1bnRlckhvcCA9IGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBoYXNXaGl0ZSBhbmQgaGFzWWVsbG93IGFuZCBoYXNPcmFuZ2UgYW5kIGhhc0dyZWVuIGFuZCBoYXNCbHVlIGFuZCBoYXNQdXJwbGUgYW5kIG5vdCBoYXNSZWQgdGhlbgogICAgICAgICAgICBEZWJ1ZygiUmVkIEJlbHQgS2lsbCBSdW1ibGluZyBXYXRlcnNcbuC4q+C4suC4quC4teC5geC4lOC4hy4u4LiV4Li14LmA4LiI4LmJ4Liy4LiX4Liw4LmA4Lil4LiX4Li14LmI4LmA4LiB4Li04LiU4LmA4Lib4LmH4LiZ4LiB4Lil4Li44LmI4LihIikKICAgICAgICAgICAgaWYgX0cuQXV0b1F1ZXN0RG9qbyB0aGVuCiAgICAgICAgICAgICAgICAgX0cuQXV0b1NlYWJlc3RGYXJtID0gdHJ1ZQogICAgICAgICAgICAgICAgX0cuTm9jbGlwcm9jayA9IHRydWUKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX0cuQXV0b1NlYWJlc3RGYXJtID0gZmFsc2UKICAgICAgICAgICAgICAgIF9HLk5vY2xpcHJvY2sgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgaGFzV2hpdGUgYW5kIGhhc1llbGxvdyBhbmQgaGFzT3JhbmdlIGFuZCBoYXNHcmVlbiBhbmQgaGFzQmx1ZSBhbmQgaGFzUHVycGxlIGFuZCBoYXNSZWQgYW5kIG5vdCBoYXNCbGFjayB0aGVuCiAgICAgICAgICAgIERlYnVnKCJCbGFjayBCZWx0IENvbXBsZXRlIHRoZSBWb2xjYW5vIEV2ZW50XG7guKvguLLguKrguLXguJTguLMuLuC4nOC5iOC4suC4meC4reC4teC5gOC4p+C5ieC4meC4l+C5jOC4oOC4ueC5gOC4guC4suC5hOC4nyIpCiAgICAgICAgICAgIGlmIF9HLkF1dG9RdWVzdERvam8gdGhlbgogICAgICAgICAgICAgICAgX0cuQXV0b0ZpbmRJc2xhbmQgPSB0cnVlCiAgICAgICAgICAgICAgICBfRy52b2xjYW5vUm9ja3MgPSB0cnVlCiAgICAgICAgICAgICAgICBfRy5LaWxsQXVyYSA9IHRydWUKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX0cuQXV0b0ZpbmRJc2xhbmQgPSBmYWxzZQogICAgICAgICAgICAgICAgX0cudm9sY2Fub1JvY2tzID0gZmFsc2UKICAgICAgICAgICAgICAgIF9HLktpbGxBdXJhID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBEZWJ1ZygiQ29tcGxldGUgQWxsIFF1ZXN0XG7guITguKPguJrguJfguLjguIHguYDguITguKfguKrguYHguKXguYnguKchIikKICAgICAgICAgICAgX0cuQXV0b1F1ZXN0RG9qbyA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBhdXRvUXVlc3RFdmVudCA9IEluc3RhbmNlLm5ldygiQmluZGFibGVFdmVudCIpCmxvY2FsIGxhc3RBdXRvUXVlc3RTdGF0ZSA9IF9HLkF1dG9RdWVzdERvam8KCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgX0cuQXV0b1F1ZXN0RG9qbyB+PSBsYXN0QXV0b1F1ZXN0U3RhdGUgdGhlbgogICAgICAgICAgICBsYXN0QXV0b1F1ZXN0U3RhdGUgPSBfRy5BdXRvUXVlc3REb2pvCiAgICAgICAgICAgIGlmIF9HLkF1dG9RdWVzdERvam8gdGhlbgogICAgICAgICAgICAgICAgc3Bhd24oUnVuQXV0b1F1ZXN0RG9qbykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKcGFnZTE2OlRvZ2dsZSgiQXV0b1F1ZXN0RG9qbyhBY2NlcHQgUXVlc3Qgb24geW91ciBvd24pXG7guK3guK3guYLguJXguYnguYDguITguKfguKrguYLguJTguYLguIgo4Lij4Lix4Lia4LmA4LiE4Lin4Liq4LiU4LmJ4Lin4Lii4LiV4Lix4Lin4LmA4Lit4LiHKSIsIF9HLkF1dG9RdWVzdERvam8sIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cuQXV0b1F1ZXN0RG9qbyA9IHZhbHVlCmVuZCkKCnBhZ2UxNjpTZXBlcmF0b3IoIkRyYWdvbiBIdW50ZXIgUXVlc3RcbuC5gOC4hOC4p+C4quC4guC4reC4h+C4lOC4o+C4suC4geC5ieC4reC4meC4ruC4seC4meC5gOC4leC4reC4o+C5jCIpCgpwYWdlMTY6VG9nZ2xlKCJUZWxlcG9ydCBUbyBEcmFnb25IdW50ZXJcbuC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4leC5hOC4m+C4l+C4teC5iCBEcmFnb24gSHVudGVyIixfRy5Ub0RyYWdvbkh1bnRlciwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5Ub0RyYWdvbkh1bnRlciA9IHZhbHVlCiAgICBpZiB2YWx1ZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgdG9UYXJnZXQoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgIGVuZAplbmQpCgpsb2NhbCBwb3NpdGlvbkQgPSBDRnJhbWUubmV3KDU4NjcuMjQ0MTQsIDEyMDkuNDM5MzMsIDgxMS4yMDI5NDIsIDAuNzA0NDUyNzUzLCAtMS44NDkwNjczOWUtMDgsIDAuNzA5NzUwODkxLCAxLjI0OTc2NTI3ZS0wOCwgMSwgMS4zNjQ3OTgzMmUtMDgsIC0wLjcwOTc1MDg5MSwgLTcuNDQxMzg5NzNlLTEwLCAwLjcwNDQ1Mjc1MykKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBfRy5Ub0RyYWdvbkh1bnRlciB0aGVuCiAgICAgICAgICAgIHRvVGFyZ2V0KHBvc2l0aW9uRCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCl9HLkN1cnJlbnRRdWVzdCA9IG5pbApsb2NhbCBhY3RpdmVUd2VlbiA9IG5pbApsb2NhbCBjaGVjayA9IHRydWUKbG9jYWwgaXNRdWVzdEFjdGl2ZSA9IGZhbHNlCmxvY2FsIHRhc2tDb21wbGV0ZWQgPSBmYWxzZQpwYWdlMTY6VG9nZ2xlKCJBdXRvUXVlc3REcmFnb25IdW50ZXJcbuC4reC4reC5guC4leC5ieC5gOC4hOC4p+C4quC4lOC4o+C4suC4geC5ieC4reC4meC4ruC4seC4meC5gOC4leC4reC4o+C5jCIsIF9HLmRyYWdvbmh1bnRlcnF1ZXN0LCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLmRyYWdvbmh1bnRlcnF1ZXN0ID0gdmFsdWUKICAgIGlmIG5vdCB2YWx1ZSB0aGVuCiAgICAgICAgc3RvcE1vdmVtZW50KCkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuVG9wYmFyU3RhbmRhcmQuRW5hYmxlZCA9IHRydWUKICAgIGVsc2UKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuVG9wYmFyU3RhbmRhcmQuRW5hYmxlZCA9IGZhbHNlCiAgICBlbmQKZW5kKQoKbG9jYWwgZHJhZ29uSHVudGVyTlBDUG9zID0gQ0ZyYW1lLm5ldyg1ODY3LjI0NDE0MDYyNSwgMTIwOS40MzkzMzEwNTQ2ODc1LCA4MTEuMjAyOTQxODk0NTMxMikKbG9jYWwgZHJhZ29uSHVudGVyTlBDID0gV29ya3NwYWNlLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBIdW50ZXIiKQoKbG9jYWwgZnVuY3Rpb24gd2FpdEZvckNoYXJhY3RlcigpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIG5vdCBjaGFyYWN0ZXIgb3Igbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIG9yIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgICAgIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikKICAgIGVuZAogICAgcmV0dXJuIGNoYXJhY3RlcgplbmQKCmxvY2FsIGZ1bmN0aW9uIHRvVGFyZ2V0RCh0YXJnZXRDRnJhbWUsIGlzRHJhZ29uSHVudGVyKQogICAgbG9jYWwgY2hhcmFjdGVyID0gd2FpdEZvckNoYXJhY3RlcigpCiAgICBsb2NhbCByb290UGFydCA9IGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CgogICAgaWYgaXNEcmFnb25IdW50ZXIgdGhlbgogICAgICAgIGlmIG5vdCBkcmFnb25IdW50ZXJOUEMgb3Igbm90IGRyYWdvbkh1bnRlck5QQzpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgZHJhZ29uSHVudGVyTlBDID0gV29ya3NwYWNlLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBIdW50ZXIiKQogICAgICAgICAgICBpZiBub3QgZHJhZ29uSHVudGVyTlBDIHRoZW4KICAgICAgICAgICAgICAgIHRhcmdldENGcmFtZSA9IGRyYWdvbkh1bnRlck5QQ1BvcwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0YXJnZXRDRnJhbWUgPSBkcmFnb25IdW50ZXJOUEMuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICB0YXJnZXRDRnJhbWUgPSBkcmFnb25IdW50ZXJOUEMuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGRpc3RhbmNlID0gKHJvb3RQYXJ0LlBvc2l0aW9uIC0gdGFyZ2V0Q0ZyYW1lLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgIGxvY2FsIGluZm8gPSBUd2VlbkluZm8ubmV3KGRpc3RhbmNlIC8gMzAwLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhcikKICAgIGxvY2FsIHR3ZWVuID0gVHdlZW5TZXJ2aWNlOkNyZWF0ZShyb290UGFydCwgaW5mbywge0NGcmFtZSA9IHRhcmdldENGcmFtZX0pCiAgICBhY3RpdmVUd2VlbiA9IHR3ZWVuCiAgICB0d2VlbjpQbGF5KCkKICAgIHJldHVybiB0d2VlbgplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0b3BNb3ZlbWVudCgpCiAgICBpZiBhY3RpdmVUd2VlbiB0aGVuCiAgICAgICAgYWN0aXZlVHdlZW46Q2FuY2VsKCkKICAgICAgICBhY3RpdmVUd2VlbiA9IG5pbAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gdGFwU2NyZWVuQXRHdWlFbGVtZW50KGd1aUVsZW1lbnQpCiAgICBpZiBub3QgZ3VpRWxlbWVudCB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBsb2NhbCBhYnNvbHV0ZVBvc2l0aW9uID0gZ3VpRWxlbWVudC5BYnNvbHV0ZVBvc2l0aW9uCiAgICBsb2NhbCBhYnNvbHV0ZVNpemUgPSBndWlFbGVtZW50LkFic29sdXRlU2l6ZQogICAgbG9jYWwgdGFwWCA9IGFic29sdXRlUG9zaXRpb24uWCArIChhYnNvbHV0ZVNpemUuWCAvIDIpCiAgICBsb2NhbCB0YXBZID0gYWJzb2x1dGVQb3NpdGlvbi5ZICsgKGFic29sdXRlU2l6ZS5ZIC8gMikKCiAgICBsb2NhbCBzY3JlZW5TaXplID0gR3VpU2VydmljZTpHZXRTY3JlZW5SZXNvbHV0aW9uKCkKICAgIGlmIHRhcFggPCAwIG9yIHRhcFggPiBzY3JlZW5TaXplLlggb3IgdGFwWSA8IDAgb3IgdGFwWSA+IHNjcmVlblNpemUuWSB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRNb3VzZUJ1dHRvbkV2ZW50KHRhcFgsIHRhcFksIDAsIHRydWUsIGdhbWUsIDApCiAgICB0YXNrLndhaXQoMC4xKQogICAgVmlydHVhbElucHV0TWFuYWdlcjpTZW5kTW91c2VCdXR0b25FdmVudCh0YXBYLCB0YXBZLCAwLCBmYWxzZSwgZ2FtZSwgMCkKZW5kCgpsb2NhbCBmdW5jdGlvbiB0YXBTY3JlZW5DZW50ZXIoKQogICAgbG9jYWwgc2NyZWVuU2l6ZSA9IEd1aVNlcnZpY2U6R2V0U2NyZWVuUmVzb2x1dGlvbigpCiAgICBsb2NhbCBjZW50ZXJYID0gc2NyZWVuU2l6ZS5YIC8gMgogICAgbG9jYWwgY2VudGVyWSA9IHNjcmVlblNpemUuWSAvIDIKICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZE1vdXNlQnV0dG9uRXZlbnQoY2VudGVyWCwgY2VudGVyWSwgMCwgdHJ1ZSwgZ2FtZSwgMCkKICAgIHRhc2sud2FpdCgwLjEpCiAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRNb3VzZUJ1dHRvbkV2ZW50KGNlbnRlclgsIGNlbnRlclksIDAsIGZhbHNlLCBnYW1lLCAwKQplbmQKCgpsb2NhbCBzdWNjZXNzLCBOZXQgPSBwY2FsbChmdW5jdGlvbigpCiAgICByZXR1cm4gcmVxdWlyZShSZXBsaWNhdGVkU3RvcmFnZS5Nb2R1bGVzLk5ldCkKZW5kKQppZiBub3Qgc3VjY2VzcyB0aGVuCiAgICB3YXJuKCJGYWlsZWQgdG8gbG9hZCBSZXBsaWNhdGVkU3RvcmFnZS5Nb2R1bGVzLk5ldDoiLCBOZXQpCiAgICByZXR1cm4KZW5kCgpsb2NhbCBkcmFnb25IdW50ZXIKaWYgbm90IE5ldC5SZW1vdGVGdW5jdGlvbiBvciB0eXBlKE5ldC5SZW1vdGVGdW5jdGlvbikgfj0gImZ1bmN0aW9uIiB0aGVuCiAgICBkcmFnb25IdW50ZXIgPSBSZXBsaWNhdGVkU3RvcmFnZS5Nb2R1bGVzLk5ldDpGaW5kRmlyc3RDaGlsZCgiUkYvRHJhZ29uSHVudGVyIikKICAgIGlmIG5vdCBkcmFnb25IdW50ZXIgdGhlbgogICAgICAgIGxvY2FsIHBvc3NpYmxlRm9sZGVycyA9IHsiVXRpbCIsICJSZW1vdGVzIiwgIlJ1bWJsZVYyIiwgIkFzc2V0cyIsICJDb21tb24iLCAiRlgifQogICAgICAgIGZvciBfLCBmb2xkZXJOYW1lIGluIGlwYWlycyhwb3NzaWJsZUZvbGRlcnMpIGRvCiAgICAgICAgICAgIGxvY2FsIGZvbGRlciA9IFJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKGZvbGRlck5hbWUpCiAgICAgICAgICAgIGlmIGZvbGRlciBhbmQgZm9sZGVyOkZpbmRGaXJzdENoaWxkKCJSRi9EcmFnb25IdW50ZXIiKSB0aGVuCiAgICAgICAgICAgICAgICBkcmFnb25IdW50ZXIgPSBmb2xkZXI6RmluZEZpcnN0Q2hpbGQoIlJGL0RyYWdvbkh1bnRlciIpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgbm90IGRyYWdvbkh1bnRlciB0aGVuCiAgICAgICAgd2FybigiUkYvRHJhZ29uSHVudGVyIG5vdCBmb3VuZCBpbiBhbnkgZm9sZGVyIikKICAgICAgICBsb2NhbCBjb21tRiA9IFJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfCiAgICAgICAgaWYgY29tbUYgdGhlbgogICAgICAgICAgICBsb2NhbCBzdWNjZXNzLCBxdWVzdFN0YXR1cyA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHJldHVybiBjb21tRjpJbnZva2VTZXJ2ZXIoIkNoZWNrUXVlc3QiLCAiRHJhZ29uSHVudGVyIikKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgICAgIHJldHVybgogICAgZW5kCmVsc2UKICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKE5ldC5SZW1vdGVGdW5jdGlvbiwgIkRyYWdvbkh1bnRlciIpCiAgICBpZiBzdWNjZXNzIGFuZCByZXN1bHQgdGhlbgogICAgICAgIGRyYWdvbkh1bnRlciA9IHJlc3VsdAogICAgZWxzZQogICAgICAgIGRyYWdvbkh1bnRlciA9IFJlcGxpY2F0ZWRTdG9yYWdlLk1vZHVsZXMuTmV0OkZpbmRGaXJzdENoaWxkKCJSRi9EcmFnb25IdW50ZXIiKQogICAgICAgIGlmIG5vdCBkcmFnb25IdW50ZXIgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgIGVuZAplbmQKCmlmIG5vdCBkcmFnb25IdW50ZXIgb3Igbm90IGRyYWdvbkh1bnRlcjpJc0EoIlJlbW90ZUZ1bmN0aW9uIikgdGhlbgogICAgd2FybigiZHJhZ29uSHVudGVyIGlzIG5vdCBhIHZhbGlkIFJlbW90ZUZ1bmN0aW9uOiIsIGRyYWdvbkh1bnRlcikKICAgIHJldHVybgplbmQKCmxvY2FsIGZ1bmN0aW9uIGNoZWNrVGFza0NvbXBsZXRlZCgpCiAgICBmb3IgXywgdiBpbiBpcGFpcnMoUGxheWVyR3VpLk5vdGlmaWNhdGlvbnM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2OklzQSgiVGV4dExhYmVsIikgYW5kIHYuVGV4dDpmaW5kKCJUYXNrIGNvbXBsZXRlZCEiKSB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBmYWxzZQplbmQKICAgIApsb2NhbCBmdW5jdGlvbiBzdWJtaXRRdWVzdCgpCiAgICB0b1RhcmdldEQoZHJhZ29uSHVudGVyTlBDUG9zLCB0cnVlKQogICAgdGFzay53YWl0KDMpCgogICAgbG9jYWwgY2hhcmFjdGVyID0gd2FpdEZvckNoYXJhY3RlcigpCiAgICBsb2NhbCByb290UGFydCA9IGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CiAgICBsb2NhbCBkaXN0YW5jZSA9IGRyYWdvbkh1bnRlck5QQyBhbmQgZHJhZ29uSHVudGVyTlBDOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICBhbmQgKHJvb3RQYXJ0LlBvc2l0aW9uIC0gZHJhZ29uSHVudGVyTlBDLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgIG9yIChyb290UGFydC5Qb3NpdGlvbiAtIGRyYWdvbkh1bnRlck5QQ1Bvcy5Qb3NpdGlvbikuTWFnbml0dWRlCgogICAgaWYgZGlzdGFuY2UgPiAxMCB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICB0YXBTY3JlZW5DZW50ZXIoKQogICAgdGFzay53YWl0KDEpCgogICAgbG9jYWwgZGlhbG9ndWUgPSBQbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIk1haW4iKSBhbmQgUGxheWVyR3VpLk1haW46RmluZEZpcnN0Q2hpbGQoIkRpYWxvZ3VlIikKICAgIGxvY2FsIG9wdGlvbjEgPSBkaWFsb2d1ZSBhbmQgZGlhbG9ndWU6RmluZEZpcnN0Q2hpbGQoIk9wdGlvbjEiKQogICAgbG9jYWwgb3B0aW9uMVRleHRMYWJlbCA9IG9wdGlvbjEgYW5kIG9wdGlvbjE6RmluZEZpcnN0Q2hpbGQoIlRleHRMYWJlbCIpCgogICAgaWYgb3B0aW9uMVRleHRMYWJlbCBhbmQgKG9wdGlvbjFUZXh0TGFiZWwuVGV4dCA9PSAiU3VibWl0IiBvciBvcHRpb24xVGV4dExhYmVsLlRleHQgPT0gIkNsYWltIikgdGhlbgogICAgICAgIHRhcFNjcmVlbkF0R3VpRWxlbWVudChvcHRpb24xKQogICAgICAgIHJldHVybiB0cnVlCiAgICBlbmQKICAgIHJldHVybiBmYWxzZQplbmQKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgIF9HLmRyYWdvbmh1bnRlcnF1ZXN0IHRoZW4gICAgIAoKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSB3YWl0Rm9yQ2hhcmFjdGVyKCkKICAgICAgICBsb2NhbCByb290UGFydCA9IGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CgogICAgICAgIGlmIGNoZWNrVGFza0NvbXBsZXRlZCgpIHRoZW4KICAgICAgICAgICAgdGFza0NvbXBsZXRlZCA9IHRydWUKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IGlzUXVlc3RBY3RpdmUgdGhlbgogICAgICAgICAgICBsb2NhbCBzdWNjZXNzLCBxdWVzdFN0YXR1cyA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHJldHVybiBkcmFnb25IdW50ZXI6SW52b2tlU2VydmVyKHtDb250ZXh0ID0gIkNoZWNrIn0pCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGlmIHN1Y2Nlc3MgYW5kIHR5cGUocXVlc3RTdGF0dXMpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgcXVlc3ROYW1lID0gcXVlc3RTdGF0dXMuVGV4dCBvciBxdWVzdFN0YXR1c1siVGV4dCJdCiAgICAgICAgICAgICAgICBpZiBxdWVzdE5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgIF9HLkN1cnJlbnRRdWVzdCA9IHF1ZXN0TmFtZQogICAgICAgICAgICAgICAgICAgIGlzUXVlc3RBY3RpdmUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgdGFza0NvbXBsZXRlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgY2hlY2sgPSB0cnVlCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX0cuQ3VycmVudFF1ZXN0ID0gbmlsCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgd2FybigiRmFpbGVkIHRvIGNoZWNrIHF1ZXN0OiIsIHF1ZXN0U3RhdHVzKQogICAgICAgICAgICAgICAgX0cuQ3VycmVudFF1ZXN0ID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgX0cuQ3VycmVudFF1ZXN0IHRoZW4KICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSBkcmFnb25IdW50ZXJOUEMgYW5kIGRyYWdvbkh1bnRlck5QQzpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBhbmQgKHJvb3RQYXJ0LlBvc2l0aW9uIC0gZHJhZ29uSHVudGVyTlBDLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgb3IgKHJvb3RQYXJ0LlBvc2l0aW9uIC0gZHJhZ29uSHVudGVyTlBDUG9zLlBvc2l0aW9uKS5NYWduaXR1ZGUKCiAgICAgICAgICAgIGlmIGRpc3RhbmNlID4gMTAgdGhlbgogICAgICAgICAgICAgICAgdG9UYXJnZXREKGRyYWdvbkh1bnRlck5QQ1BvcywgdHJ1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBkaWFsb2d1ZSA9IFBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiTWFpbiIpIGFuZCBQbGF5ZXJHdWkuTWFpbjpGaW5kRmlyc3RDaGlsZCgiRGlhbG9ndWUiKQogICAgICAgICAgICBsb2NhbCBvcHRpb24xID0gZGlhbG9ndWUgYW5kIGRpYWxvZ3VlOkZpbmRGaXJzdENoaWxkKCJPcHRpb24xIikKICAgICAgICAgICAgbG9jYWwgb3B0aW9uMVRleHRMYWJlbCA9IG9wdGlvbjEgYW5kIG9wdGlvbjE6RmluZEZpcnN0Q2hpbGQoIlRleHRMYWJlbCIpCgogICAgICAgICAgICBpZiBub3QgZGlhbG9ndWUgb3Igbm90IGRpYWxvZ3VlLlZpc2libGUgdGhlbgogICAgICAgICAgICAgICAgaWYgY2hlY2sgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhcFNjcmVlbkNlbnRlcigpCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICBkaWFsb2d1ZSA9IFBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiTWFpbiIpIGFuZCBQbGF5ZXJHdWkuTWFpbjpGaW5kRmlyc3RDaGlsZCgiRGlhbG9ndWUiKQogICAgICAgICAgICAgICAgICAgIG9wdGlvbjEgPSBkaWFsb2d1ZSBhbmQgZGlhbG9ndWU6RmluZEZpcnN0Q2hpbGQoIk9wdGlvbjEiKQogICAgICAgICAgICAgICAgICAgIG9wdGlvbjFUZXh0TGFiZWwgPSBvcHRpb24xIGFuZCBvcHRpb24xOkZpbmRGaXJzdENoaWxkKCJUZXh0TGFiZWwiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2VpZiBvcHRpb24xVGV4dExhYmVsIGFuZCBkaWFsb2d1ZS5WaXNpYmxlIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIG9wdGlvblRleHQgPSBvcHRpb24xVGV4dExhYmVsLlRleHQKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2UKCiAgICAgICAgICAgICAgICBpZiAob3B0aW9uVGV4dCA9PSAiSHVudCIgb3Igb3B0aW9uVGV4dCA9PSAiU3VyZSIpIGFuZCBvcHRpb24xVGV4dExhYmVsLlZpc2libGUgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHN1Y2Nlc3MsIGVyciA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgR3VpU2VydmljZS5TZWxlY3RlZE9iamVjdCA9IG9wdGlvbjEKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgaWYgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5SZXR1cm4sIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwgRW51bS5LZXlDb2RlLlJldHVybiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIEd1aVNlcnZpY2UuU2VsZWN0ZWRPYmplY3QgPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgdGFwU2NyZWVuQ2VudGVyKCkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcFNjcmVlbkF0R3VpRWxlbWVudChvcHRpb24xKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBfRy5DdXJyZW50UXVlc3QgdGhlbgogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5EaWFsb2d1ZS5WaXNpYmxlIHRoZW4gCiAgICAgICAgICAgICAgICB0YXBTY3JlZW5DZW50ZXIoKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIGxvY2FsIHF1ZXN0VGV4dCA9IHRvc3RyaW5nKF9HLkN1cnJlbnRRdWVzdCk6bG93ZXIoKQogICAgICAgICAgICBpZiBxdWVzdFRleHQ6ZmluZCgidmVub21vdXMiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB2ZW5vbW91c1BvcyA9IENGcmFtZS5uZXcoNDg3OS45MTk5MiwgMTA5My42ODg5NiwgMTEwNC4wMDgwNiwgMC45NDM3OTU0NDMsIDAsIDAuMzMwNTMwMTM3LCAwLCAxLCAwLCAtMC4zMzA1MzAxMzcsIDAsIDAuOTQzNzk1NDQzKQogICAgICAgICAgICAgICAgdG9UYXJnZXREKHZlbm9tb3VzUG9zKQoKICAgICAgICAgICAgICAgIGxvY2FsIGVuZW1pZXNLaWxsZWQgPSAwCiAgICAgICAgICAgICAgICBmb3IgXywgZW5lbXkgaW4gaXBhaXJzKFdvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgZW5lbXkuTmFtZTpsb3dlcigpOmZpbmQoInZlbm9tb3VzIikgYW5kIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBlbmVteS5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIgPSB3YWl0Rm9yQ2hhcmFjdGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0RChlbmVteS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIE1ldGhvZEZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcmluZ01vYiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShMb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZW5lbXkuUGFyZW50IG9yIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIHRhc2tDb21wbGV0ZWQgb3IgY2hlY2tUYXNrQ29tcGxldGVkKCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5lbWllc0tpbGxlZCA9IGVuZW1pZXNLaWxsZWQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVuZW1pZXNLaWxsZWQgPj0gMyBvciB0YXNrQ29tcGxldGVkIG9yIGNoZWNrVGFza0NvbXBsZXRlZCgpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLkN1cnJlbnRRdWVzdCA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNRdWVzdEFjdGl2ZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrQ29tcGxldGVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdFF1ZXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlaWYgcXVlc3RUZXh0OmZpbmQoImRlc3Ryb3kgMTAgdHJlZXMiKSB0aGVuCgogICAgICAgICAgICAgICAgbG9jYWwgcG9zaXRpb24xID0gQ0ZyYW1lLm5ldyg1MjM3LjAxNTYyLCAxMDA0LjEzMTk2LCA0MzAuODQxOTgsIDAuNTYwNzgzMzg2LCAxLjMzMDY4NzEyZS0wOCwgLTAuODI3OTYyNTc3LCAtMS4xMTkzODQ1OWUtMDgsIDEsIDguNDkwMTc2NTZlLTA5LCAwLjgyNzk2MjU3NywgNC41MDY5MzUyN2UtMDksIDAuNTYwNzgzMzg2KQogICAgICAgICAgICAgICAgbG9jYWwgcG9zaXRpb24yID0gQ0ZyYW1lLm5ldyg1MzQ1LjQ4Nzc5LCAxMDA0LjEzMTk2LCAzNTcuNTExMjYxLCAtMC40NTI1NDQ5NTcsIDYuNTI3MTA2NjhlLTA4LCAwLjg5MTc0MTU3NCwgLTIuNDcwMDU2NjllLTA4LCAxLCAtOC41NzMwMTk5OGUtMDgsIC0wLjg5MTc0MTU3NCwgLTYuMDgyMzI5NjZlLTA4LCAtMC40NTI1NDQ5NTcpCgogICAgICAgICAgICAgICAgbG9jYWwgY3VycmVudFRhcmdldCA9IHBvc2l0aW9uMQogICAgICAgICAgICAgICAgbG9jYWwgaXNNb3Zpbmd0b1RhcmdldGl0aW9uMSA9IHRydWUKCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoMCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuZHJhZ29uaHVudGVycXVlc3QgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0dG9UYXJnZXQxID0gKHJvb3RQYXJ0LlBvc2l0aW9uIC0gcG9zaXRpb24xLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0dG9UYXJnZXQyID0gKHJvb3RQYXJ0LlBvc2l0aW9uIC0gcG9zaXRpb24yLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICBpZiBkaXN0dG9UYXJnZXQxID49IDIwIGFuZCBkaXN0dG9UYXJnZXQyID49IDIwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXREKGN1cnJlbnRUYXJnZXQpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXN0dG9UYXJnZXQxIDw9IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBBbGxXZWFwb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuVXNlc2tpbGwgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpc01vdmluZ3RvVGFyZ2V0aXRpb24xIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VGFyZ2V0ID0gcG9zaXRpb24yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNNb3Zpbmd0b1RhcmdldGl0aW9uMSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXREKGN1cnJlbnRUYXJnZXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGRpc3R0b1RhcmdldDIgPD0gNSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcEFsbFdlYXBvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5Vc2Vza2lsbCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpc01vdmluZ3RvVGFyZ2V0aXRpb24xIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VGFyZ2V0ID0gcG9zaXRpb24xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNNb3Zpbmd0b1RhcmdldGl0aW9uMSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1RhcmdldEQoY3VycmVudFRhcmdldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgdGFza0NvbXBsZXRlZCBvciBjaGVja1Rhc2tDb21wbGV0ZWQoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLkN1cnJlbnRRdWVzdCA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICBfRy5Vc2Vza2lsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUXVlc3RBY3RpdmUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrQ29tcGxldGVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0UXVlc3QoKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlaWYgcXVlc3RUZXh0OmZpbmQoImh5ZHJhIGVuZm9yY2VycyIpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGVuZm9yY2VQb3MgPSBDRnJhbWUubmV3KDQ1NDcuMTE1MjMsIDEwMDMuMTAxOTksIDMzNC4xOTUwMDcsIDAuMzg4ODEwNDU2LCAtMCwgLTAuOTIxMzE3OTM1LCAwLCAxLCAtMCwgMC45MjEzMTc5MzUsIDAsIDAuMzg4ODEwNDU2KQogICAgICAgICAgICAgICAgdG9UYXJnZXREKGVuZm9yY2VQb3MpCgogICAgICAgICAgICAgICAgbG9jYWwgZW5lbWllc0tpbGxlZCA9IDAKICAgICAgICAgICAgICAgIGZvciBfLCBlbmVteSBpbiBpcGFpcnMoV29ya3NwYWNlLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBlbmVteS5OYW1lOmxvd2VyKCk6ZmluZCgiaHlkcmEgZW5mb3JjZXIiKSBhbmQgZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJhY3RlciA9IHdhaXRGb3JDaGFyYWN0ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXREKGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKF9HLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KExvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBlbmVteS5QYXJlbnQgb3IgZW5lbXkuSHVtYW5vaWQuSGVhbHRoIDw9IDAgb3IgdGFza0NvbXBsZXRlZCBvciBjaGVja1Rhc2tDb21wbGV0ZWQoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmVtaWVzS2lsbGVkID0gZW5lbWllc0tpbGxlZCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZW5lbWllc0tpbGxlZCA+PSAzIG9yIHRhc2tDb21wbGV0ZWQgb3IgY2hlY2tUYXNrQ29tcGxldGVkKCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuQ3VycmVudFF1ZXN0ID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1F1ZXN0QWN0aXZlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tDb21wbGV0ZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0UXVlc3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX0cuQ3VycmVudFF1ZXN0ID0gbmlsCiAgICAgICAgICAgICAgICBpc1F1ZXN0QWN0aXZlID0gZmFsc2UKICAgICAgICAgICAgICAgIHRhc2tDb21wbGV0ZWQgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgZW5kCiAgICBzdG9wTW92ZW1lbnQoKQplbmQpCgpwYWdlMTY6VG9nZ2xlKCJBdXRvIENvbGxldEVtYmVyRmxhbWVcbuC4reC4reC5guC4leC5ieC5gOC4geC5h+C4muC4peC4ueC4geC5hOC4nyIsIF9HLkF1dG9FbWJlciwgZnVuY3Rpb24odmFsdWUpCiAgICAgICAgX0cuQXV0b0VtYmVyID0gdmFsdWUKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9FbWJlciBkbyB3YWl0KCkKICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkVtYmVyVGVtcGxhdGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSB3b3Jrc3BhY2UuRW1iZXJUZW1wbGF0ZS5QYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCnBhZ2UxNjpCdXR0b24oIkNyYWZ0IFZvbGNhbmljIE1hZ25ldFxu4LiE4Lij4Liy4Lif4LiX4LmM4LiV4Liw4LmA4LiB4Li14Lii4LiHIixmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpOkludm9rZVNlcnZlcigiQ3JhZnRJdGVtIiwiQ3JhZnQiLCJWb2xjYW5pYyBNYWduZXQiKQplbmQpCnBhZ2UxNjpTZXBlcmF0b3IoIlZvY2Fsbm8v4Lig4Li54LmA4LiC4Liy4LmE4LifIikKIC0tIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4geC4lCBQcm94aW1pdHlQcm9tcHQKbG9jYWwgZnVuY3Rpb24gZmlyZVByb3hpbWl0eVByb21wdChwcm9tcHQpCiAgICBpZiBwcm9tcHQgYW5kIHByb21wdDpJc0EoIlByb3hpbWl0eVByb21wdCIpIHRoZW4KICAgICAgICBpZiBub3QgcHJvbXB0LkVuYWJsZWQgdGhlbgogICAgICAgICAgICB3YXJuKCJQcm94aW1pdHlQcm9tcHQg4LiW4Li54LiB4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZIikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZW5kCiAgICAgICAgcHJvbXB0OklucHV0SG9sZEJlZ2luKCkKICAgICAgICB0YXNrLndhaXQocHJvbXB0LkhvbGREdXJhdGlvbikKICAgICAgICBwcm9tcHQ6SW5wdXRIb2xkRW5kKCkKICAgICAgICBwcmludCgi4LiB4LiUIFByb3hpbWl0eVByb21wdCDguKrguLPguYDguKPguYfguIgiKQogICAgICAgIHJldHVybiB0cnVlCiAgICBlbHNlCiAgICAgICAgd2Fybigi4LmE4Lih4LmI4Lie4LiaIFByb3hpbWl0eVByb21wdCDguKvguKPguLfguK3guYTguKHguYjguJbguLnguIHguJXguYnguK3guIciKQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCmVuZAoKLS0g4Liq4Lij4LmJ4Liy4LiH4Lib4Li44LmI4Lih4LmD4LiZIFVJIOC4quC4s+C4q+C4o+C4seC4muC5gOC4m+C4tOC4lC/guJvguLTguJTguJ/guLHguIfguIHguYzguIrguLHguJkgQXV0byBWb2xjYW5vIElzbGFuZApwYWdlMTY6VG9nZ2xlKCJBdXRvIFZvbGNhbm8gSXNsYW5kXG7guK3guK3guYLguJXguYnguYDguIHguLLguLDguKDguLnguYDguILguLLguYTguJ8iLCBfRy52b2xjYW5vUm9ja3MsIGZ1bmN0aW9uKHZhbHVlKQogICAgX0cudm9sY2Fub1JvY2tzID0gdmFsdWUKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgICAgICBpZiBfRy52b2xjYW5vUm9ja3MgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBpc0ZpZ2h0aW5nID0gZmFsc2UKICAgICAgICAgICAgICAgIGxvY2FsIHZvbGNhbm9Sb2Nrc0ZvbGRlciA9IHdvcmtzcGFjZS5NYXAuUHJlaGlzdG9yaWNJc2xhbmQuQ29yZTpGaW5kRmlyc3RDaGlsZCgiVm9sY2Fub1JvY2tzIikKICAgICAgICAgICAgICAgIGxvY2FsIGhhc0JyaWdodFJlZFJvY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgaWYgdm9sY2Fub1JvY2tzRm9sZGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh2b2xjYW5vUm9ja3NGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuTmFtZSA9PSAiUm9jayIgb3Igdi5OYW1lID09ICJ2b2xjYW5vcm9jayIpIGFuZCB2OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBicmlja0NvbG9yTmFtZSA9IHYuQnJpY2tDb2xvci5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByID0gbWF0aC5mbG9vcih2LkNvbG9yLlIgKiAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBnID0gbWF0aC5mbG9vcih2LkNvbG9yLkcgKiAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBiID0gbWF0aC5mbG9vcih2LkNvbG9yLkIgKiAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBtYXRlcmlhbCA9IHYuTWF0ZXJpYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyaWNrQ29sb3JOYW1lID09ICJCcmlnaHQgcmVkIiBhbmQgciA9PSAxODUgYW5kIGcgPT0gNTMgYW5kIGIgPT0gNTYgYW5kIG1hdGVyaWFsID09IEVudW0uTWF0ZXJpYWwuTmVvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzQnJpZ2h0UmVkUm9jayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGhhc0xhdmFHb2xlbSA9IGZhbHNlCiAgICAgICAgICAgICAgICBmb3IgXywgZW5lbXkgaW4gcGFpcnMod29ya3NwYWNlLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZChlbmVteS5OYW1lLCAiTGF2YSBHb2xlbSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaGFzTGF2YUdvbGVtID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBoYXNCcmlnaHRSZWRSb2NrIGFuZCBub3QgaGFzTGF2YUdvbGVtIGFuZCBub3QgaXNGaWdodGluZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuC5hOC4oeC5iOC4oeC4tSBWb2xjYW5vUm9ja3Mg4Liq4Li14LmB4LiU4LiHIOC5geC4peC4sCBMYXZhIEdvbGVtLCDguYTguJvguIHguJQgUHJveGltaXR5UHJvbXB0IikKICAgICAgICAgICAgICAgICAgICBsb2NhbCByZWxpY0NGcmFtZSA9IHJlbGljLldvcmxkUGl2b3QKICAgICAgICAgICAgICAgICAgICBsb2NhbCBvZmZzZXQgPSBDRnJhbWUubmV3KDAsIC01MCwgMzApCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmV3Q0ZyYW1lID0gcmVsaWNDRnJhbWUgKiBvZmZzZXQKICAgICAgICAgICAgICAgICAgICBodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IG5ld0NGcmFtZQogICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYWN0aXZhdGlvblByb21wdCA9IGNvcmU6RmluZEZpcnN0Q2hpbGQoIkFjdGl2YXRpb25Qcm9tcHQiKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHByb21wdCA9IGFjdGl2YXRpb25Qcm9tcHQgYW5kIGFjdGl2YXRpb25Qcm9tcHQ6RmluZEZpcnN0Q2hpbGQoIlByb3hpbWl0eVByb21wdCIpCiAgICAKICAgICAgICAgICAgICAgICAgICBpZiBwcm9tcHQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4Lie4LiaIFByb3hpbWl0eVByb21wdCwg4LiB4Liz4Lil4Lix4LiH4LiB4LiULi4uIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3VjY2VzcyA9IGZpcmVQcm94aW1pdHlQcm9tcHQocHJvbXB0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdWNjZXNzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLguKPguK3guYPguKvguYkgUHJveGltaXR5UHJvbXB0IOC4q+C4suC4ouC5hOC4myIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLCBFbnVtLktleUNvZGUuRSwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgcHJvbXB0LlBhcmVudCBvciBub3QgX0cudm9sY2Fub1JvY2tzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwgRW51bS5LZXlDb2RlLkUsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLCBFbnVtLktleUNvZGUuRSwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4Lit4Li14LmA4Lin4LiZ4LiV4LmM4LmA4Lij4Li04LmI4Lih4LmB4Lil4LmJ4LinIFByb3hpbWl0eVByb21wdCDguKvguLLguKLguYTguJsiKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm4oIuC5hOC4oeC5iOC4nuC4miBQcm94aW1pdHlQcm9tcHQiKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIC0tIOC4guC4seC5ieC4meC4leC4reC4meC4l+C4teC5iCAyOiDguKvguLIgVm9sY2Fub1JvY2tzICh2b2xjYW5vcm9jaykg4LiX4Li14LmI4LmA4Lib4LmH4LiZ4Liq4Li14LmB4LiU4LiHCiAgICAgICAgICAgICAgICBsb2NhbCBmb3VuZEJyaWdodFJlZFJvY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgaWYgdm9sY2Fub1JvY2tzRm9sZGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh2b2xjYW5vUm9ja3NGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9HLnZvbGNhbm9Sb2NrcyB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5OYW1lID09ICJSb2NrIiBvciB2Lk5hbWUgPT0gInZvbGNhbm9yb2NrIikgYW5kIHY6SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJyaWNrQ29sb3JOYW1lID0gdi5Ccmlja0NvbG9yLk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHIgPSBtYXRoLmZsb29yKHYuQ29sb3IuUiAqIDI1NSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGcgPSBtYXRoLmZsb29yKHYuQ29sb3IuRyAqIDI1NSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGIgPSBtYXRoLmZsb29yKHYuQ29sb3IuQiAqIDI1NSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG1hdGVyaWFsID0gdi5NYXRlcmlhbAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBicmlja0NvbG9yTmFtZSA9PSAiQnJpZ2h0IHJlZCIgYW5kIHIgPT0gMTg1IGFuZCBnID09IDUzIGFuZCBiID09IDU2IGFuZCBtYXRlcmlhbCA9PSBFbnVtLk1hdGVyaWFsLk5lb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kQnJpZ2h0UmVkUm9jayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0ZpZ2h0aW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLguJ7guJogdm9sY2Fub3JvY2sg4Liq4Li14LmB4LiU4LiHLCDguYDguKPguLTguYjguKHguJXguLUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvblNraWxsTWFzdGVyeURldmlsRnJ1aXQgPSB2LlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KHYuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAyMCwgMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwQWxsV2VhcG9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuVXNlc2tpbGwgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgdi5Ccmlja0NvbG9yLk5hbWUgfj0gIkJyaWdodCByZWQiIG9yIG5vdCB2LlBhcmVudCBvciBub3QgX0cudm9sY2Fub1JvY2tzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuVXNlc2tpbGwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRmlnaHRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLguJXguLUgdm9sY2Fub3JvY2sg4LmA4Liq4Lij4LmH4LiI4LmB4Lil4LmJ4LinIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayAtLSDguK3guK3guIHguIjguLLguIHguKXguLnguJvguYDguKHguLfguYjguK3guJXguLXguKvguLTguJnguYDguKrguKPguYfguIgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAtLSDguILguLHguYnguJnguJXguK3guJnguJfguLXguYggMzog4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li1IHZvbGNhbm9yb2NrIOC4quC4teC5geC4lOC4hyDguYPguKvguYnguKvguLIgTGF2YSBHb2xlbQogICAgICAgICAgICAgICAgaWYgbm90IGZvdW5kQnJpZ2h0UmVkUm9jayB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZm91bmRHb2xlbSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGVuZW15IGluIHBhaXJzKHdvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy52b2xjYW5vUm9ja3MgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoZW5lbXkuTmFtZSwgIkxhdmEgR29sZW0iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZEdvbGVtID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNGaWdodGluZyA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLguJ7guJogTGF2YSBHb2xlbSwg4LmA4Lij4Li04LmI4Lih4LiV4Li1IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVGFyZ2V0KGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogTWV0aG9kRmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihfRy5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnJpbmdNb2IgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFzdEF0dGFjayA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5Vc2Vza2lsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoODAsIDgwLCA4MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShwbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZW5lbXkuUGFyZW50IG9yIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIG5vdCBfRy52b2xjYW5vUm9ja3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyaW5nTW9iID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhc3RBdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNGaWdodGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4LiV4Li1IExhdmEgR29sZW0g4LmA4Liq4Lij4LmH4LiI4LmB4Lil4LmJ4LinIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIC0tIOC4reC4reC4geC4iOC4suC4geC4peC4ueC4m+C5gOC4oeC4t+C5iOC4reC4leC4tSBMYXZhIEdvbGVtIOC5gOC4quC4o+C5h+C4iAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZm91bmRHb2xlbSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLguYTguKHguYjguJ7guJogTGF2YSBHb2xlbSwg4Lij4LitIFZvbGNhbm9Sb2NrcyDguJXguYjguK3guYTguJsuLi4iKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHByaW50KCLguJvguLTguJQgQXV0byBWb2xjYW5vIElzbGFuZCIpCiAgICAgICAgICAgICAgICBfRy5Vc2Vza2lsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICBCcmluZ01vYiA9IGZhbHNlCiAgICAgICAgICAgICAgICBGYXN0QXR0YWNrID0gZmFsc2UKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKSAgICAKZW5kKQoKICAgICAgICAKcGFnZTE2OlRvZ2dsZSgiQXV0byBDb2xsZWN0IEJvbmVcbuC5gOC4geC5h+C4muC4geC4o+C4sOC4lOC4ueC4geC5hOC4lOC5guC4meC5gOC4quC4suC4o+C5jCIsZmFsc2UsZnVuY3Rpb24odmFsdWUpCiAgICBfRy5Db2xsZWN0Qm9uZSA9IHZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBfRy5Db2xsZWN0Qm9uZSB0aGVuCiAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkRpbm9Cb25lIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9UYXJnZXQodi5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDIsIDApKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnBhZ2UxNjpUb2dnbGUoIlRlbHBvcnQgVG8gTlBDIEZvc3NpbCBFeHBlcnRcbuC5gOC4l+C5gOC4peC4nuC4reC4o+C5jOC4leC5hOC4m+C4q+C4suC4leC4seC4p+C4peC4sOC4hOC4o+C4hOC4o+C4suC4n+C4guC4reC4hyIsZmFsc2UsZnVuY3Rpb24odmFsdWUpCiAgICBfRy5UbnBjID0gdmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIGlmIF9HLlRucGMgdGhlbgogICAgICAgICAgICBpZiB3b3Jrc3BhY2UuTWFwLlByZWhpc3RvcmljSXNsYW5kLkNvcmU6RmluZEZpcnN0Q2hpbGQoIkZvc3NpbEV4cGVydFNwYXduIikgdGhlbgogICAgICAgICAgICAgICAgdG9UYXJnZXQod29ya3NwYWNlLk1hcC5QcmVoaXN0b3JpY0lzbGFuZC5Db3JlLkZvc3NpbEV4cGVydFNwYXduLkNGcmFtZSAqIENGcmFtZS5uZXcoMCw1LDApKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpwYWdlMTE6U2VwZXJhdG9yKCJIYWtpLExlZ2VuZFN3b3JkL+C4ruC4suC4hOC4tCzguJTguLLguJrguYLguIvguYLguKUiKQpwYWdlMTE6VG9nZ2xlKCJBdXRvQnV5TGVnZW5kYXJ5U3dvcmRcbuC4reC4reC5guC4leC5ieC4i+C4t+C5ieC4reC4lOC4suC4muC5guC4i+C5guC4pSIsIF9HLkF1dG9CdXlMZWdlbmRhcnlTd29yZCwgZnVuY3Rpb24odmFsdWUpCiAgICBfRy5BdXRvQnV5TGVnZW5kYXJ5U3dvcmQgPSB2YWx1ZQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgX0cuQXV0b0J1eUxlZ2VuZGFyeVN3b3JkIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJMZWdlbmRhcnlTd29yZERlYWxlciIsICIxIikKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJMZWdlbmRhcnlTd29yZERlYWxlciIsICIyIikKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJMZWdlbmRhcnlTd29yZERlYWxlciIsICIzIikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkgCnBhZ2UxMTpUb2dnbGUoIkF1dG9CdXlMZWdlbmRhcnlTd29yZEhvcFxu4Lit4Lit4LmC4LiV4LmJ4LiL4Li34LmJ4Lit4LiU4Liy4Lia4LmC4LiL4LmC4Lil4Lii4LmJ4Liy4Lii4LiL4Li04LifIiwgX0cuU2V0dGluZ3MuQXV0b0J1eUxlZ2VuZGFyeVN3b3JkSG9wLCBmdW5jdGlvbih2YWx1ZSkKX0cuQXV0b0J1eUxlZ2VuZGFyeVN3b3JkSG9wID0gdmFsdWUKX0cuU2V0dGluZ3MuQXV0b0J1eUxlZ2VuZGFyeVN3b3JkSG9wID0gdmFsdWUKICAgIFNhdmVTZXR0aW5ncygpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBfRy5TZXR0aW5ncy5BdXRvQnV5TGVnZW5kYXJ5U3dvcmRIb3AgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkxlZ2VuZGFyeVN3b3JkRGVhbGVyIiwgIjEiKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkxlZ2VuZGFyeVN3b3JkRGVhbGVyIiwgIjIiKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkxlZ2VuZGFyeVN3b3JkRGVhbGVyIiwgIjMiKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLHtUaXRsZSA9ICJWZWN0b3JIdWIiLFRleHQgPSAiSG9wU2VydmVyLi4uIixJY29uID0gInJieGFzc2V0aWQ6Ly8xNjEyOTIzNTA1NCIsRHVyYXRpb24gPSA1fSkKICAgICAgICAgICAgICAgICAgICB3aGlsZSBfRy5BdXRvQnV5TGVnZW5kYXJ5U3dvcmRIb3AgZG8gdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICB3YWl0KDcpCiAgICAgICAgICAgICAgICAgICAgSG9wKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKcGFnZTExOlRvZ2dsZSgiQXV0b0J1eUVuY2hhbm1lbnRIYWtpXG7guK3guK3guYLguJXguYnguIvguLfguYnguK3guKrguLXguK7guLLguITguLQiLCB0cnVlLCBmdW5jdGlvbih2YWx1ZSkKICAgIF9HLkF1dG9CdXlFbmNoYW5tZW50SGFraSA9IHZhbHVlCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBfRy5BdXRvQnV5RW5jaGFubWVudEhha2kgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9ICJDb2xvcnNEZWFsZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBbMl0gPSAiMiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCnBhZ2UxMTpUb2dnbGUoIkF1dG9CdXlFbmNoYW5tZW50SGFraUhvcFxu4Lit4Lit4LmC4LiV4LmJ4LiL4Li34LmJ4Lit4Liq4Li14Liu4Liy4LiE4Li04Lii4LmJ4Liy4Lii4LmA4LiL4Li04LifIiwgX0cuU2V0dGluZ3MuQXV0b0J1eUVuY2hhbm1lbnRIYWtpSG9wLCBmdW5jdGlvbih2YWx1ZSkKX0cuQXV0b0J1eUVuY2hhbm1lbnRIYWtpSG9wID0gdmFsdWUKX0cuU2V0dGluZ3MuQXV0b0J1eUVuY2hhbm1lbnRIYWtpSG9wID0gdmFsdWUKU2F2ZVNldHRpbmdzKCkKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuU2V0dGluZ3MuQXV0b0J1eUVuY2hhbm1lbnRIYWtpSG9wIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gIkNvbG9yc0RlYWxlciIsCiAgICAgICAgICAgICAgICAgICAgWzJdID0gIjIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLHtUaXRsZSA9ICJWZWN0b3JIdWIiLFRleHQgPSAiSG9wU2VydmVyLi4uIixJY29uID0gInJieGFzc2V0aWQ6Ly8xNjEyOTIzNTA1NCIsRHVyYXRpb24gPSA1fSkKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgX0cuQXV0b0J1eUVuY2hhbm1lbnRIYWtpSG9wIGRvIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoNykKICAgICAgICAgICAgICAgICAgICAgICAgSG9wKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKcGFnZTExOlNlcGVyYXRvcigiRnJhZ21lbnQv4LmA4LiH4Li04LiZ4Lih4LmI4Lin4LiHIikKcGFnZTExOkJ1dHRvbigiUmVmdW5kIFN0YXQgWzIsNTAwRl1cbuC4o+C4teC4hOC5iOC4suC4quC5gOC4leC4leC4seC4qiBbMiw1MDAg4LmA4LiH4Li04LiZ4Lih4LmI4Lin4LiHXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQmxhY2tiZWFyZFJld2FyZCIsICJSZWZ1bmQiLCAiMSIpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJsYWNrYmVhcmRSZXdhcmQiLCAiUmVmdW5kIiwgIjIiKQplbmQpCnBhZ2UxMTpCdXR0b24oIlJlcm9sbCBSYWNlIFszLDAwMEZdXG7guKPguLXguYLguKPguKXguYDguJzguYjguLLguJ7guLHguJnguJjguLjguYwgWzMsMDAwIOC5gOC4h+C4tOC4meC4oeC5iOC4p+C4h10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJsYWNrYmVhcmRSZXdhcmQiLCAiUmVyb2xsIiwgIjEiKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCbGFja2JlYXJkUmV3YXJkIiwgIlJlcm9sbCIsICIyIikKZW5kKQpwYWdlMTE6U2VwZXJhdG9yKCJBYmlsaXRpZXNcbuC4l+C4seC4geC4qeC4sCIpCnBhZ2UxMTpCdXR0b24oIkhha2kgWzI1LDAwJF1cbuC4ruC4suC4hOC4tCBbMjUsMDAg4LmA4LiH4Li04LiZ4LmA4LiC4Li14Lii4LinXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5SGFraSIsICJCdXNvIikKZW5kKQpwYWdlMTE6QnV0dG9uKCJHZXBwbyBbMTAsMDAwJF1cbuC5gOC4lOC4tOC4meC4iuC4oeC4iOC4seC4meC4l+C4o+C5jCBbMTAsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUhha2kiLCAiR2VwcG8iKQplbmQpCnBhZ2UxMTpCdXR0b24oIlNvcnUgWzEwMCwwMDAkXVxu4LmC4LiL4LilIFsxMDAsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUhha2kiLCAiU29ydSIpCmVuZCkKcGFnZTExOkJ1dHRvbigiT2JzZXJ2YXRpb25IYWtpIFs3NTAsMDAwJF1cbuC4ruC4suC4hOC4tOC4quC4seC4h+C5gOC4geC4lSBbNzUwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJLZW5UYWxrIiwgIkJ1eSIpCmVuZCkKcGFnZTExOlNlcGVyYXRvcigiRmlnaHRpbmcgU3R5bGVcbuC4l+C4seC4geC4qeC4sOC4geC4suC4o+C4leC5iOC4reC4quC4ueC5iSIpCnBhZ2UxMTpCdXR0b24oIkJsYWNrIExlZyBbMTUwLDAwMCRdXG7guILguLLguJTguLMgWzE1MCwwMDAg4LmA4LiH4Li04LiZ4LmA4LiC4Li14Lii4LinXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5QmxhY2tMZWciKQplbmQpCnBhZ2UxMTpCdXR0b24oIkVsZWN0cm8gWzUwMCwwMDAkXVxu4Lir4Lih4Lix4LiU4Liq4Liy4Lii4Lif4LmJ4LiyIFs1MDAsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUVsZWN0cm8iKQplbmQpCnBhZ2UxMTpCdXR0b24oIkZpc2htYW4gS2FyYXRlIFs3NTAsMDAwJF1cbuC4q+C4oeC4seC4lOC4oeC4meC4uOC4qeC4ouC5jOC5gOC4h+C4t+C4reC4gSBbNzUwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlGaXNobWFuS2FyYXRlIikKZW5kKQpwYWdlMTE6QnV0dG9uKCJEcmFnb24gQ2xhdyBbMSw1MDBGXVxu4Lir4Lih4Lix4LiU4Lih4Lix4LiH4LiB4LijIFsxLDUwMCDguYDguIfguLTguJnguKHguYjguKfguIddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCbGFja2JlYXJkUmV3YXJkIiwgIkRyYWdvbkNsYXciLCAiMSIpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJsYWNrYmVhcmRSZXdhcmQiLCAiRHJhZ29uQ2xhdyIsICIyIikKZW5kKQpwYWdlMTE6QnV0dG9uKCJTdXBlcmh1bWFuIFszLDAwMCwwMDBdXG7guIrguLjguJvguYDguJvguK3guKPguK7guLTguKfguYHguKHguJkgWzMsMDAwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlTdXBlcmh1bWFuIikKZW5kKQpwYWdlMTE6QnV0dG9uKCJEZWF0aCBTdGVwIFsyLDUwMCwwMDAvNSwwMDBGXVxu4LiC4Liy4LiU4Liz4LiC4Lix4LmJ4LiZ4Liq4Lit4LiHIFsyLDUwMCwwMDAg4LmA4LiH4Li04LiZ4LmA4LiC4Li14Lii4LinLzUsMDAwIOC5gOC4h+C4tOC4meC4oeC5iOC4p+C4h10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eURlYXRoU3RlcCIpCmVuZCkKcGFnZTExOkJ1dHRvbigiU2hhcmttYW4gS2FyYXRlIFsyLDUwMCwwMDAvNSwwMDBGXVxu4Lir4Lih4Lix4LiU4Lih4LiZ4Li44Lip4Lii4LmM4LmA4LiH4Li34Lit4LiB4LiC4Lix4LmJ4LiZ4Liq4Lit4LiHIFsyLDUwMCwwMDAg4LmA4LiH4Li04LiZ4LmA4LiC4Li14Lii4LinLzUsMDAwIOC5gOC4h+C4tOC4meC4oeC5iOC4p+C4h10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eVNoYXJrbWFuS2FyYXRlIiwgdHJ1ZSkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5U2hhcmttYW5LYXJhdGUiKQplbmQpCnBhZ2UxMTpCdXR0b24oIkVsZWN0cmljIENsYXcgWzMsMDAwLDAwMC81LDAwMEZdXG7guKvguKHguLHguJTguKrguLLguKLguJ/guYnguLLguILguLHguYnguJnguKrguK3guIcgWzMsMDAwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKcvNSwwMDAg4LmA4LiH4Li04LiZ4Lih4LmI4Lin4LiHXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RWxlY3RyaWNDbGF3IiwgdHJ1ZSkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RWxlY3RyaWNDbGF3IikKZW5kKQpwYWdlMTE6QnV0dG9uKCJEcmFnb24gVGFsb24gWzMsMDAwLDAwMC81LDAwMEZdXG7guKvguKHguLHguJTguKHguLHguIfguIHguKPguILguLHguYnguJnguKrguK3guIcgWzMsMDAwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKcvNSwwMDAg4LmA4LiH4Li04LiZ4Lih4LmI4Lin4LiHXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RHJhZ29uVGFsb24iLCB0cnVlKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEcmFnb25UYWxvbiIpCmVuZCkKcGFnZTExOkJ1dHRvbigiR29kaHVtYW4gWzUsMDAwLDAwMC81LDAwMEZdXG7guIrguLjguJvguYDguJvguK3guKPguK7guLTguKfguYHguKHguJnguILguLHguYnguJnguKrguK3guIcgWzUsMDAwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKcvNSwwMDAg4LmA4LiH4Li04LiZ4Lih4LmI4Lin4LiHXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5R29kaHVtYW4iLCB0cnVlKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlHb2RodW1hbiIpCmVuZCkKcGFnZTExOkJ1dHRvbigiU2FuZ3VpbmVBcnQgWzUsMDAwLDAwMC81LDAwMEZdXG7guKvguKHguLHguJTguYHguKfguKHguYTguJ7guKPguYwgWzUsMDAwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKcvNSwwMDAg4LmA4LiH4Li04LiZ4Lih4LmI4Lin4LiHXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5U2FuZ3VpbmVBcnQiLCB0cnVlKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlTYW5ndWluZUFydCIpCmVuZCkKcGFnZTExOlNlcGVyYXRvcigiV2VhcG9uXG7guK3guLLguKfguLjguJgiKQpwYWdlMTE6QnV0dG9uKCJLYXRhbmEgWzEsMDAwXVxu4LiE4Liy4LiV4Liy4LiZ4LiwIFsxLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlJdGVtIiwgIkthdGFuYSIpCmVuZCkKcGFnZTExOkJ1dHRvbigiQ3V0bGFzcyBbMSwwMDBdXG7guITguLHguJXguKXguLLguKogWzEsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUl0ZW0iLCAiQ3V0bGFzcyIpCmVuZCkKcGFnZTExOkJ1dHRvbigiRHVlbCBLYXRhbmEgWzEyLDAwMF1cbuC4hOC4suC4leC4suC4meC4sOC4hOC4ueC5iCBbMTIsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUl0ZW0iLCAiRHVlbCBLYXRhbmEiKQplbmQpCnBhZ2UxMTpCdXR0b24oIklyb24gTWFjZSBbMjUsMDAwXVxu4LiB4Lij4Liw4Lia4Lit4LiHIFsyNSwwMDAg4LmA4LiH4Li04LiZ4LmA4LiC4Li14Lii4LinXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5SXRlbSIsICJJcm9uIE1hY2UiKQplbmQpCnBhZ2UxMTpCdXR0b24oIlBpcGUgWzEwMCwwMDBdXG7guJfguYjguK3guIvguLLguYLguJrguYkgWzEwMCwwMDAg4LmA4LiH4Li04LiZ4LmA4LiC4Li14Lii4LinXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5SXRlbSIsICJQaXBlIikKZW5kKQpwYWdlMTE6QnV0dG9uKCJUcmlwbGUgS2F0YW5hIFs2MCwwMDBdXG7guITguLLguJXguLLguJnguLDguKrguLLguKHguYDguKXguYjguKEgWzYwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlJdGVtIiwgIlRyaXBsZSBLYXRhbmEiKQplbmQpCnBhZ2UxMTpCdXR0b24oIkR1YWwtSGVhZGVkIEJsYWRlIFs0MDAsMDAwXVxu4LiX4Lin4LiZ4Liq4Lit4LiH4LiU4LmJ4Liy4LiZIFs0MDAsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUl0ZW0iLCAiRHVhbC1IZWFkZWQgQmxhZGUiKQplbmQpCnBhZ2UxMTpCdXR0b24oIkJpc2VudG8gWzEsMDAwLDAwMF1cbuC4l+C4p+C4meC4guC4meC4suC4lOC5g+C4q+C4jeC5iCBbMSwwMDAsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUl0ZW0iLCAiQmlzZW50byIpCmVuZCkKcGFnZTExOkJ1dHRvbigiU291bCBDYW5lIFs3NTAsMDAwXVxu4LmE4Lih4LmJ4LmA4LiX4LmJ4Liy4Lia4Lij4Li54LmK4LiEIFs3NTAsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUl0ZW0iLCAiU291bCBDYW5lIikKZW5kKQpwYWdlMTE6U2VwZXJhdG9yKCJHdW5cbuC4m+C4t+C4mSIpCnBhZ2UxMTpCdXR0b24oIlNsaW5nc2hvdCBbNSwwMDBdXG7guKvguJnguLHguIfguKrguJXguLTguYrguIEgWzUsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUl0ZW0iLCAiU2xpbmdzaG90IikKZW5kKQpwYWdlMTE6QnV0dG9uKCJNdXNrZXQgWzgsMDAwXVxu4Lib4Li34LiZ4LmE4Lih4LmJ4LiU4LmJ4Liy4Lih4Lii4Liy4LinIFs4LDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlJdGVtIiwgIk11c2tldCIpCmVuZCkKcGFnZTExOkJ1dHRvbigiRmxpbnRsb2NrIFsxMCw1MDBdXG7guJvguLfguJnguYDguKvguKXguYfguIHguJTguYnguLLguKHguKrguLHguYnguJkgWzEwLDUwMCDguYDguIfguLTguJnguYDguILguLXguKLguKddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlJdGVtIiwgIkZsaW50bG9jayIpCmVuZCkKcGFnZTExOkJ1dHRvbigiUmVmaW5lZCBGbGludGxvY2sgWzY1LDAwMF1cbuC4m+C4t+C4meC5gOC4q+C4peC5h+C4geC4lOC5ieC4suC4oeC4ouC4suC4pyBbNjUsMDAwXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5SXRlbSIsICJSZWZpbmVkIEZsaW50bG9jayIpCmVuZCkKcGFnZTExOkJ1dHRvbigiQ2Fubm9uIFsxMDAsMDAwXVxu4Lib4Li34LiZ4LmD4Lir4LiN4LmIIFsxMDAsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUl0ZW0iLCAiQ2Fubm9uIikKZW5kKQpwYWdlMTE6QnV0dG9uKCJLYWJ1Y2hhIFsxNTAwRl1cbuC4q+C4meC4seC4h+C4quC4leC4tOC5iuC4geC4guC4meC4suC4lOC5g+C4q+C4jeC5iCBbMTUwMCDguYDguIfguLTguJnguKHguYjguKfguIddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCbGFja2JlYXJkUmV3YXJkIiwgIlNsaW5nc2hvdCIsICIxIikKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQmxhY2tiZWFyZFJld2FyZCIsICJTbGluZ3Nob3QiLCAiMiIpCmVuZCkKcGFnZTExOlNlcGVyYXRvcigiQWNjZXNzb3J5XG7guILguK3guIfguYHguJXguYjguIfguIHguLLguKIiKQpwYWdlMTE6QnV0dG9uKCJCbGFjayBDYXBlIFs1MCwwMDBdXG7guJzguYnguLLguITguKXguLjguKHguKrguLXguJTguLMgWzUwLDAwMCDguYDguIfguLTguJnguYDguILguLXguKLguKddIiwgZnVuY3Rpb24oKQpnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlJdGVtIiwgIkJsYWNrIENhcGUiKQplbmQpCnBhZ2UxMTpCdXR0b24oIlRvZW1vIFJpbmcgWzUwMCwwMDBdXG7guIHguKXguK3guIfguYDguK3guYDguJnguKUgWzUwMCwwMDAg4LmA4LiH4Li04LiZ4LmA4LiC4Li14Lii4LinXSIsIGZ1bmN0aW9uKCkKZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5SXRlbSIsICJUb21vZSBSaW5nIikKZW5kKQpwYWdlMTE6QnV0dG9uKCJTd29yZHNtYW4gSGF0IFsxNTAsMDAwXVxu4Lir4Lih4Lin4LiB4LiZ4Lix4LiB4LiU4Liy4LiaIFsxNTAsMDAwIOC5gOC4h+C4tOC4meC5gOC4guC4teC4ouC4p10iLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUl0ZW0iLCAiU3dvcmRzbWFuIEhhdCIpCmVuZCkKCnBhZ2UxMjpTZXBlcmF0b3IoIlRlYW0v4LiX4Li14LihIikKcGFnZTEyOkJ1dHRvbigiSm9pbiBQaXJhdGVzIFRlYW1cbuC5gOC4guC5ieC4suC4o+C5iOC4p+C4oeC4l+C4teC4oeC5guC4iOC4o+C4quC4peC4seC4lCIsIGZ1bmN0aW9uKCkKICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlNldFRlYW0iLCAiUGlyYXRlcyIpCmVuZCkKCnBhZ2UxMjpCdXR0b24oIkpvaW4gTWFyaW5lcyBUZWFtXG7guYDguILguYnguLLguKPguYjguKfguKHguJfguLXguKHguJfguKvguLLguKPguYDguKPguLfguK0iLCBmdW5jdGlvbigpCiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTZXRUZWFtIiwgIk1hcmluZXMiKQplbmQpCiAgICAgICAgCnBhZ2UxMjpTZXBlcmF0b3IoIlNlcnZlci/guYDguIvguLTguJ/guYDguKfguK3guKPguYwiKQpsb2NhbCBUUFMgPSBnYW1lOkdldFNlcnZpY2UoIlRlbGVwb3J0U2VydmljZSIpCmxvY2FsIExQID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKCnBhZ2UxMjpUZXh0Ym94KCJKb2JJRFxu4LiI4LmH4Lit4Lia4LmE4Lit4LiU4Li1IiwiIixmdW5jdGlvbih4KQpKb2JJZF9UZXh0Ym94ID0geAplbmQpCnBhZ2UxMjpCdXR0b24oIkpvaW4gSm9iSURcbuC5gOC4guC5ieC4suC4o+C5iOC4p+C4oeC4iOC5h+C4reC4muC5hOC4reC4lOC4tSIsIGZ1bmN0aW9uKCkKICAgIFRQUzpUZWxlcG9ydFRvUGxhY2VJbnN0YW5jZShnYW1lLlBsYWNlSWQsIEpvYklkX1RleHRib3gsIExQKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIse1RpdGxlID0gIlZlY3Rvckh1YiIsVGV4dCA9ICJTdWNjZXNzIEpvYklEIFBsZWFzZSBXYWl0IixJY29uID0gInJieGFzc2V0aWQ6Ly8xNjEyOTIzNTA1NCIsRHVyYXRpb24gPSAzfSkgCmVuZCkKCnBhZ2UxMjpCdXR0b24oIkNvcHkgSm9iSURcbuC4geC5h+C4reC4m+C4m+C4teC5ieC4iOC5h+C4reC4muC5hOC4reC4lOC4tSIsZnVuY3Rpb24oKQogICAgc2V0Y2xpcGJvYXJkKGdhbWUuSm9iSWQpCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIix7VGl0bGUgPSAiVmVjdG9ySHViIixUZXh0ID0gIlN1Y2Nlc3MgQ29weSBKb2JJRCIsSWNvbiA9ICJyYnhhc3NldGlkOi8vMTYxMjkyMzUwNTQiLER1cmF0aW9uID0gM30pICAgCmVuZCkKcGFnZTEyOkJ1dHRvbigiSm9pblNlcnZlciBIb3BcbuC5gOC4guC5ieC4suC5gOC4i+C4tOC4n+C4hOC4meC5gOC4ouC4reC4sCIsIGZ1bmN0aW9uKCkKICAgIHJlcGVhdCB3YWl0KCkgdW50aWwgZ2FtZTpJc0xvYWRlZCgpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICBsb2NhbCBIdHRwU2VydmljZSwgVFBTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlICJIdHRwU2VydmljZSIsIGdhbWU6R2V0U2VydmljZSAiVGVsZXBvcnRTZXJ2aWNlIjsKICAgICAgICBsb2NhbCBPdGhlclNlcnZlcnMgPSBIdHRwU2VydmljZTpKU09ORGVjb2RlKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9nYW1lcy5yb2Jsb3guY29tL3YxL2dhbWVzLyIgLi4KICAgICAgICAgICAgZ2FtZS5QbGFjZUlkIC4uICIvc2VydmVycy9QdWJsaWM/c29ydE9yZGVyPUFzYyZsaW1pdD0xMDAiKSkKICAgICAgICBmdW5jdGlvbiBqb2luTmV3KCkKICAgICAgICAgICAgaWYgbm90IGlzZmlsZSgnc2VydmVycy5zc3MnKSB0aGVuCiAgICAgICAgICAgICAgICB3cml0ZWZpbGUoJ3NlcnZlcnMuc3NzJywgSHR0cFNlcnZpY2U6SlNPTkVuY29kZSh7fSkpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCBkb250Sm9pbiA9IHJlYWRmaWxlKCdzZXJ2ZXJzLnNzcycpCiAgICAgICAgICAgIGRvbnRKb2luID0gSHR0cFNlcnZpY2U6SlNPTkRlY29kZShkb250Sm9pbikKCiAgICAgICAgICAgIGZvciBJbmRleCwgU2VydmVyIGluIG5leHQsIE90aGVyU2VydmVyc1siZGF0YSJdIGRvCiAgICAgICAgICAgICAgICBpZiBTZXJ2ZXIgfj0gZ2FtZS5Kb2JJZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaiA9IHRydWUKICAgICAgICAgICAgICAgICAgICBmb3IgYSwgYyBpbiBwYWlycyhkb250Sm9pbikgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYyA9PSBTZXJ2ZXIuaWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGogdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoZG9udEpvaW4sIFNlcnZlclsiaWQiXSkKICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVmaWxlKCJzZXJ2ZXJzLnNzcyIsIEh0dHBTZXJ2aWNlOkpTT05FbmNvZGUoZG9udEpvaW4pKQogICAgICAgICAgICAgICAgICAgICAgICB3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNlcnZlclsnaWQnXQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgIGxvY2FsIHNlcnZlciA9IGpvaW5OZXcoKQogICAgaWYgbm90IHNlcnZlciB0aGVuCiAgICAgICAgd3JpdGVmaWxlKCJzZXJ2ZXJzLnNzcyIsIEh0dHBTZXJ2aWNlOkpTT05FbmNvZGUoe30pKQogICAgICAgIGxvY2FsIHNlcnZlciA9IGpvaW5OZXcoKQogICAgICAgIFRQU2VydmljZTpUZWxlcG9ydFRvUGxhY2VJbnN0YW5jZShnYW1lLlBsYWNlSWQsIHNlcnZlcikKICAgIGVsc2UKICAgICAgICBUUFNlcnZpY2U6VGVsZXBvcnRUb1BsYWNlSW5zdGFuY2UoZ2FtZS5QbGFjZUlkLCBzZXJ2ZXIpCiAgICBlbmQKZW5kKQpwYWdlMTI6QnV0dG9uKCJSZWpvaW5TZXJ2ZXJcbuC5gOC4guC5ieC4suC5gOC4i+C4tOC4n+C5gOC4lOC4tOC4oSIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIHRzID0gZ2FtZTpHZXRTZXJ2aWNlKCJUZWxlcG9ydFNlcnZpY2UiKQogICAgbG9jYWwgcCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgdHM6VGVsZXBvcnQoZ2FtZS5QbGFjZUlkLCBwKQplbmQpCnBhZ2UxMjpTZXBlcmF0b3IoIk90aGVyL+C4reC4t+C5iOC4meC5hiIpCnBhZ2UxMjpCdXR0b24oIkthaXR1biBDYXB0dXJlXG7guJbguYjguLLguKLguKDguLLguJ7guYTguIHguYjguJXguLHguJkiLCBmdW5jdGlvbigpCmthaXR1bmNhcCgpCmVuZCkKcGFnZTEyOkJ1dHRvbigiU2hvdyBTa2lsbERldmlsRnJ1aXNBd2FrZWRcbuC5geC4quC4lOC4h+C4quC4geC4tOC4peC4nOC4peC5hOC4oeC5ieC4m+C4teC4qOC4suC4iOC4leC4t+C5iOC4mSIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIGFyZ3MgPSB7CiAgICBbMV0gPSAiZ2V0QXdha2VuZWRBYmlsaXRpZXMiCiAgICB9CgogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uQXdha2VuaW5nVG9nZ2xlci5WaXNpYmxlID0gdHJ1ZQplbmQpCnBhZ2UxMjpCdXR0b24oIlNob3cgVGl0bGVzXG7guYHguKrguJTguIfguInguLLguKLguLIiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBhcmdzID0gewogICAgWzFdID0gImdldFRpdGxlcyIKICAgIH0KICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgZ2FtZS5QbGF5ZXJzLmxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlRpdGxlcy5WaXNpYmxlID0gdHJ1ZQplbmQpCnBhZ2UxMjpCdXR0b24oIlNob3cgQ29sb3JIYWtpXG7guYHguKrguJTguIfguKrguLXguK7guLLguITguLQiLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMubG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uQ29sb3JzLlZpc2libGUgPSB0cnVlCmVuZCkKZnVuY3Rpb24gRnVsbEJyaWdodCgpCnBjYWxsKGZ1bmN0aW9uKCkKbG9jYWwgbGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKbGlnaHRpbmcuQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCmxpZ2h0aW5nLkJyaWdodG5lc3MgPSAxCmxpZ2h0aW5nLkZvZ0VuZCA9IDFlMTAKZm9yIGksIHYgaW4gcGFpcnMobGlnaHRpbmc6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgIGlmCiAgICAgICAgdjpJc0EoIkJsb29tRWZmZWN0Iikgb3IgdjpJc0EoIkJsdXJFZmZlY3QiKSBvciB2OklzQSgiQ29sb3JDb3JyZWN0aW9uRWZmZWN0Iikgb3IgdjpJc0EoIlN1blJheXNFZmZlY3QiKQogICAgICAgIHRoZW4KICAgICAgICB2LkVuYWJsZWQgPSBmYWxzZQogICAgZW5kCmVuZApsaWdodGluZy5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIGxpZ2h0aW5nLkFtYmllbnQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgIGxpZ2h0aW5nLkJyaWdodG5lc3MgPSAxCiAgICAgICAgbGlnaHRpbmcuRm9nRW5kID0gMWUxMAogICAgZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgd2FpdCgpCiAgICAgICAgICAgIHVudGlsIGNoYXJhY3RlciB+PSBuaWwKICAgICAgICAgICAgaWYgbm90IGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0OkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlBvaW50TGlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBoZWFkbGlnaHQgPSBJbnN0YW5jZS5uZXcoIlBvaW50TGlnaHQiLCBjaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgIGhlYWRsaWdodC5CcmlnaHRuZXNzID0gMQogICAgICAgICAgICAgICAgaGVhZGxpZ2h0LlJhbmdlID0gNjAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKcmVwZWF0CiAgICB0YXNrLndhaXQoKQp1bnRpbCBnYW1lOklzTG9hZGVkKCkKd2FpdCg1KQpmb3IgaSwgdiBpbiBwYWlycyhnYW1lLkxpZ2h0aW5nOkdldENoaWxkcmVuKCkpIGRvCiAgICBpZiB2OklzQSgiIikgb3IgdjpJc0EoIlNreSIpIG9yIHY6SXNBKCJCbHVyRWZmZWN0Iikgb3IgdjpJc0EoIkJsb29tRWZmZWN0Iikgb3IgdjpJc0EoIlN1blJheXNFZmZlY3QiKSB0aGVuCiAgICAgICAgdjpEZXN0cm95KCkKICAgIGVuZAplbmQKICAgIGdhbWUuTGlnaHRpbmcuQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICBnYW1lLkxpZ2h0aW5nLkJyaWdodG5lc3MgPSAxCiAgICBnYW1lLkxpZ2h0aW5nLkNsb2NrVGltZSA9IDE0CiAgICBnYW1lLkxpZ2h0aW5nLkNvbG9yU2hpZnRfQm90dG9tID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgIGdhbWUuTGlnaHRpbmcuQ29sb3JTaGlmdF9Ub3AgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgZ2FtZS5MaWdodGluZy5FeHBvc3VyZUNvbXBlbnNhdGlvbiA9IDAKICAgIGdhbWUuTGlnaHRpbmcuRm9nQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgZ2FtZS5MaWdodGluZy5Gb2dFbmQgPSA5OTk5OTk5OTkKICAgIGdhbWUuTGlnaHRpbmcuR2VvZ3JhcGhpY0xhdGl0dWRlID0gNDEuNzMzCiAgICBnYW1lLkxpZ2h0aW5nLk91dGRvb3JBbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgIGdhbWUuTGlnaHRpbmcuR2xvYmFsU2hhZG93cyA9IHRydWUKICAgIGdhbWUuTGlnaHRpbmcuQ2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgIGdhbWUuTGlnaHRpbmcuQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICBnYW1lLkxpZ2h0aW5nLkJyaWdodG5lc3MgPSAxCiAgICBnYW1lLkxpZ2h0aW5nLkNsb2NrVGltZSA9IDE0CiAgICBnYW1lLkxpZ2h0aW5nLkNvbG9yU2hpZnRfQm90dG9tID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgIGdhbWUuTGlnaHRpbmcuQ29sb3JTaGlmdF9Ub3AgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgZ2FtZS5MaWdodGluZy5FeHBvc3VyZUNvbXBlbnNhdGlvbiA9IDAKICAgIGdhbWUuTGlnaHRpbmcuRm9nQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgZ2FtZS5MaWdodGluZy5Gb2dFbmQgPSA5OTk5OTk5OTkKICAgIGdhbWUuTGlnaHRpbmcuR2VvZ3JhcGhpY0xhdGl0dWRlID0gNDEuNzMzCiAgICBnYW1lLkxpZ2h0aW5nLk91dGRvb3JBbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgIGdhbWUuTGlnaHRpbmcuR2xvYmFsU2hhZG93cyA9IHRydWUKZW5kKQpnYW1lLkxpZ2h0aW5nLkRlc2NlbmRhbnRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKG9iaikKaWYgb2JqOklzQSgiIikgb3Igb2JqOklzQSgiU2t5Iikgb3Igb2JqOklzQSgiQmx1ckVmZmVjdCIpIG9yIG9iajpJc0EoIkJsb29tRWZmZWN0Iikgb3Igb2JqOklzQSgiU3VuUmF5c0VmZmVjdCIpIHRoZW4KICAgIG9iajpEZXN0cm95KCkKZW5kCmVuZCkKZW5kCnBhZ2UxMjpCdXR0b24oIkZ1bGxCcmlnaHRcbuC5geC4oeC4nuC4quC4p+C5iOC4suC4hyIsIGZ1bmN0aW9uKCkKICAgIEZ1bGxCcmlnaHQoKQplbmQpCnBhZ2UxMjpUb2dnbGUoIldhbGsgT24gV2F0ZXJcbuC5gOC4lOC4tOC4meC4muC4meC4meC5ieC4syIsZmFzbGUsZnVuY3Rpb24odmFsdWUpCiAgICBfRy5XYWxrV2F0ZXIgPSB2YWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5XYWxrV2F0ZXIgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXBbIldhdGVyQmFzZS1QbGFuZSJdLlNpemUgPSBWZWN0b3IzLm5ldygxMDAwLDExMiwxMDAwKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcFsiV2F0ZXJCYXNlLVBsYW5lIl0uU2l6ZSA9IFZlY3RvcjMubmV3KDEwMDAsODAsMTAwMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKX0cuQXV0b1Jlam9pbiA9IHRydWUKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBfRy5BdXRvUmVqb2luICB0aGVuCiAgICAgICAgICAgIF9HLkF1dG9SZWpvaW4gID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuUm9ibG94UHJvbXB0R3VpLnByb21wdE92ZXJsYXkuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICAgICAgICAgIGlmIGNoaWxkLk5hbWUgPT0gJ0Vycm9yUHJvbXB0JyBhbmQgY2hpbGQ6RmluZEZpcnN0Q2hpbGQoJ01lc3NhZ2VBcmVhJykgYW5kIGNoaWxkLk1lc3NhZ2VBcmVhOkZpbmRGaXJzdENoaWxkKCJFcnJvckZyYW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIik6VGVsZXBvcnQoZ2FtZS5QbGFjZUlkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClZlYygiPENvbG9yPUN5YW4+VmVjdG9yIEh1YihCRVRBKSBMb2FkaW5nIFN1Y2Nlc3M8Q29sb3I9Lz4iKSAgIA=='
local hcQjHBAmIyYT = apnvRXUtjxXs .. runjvdupAemE .. ifizXwpuctAu
local zdwutwMJnrJb = 8193
local PyCxkglfKuJy = 1674

-- Simple Base64 Decoder ที่ทำงานใน Roblox
local function simpleBase64Decode(data)
    local chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    local result = ""
    
    -- ทำความสะอาดข้อมูล
    data = data:gsub('[^' .. chars .. '=]', '')
    
    local function indexOf(str, char)
        for i = 1, #str do
            if str:sub(i, i) == char then
                return i - 1
            end
        end
        return -1
    end
    
    -- แปลง base64 โดยไม่ใช้ bit operations
    for i = 1, #data, 4 do
        local a = indexOf(chars, data:sub(i, i))
        local b = indexOf(chars, data:sub(i+1, i+1))
        local c = indexOf(chars, data:sub(i+2, i+2))
        local d = indexOf(chars, data:sub(i+3, i+3))
        
        if a >= 0 and b >= 0 then
            -- ใช้ math operations แทน bit operations
            local byte1 = (a * 4) + math.floor(b / 16)
            result = result .. string.char(byte1)
            
            if c >= 0 then
                local byte2 = ((b % 16) * 16) + math.floor(c / 4)
                result = result .. string.char(byte2)
                
                if d >= 0 then
                    local byte3 = ((c % 4) * 64) + d
                    result = result .. string.char(byte3)
                end
            end
        end
    end
    
    return result
end

-- ฟังก์ชันสำหรับ execute script
local function executeDecodedScript()
    print("🔄 กำลังถอดรหัสสคริปต์...")
    
    -- ได้ข้อมูลที่ encode แล้วจากตัวแปร obfuscated
    local encodedData = hcQjHBAmIyYT
    
    -- ถอดรหัส base64
    local originalScript = simpleBase64Decode(encodedData)
    
    print("✅ ถอดรหัสสำเร็จ!")
    print("📊 ขนาดสคริปต์: " .. #originalScript .. " characters")
    
    -- ตรวจสอบว่าได้สคริปต์ที่ถูกต้องหรือไม่
    if #originalScript > 0 and originalScript:find("print") then
        print("✅ สคริปต์ดูถูกต้อง")
        
        -- Execute สคริปต์ต้นฉบับ
        local success, result = pcall(function()
            local func, err = loadstring(originalScript)
            if func then
                return func()
            else
                error("Loadstring error: " .. tostring(err))
            end
        end)
        
        if success then
            print("🚀 Execute สคริปต์สำเร็จ!")
            return result
        else
            warn("❌ Execute ล้มเหลว: " .. tostring(result))
            print("📝 สคริปต์ที่ถอดรหัสได้ (100 ตัวอักษรแรก):")
            print(originalScript:sub(1, 100) .. "...")
            return nil
        end
    else
        warn("❌ สคริปต์ที่ถอดรหัสได้ผิดปกติ")
        print("📝 ข้อมูลที่ได้ (50 ตัวอักษรแรก):")
        print(originalScript:sub(1, 50) .. "...")
        return nil
    end
end

-- Debug mode: แสดงข้อมูลเพิ่มเติม
local DEBUG_MODE = false  -- เปลี่ยนเป็น true ถ้าต้องการ debug

if DEBUG_MODE then
    print("🐛 Debug Mode เปิดอยู่")
    print("📊 ข้อมูลที่ encode:")
    print("   ความยาว encoded data: " .. #hcQjHBAmIyYT)
    print("   ตัวอักษร 50 ตัวแรก: " .. hcQjHBAmIyYT:sub(1, 50))
end

-- เรียกใช้งานทันที
return executeDecodedScript()
