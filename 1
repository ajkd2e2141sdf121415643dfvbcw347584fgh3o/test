-- Services
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local StarterGui = game:GetService("StarterGui")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
local PlaceId = game.PlaceId
local CurrentJobId = game.JobId

-- ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤ delay ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
local RETRY_DELAY = 2  -- ‡∏•‡∏î‡∏à‡∏≤‡∏Å 5 ‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
local MAX_ATTEMPTS = 3 -- ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°

-- ‡πÄ‡∏Å‡πá‡∏ö history server id (‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà 50 servers ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
local JoinedServers = {}
pcall(function()
    local data = HttpService:JSONDecode(readfile("JoinedServers.json"))
    if typeof(data) == "table" and #data <= 50 then
        JoinedServers = data
    end
end)

local function SaveServers()
    -- ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà 50 servers ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    if #JoinedServers > 50 then
        local newList = {}
        for i = #JoinedServers - 49, #JoinedServers do
            table.insert(newList, JoinedServers[i])
        end
        JoinedServers = newList
    end
    writefile("JoinedServers.json", HttpService:JSONEncode(JoinedServers))
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Server Hop ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
local function QuickServerHop()
    local attempts = 0
    
    while attempts < MAX_ATTEMPTS do
        attempts = attempts + 1
        
        local success, servers = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(
                string.format("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Random&limit=50", PlaceId)
            ))
        end)
        
        if success and servers and servers.data then
            -- ‡∏´‡∏≤ server ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà server ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤
            for _, server in ipairs(servers.data) do
                local id = server.id
                if id ~= CurrentJobId and -- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà server ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                   server.playing > 1 and -- ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà
                   server.playing < server.maxPlayers - 2 and -- ‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°
                   not table.find(JoinedServers, id) then -- ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤
                    
                    table.insert(JoinedServers, id)
                    SaveServers()
                    
                    print("[Hop] Found server: " .. id .. " (" .. server.playing .. "/" .. server.maxPlayers .. ")")
                    TeleportService:TeleportToPlaceInstance(PlaceId, id, LocalPlayer)
                    return
                end
            end
            
            -- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ server ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
            print("[Hop] No suitable server found in attempt " .. attempts .. ". Retrying...")
            
        else
            warn("[Hop] Failed to fetch server list. Attempt " .. attempts .. "/" .. MAX_ATTEMPTS)
        end
        
        if attempts < MAX_ATTEMPTS then
            task.wait(RETRY_DELAY)
        end
    end
    
    -- ‡∏ñ‡πâ‡∏≤‡∏•‡∏≠‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (join server ‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠)
    print("[Hop] Using fallback method - joining any available server")
    pcall(function()
        TeleportService:Teleport(PlaceId, LocalPlayer)
    end)
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≠ Character (‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
local function getCharacter()
    local timeout = 3
    local start = tick()
    while not (LocalPlayer.Character and LocalPlayer.Character.Parent) do
        if tick() - start > timeout then
            warn("[Script] Character load timeout! Server hopping...")
            QuickServerHop()
            return
        end
        task.wait(0.1)
    end
    return LocalPlayer.Character
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≠ Humanoid
local function waitForHumanoid()
    local character = getCharacter()
    if character then
        return character:WaitForChild("Humanoid", 3)
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î GUI ‡∏Ç‡∏≠‡∏á Diamond (‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤ timeout)
local function getGuiObjects()
    local timeout = 3
    local start = tick()
    local pg
    while not pg do
        pg = LocalPlayer:FindFirstChild("PlayerGui")
        if tick() - start > timeout then
            warn("[Script] PlayerGui load timeout! Server hopping...")
            QuickServerHop()
            return
        end
        task.wait(0.1)
    end
    
    local interface = pg:WaitForChild("Interface", 3)
    local diamondCount = interface and interface:WaitForChild("DiamondCount", 3)
    local countLabel = diamondCount and diamondCount:WaitForChild("Count", 3)
    
    if not countLabel then
        warn("[Script] DiamondCount UI not found! Server hopping...")
        QuickServerHop()
        return
    end
    
    return countLabel
end

-- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
local humanoid = waitForHumanoid()
local countLabel = getGuiObjects()

-- Config (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ default)
getgenv().AutoFarm = getgenv().AutoFarm or false
getgenv().LockDiamondEnabled = getgenv().LockDiamondEnabled or true
getgenv().BuyClassSelect = getgenv().BuyClassSelect or true
getgenv().LockDiamond = getgenv().LockDiamond or 1000
getgenv().SelectClasses = getgenv().SelectClasses or {"Camper"}
getgenv().Webhookurl = getgenv().Webhookurl or ""
_G.FarmChest = _G.FarmChest or false

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö script ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß
local farmScriptLoaded = false

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
local function notify(title, text, duration)
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Icon = "rbxassetid://16129235054",
            Title = title,
            Text = text,
            Duration = duration or 3
        })
    end)
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á webhook
local function sendWebhook(message)
    if getgenv().Webhookurl and getgenv().Webhookurl ~= "" and getgenv().Webhookurl ~= "linkwebhook" then
        pcall(function()
            local data = {
                ["content"] = message,
                ["username"] = "Roblox Bot",
                ["avatar_url"] = "https://cdn.discordapp.com/attachments/your-avatar-url"
            }
            HttpService:PostAsync(getgenv().Webhookurl, HttpService:JSONEncode(data), Enum.HttpContentType.ApplicationJson)
        end)
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Place ID
local function isInLobby()
    return game.PlaceId == 79546208627805
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î Auto Farm Script
local function loadFarmScript()
    if not farmScriptLoaded and getgenv().AutoFarm then
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/7878wqz/sc1/refs/heads/main/99Dmh"))()
            farmScriptLoaded = true
            notify("Auto Farm", "Farm script loaded!", 3)
        end)
    end
end

-- handle respawn
LocalPlayer.CharacterAdded:Connect(function()
    humanoid = waitForHumanoid()
    countLabel = getGuiObjects()
    notify("Respawned", "Character and UI reloaded", 3)
    
    -- ‡πÇ‡∏´‡∏•‡∏î farm script ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á respawn ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
    farmScriptLoaded = false
    if getgenv().AutoFarm and not isInLobby() then
        task.wait(2) -- ‡∏£‡∏≠‡πÉ‡∏´‡πâ character ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        loadFarmScript()
    end
end)

-- Loop ‡∏´‡∏•‡∏±‡∏Å
spawn(function()
    while task.wait(1) do
        if getgenv().LockDiamondEnabled and countLabel then
            local diamondValue = tonumber(countLabel.Text) or 0
            local targetValue = tonumber(getgenv().LockDiamond) or 0
            local classNames = table.concat(getgenv().SelectClasses or {}, ", ") or "None"
            
            notify("Status", "‡πÄ‡∏û‡∏ä‡∏£: " .. diamondValue .. "/" .. targetValue .. " | ‡∏Ñ‡∏•‡∏≤‡∏™: " .. classNames, 2)
            
            if diamondValue >= targetValue then
                notify("Diamond Target Reached", "‡πÄ‡∏û‡∏ä‡∏£‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ...", 3)
                sendWebhook("üéØ **‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!** ‡πÄ‡∏û‡∏ä‡∏£: " .. diamondValue .. "/" .. targetValue .. " | ‡πÄ‡∏ß‡∏•‡∏≤: " .. os.date("%X"))
                
                if not isInLobby() then
                    pcall(function()
                        TeleportService:Teleport(79546208627805, LocalPlayer)
                    end)
                end
            else
                -- ‡πÇ‡∏´‡∏•‡∏î farm script ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà lobby
                if getgenv().AutoFarm and not isInLobby() then
                    loadFarmScript()
                end
            end
        end
    end
end)

-- Auto buy multiple classes in lobby
spawn(function()
    while task.wait() do
        if isInLobby() and getgenv().BuyClassSelect and getgenv().SelectClasses then
            for _, className in ipairs(getgenv().SelectClasses) do
                pcall(function()
                    game:GetService("ReplicatedStorage"):WaitForChild("RemoteEvents"):WaitForChild("RequestPurchaseClass"):FireServer(className)
                    notify("Buying Class", "‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏•‡∏≤‡∏™: " .. className, 2)
                    sendWebhook("üõí **‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏•‡∏≤‡∏™:** " .. className .. " | ‡πÄ‡∏ß‡∏•‡∏≤: " .. os.date("%X"))
                end)
                wait(1) -- ‡∏£‡∏≠ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏•‡∏≤‡∏™
            end
            wait(1) -- ‡∏£‡∏≠ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
        end
    end
end)

-- ‡πÇ‡∏´‡∏•‡∏î script ‡πÄ‡∏™‡∏£‡∏¥‡∏°
loadstring(game:HttpGet('https://raw.githubusercontent.com/7878wqz/sc1/refs/heads/main/h2'))()

print("‚úÖ Script loaded successfully!")
notify("Script Loaded", "Auto Farm System Ready!", 5)
